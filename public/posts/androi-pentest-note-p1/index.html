<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Android Pentest Note - quactv</title><meta name="Description" content="quactv blog"><meta property="og:title" content="Android Pentest Note" />
<meta property="og:description" content="Concept Decompile and compile Using Adb and Frida interact Android  Concept Structure  AndroidManifest file contains the application’s structure Res folder contains all the resources that the application needs to run , including user interface layout, icons, audio, etc. The most interesting files for us are the classes.dex files because they are the compiled java files. The .dex extension stands for Dalvik EXecutable. So we need to decompile these dex files to get the java classes." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/androi-pentest-note-p1/" /><meta property="og:image" content="http://example.org/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-21T18:17:00&#43;07:00" />
<meta property="article:modified_time" content="2021-07-21T18:17:00&#43;07:00" /><meta property="og:site_name" content="quactv blog" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://example.org/logo.png"/>

<meta name="twitter:title" content="Android Pentest Note"/>
<meta name="twitter:description" content="Concept Decompile and compile Using Adb and Frida interact Android  Concept Structure  AndroidManifest file contains the application’s structure Res folder contains all the resources that the application needs to run , including user interface layout, icons, audio, etc. The most interesting files for us are the classes.dex files because they are the compiled java files. The .dex extension stands for Dalvik EXecutable. So we need to decompile these dex files to get the java classes."/>
<meta name="application-name" content="quactv blog">
<meta name="apple-mobile-web-app-title" content="quactv blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/posts/androi-pentest-note-p1/" /><link rel="prev" href="http://example.org/posts/linux-backdoors/" /><link rel="next" href="http://example.org/posts/jwt-attack/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Android Pentest Note",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/posts\/androi-pentest-note-p1\/"
        },"genre": "posts","keywords": "Android","wordcount":  925 ,
        "url": "http:\/\/example.org\/posts\/androi-pentest-note-p1\/","datePublished": "2021-07-21T18:17:00+07:00","dateModified": "2021-07-21T18:17:00+07:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "quactv"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="quactv">&gt; root@quactv:~#</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/write-up/"> Write-up </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About me </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="quactv">&gt; root@quactv:~#</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/write-up/" title="">Write-up</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About me</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Android Pentest Note</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>quactv</a></span>&nbsp;<span class="post-category">included in <a href="/categories/offensive-security/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Offensive Security</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2021-07-21">2021-07-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;925 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#concept">Concept</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#decompile-and-compile">Decompile and compile</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#using-adb-and-frida-interact-android">Using Adb and Frida interact Android</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#refer">Refer</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><ul>
<li><a href="#concept" rel="">Concept</a></li>
<li><a href="#decompile-and-compile" rel="">Decompile and compile</a></li>
<li><a href="#using-adb-and-frida-interact-android" rel="">Using Adb and Frida interact Android</a></li>
</ul>
<h2 id="concept">Concept</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/1.png"
        data-srcset="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/1.png, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/1.png 1.5x, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/1.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/1.png"
        title="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/1.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/2.png"
        data-srcset="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/2.png, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/2.png 1.5x, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/2.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/2.png"
        title="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/2.png" /></p>
<h4 id="structure">Structure</h4>
<ul>
<li><strong>AndroidManifest file</strong> contains the application’s structure</li>
<li><strong>Res folder</strong> contains all the resources that the application needs to run , including user interface layout, icons, audio, etc.</li>
<li><strong>The most interesting files for us are the classes.dex files</strong> because they are the compiled java files. The .dex extension stands for Dalvik EXecutable. So we need to decompile these dex files to get the java classes.</li>
</ul>
<h4 id="tools">Tools</h4>
<ul>
<li><strong>Apktool</strong> : tool for reverse engineering Android apk files. In this case we are using to extract files from apk and rebuild.</li>
<li><strong>Keytool</strong> : Java tool for creating keys/certs, that comes with the JDK.</li>
<li><strong>Jarsigner</strong> : Java tool for signing JAR/APK files, that comes with the JDK.</li>
<li><strong>Zipalign</strong> : archive alignment tool, that comes with the Android SDK.</li>
<li><strong>JD-GUI</strong> : To view java code.</li>
<li><strong>dex2jar</strong> : Converts Android dex files to class/jar files.</li>
<li><strong>MobSF</strong> : Mobile Security Framework (MobSF) is an automated, all-in-one mobile application (Android/iOS/Windows) pen-testing.</li>
<li><strong>Adb</strong> : is a versatile command-line tool that lets you communicate with a device.</li>
<li><strong>Frida</strong> : Dynamic Binary Instrumentation tool.</li>
<li><strong>How to Frida work?</strong> : Frida is writing code directly in process memory. When you attach frida to a running application, frida on the background uses ptrace to hijack the thread. A bootstrapper populates this thread and starts a new one, connecting to the frida server that is running on the device and loads a dynamically generated library that has the frida agent along with our instrumentation code. This last part is where all the magic happens. The hijacked thread is being restored to its original state and resumes, then the process continues normally. (<a href="https://erev0s.com/blog/frida-code-snippets-for-android/)">https://erev0s.com/blog/frida-code-snippets-for-android/)</a>.</li>
<li><strong>APKLab</strong> : extension VSCode for apk (good).</li>
</ul>
<h2 id="decompile-and-compile">Decompile and compile</h2>
<h4 id="unpack-file-apk">Unpack file apk</h4>
<p><code>unzip application.apk</code></p>
<h4 id="to-decompile-an">To decompile an</h4>
<p><code>apktool d -r -s application.apk</code><br>
or<br>
<code>apktool d application.apk</code><br>
or<br>
<code>java -jar Bytecode-Viewer-2.10.12.jar -&gt; load apk file</code><br>
or<br>
<code>using extension ApkLap in Visual Studio Code</code><br>
or<br>
<code>using jadx</code> (<a href="https://github.com/skylot/jadx/releases/download/v1.2.0/jadx-gui-1.2.0-no-jre-win.exe">https://github.com/skylot/jadx/releases/download/v1.2.0/jadx-gui-1.2.0-no-jre-win.exe</a>)</p>
<h4 id="convert-the-dex-files-into-standard-class-files">Convert the Dex files into standard class files</h4>
<p><code>sh d2j-dex2jar.sh application/classes.dex </code><br>
(classes.dex have from unzip application)</p>
<h4 id="use-the-jd-java-decompiler-to-inspect-the-source">Use the JD (Java Decompiler) to inspect the source</h4>
<p><code>java -jar jd-gui.jar classes-dex2jar.jar</code><br>
or<br>
<code>java -jar recaf-2.20.1-J8-jar-with-dependencies.jar --input=classes-dex2jar.jar</code>\</p>
<ul>
<li>Once you have made your changes, you need to repack the APK. This will create a my_application.apkfile:</li>
</ul>
<h4 id="to-recompilebuild-the-apk">To recompile(build) the apk</h4>
<ul>
<li>After modify apk file (smili code,&hellip;) you can recompile apk app<br>
<code>apktool b -f -d application</code></li>
<li>or<br>
<code>using APKLap in VSCode (https://github.com/APKLab/APKLab)</code></li>
<li>After recompiling (building) the apk the new apk will be generated in Dist folder.(using apk tools)</li>
<li>New apk save in : Application -&gt; Dist -&gt;  application.apk</li>
<li>The APK must be signed before you run on your device.</li>
<li>Before signing an apk, create a key if you don’t have an existing one. If prompted for a password, create your own password.\</li>
<li><strong>To generate a key</strong><br>
<code>keytool -genkey -v -keystore my-release-key.keystore -alias alias_name  -keyalg RSA -keysize 2048 -validity 10000</code></li>
<li><strong>Sign the apk</strong><br>
<code>jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore my_application.apk alias_name</code></li>
<li><strong>Verify apk (Option)</strong><br>
<code>jarsigner -verify -verbose -certs my_application.apk</code></li>
<li>Finally, the apk must be aligned for optimal loading:<br>
<code>./zipalign -v 4 my_application.apk my_application-aligned.apk</code></li>
<li>You have a my_application-aligned.apk file, which you can install onto your device.</li>
</ul>
<h2 id="using-adb-and-frida-interact-android">Using Adb and Frida interact Android</h2>
<h4 id="adb">Adb</h4>
<ul>
<li><code>adb devices</code> : list devices</li>
<li><code>adb connect IP:Port</code> : connect to devices</li>
<li><code>adb shell</code> : spawn shell</li>
<li><code>adb root</code> : run with root user</li>
<li><code>adb backup -apk -shared com.android.insecurebankv2</code> (android:allowBackup=&ldquo;true&rdquo; in AndroidMainfest.xml) : backup apk file</li>
<li><code>cat backup.ab</code> | ( dd bs=24 count=0 skip=1; cat) | zlib-flate-uncompress &gt; backup.tar : read backup file</li>
</ul>
<h4 id="frida">Frida</h4>
<ul>
<li><code>wget https://github.com/frida/frida/releases/download/15.0.0/frida-inject-15.0.0-android-x86.xz</code> : download</li>
<li><code>adb push frida-server /data/local/tmp</code> : push Frida server to Androi</li>
<li><code>adb shell &quot;chmod 755 /data/local/tmp/frida-server&quot;</code>: set permission Frida binari</li>
<li><code>adb shell &quot;/data/local/tmp/frida-server&quot; &amp;</code> : run Frida-server in Android</li>
<li><code>Frida-ps -U</code> : list running process</li>
<li><code>Frida-ps -aU | grep -i &quot;name&quot;</code> : check process name</li>
</ul>
<h4 id="example-frida">Example Frida</h4>
<p><strong>Login bypass</strong></p>
<ul>
<li>APP : Sieve (download apk -&gt; adb install sieve.apk)</li>
<li>A function named “checkKeyResult”. If the boolean value is true, the application redirects the flow to loginSuccessful() function if false then to loginFailed(). 
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/3.png"
        data-srcset="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/3.png, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/3.png 1.5x, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/3.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/3.png"
        title="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/3.png" /></li>
<li>Frida has support for binding with multiple languages like Python,C,.NET and Swift. However, we are using python to demonstrate the bypass</li>
<li>Check process name : <code>frida-ps -aU | grep -i &quot;sieve&quot;</code></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">MainActivity</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;com.mwr.example.sieve.MainLoginActivity&#39;</span><span class="p">);</span> <span class="c1">//Obtain referrence of the Activity currently running
</span><span class="c1"></span>    <span class="nx">MainActivity</span><span class="p">.</span><span class="nx">checkKeyResult</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//Obtain reference of the function whcih needs to be called
</span><span class="c1"></span>        <span class="nx">send</span><span class="p">(</span><span class="s1">&#39;checkKeyResult&#39;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">checkKeyResult</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">//Calling the function and passing the boolean parameter as true
</span><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Done:&#39;</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">});</span>
</code></pre></div><ul>
<li>Run: <code>frida -U --no-pause -l bypass.js -f appname</code><br>
<strong>Check root bypass</strong></li>
<li>APP : bankinsecurev2 (download apk -&gt; adb install bankinsecurev2.apk)</li>
<li>The application uses two functions to check whether the device is rooted or not as shown below in the decompiled APK of the InsecureBank app: doesSUexist, doesSuperuserApkExist
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/5.png"
        data-srcset="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/5.png, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/5.png 1.5x, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/5.png 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/5.png"
        title="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/5.png" /></li>
<li>Script bypass:</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">MainActivity</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;com.android.insecurebankv2.PostLogin&#39;</span><span class="p">);</span>
    <span class="nx">MainActivity</span><span class="p">.</span><span class="nx">doesSUexist</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Done: doesSUexist&#39;</span><span class="p">);</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
	
	<span class="nx">MainActivity</span><span class="p">.</span><span class="nx">doesSuperuserApkExist</span><span class="p">.</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Done: doesSuperuserApkExist&#39;</span><span class="p">);</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">});</span>
</code></pre></div><ul>
<li>Running: <code>frida -U --no-pause -l bypass.js -f appname</code><br>
<strong>Real world</strong></li>
<li>Check emulator:<br>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/7.PNG"
        data-srcset="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/7.PNG, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/7.PNG 1.5x, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/7.PNG 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/7.PNG"
        title="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/7.PNG" /></li>
<li>In class StringUtil
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/9.PNG"
        data-srcset="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/9.PNG, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/9.PNG 1.5x, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/9.PNG 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/9.PNG"
        title="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/9.PNG" /></li>
<li>Check root:<br>
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/8.PNG"
        data-srcset="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/8.PNG, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/8.PNG 1.5x, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/8.PNG 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/8.PNG"
        title="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/8.PNG" /></li>
<li>In class RootUtil
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/10.PNG"
        data-srcset="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/10.PNG, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/10.PNG 1.5x, https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/10.PNG 2x"
        data-sizes="auto"
        alt="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/10.PNG"
        title="https://raw.githubusercontent.com/tranquac/Blog_Image/master/androi/10.PNG" /></li>
<li>Bypass check emulator and root (overload 2 method a() in StringUtil and a() in RootUtil):</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">Java</span><span class="p">.</span><span class="nx">perform</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nBypass emulator detection&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">StringUtil</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;package.name&#39;</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nHijacking a() function in StringUtil class&#39;</span><span class="p">);</span>
    <span class="nx">StringUtil</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;java.lang.String&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nInside the a() function&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nEmulator detection bypassed&#39;</span><span class="p">);</span>


    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nBypass root detection&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">RootUtil</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;package.name&#39;</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nHijacking a() function in RootUtil class&#39;</span><span class="p">);</span>
    <span class="nx">RootUtil</span><span class="p">.</span><span class="nx">a</span><span class="p">.</span><span class="nx">overload</span><span class="p">(</span><span class="s1">&#39;android.content.Context&#39;</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nInside the a() function&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;\nRoot detection bypassed&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><ul>
<li>Running: <code>frida -U --no-pause -l bypass.js -f appname</code></li>
</ul>
<h2 id="refer">Refer</h2>
<p><a href="https://frida.re/docs">https://frida.re/docs</a><br>
<a href="https://11x256.github.io/Frida-hooking-android-part-1/">https://11x256.github.io/Frida-hooking-android-part-1/</a><br>
<a href="https://11x256.github.io/Frida-hooking-android-part-2/">https://11x256.github.io/Frida-hooking-android-part-2/</a><br>
<a href="https://notsosecure.com/pentesting-android-apps-using-frida/">https://notsosecure.com/pentesting-android-apps-using-frida/</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-07-21</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://example.org/posts/androi-pentest-note-p1/" data-title="Android Pentest Note" data-via="quactv1" data-hashtags="Android"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://example.org/posts/androi-pentest-note-p1/" data-hashtag="Android"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://example.org/posts/androi-pentest-note-p1/" data-title="Android Pentest Note"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://example.org/posts/androi-pentest-note-p1/" data-title="Android Pentest Note"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://example.org/posts/androi-pentest-note-p1/" data-title="Android Pentest Note"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/android/">Android</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/linux-backdoors/" class="prev" rel="prev" title="Linux Backdoors"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Linux Backdoors</a>
            <a href="/posts/jwt-attack/" class="next" rel="next" title="JWT Attack">JWT Attack<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">quactv</a></span>&nbsp;|&nbsp;<span class="license">Infosec</span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp">Security</span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
